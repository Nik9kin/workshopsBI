/*! jQuery v1.11.0 | (c) 2005, 2014 jQuery Foundation, Inc. | jquery.org/license */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k="".trim,l={},m="1.11.0",n=function(a,b){return new n.fn.init(a,b)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function(a,b){return b.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:"",length:0,toArray:function(){return d.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:d.call(this)},pushStack:function(a){var b=n.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return n.each(this,a,b)},map:function(a){return this.pushStack(n.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||n.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(n.isPlainObject(c)||(b=n.isArray(c)))?(b?(b=!1,f=a&&n.isArray(a)?a:[]):f=a&&n.isPlainObject(a)?a:{},g[d]=n.extend(j,f,c)):void 0!==c&&(g[d]=c));return g},n.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===n.type(a)},isArray:Array.isArray||function(a){return"array"===n.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){return a-parseFloat(a)>=0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},isPlainObject:function(a){var b;if(!a||"object"!==n.type(a)||a.nodeType||n.isWindow(a))return!1;try{if(a.constructor&&!j.call(a,"constructor")&&!j.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}if(l.ownLast)for(b in a)return j.call(a,b);for(b in a);return void 0===b||j.call(a,b)},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?h[i.call(a)]||"object":typeof a},globalEval:function(b){b&&n.trim(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(p,"ms-").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,e=0,f=a.length,g=s(a);if(c){if(g){for(;f>e;e++)if(d=b.apply(a[e],c),d===!1)break}else for(e in a)if(d=b.apply(a[e],c),d===!1)break}else if(g){for(;f>e;e++)if(d=b.call(a[e],e,a[e]),d===!1)break}else for(e in a)if(d=b.call(a[e],e,a[e]),d===!1)break;return a},trim:k&&!k.call("\ufeff\xa0")?function(a){return null==a?"":k.call(a)}:function(a){return null==a?"":(a+"").replace(o,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?n.merge(c,"string"==typeof a?[a]:a):f.call(c,a)),c},inArray:function(a,b,c){var d;if(b){if(g)return g.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,b){var c=+b.length,d=0,e=a.length;while(c>d)a[e++]=b[d++];if(c!==c)while(void 0!==b[d])a[e++]=b[d++];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,f=0,g=a.length,h=s(a),i=[];if(h)for(;g>f;f++)d=b(a[f],f,c),null!=d&&i.push(d);else for(f in a)d=b(a[f],f,c),null!=d&&i.push(d);return e.apply([],i)},guid:1,proxy:function(a,b){var c,e,f;return"string"==typeof b&&(f=a[b],b=a,a=f),n.isFunction(a)?(c=d.call(arguments,2),e=function(){return a.apply(b||this,c.concat(d.call(arguments)))},e.guid=a.guid=a.guid||n.guid++,e):void 0},now:function(){return+new Date},support:l}),n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){h["[object "+b+"]"]=b.toLowerCase()});function s(a){var b=a.length,c=n.type(a);return"function"===c||n.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s="sizzle"+-new Date,t=a.document,u=0,v=0,w=eb(),x=eb(),y=eb(),z=function(a,b){return a===b&&(j=!0),0},A="undefined",B=1<<31,C={}.hasOwnProperty,D=[],E=D.pop,F=D.push,G=D.push,H=D.slice,I=D.indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},J="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",K="[\\x20\\t\\r\\n\\f]",L="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",M=L.replace("w","w#"),N="\\["+K+"*("+L+")"+K+"*(?:([*^$|!~]?=)"+K+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+M+")|)|)"+K+"*\\]",O=":("+L+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+N.replace(3,8)+")*)|.*)\\)|)",P=new RegExp("^"+K+"+|((?:^|[^\\\\])(?:\\\\.)*)"+K+"+$","g"),Q=new RegExp("^"+K+"*,"+K+"*"),R=new RegExp("^"+K+"*([>+~]|"+K+")"+K+"*"),S=new RegExp("="+K+"*([^\\]'\"]*?)"+K+"*\\]","g"),T=new RegExp(O),U=new RegExp("^"+M+"$"),V={ID:new RegExp("^#("+L+")"),CLASS:new RegExp("^\\.("+L+")"),TAG:new RegExp("^("+L.replace("w","w*")+")"),ATTR:new RegExp("^"+N),PSEUDO:new RegExp("^"+O),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+K+"*(even|odd|(([+-]|)(\\d*)n|)"+K+"*(?:([+-]|)"+K+"*(\\d+)|))"+K+"*\\)|)","i"),bool:new RegExp("^(?:"+J+")$","i"),needsContext:new RegExp("^"+K+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+K+"*((?:-\\d)?\\d*)"+K+"*\\)|)(?=[^-]|$)","i")},W=/^(?:input|select|textarea|button)$/i,X=/^h\d$/i,Y=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,$=/[+~]/,_=/'|\\/g,ab=new RegExp("\\\\([\\da-f]{1,6}"+K+"?|("+K+")|.)","ig"),bb=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)};try{G.apply(D=H.call(t.childNodes),t.childNodes),D[t.childNodes.length].nodeType}catch(cb){G={apply:D.length?function(a,b){F.apply(a,H.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function db(a,b,d,e){var f,g,h,i,j,m,p,q,u,v;if((b?b.ownerDocument||b:t)!==l&&k(b),b=b||l,d=d||[],!a||"string"!=typeof a)return d;if(1!==(i=b.nodeType)&&9!==i)return[];if(n&&!e){if(f=Z.exec(a))if(h=f[1]){if(9===i){if(g=b.getElementById(h),!g||!g.parentNode)return d;if(g.id===h)return d.push(g),d}else if(b.ownerDocument&&(g=b.ownerDocument.getElementById(h))&&r(b,g)&&g.id===h)return d.push(g),d}else{if(f[2])return G.apply(d,b.getElementsByTagName(a)),d;if((h=f[3])&&c.getElementsByClassName&&b.getElementsByClassName)return G.apply(d,b.getElementsByClassName(h)),d}if(c.qsa&&(!o||!o.test(a))){if(q=p=s,u=b,v=9===i&&a,1===i&&"object"!==b.nodeName.toLowerCase()){m=ob(a),(p=b.getAttribute("id"))?q=p.replace(_,"\\$&"):b.setAttribute("id",q),q="[id='"+q+"'] ",j=m.length;while(j--)m[j]=q+pb(m[j]);u=$.test(a)&&mb(b.parentNode)||b,v=m.join(",")}if(v)try{return G.apply(d,u.querySelectorAll(v)),d}catch(w){}finally{p||b.removeAttribute("id")}}}return xb(a.replace(P,"$1"),b,d,e)}function eb(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function fb(a){return a[s]=!0,a}function gb(a){var b=l.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function hb(a,b){var c=a.split("|"),e=a.length;while(e--)d.attrHandle[c[e]]=b}function ib(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||B)-(~a.sourceIndex||B);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function jb(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function kb(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function lb(a){return fb(function(b){return b=+b,fb(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function mb(a){return a&&typeof a.getElementsByTagName!==A&&a}c=db.support={},f=db.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},k=db.setDocument=function(a){var b,e=a?a.ownerDocument||a:t,g=e.defaultView;return e!==l&&9===e.nodeType&&e.documentElement?(l=e,m=e.documentElement,n=!f(e),g&&g!==g.top&&(g.addEventListener?g.addEventListener("unload",function(){k()},!1):g.attachEvent&&g.attachEvent("onunload",function(){k()})),c.attributes=gb(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=gb(function(a){return a.appendChild(e.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=Y.test(e.getElementsByClassName)&&gb(function(a){return a.innerHTML="<div class='a'></div><div class='a i'></div>",a.firstChild.className="i",2===a.getElementsByClassName("i").length}),c.getById=gb(function(a){return m.appendChild(a).id=s,!e.getElementsByName||!e.getElementsByName(s).length}),c.getById?(d.find.ID=function(a,b){if(typeof b.getElementById!==A&&n){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},d.filter.ID=function(a){var b=a.replace(ab,bb);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(ab,bb);return function(a){var c=typeof a.getAttributeNode!==A&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return typeof b.getElementsByTagName!==A?b.getElementsByTagName(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return typeof b.getElementsByClassName!==A&&n?b.getElementsByClassName(a):void 0},p=[],o=[],(c.qsa=Y.test(e.querySelectorAll))&&(gb(function(a){a.innerHTML="<select t=''><option selected=''></option></select>",a.querySelectorAll("[t^='']").length&&o.push("[*^$]="+K+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||o.push("\\["+K+"*(?:value|"+J+")"),a.querySelectorAll(":checked").length||o.push(":checked")}),gb(function(a){var b=e.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&o.push("name"+K+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||o.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),o.push(",.*:")})),(c.matchesSelector=Y.test(q=m.webkitMatchesSelector||m.mozMatchesSelector||m.oMatchesSelector||m.msMatchesSelector))&&gb(function(a){c.disconnectedMatch=q.call(a,"div"),q.call(a,"[s!='']:x"),p.push("!=",O)}),o=o.length&&new RegExp(o.join("|")),p=p.length&&new RegExp(p.join("|")),b=Y.test(m.compareDocumentPosition),r=b||Y.test(m.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},z=b?function(a,b){if(a===b)return j=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===e||a.ownerDocument===t&&r(t,a)?-1:b===e||b.ownerDocument===t&&r(t,b)?1:i?I.call(i,a)-I.call(i,b):0:4&d?-1:1)}:function(a,b){if(a===b)return j=!0,0;var c,d=0,f=a.parentNode,g=b.parentNode,h=[a],k=[b];if(!f||!g)return a===e?-1:b===e?1:f?-1:g?1:i?I.call(i,a)-I.call(i,b):0;if(f===g)return ib(a,b);c=a;while(c=c.parentNode)h.unshift(c);c=b;while(c=c.parentNode)k.unshift(c);while(h[d]===k[d])d++;return d?ib(h[d],k[d]):h[d]===t?-1:k[d]===t?1:0},e):l},db.matches=function(a,b){return db(a,null,null,b)},db.matchesSelector=function(a,b){if((a.ownerDocument||a)!==l&&k(a),b=b.replace(S,"='$1']"),!(!c.matchesSelector||!n||p&&p.test(b)||o&&o.test(b)))try{var d=q.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return db(b,l,null,[a]).length>0},db.contains=function(a,b){return(a.ownerDocument||a)!==l&&k(a),r(a,b)},db.attr=function(a,b){(a.ownerDocument||a)!==l&&k(a);var e=d.attrHandle[b.toLowerCase()],f=e&&C.call(d.attrHandle,b.toLowerCase())?e(a,b,!n):void 0;return void 0!==f?f:c.attributes||!n?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},db.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},db.uniqueSort=function(a){var b,d=[],e=0,f=0;if(j=!c.detectDuplicates,i=!c.sortStable&&a.slice(0),a.sort(z),j){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return i=null,a},e=db.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=db.selectors={cacheLength:50,createPseudo:fb,match:V,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ab,bb),a[3]=(a[4]||a[5]||"").replace(ab,bb),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||db.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&db.error(a[0]),a},PSEUDO:function(a){var b,c=!a[5]&&a[2];return V.CHILD.test(a[0])?null:(a[3]&&void 0!==a[4]?a[2]=a[4]:c&&T.test(c)&&(b=ob(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ab,bb).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=w[a+" "];return b||(b=new RegExp("(^|"+K+")"+a+"("+K+"|$)"))&&w(a,function(a){return b.test("string"==typeof a.className&&a.className||typeof a.getAttribute!==A&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=db.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),t=!i&&!h;if(q){if(f){while(p){l=b;while(l=l[p])if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&t){k=q[s]||(q[s]={}),j=k[a]||[],n=j[0]===u&&j[1],m=j[0]===u&&j[2],l=n&&q.childNodes[n];while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if(1===l.nodeType&&++m&&l===b){k[a]=[u,n,m];break}}else if(t&&(j=(b[s]||(b[s]={}))[a])&&j[0]===u)m=j[1];else while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if((h?l.nodeName.toLowerCase()===r:1===l.nodeType)&&++m&&(t&&((l[s]||(l[s]={}))[a]=[u,m]),l===b))break;return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||db.error("unsupported pseudo: "+a);return e[s]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?fb(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=I.call(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:fb(function(a){var b=[],c=[],d=g(a.replace(P,"$1"));return d[s]?fb(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:fb(function(a){return function(b){return db(a,b).length>0}}),contains:fb(function(a){return function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:fb(function(a){return U.test(a||"")||db.error("unsupported lang: "+a),a=a.replace(ab,bb).toLowerCase(),function(b){var c;do if(c=n?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===m},focus:function(a){return a===l.activeElement&&(!l.hasFocus||l.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return X.test(a.nodeName)},input:function(a){return W.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:lb(function(){return[0]}),last:lb(function(a,b){return[b-1]}),eq:lb(function(a,b,c){return[0>c?c+b:c]}),even:lb(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:lb(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:lb(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:lb(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=jb(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=kb(b);function nb(){}nb.prototype=d.filters=d.pseudos,d.setFilters=new nb;function ob(a,b){var c,e,f,g,h,i,j,k=x[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){(!c||(e=Q.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=R.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(P," ")}),h=h.slice(c.length));for(g in d.filter)!(e=V[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?db.error(a):x(a,i).slice(0)}function pb(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function qb(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=v++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[u,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(i=b[s]||(b[s]={}),(h=i[d])&&h[0]===u&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function rb(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function sb(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function tb(a,b,c,d,e,f){return d&&!d[s]&&(d=tb(d)),e&&!e[s]&&(e=tb(e,f)),fb(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||wb(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:sb(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=sb(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?I.call(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=sb(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):G.apply(g,r)})}function ub(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],i=g||d.relative[" "],j=g?1:0,k=qb(function(a){return a===b},i,!0),l=qb(function(a){return I.call(b,a)>-1},i,!0),m=[function(a,c,d){return!g&&(d||c!==h)||((b=c).nodeType?k(a,c,d):l(a,c,d))}];f>j;j++)if(c=d.relative[a[j].type])m=[qb(rb(m),c)];else{if(c=d.filter[a[j].type].apply(null,a[j].matches),c[s]){for(e=++j;f>e;e++)if(d.relative[a[e].type])break;return tb(j>1&&rb(m),j>1&&pb(a.slice(0,j-1).concat({value:" "===a[j-2].type?"*":""})).replace(P,"$1"),c,e>j&&ub(a.slice(j,e)),f>e&&ub(a=a.slice(e)),f>e&&pb(a))}m.push(c)}return rb(m)}function vb(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,i,j,k){var m,n,o,p=0,q="0",r=f&&[],s=[],t=h,v=f||e&&d.find.TAG("*",k),w=u+=null==t?1:Math.random()||.1,x=v.length;for(k&&(h=g!==l&&g);q!==x&&null!=(m=v[q]);q++){if(e&&m){n=0;while(o=a[n++])if(o(m,g,i)){j.push(m);break}k&&(u=w)}c&&((m=!o&&m)&&p--,f&&r.push(m))}if(p+=q,c&&q!==p){n=0;while(o=b[n++])o(r,s,g,i);if(f){if(p>0)while(q--)r[q]||s[q]||(s[q]=E.call(j));s=sb(s)}G.apply(j,s),k&&!f&&s.length>0&&p+b.length>1&&db.uniqueSort(j)}return k&&(u=w,h=t),r};return c?fb(f):f}g=db.compile=function(a,b){var c,d=[],e=[],f=y[a+" "];if(!f){b||(b=ob(a)),c=b.length;while(c--)f=ub(b[c]),f[s]?d.push(f):e.push(f);f=y(a,vb(e,d))}return f};function wb(a,b,c){for(var d=0,e=b.length;e>d;d++)db(a,b[d],c);return c}function xb(a,b,e,f){var h,i,j,k,l,m=ob(a);if(!f&&1===m.length){if(i=m[0]=m[0].slice(0),i.length>2&&"ID"===(j=i[0]).type&&c.getById&&9===b.nodeType&&n&&d.relative[i[1].type]){if(b=(d.find.ID(j.matches[0].replace(ab,bb),b)||[])[0],!b)return e;a=a.slice(i.shift().value.length)}h=V.needsContext.test(a)?0:i.length;while(h--){if(j=i[h],d.relative[k=j.type])break;if((l=d.find[k])&&(f=l(j.matches[0].replace(ab,bb),$.test(i[0].type)&&mb(b.parentNode)||b))){if(i.splice(h,1),a=f.length&&pb(i),!a)return G.apply(e,f),e;break}}}return g(a,m)(f,b,!n,e,$.test(a)&&mb(b.parentNode)||b),e}return c.sortStable=s.split("").sort(z).join("")===s,c.detectDuplicates=!!j,k(),c.sortDetached=gb(function(a){return 1&a.compareDocumentPosition(l.createElement("div"))}),gb(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||hb("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&gb(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||hb("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),gb(function(a){return null==a.getAttribute("disabled")})||hb(J,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),db}(a);n.find=t,n.expr=t.selectors,n.expr[":"]=n.expr.pseudos,n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=n.expr.match.needsContext,v=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,w=/^.[^:#\[\.,]*$/;function x(a,b,c){if(n.isFunction(b))return n.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return n.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(w.test(b))return n.filter(b,a,c);b=n.filter(b,a)}return n.grep(a,function(a){return n.inArray(a,b)>=0!==c})}n.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?n.find.matchesSelector(d,a)?[d]:[]:n.find.matches(a,n.grep(b,function(a){return 1===a.nodeType}))},n.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if("string"!=typeof a)return this.pushStack(n(a).filter(function(){for(b=0;e>b;b++)if(n.contains(d[b],this))return!0}));for(b=0;e>b;b++)n.find(a,d[b],c);return c=this.pushStack(e>1?n.unique(c):c),c.selector=this.selector?this.selector+" "+a:a,c},filter:function(a){return this.pushStack(x(this,a||[],!1))},not:function(a){return this.pushStack(x(this,a||[],!0))},is:function(a){return!!x(this,"string"==typeof a&&u.test(a)?n(a):a||[],!1).length}});var y,z=a.document,A=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,B=n.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(c="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:A.exec(a),!c||!c[1]&&b)return!b||b.jquery?(b||y).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof n?b[0]:b,n.merge(this,n.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:z,!0)),v.test(c[1])&&n.isPlainObject(b))for(c in b)n.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}if(d=z.getElementById(c[2]),d&&d.parentNode){if(d.id!==c[2])return y.find(a);this.length=1,this[0]=d}return this.context=z,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):n.isFunction(a)?"undefined"!=typeof y.ready?y.ready(a):a(n):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),n.makeArray(a,this))};B.prototype=n.fn,y=n(z);var C=/^(?:parents|prev(?:Until|All))/,D={children:!0,contents:!0,next:!0,prev:!0};n.extend({dir:function(a,b,c){var d=[],e=a[b];while(e&&9!==e.nodeType&&(void 0===c||1!==e.nodeType||!n(e).is(c)))1===e.nodeType&&d.push(e),e=e[b];return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),n.fn.extend({has:function(a){var b,c=n(a,this),d=c.length;return this.filter(function(){for(b=0;d>b;b++)if(n.contains(this,c[b]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=u.test(a)||"string"!=typeof a?n(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&n.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?n.unique(f):f)},index:function(a){return a?"string"==typeof a?n.inArray(this[0],n(a)):n.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(n.unique(n.merge(this.get(),n(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function E(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}n.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return n.dir(a,"parentNode")},parentsUntil:function(a,b,c){return n.dir(a,"parentNode",c)},next:function(a){return E(a,"nextSibling")},prev:function(a){return E(a,"previousSibling")},nextAll:function(a){return n.dir(a,"nextSibling")},prevAll:function(a){return n.dir(a,"previousSibling")},nextUntil:function(a,b,c){return n.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return n.dir(a,"previousSibling",c)},siblings:function(a){return n.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return n.sibling(a.firstChild)},contents:function(a){return n.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:n.merge([],a.childNodes)}},function(a,b){n.fn[a]=function(c,d){var e=n.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=n.filter(d,e)),this.length>1&&(D[a]||(e=n.unique(e)),C.test(a)&&(e=e.reverse())),this.pushStack(e)}});var F=/\S+/g,G={};function H(a){var b=G[a]={};return n.each(a.match(F)||[],function(a,c){b[c]=!0}),b}n.Callbacks=function(a){a="string"==typeof a?G[a]||H(a):n.extend({},a);var b,c,d,e,f,g,h=[],i=!a.once&&[],j=function(l){for(c=a.memory&&l,d=!0,f=g||0,g=0,e=h.length,b=!0;h&&e>f;f++)if(h[f].apply(l[0],l[1])===!1&&a.stopOnFalse){c=!1;break}b=!1,h&&(i?i.length&&j(i.shift()):c?h=[]:k.disable())},k={add:function(){if(h){var d=h.length;!function f(b){n.each(b,function(b,c){var d=n.type(c);"function"===d?a.unique&&k.has(c)||h.push(c):c&&c.length&&"string"!==d&&f(c)})}(arguments),b?e=h.length:c&&(g=d,j(c))}return this},remove:function(){return h&&n.each(arguments,function(a,c){var d;while((d=n.inArray(c,h,d))>-1)h.splice(d,1),b&&(e>=d&&e--,f>=d&&f--)}),this},has:function(a){return a?n.inArray(a,h)>-1:!(!h||!h.length)},empty:function(){return h=[],e=0,this},disable:function(){return h=i=c=void 0,this},disabled:function(){return!h},lock:function(){return i=void 0,c||k.disable(),this},locked:function(){return!i},fireWith:function(a,c){return!h||d&&!i||(c=c||[],c=[a,c.slice?c.slice():c],b?i.push(c):j(c)),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return!!d}};return k},n.extend({Deferred:function(a){var b=[["resolve","done",n.Callbacks("once memory"),"resolved"],["reject","fail",n.Callbacks("once memory"),"rejected"],["notify","progress",n.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return n.Deferred(function(c){n.each(b,function(b,f){var g=n.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&n.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?n.extend(a,d):d}},e={};return d.pipe=d.then,n.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=d.call(arguments),e=c.length,f=1!==e||a&&n.isFunction(a.promise)?e:0,g=1===f?a:n.Deferred(),h=function(a,b,c){return function(e){b[a]=this,c[a]=arguments.length>1?d.call(arguments):e,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(e>1)for(i=new Array(e),j=new Array(e),k=new Array(e);e>b;b++)c[b]&&n.isFunction(c[b].promise)?c[b].promise().done(h(b,k,c)).fail(g.reject).progress(h(b,j,i)):--f;return f||g.resolveWith(k,c),g.promise()}});var I;n.fn.ready=function(a){return n.ready.promise().done(a),this},n.extend({isReady:!1,readyWait:1,holdReady:function(a){a?n.readyWait++:n.ready(!0)},ready:function(a){if(a===!0?!--n.readyWait:!n.isReady){if(!z.body)return setTimeout(n.ready);n.isReady=!0,a!==!0&&--n.readyWait>0||(I.resolveWith(z,[n]),n.fn.trigger&&n(z).trigger("ready").off("ready"))}}});function J(){z.addEventListener?(z.removeEventListener("DOMContentLoaded",K,!1),a.removeEventListener("load",K,!1)):(z.detachEvent("onreadystatechange",K),a.detachEvent("onload",K))}function K(){(z.addEventListener||"load"===event.type||"complete"===z.readyState)&&(J(),n.ready())}n.ready.promise=function(b){if(!I)if(I=n.Deferred(),"complete"===z.readyState)setTimeout(n.ready);else if(z.addEventListener)z.addEventListener("DOMContentLoaded",K,!1),a.addEventListener("load",K,!1);else{z.attachEvent("onreadystatechange",K),a.attachEvent("onload",K);var c=!1;try{c=null==a.frameElement&&z.documentElement}catch(d){}c&&c.doScroll&&!function e(){if(!n.isReady){try{c.doScroll("left")}catch(a){return setTimeout(e,50)}J(),n.ready()}}()}return I.promise(b)};var L="undefined",M;for(M in n(l))break;l.ownLast="0"!==M,l.inlineBlockNeedsLayout=!1,n(function(){var a,b,c=z.getElementsByTagName("body")[0];c&&(a=z.createElement("div"),a.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",b=z.createElement("div"),c.appendChild(a).appendChild(b),typeof b.style.zoom!==L&&(b.style.cssText="border:0;margin:0;width:1px;padding:1px;display:inline;zoom:1",(l.inlineBlockNeedsLayout=3===b.offsetWidth)&&(c.style.zoom=1)),c.removeChild(a),a=b=null)}),function(){var a=z.createElement("div");if(null==l.deleteExpando){l.deleteExpando=!0;try{delete a.test}catch(b){l.deleteExpando=!1}}a=null}(),n.acceptData=function(a){var b=n.noData[(a.nodeName+" ").toLowerCase()],c=+a.nodeType||1;return 1!==c&&9!==c?!1:!b||b!==!0&&a.getAttribute("classid")===b};var N=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,O=/([A-Z])/g;function P(a,b,c){if(void 0===c&&1===a.nodeType){var d="data-"+b.replace(O,"-$1").toLowerCase();if(c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:N.test(c)?n.parseJSON(c):c}catch(e){}n.data(a,b,c)}else c=void 0}return c}function Q(a){var b;for(b in a)if(("data"!==b||!n.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function R(a,b,d,e){if(n.acceptData(a)){var f,g,h=n.expando,i=a.nodeType,j=i?n.cache:a,k=i?a[h]:a[h]&&h;if(k&&j[k]&&(e||j[k].data)||void 0!==d||"string"!=typeof b)return k||(k=i?a[h]=c.pop()||n.guid++:h),j[k]||(j[k]=i?{}:{toJSON:n.noop}),("object"==typeof b||"function"==typeof b)&&(e?j[k]=n.extend(j[k],b):j[k].data=n.extend(j[k].data,b)),g=j[k],e||(g.data||(g.data={}),g=g.data),void 0!==d&&(g[n.camelCase(b)]=d),"string"==typeof b?(f=g[b],null==f&&(f=g[n.camelCase(b)])):f=g,f
}}function S(a,b,c){if(n.acceptData(a)){var d,e,f=a.nodeType,g=f?n.cache:a,h=f?a[n.expando]:n.expando;if(g[h]){if(b&&(d=c?g[h]:g[h].data)){n.isArray(b)?b=b.concat(n.map(b,n.camelCase)):b in d?b=[b]:(b=n.camelCase(b),b=b in d?[b]:b.split(" ")),e=b.length;while(e--)delete d[b[e]];if(c?!Q(d):!n.isEmptyObject(d))return}(c||(delete g[h].data,Q(g[h])))&&(f?n.cleanData([a],!0):l.deleteExpando||g!=g.window?delete g[h]:g[h]=null)}}}n.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(a){return a=a.nodeType?n.cache[a[n.expando]]:a[n.expando],!!a&&!Q(a)},data:function(a,b,c){return R(a,b,c)},removeData:function(a,b){return S(a,b)},_data:function(a,b,c){return R(a,b,c,!0)},_removeData:function(a,b){return S(a,b,!0)}}),n.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=n.data(f),1===f.nodeType&&!n._data(f,"parsedAttrs"))){c=g.length;while(c--)d=g[c].name,0===d.indexOf("data-")&&(d=n.camelCase(d.slice(5)),P(f,d,e[d]));n._data(f,"parsedAttrs",!0)}return e}return"object"==typeof a?this.each(function(){n.data(this,a)}):arguments.length>1?this.each(function(){n.data(this,a,b)}):f?P(f,a,n.data(f,a)):void 0},removeData:function(a){return this.each(function(){n.removeData(this,a)})}}),n.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=n._data(a,b),c&&(!d||n.isArray(c)?d=n._data(a,b,n.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=n.queue(a,b),d=c.length,e=c.shift(),f=n._queueHooks(a,b),g=function(){n.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return n._data(a,c)||n._data(a,c,{empty:n.Callbacks("once memory").add(function(){n._removeData(a,b+"queue"),n._removeData(a,c)})})}}),n.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?n.queue(this[0],a):void 0===b?this:this.each(function(){var c=n.queue(this,a,b);n._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&n.dequeue(this,a)})},dequeue:function(a){return this.each(function(){n.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=n.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=n._data(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var T=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,U=["Top","Right","Bottom","Left"],V=function(a,b){return a=b||a,"none"===n.css(a,"display")||!n.contains(a.ownerDocument,a)},W=n.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===n.type(c)){e=!0;for(h in c)n.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,n.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(n(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},X=/^(?:checkbox|radio)$/i;!function(){var a=z.createDocumentFragment(),b=z.createElement("div"),c=z.createElement("input");if(b.setAttribute("className","t"),b.innerHTML="  <link/><table></table><a href='/a'>a</a>",l.leadingWhitespace=3===b.firstChild.nodeType,l.tbody=!b.getElementsByTagName("tbody").length,l.htmlSerialize=!!b.getElementsByTagName("link").length,l.html5Clone="<:nav></:nav>"!==z.createElement("nav").cloneNode(!0).outerHTML,c.type="checkbox",c.checked=!0,a.appendChild(c),l.appendChecked=c.checked,b.innerHTML="<textarea>x</textarea>",l.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue,a.appendChild(b),b.innerHTML="<input type='radio' checked='checked' name='t'/>",l.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,l.noCloneEvent=!0,b.attachEvent&&(b.attachEvent("onclick",function(){l.noCloneEvent=!1}),b.cloneNode(!0).click()),null==l.deleteExpando){l.deleteExpando=!0;try{delete b.test}catch(d){l.deleteExpando=!1}}a=b=c=null}(),function(){var b,c,d=z.createElement("div");for(b in{submit:!0,change:!0,focusin:!0})c="on"+b,(l[b+"Bubbles"]=c in a)||(d.setAttribute(c,"t"),l[b+"Bubbles"]=d.attributes[c].expando===!1);d=null}();var Y=/^(?:input|select|textarea)$/i,Z=/^key/,$=/^(?:mouse|contextmenu)|click/,_=/^(?:focusinfocus|focusoutblur)$/,ab=/^([^.]*)(?:\.(.+)|)$/;function bb(){return!0}function cb(){return!1}function db(){try{return z.activeElement}catch(a){}}n.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=n._data(a);if(r){c.handler&&(i=c,c=i.handler,e=i.selector),c.guid||(c.guid=n.guid++),(g=r.events)||(g=r.events={}),(k=r.handle)||(k=r.handle=function(a){return typeof n===L||a&&n.event.triggered===a.type?void 0:n.event.dispatch.apply(k.elem,arguments)},k.elem=a),b=(b||"").match(F)||[""],h=b.length;while(h--)f=ab.exec(b[h])||[],o=q=f[1],p=(f[2]||"").split(".").sort(),o&&(j=n.event.special[o]||{},o=(e?j.delegateType:j.bindType)||o,j=n.event.special[o]||{},l=n.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&n.expr.match.needsContext.test(e),namespace:p.join(".")},i),(m=g[o])||(m=g[o]=[],m.delegateCount=0,j.setup&&j.setup.call(a,d,p,k)!==!1||(a.addEventListener?a.addEventListener(o,k,!1):a.attachEvent&&a.attachEvent("on"+o,k))),j.add&&(j.add.call(a,l),l.handler.guid||(l.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,l):m.push(l),n.event.global[o]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=n.hasData(a)&&n._data(a);if(r&&(k=r.events)){b=(b||"").match(F)||[""],j=b.length;while(j--)if(h=ab.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o){l=n.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,m=k[o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),i=f=m.length;while(f--)g=m[f],!e&&q!==g.origType||c&&c.guid!==g.guid||h&&!h.test(g.namespace)||d&&d!==g.selector&&("**"!==d||!g.selector)||(m.splice(f,1),g.selector&&m.delegateCount--,l.remove&&l.remove.call(a,g));i&&!m.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||n.removeEvent(a,o,r.handle),delete k[o])}else for(o in k)n.event.remove(a,o+b[j],c,d,!0);n.isEmptyObject(k)&&(delete r.handle,n._removeData(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,k,l,m,o=[d||z],p=j.call(b,"type")?b.type:b,q=j.call(b,"namespace")?b.namespace.split("."):[];if(h=l=d=d||z,3!==d.nodeType&&8!==d.nodeType&&!_.test(p+n.event.triggered)&&(p.indexOf(".")>=0&&(q=p.split("."),p=q.shift(),q.sort()),g=p.indexOf(":")<0&&"on"+p,b=b[n.expando]?b:new n.Event(p,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=q.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+q.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:n.makeArray(c,[b]),k=n.event.special[p]||{},e||!k.trigger||k.trigger.apply(d,c)!==!1)){if(!e&&!k.noBubble&&!n.isWindow(d)){for(i=k.delegateType||p,_.test(i+p)||(h=h.parentNode);h;h=h.parentNode)o.push(h),l=h;l===(d.ownerDocument||z)&&o.push(l.defaultView||l.parentWindow||a)}m=0;while((h=o[m++])&&!b.isPropagationStopped())b.type=m>1?i:k.bindType||p,f=(n._data(h,"events")||{})[b.type]&&n._data(h,"handle"),f&&f.apply(h,c),f=g&&h[g],f&&f.apply&&n.acceptData(h)&&(b.result=f.apply(h,c),b.result===!1&&b.preventDefault());if(b.type=p,!e&&!b.isDefaultPrevented()&&(!k._default||k._default.apply(o.pop(),c)===!1)&&n.acceptData(d)&&g&&d[p]&&!n.isWindow(d)){l=d[g],l&&(d[g]=null),n.event.triggered=p;try{d[p]()}catch(r){}n.event.triggered=void 0,l&&(d[g]=l)}return b.result}},dispatch:function(a){a=n.event.fix(a);var b,c,e,f,g,h=[],i=d.call(arguments),j=(n._data(this,"events")||{})[a.type]||[],k=n.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=n.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,g=0;while((e=f.handlers[g++])&&!a.isImmediatePropagationStopped())(!a.namespace_re||a.namespace_re.test(e.namespace))&&(a.handleObj=e,a.data=e.data,c=((n.event.special[e.origType]||{}).handle||e.handler).apply(f.elem,i),void 0!==c&&(a.result=c)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!=this;i=i.parentNode||this)if(1===i.nodeType&&(i.disabled!==!0||"click"!==a.type)){for(e=[],f=0;h>f;f++)d=b[f],c=d.selector+" ",void 0===e[c]&&(e[c]=d.needsContext?n(c,this).index(i)>=0:n.find(c,this,null,[i]).length),e[c]&&e.push(d);e.length&&g.push({elem:i,handlers:e})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},fix:function(a){if(a[n.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];g||(this.fixHooks[e]=g=$.test(e)?this.mouseHooks:Z.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new n.Event(f),b=d.length;while(b--)c=d[b],a[c]=f[c];return a.target||(a.target=f.srcElement||z),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,g.filter?g.filter(a,f):a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button,g=b.fromElement;return null==a.pageX&&null!=b.clientX&&(d=a.target.ownerDocument||z,e=d.documentElement,c=d.body,a.pageX=b.clientX+(e&&e.scrollLeft||c&&c.scrollLeft||0)-(e&&e.clientLeft||c&&c.clientLeft||0),a.pageY=b.clientY+(e&&e.scrollTop||c&&c.scrollTop||0)-(e&&e.clientTop||c&&c.clientTop||0)),!a.relatedTarget&&g&&(a.relatedTarget=g===a.target?b.toElement:g),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==db()&&this.focus)try{return this.focus(),!1}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){return this===db()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return n.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(a){return n.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=n.extend(new n.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?n.event.trigger(e,null,b):n.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},n.removeEvent=z.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){var d="on"+b;a.detachEvent&&(typeof a[d]===L&&(a[d]=null),a.detachEvent(d,c))},n.Event=function(a,b){return this instanceof n.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&(a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault())?bb:cb):this.type=a,b&&n.extend(this,b),this.timeStamp=a&&a.timeStamp||n.now(),void(this[n.expando]=!0)):new n.Event(a,b)},n.Event.prototype={isDefaultPrevented:cb,isPropagationStopped:cb,isImmediatePropagationStopped:cb,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=bb,a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=bb,a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=bb,this.stopPropagation()}},n.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){n.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!n.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),l.submitBubbles||(n.event.special.submit={setup:function(){return n.nodeName(this,"form")?!1:void n.event.add(this,"click._submit keypress._submit",function(a){var b=a.target,c=n.nodeName(b,"input")||n.nodeName(b,"button")?b.form:void 0;c&&!n._data(c,"submitBubbles")&&(n.event.add(c,"submit._submit",function(a){a._submit_bubble=!0}),n._data(c,"submitBubbles",!0))})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&n.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){return n.nodeName(this,"form")?!1:void n.event.remove(this,"._submit")}}),l.changeBubbles||(n.event.special.change={setup:function(){return Y.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(n.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._just_changed=!0)}),n.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1),n.event.simulate("change",this,a,!0)})),!1):void n.event.add(this,"beforeactivate._change",function(a){var b=a.target;Y.test(b.nodeName)&&!n._data(b,"changeBubbles")&&(n.event.add(b,"change._change",function(a){!this.parentNode||a.isSimulated||a.isTrigger||n.event.simulate("change",this.parentNode,a,!0)}),n._data(b,"changeBubbles",!0))})},handle:function(a){var b=a.target;return this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type?a.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return n.event.remove(this,"._change"),!Y.test(this.nodeName)}}),l.focusinBubbles||n.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){n.event.simulate(b,a.target,n.event.fix(a),!0)};n.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=n._data(d,b);e||d.addEventListener(a,c,!0),n._data(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=n._data(d,b)-1;e?n._data(d,b,e):(d.removeEventListener(a,c,!0),n._removeData(d,b))}}}),n.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(f in a)this.on(f,b,c,a[f],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=cb;else if(!d)return this;return 1===e&&(g=d,d=function(a){return n().off(a),g.apply(this,arguments)},d.guid=g.guid||(g.guid=n.guid++)),this.each(function(){n.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,n(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=cb),this.each(function(){n.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){n.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?n.event.trigger(a,b,c,!0):void 0}});function eb(a){var b=fb.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}var fb="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",gb=/ jQuery\d+="(?:null|\d+)"/g,hb=new RegExp("<(?:"+fb+")[\\s/>]","i"),ib=/^\s+/,jb=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,kb=/<([\w:]+)/,lb=/<tbody/i,mb=/<|&#?\w+;/,nb=/<(?:script|style|link)/i,ob=/checked\s*(?:[^=]|=\s*.checked.)/i,pb=/^$|\/(?:java|ecma)script/i,qb=/^true\/(.*)/,rb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,sb={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:l.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},tb=eb(z),ub=tb.appendChild(z.createElement("div"));sb.optgroup=sb.option,sb.tbody=sb.tfoot=sb.colgroup=sb.caption=sb.thead,sb.th=sb.td;function vb(a,b){var c,d,e=0,f=typeof a.getElementsByTagName!==L?a.getElementsByTagName(b||"*"):typeof a.querySelectorAll!==L?a.querySelectorAll(b||"*"):void 0;if(!f)for(f=[],c=a.childNodes||a;null!=(d=c[e]);e++)!b||n.nodeName(d,b)?f.push(d):n.merge(f,vb(d,b));return void 0===b||b&&n.nodeName(a,b)?n.merge([a],f):f}function wb(a){X.test(a.type)&&(a.defaultChecked=a.checked)}function xb(a,b){return n.nodeName(a,"table")&&n.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function yb(a){return a.type=(null!==n.find.attr(a,"type"))+"/"+a.type,a}function zb(a){var b=qb.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function Ab(a,b){for(var c,d=0;null!=(c=a[d]);d++)n._data(c,"globalEval",!b||n._data(b[d],"globalEval"))}function Bb(a,b){if(1===b.nodeType&&n.hasData(a)){var c,d,e,f=n._data(a),g=n._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;e>d;d++)n.event.add(b,c,h[c][d])}g.data&&(g.data=n.extend({},g.data))}}function Cb(a,b){var c,d,e;if(1===b.nodeType){if(c=b.nodeName.toLowerCase(),!l.noCloneEvent&&b[n.expando]){e=n._data(b);for(d in e.events)n.removeEvent(b,d,e.handle);b.removeAttribute(n.expando)}"script"===c&&b.text!==a.text?(yb(b).text=a.text,zb(b)):"object"===c?(b.parentNode&&(b.outerHTML=a.outerHTML),l.html5Clone&&a.innerHTML&&!n.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&X.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.defaultSelected=b.selected=a.defaultSelected:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}}n.extend({clone:function(a,b,c){var d,e,f,g,h,i=n.contains(a.ownerDocument,a);if(l.html5Clone||n.isXMLDoc(a)||!hb.test("<"+a.nodeName+">")?f=a.cloneNode(!0):(ub.innerHTML=a.outerHTML,ub.removeChild(f=ub.firstChild)),!(l.noCloneEvent&&l.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||n.isXMLDoc(a)))for(d=vb(f),h=vb(a),g=0;null!=(e=h[g]);++g)d[g]&&Cb(e,d[g]);if(b)if(c)for(h=h||vb(a),d=d||vb(f),g=0;null!=(e=h[g]);g++)Bb(e,d[g]);else Bb(a,f);return d=vb(f,"script"),d.length>0&&Ab(d,!i&&vb(a,"script")),d=h=e=null,f},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k,m=a.length,o=eb(b),p=[],q=0;m>q;q++)if(f=a[q],f||0===f)if("object"===n.type(f))n.merge(p,f.nodeType?[f]:f);else if(mb.test(f)){h=h||o.appendChild(b.createElement("div")),i=(kb.exec(f)||["",""])[1].toLowerCase(),k=sb[i]||sb._default,h.innerHTML=k[1]+f.replace(jb,"<$1></$2>")+k[2],e=k[0];while(e--)h=h.lastChild;if(!l.leadingWhitespace&&ib.test(f)&&p.push(b.createTextNode(ib.exec(f)[0])),!l.tbody){f="table"!==i||lb.test(f)?"<table>"!==k[1]||lb.test(f)?0:h:h.firstChild,e=f&&f.childNodes.length;while(e--)n.nodeName(j=f.childNodes[e],"tbody")&&!j.childNodes.length&&f.removeChild(j)}n.merge(p,h.childNodes),h.textContent="";while(h.firstChild)h.removeChild(h.firstChild);h=o.lastChild}else p.push(b.createTextNode(f));h&&o.removeChild(h),l.appendChecked||n.grep(vb(p,"input"),wb),q=0;while(f=p[q++])if((!d||-1===n.inArray(f,d))&&(g=n.contains(f.ownerDocument,f),h=vb(o.appendChild(f),"script"),g&&Ab(h),c)){e=0;while(f=h[e++])pb.test(f.type||"")&&c.push(f)}return h=null,o},cleanData:function(a,b){for(var d,e,f,g,h=0,i=n.expando,j=n.cache,k=l.deleteExpando,m=n.event.special;null!=(d=a[h]);h++)if((b||n.acceptData(d))&&(f=d[i],g=f&&j[f])){if(g.events)for(e in g.events)m[e]?n.event.remove(d,e):n.removeEvent(d,e,g.handle);j[f]&&(delete j[f],k?delete d[i]:typeof d.removeAttribute!==L?d.removeAttribute(i):d[i]=null,c.push(f))}}}),n.fn.extend({text:function(a){return W(this,function(a){return void 0===a?n.text(this):this.empty().append((this[0]&&this[0].ownerDocument||z).createTextNode(a))},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=xb(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=xb(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?n.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||n.cleanData(vb(c)),c.parentNode&&(b&&n.contains(c.ownerDocument,c)&&Ab(vb(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++){1===a.nodeType&&n.cleanData(vb(a,!1));while(a.firstChild)a.removeChild(a.firstChild);a.options&&n.nodeName(a,"select")&&(a.options.length=0)}return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return n.clone(this,a,b)})},html:function(a){return W(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a)return 1===b.nodeType?b.innerHTML.replace(gb,""):void 0;if(!("string"!=typeof a||nb.test(a)||!l.htmlSerialize&&hb.test(a)||!l.leadingWhitespace&&ib.test(a)||sb[(kb.exec(a)||["",""])[1].toLowerCase()])){a=a.replace(jb,"<$1></$2>");try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(n.cleanData(vb(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,n.cleanData(vb(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=e.apply([],a);var c,d,f,g,h,i,j=0,k=this.length,m=this,o=k-1,p=a[0],q=n.isFunction(p);if(q||k>1&&"string"==typeof p&&!l.checkClone&&ob.test(p))return this.each(function(c){var d=m.eq(c);q&&(a[0]=p.call(this,c,d.html())),d.domManip(a,b)});if(k&&(i=n.buildFragment(a,this[0].ownerDocument,!1,this),c=i.firstChild,1===i.childNodes.length&&(i=c),c)){for(g=n.map(vb(i,"script"),yb),f=g.length;k>j;j++)d=i,j!==o&&(d=n.clone(d,!0,!0),f&&n.merge(g,vb(d,"script"))),b.call(this[j],d,j);if(f)for(h=g[g.length-1].ownerDocument,n.map(g,zb),j=0;f>j;j++)d=g[j],pb.test(d.type||"")&&!n._data(d,"globalEval")&&n.contains(h,d)&&(d.src?n._evalUrl&&n._evalUrl(d.src):n.globalEval((d.text||d.textContent||d.innerHTML||"").replace(rb,"")));i=c=null}return this}}),n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){n.fn[a]=function(a){for(var c,d=0,e=[],g=n(a),h=g.length-1;h>=d;d++)c=d===h?this:this.clone(!0),n(g[d])[b](c),f.apply(e,c.get());return this.pushStack(e)}});var Db,Eb={};function Fb(b,c){var d=n(c.createElement(b)).appendTo(c.body),e=a.getDefaultComputedStyle?a.getDefaultComputedStyle(d[0]).display:n.css(d[0],"display");return d.detach(),e}function Gb(a){var b=z,c=Eb[a];return c||(c=Fb(a,b),"none"!==c&&c||(Db=(Db||n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=(Db[0].contentWindow||Db[0].contentDocument).document,b.write(),b.close(),c=Fb(a,b),Db.detach()),Eb[a]=c),c}!function(){var a,b,c=z.createElement("div"),d="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";c.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",a=c.getElementsByTagName("a")[0],a.style.cssText="float:left;opacity:.5",l.opacity=/^0.5/.test(a.style.opacity),l.cssFloat=!!a.style.cssFloat,c.style.backgroundClip="content-box",c.cloneNode(!0).style.backgroundClip="",l.clearCloneStyle="content-box"===c.style.backgroundClip,a=c=null,l.shrinkWrapBlocks=function(){var a,c,e,f;if(null==b){if(a=z.getElementsByTagName("body")[0],!a)return;f="border:0;width:0;height:0;position:absolute;top:0;left:-9999px",c=z.createElement("div"),e=z.createElement("div"),a.appendChild(c).appendChild(e),b=!1,typeof e.style.zoom!==L&&(e.style.cssText=d+";width:1px;padding:1px;zoom:1",e.innerHTML="<div></div>",e.firstChild.style.width="5px",b=3!==e.offsetWidth),a.removeChild(c),a=c=e=null}return b}}();var Hb=/^margin/,Ib=new RegExp("^("+T+")(?!px)[a-z%]+$","i"),Jb,Kb,Lb=/^(top|right|bottom|left)$/;a.getComputedStyle?(Jb=function(a){return a.ownerDocument.defaultView.getComputedStyle(a,null)},Kb=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Jb(a),g=c?c.getPropertyValue(b)||c[b]:void 0,c&&(""!==g||n.contains(a.ownerDocument,a)||(g=n.style(a,b)),Ib.test(g)&&Hb.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0===g?g:g+""}):z.documentElement.currentStyle&&(Jb=function(a){return a.currentStyle},Kb=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Jb(a),g=c?c[b]:void 0,null==g&&h&&h[b]&&(g=h[b]),Ib.test(g)&&!Lb.test(b)&&(d=h.left,e=a.runtimeStyle,f=e&&e.left,f&&(e.left=a.currentStyle.left),h.left="fontSize"===b?"1em":g,g=h.pixelLeft+"px",h.left=d,f&&(e.left=f)),void 0===g?g:g+""||"auto"});function Mb(a,b){return{get:function(){var c=a();if(null!=c)return c?void delete this.get:(this.get=b).apply(this,arguments)}}}!function(){var b,c,d,e,f,g,h=z.createElement("div"),i="border:0;width:0;height:0;position:absolute;top:0;left:-9999px",j="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";h.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",b=h.getElementsByTagName("a")[0],b.style.cssText="float:left;opacity:.5",l.opacity=/^0.5/.test(b.style.opacity),l.cssFloat=!!b.style.cssFloat,h.style.backgroundClip="content-box",h.cloneNode(!0).style.backgroundClip="",l.clearCloneStyle="content-box"===h.style.backgroundClip,b=h=null,n.extend(l,{reliableHiddenOffsets:function(){if(null!=c)return c;var a,b,d,e=z.createElement("div"),f=z.getElementsByTagName("body")[0];if(f)return e.setAttribute("className","t"),e.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",a=z.createElement("div"),a.style.cssText=i,f.appendChild(a).appendChild(e),e.innerHTML="<table><tr><td></td><td>t</td></tr></table>",b=e.getElementsByTagName("td"),b[0].style.cssText="padding:0;margin:0;border:0;display:none",d=0===b[0].offsetHeight,b[0].style.display="",b[1].style.display="none",c=d&&0===b[0].offsetHeight,f.removeChild(a),e=f=null,c},boxSizing:function(){return null==d&&k(),d},boxSizingReliable:function(){return null==e&&k(),e},pixelPosition:function(){return null==f&&k(),f},reliableMarginRight:function(){var b,c,d,e;if(null==g&&a.getComputedStyle){if(b=z.getElementsByTagName("body")[0],!b)return;c=z.createElement("div"),d=z.createElement("div"),c.style.cssText=i,b.appendChild(c).appendChild(d),e=d.appendChild(z.createElement("div")),e.style.cssText=d.style.cssText=j,e.style.marginRight=e.style.width="0",d.style.width="1px",g=!parseFloat((a.getComputedStyle(e,null)||{}).marginRight),b.removeChild(c)}return g}});function k(){var b,c,h=z.getElementsByTagName("body")[0];h&&(b=z.createElement("div"),c=z.createElement("div"),b.style.cssText=i,h.appendChild(b).appendChild(c),c.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;display:block;padding:1px;border:1px;width:4px;margin-top:1%;top:1%",n.swap(h,null!=h.style.zoom?{zoom:1}:{},function(){d=4===c.offsetWidth}),e=!0,f=!1,g=!0,a.getComputedStyle&&(f="1%"!==(a.getComputedStyle(c,null)||{}).top,e="4px"===(a.getComputedStyle(c,null)||{width:"4px"}).width),h.removeChild(b),c=h=null)}}(),n.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var Nb=/alpha\([^)]*\)/i,Ob=/opacity\s*=\s*([^)]*)/,Pb=/^(none|table(?!-c[ea]).+)/,Qb=new RegExp("^("+T+")(.*)$","i"),Rb=new RegExp("^([+-])=("+T+")","i"),Sb={position:"absolute",visibility:"hidden",display:"block"},Tb={letterSpacing:0,fontWeight:400},Ub=["Webkit","O","Moz","ms"];function Vb(a,b){if(b in a)return b;var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=Ub.length;while(e--)if(b=Ub[e]+c,b in a)return b;return d}function Wb(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=n._data(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&V(d)&&(f[g]=n._data(d,"olddisplay",Gb(d.nodeName)))):f[g]||(e=V(d),(c&&"none"!==c||!e)&&n._data(d,"olddisplay",e?c:n.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function Xb(a,b,c){var d=Qb.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function Yb(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=n.css(a,c+U[f],!0,e)),d?("content"===c&&(g-=n.css(a,"padding"+U[f],!0,e)),"margin"!==c&&(g-=n.css(a,"border"+U[f]+"Width",!0,e))):(g+=n.css(a,"padding"+U[f],!0,e),"padding"!==c&&(g+=n.css(a,"border"+U[f]+"Width",!0,e)));return g}function Zb(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Jb(a),g=l.boxSizing()&&"border-box"===n.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=Kb(a,b,f),(0>e||null==e)&&(e=a.style[b]),Ib.test(e))return e;d=g&&(l.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+Yb(a,b,c||(g?"border":"content"),d,f)+"px"}n.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Kb(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":l.cssFloat?"cssFloat":"styleFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=n.camelCase(b),i=a.style;if(b=n.cssProps[h]||(n.cssProps[h]=Vb(i,h)),g=n.cssHooks[b]||n.cssHooks[h],void 0===c)return g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b];if(f=typeof c,"string"===f&&(e=Rb.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(n.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||n.cssNumber[h]||(c+="px"),l.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),!(g&&"set"in g&&void 0===(c=g.set(a,c,d)))))try{i[b]="",i[b]=c}catch(j){}}},css:function(a,b,c,d){var e,f,g,h=n.camelCase(b);return b=n.cssProps[h]||(n.cssProps[h]=Vb(a.style,h)),g=n.cssHooks[b]||n.cssHooks[h],g&&"get"in g&&(f=g.get(a,!0,c)),void 0===f&&(f=Kb(a,b,d)),"normal"===f&&b in Tb&&(f=Tb[b]),""===c||c?(e=parseFloat(f),c===!0||n.isNumeric(e)?e||0:f):f}}),n.each(["height","width"],function(a,b){n.cssHooks[b]={get:function(a,c,d){return c?0===a.offsetWidth&&Pb.test(n.css(a,"display"))?n.swap(a,Sb,function(){return Zb(a,b,d)}):Zb(a,b,d):void 0},set:function(a,c,d){var e=d&&Jb(a);return Xb(a,c,d?Yb(a,b,d,l.boxSizing()&&"border-box"===n.css(a,"boxSizing",!1,e),e):0)}}}),l.opacity||(n.cssHooks.opacity={get:function(a,b){return Ob.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=n.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1,(b>=1||""===b)&&""===n.trim(f.replace(Nb,""))&&c.removeAttribute&&(c.removeAttribute("filter"),""===b||d&&!d.filter)||(c.filter=Nb.test(f)?f.replace(Nb,e):f+" "+e)}}),n.cssHooks.marginRight=Mb(l.reliableMarginRight,function(a,b){return b?n.swap(a,{display:"inline-block"},Kb,[a,"marginRight"]):void 0}),n.each({margin:"",padding:"",border:"Width"},function(a,b){n.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+U[d]+b]=f[d]||f[d-2]||f[0];return e}},Hb.test(a)||(n.cssHooks[a+b].set=Xb)}),n.fn.extend({css:function(a,b){return W(this,function(a,b,c){var d,e,f={},g=0;if(n.isArray(b)){for(d=Jb(a),e=b.length;e>g;g++)f[b[g]]=n.css(a,b[g],!1,d);return f}return void 0!==c?n.style(a,b,c):n.css(a,b)
},a,b,arguments.length>1)},show:function(){return Wb(this,!0)},hide:function(){return Wb(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){V(this)?n(this).show():n(this).hide()})}});function $b(a,b,c,d,e){return new $b.prototype.init(a,b,c,d,e)}n.Tween=$b,$b.prototype={constructor:$b,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(n.cssNumber[c]?"":"px")},cur:function(){var a=$b.propHooks[this.prop];return a&&a.get?a.get(this):$b.propHooks._default.get(this)},run:function(a){var b,c=$b.propHooks[this.prop];return this.pos=b=this.options.duration?n.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):$b.propHooks._default.set(this),this}},$b.prototype.init.prototype=$b.prototype,$b.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=n.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){n.fx.step[a.prop]?n.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[n.cssProps[a.prop]]||n.cssHooks[a.prop])?n.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},$b.propHooks.scrollTop=$b.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},n.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},n.fx=$b.prototype.init,n.fx.step={};var _b,ac,bc=/^(?:toggle|show|hide)$/,cc=new RegExp("^(?:([+-])=|)("+T+")([a-z%]*)$","i"),dc=/queueHooks$/,ec=[jc],fc={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=cc.exec(b),f=e&&e[3]||(n.cssNumber[a]?"":"px"),g=(n.cssNumber[a]||"px"!==f&&+d)&&cc.exec(n.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,n.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};function gc(){return setTimeout(function(){_b=void 0}),_b=n.now()}function hc(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=U[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function ic(a,b,c){for(var d,e=(fc[b]||[]).concat(fc["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function jc(a,b,c){var d,e,f,g,h,i,j,k,m=this,o={},p=a.style,q=a.nodeType&&V(a),r=n._data(a,"fxshow");c.queue||(h=n._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,m.always(function(){m.always(function(){h.unqueued--,n.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[p.overflow,p.overflowX,p.overflowY],j=n.css(a,"display"),k=Gb(a.nodeName),"none"===j&&(j=k),"inline"===j&&"none"===n.css(a,"float")&&(l.inlineBlockNeedsLayout&&"inline"!==k?p.zoom=1:p.display="inline-block")),c.overflow&&(p.overflow="hidden",l.shrinkWrapBlocks()||m.always(function(){p.overflow=c.overflow[0],p.overflowX=c.overflow[1],p.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],bc.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(q?"hide":"show")){if("show"!==e||!r||void 0===r[d])continue;q=!0}o[d]=r&&r[d]||n.style(a,d)}if(!n.isEmptyObject(o)){r?"hidden"in r&&(q=r.hidden):r=n._data(a,"fxshow",{}),f&&(r.hidden=!q),q?n(a).show():m.done(function(){n(a).hide()}),m.done(function(){var b;n._removeData(a,"fxshow");for(b in o)n.style(a,b,o[b])});for(d in o)g=ic(q?r[d]:0,d,m),d in r||(r[d]=g.start,q&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function kc(a,b){var c,d,e,f,g;for(c in a)if(d=n.camelCase(c),e=b[d],f=a[c],n.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=n.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function lc(a,b,c){var d,e,f=0,g=ec.length,h=n.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=_b||gc(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:n.extend({},b),opts:n.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:_b||gc(),duration:c.duration,tweens:[],createTween:function(b,c){var d=n.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(kc(k,j.opts.specialEasing);g>f;f++)if(d=ec[f].call(j,a,k,j.opts))return d;return n.map(k,ic,j),n.isFunction(j.opts.start)&&j.opts.start.call(a,j),n.fx.timer(n.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}n.Animation=n.extend(lc,{tweener:function(a,b){n.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],fc[c]=fc[c]||[],fc[c].unshift(b)},prefilter:function(a,b){b?ec.unshift(a):ec.push(a)}}),n.speed=function(a,b,c){var d=a&&"object"==typeof a?n.extend({},a):{complete:c||!c&&b||n.isFunction(a)&&a,duration:a,easing:c&&b||b&&!n.isFunction(b)&&b};return d.duration=n.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in n.fx.speeds?n.fx.speeds[d.duration]:n.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){n.isFunction(d.old)&&d.old.call(this),d.queue&&n.dequeue(this,d.queue)},d},n.fn.extend({fadeTo:function(a,b,c,d){return this.filter(V).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=n.isEmptyObject(a),f=n.speed(b,c,d),g=function(){var b=lc(this,n.extend({},a),f);(e||n._data(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=n.timers,g=n._data(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&dc.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&n.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=n._data(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=n.timers,g=d?d.length:0;for(c.finish=!0,n.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),n.each(["toggle","show","hide"],function(a,b){var c=n.fn[b];n.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(hc(b,!0),a,d,e)}}),n.each({slideDown:hc("show"),slideUp:hc("hide"),slideToggle:hc("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){n.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),n.timers=[],n.fx.tick=function(){var a,b=n.timers,c=0;for(_b=n.now();c<b.length;c++)a=b[c],a()||b[c]!==a||b.splice(c--,1);b.length||n.fx.stop(),_b=void 0},n.fx.timer=function(a){n.timers.push(a),a()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){ac||(ac=setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){clearInterval(ac),ac=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(a,b){return a=n.fx?n.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a,b,c,d,e=z.createElement("div");e.setAttribute("className","t"),e.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",a=e.getElementsByTagName("a")[0],c=z.createElement("select"),d=c.appendChild(z.createElement("option")),b=e.getElementsByTagName("input")[0],a.style.cssText="top:1px",l.getSetAttribute="t"!==e.className,l.style=/top/.test(a.getAttribute("style")),l.hrefNormalized="/a"===a.getAttribute("href"),l.checkOn=!!b.value,l.optSelected=d.selected,l.enctype=!!z.createElement("form").enctype,c.disabled=!0,l.optDisabled=!d.disabled,b=z.createElement("input"),b.setAttribute("value",""),l.input=""===b.getAttribute("value"),b.value="t",b.setAttribute("type","radio"),l.radioValue="t"===b.value,a=b=c=d=e=null}();var mc=/\r/g;n.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=n.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,n(this).val()):a,null==e?e="":"number"==typeof e?e+="":n.isArray(e)&&(e=n.map(e,function(a){return null==a?"":a+""})),b=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=n.valHooks[e.type]||n.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(mc,""):null==c?"":c)}}}),n.extend({valHooks:{option:{get:function(a){var b=n.find.attr(a,"value");return null!=b?b:n.text(a)}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(l.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&n.nodeName(c.parentNode,"optgroup"))){if(b=n(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=n.makeArray(b),g=e.length;while(g--)if(d=e[g],n.inArray(n.valHooks.option.get(d),f)>=0)try{d.selected=c=!0}catch(h){d.scrollHeight}else d.selected=!1;return c||(a.selectedIndex=-1),e}}}}),n.each(["radio","checkbox"],function(){n.valHooks[this]={set:function(a,b){return n.isArray(b)?a.checked=n.inArray(n(a).val(),b)>=0:void 0}},l.checkOn||(n.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var nc,oc,pc=n.expr.attrHandle,qc=/^(?:checked|selected)$/i,rc=l.getSetAttribute,sc=l.input;n.fn.extend({attr:function(a,b){return W(this,n.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){n.removeAttr(this,a)})}}),n.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(a&&3!==f&&8!==f&&2!==f)return typeof a.getAttribute===L?n.prop(a,b,c):(1===f&&n.isXMLDoc(a)||(b=b.toLowerCase(),d=n.attrHooks[b]||(n.expr.match.bool.test(b)?oc:nc)),void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:(e=n.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void n.removeAttr(a,b))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(F);if(f&&1===a.nodeType)while(c=f[e++])d=n.propFix[c]||c,n.expr.match.bool.test(c)?sc&&rc||!qc.test(c)?a[d]=!1:a[n.camelCase("default-"+c)]=a[d]=!1:n.attr(a,c,""),a.removeAttribute(rc?c:d)},attrHooks:{type:{set:function(a,b){if(!l.radioValue&&"radio"===b&&n.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),oc={set:function(a,b,c){return b===!1?n.removeAttr(a,c):sc&&rc||!qc.test(c)?a.setAttribute(!rc&&n.propFix[c]||c,c):a[n.camelCase("default-"+c)]=a[c]=!0,c}},n.each(n.expr.match.bool.source.match(/\w+/g),function(a,b){var c=pc[b]||n.find.attr;pc[b]=sc&&rc||!qc.test(b)?function(a,b,d){var e,f;return d||(f=pc[b],pc[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,pc[b]=f),e}:function(a,b,c){return c?void 0:a[n.camelCase("default-"+b)]?b.toLowerCase():null}}),sc&&rc||(n.attrHooks.value={set:function(a,b,c){return n.nodeName(a,"input")?void(a.defaultValue=b):nc&&nc.set(a,b,c)}}),rc||(nc={set:function(a,b,c){var d=a.getAttributeNode(c);return d||a.setAttributeNode(d=a.ownerDocument.createAttribute(c)),d.value=b+="","value"===c||b===a.getAttribute(c)?b:void 0}},pc.id=pc.name=pc.coords=function(a,b,c){var d;return c?void 0:(d=a.getAttributeNode(b))&&""!==d.value?d.value:null},n.valHooks.button={get:function(a,b){var c=a.getAttributeNode(b);return c&&c.specified?c.value:void 0},set:nc.set},n.attrHooks.contenteditable={set:function(a,b,c){nc.set(a,""===b?!1:b,c)}},n.each(["width","height"],function(a,b){n.attrHooks[b]={set:function(a,c){return""===c?(a.setAttribute(b,"auto"),c):void 0}}})),l.style||(n.attrHooks.style={get:function(a){return a.style.cssText||void 0},set:function(a,b){return a.style.cssText=b+""}});var tc=/^(?:input|select|textarea|button|object)$/i,uc=/^(?:a|area)$/i;n.fn.extend({prop:function(a,b){return W(this,n.prop,a,b,arguments.length>1)},removeProp:function(a){return a=n.propFix[a]||a,this.each(function(){try{this[a]=void 0,delete this[a]}catch(b){}})}}),n.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return f=1!==g||!n.isXMLDoc(a),f&&(b=n.propFix[b]||b,e=n.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=n.find.attr(a,"tabindex");return b?parseInt(b,10):tc.test(a.nodeName)||uc.test(a.nodeName)&&a.href?0:-1}}}}),l.hrefNormalized||n.each(["href","src"],function(a,b){n.propHooks[b]={get:function(a){return a.getAttribute(b,4)}}}),l.optSelected||(n.propHooks.selected={get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}}),n.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){n.propFix[this.toLowerCase()]=this}),l.enctype||(n.propFix.enctype="encoding");var vc=/[\t\r\n\f]/g;n.fn.extend({addClass:function(a){var b,c,d,e,f,g,h=0,i=this.length,j="string"==typeof a&&a;if(n.isFunction(a))return this.each(function(b){n(this).addClass(a.call(this,b,this.className))});if(j)for(b=(a||"").match(F)||[];i>h;h++)if(c=this[h],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(vc," "):" ")){f=0;while(e=b[f++])d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=n.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0,i=this.length,j=0===arguments.length||"string"==typeof a&&a;if(n.isFunction(a))return this.each(function(b){n(this).removeClass(a.call(this,b,this.className))});if(j)for(b=(a||"").match(F)||[];i>h;h++)if(c=this[h],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(vc," "):"")){f=0;while(e=b[f++])while(d.indexOf(" "+e+" ")>=0)d=d.replace(" "+e+" "," ");g=a?n.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(n.isFunction(a)?function(c){n(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c){var b,d=0,e=n(this),f=a.match(F)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else(c===L||"boolean"===c)&&(this.className&&n._data(this,"__className__",this.className),this.className=this.className||a===!1?"":n._data(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(vc," ").indexOf(b)>=0)return!0;return!1}}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){n.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),n.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var wc=n.now(),xc=/\?/,yc=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;n.parseJSON=function(b){if(a.JSON&&a.JSON.parse)return a.JSON.parse(b+"");var c,d=null,e=n.trim(b+"");return e&&!n.trim(e.replace(yc,function(a,b,e,f){return c&&b&&(d=0),0===d?a:(c=e||b,d+=!f-!e,"")}))?Function("return "+e)():n.error("Invalid JSON: "+b)},n.parseXML=function(b){var c,d;if(!b||"string"!=typeof b)return null;try{a.DOMParser?(d=new DOMParser,c=d.parseFromString(b,"text/xml")):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b))}catch(e){c=void 0}return c&&c.documentElement&&!c.getElementsByTagName("parsererror").length||n.error("Invalid XML: "+b),c};var zc,Ac,Bc=/#.*$/,Cc=/([?&])_=[^&]*/,Dc=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Ec=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Fc=/^(?:GET|HEAD)$/,Gc=/^\/\//,Hc=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Ic={},Jc={},Kc="*/".concat("*");try{Ac=location.href}catch(Lc){Ac=z.createElement("a"),Ac.href="",Ac=Ac.href}zc=Hc.exec(Ac.toLowerCase())||[];function Mc(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(F)||[];if(n.isFunction(c))while(d=f[e++])"+"===d.charAt(0)?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function Nc(a,b,c,d){var e={},f=a===Jc;function g(h){var i;return e[h]=!0,n.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function Oc(a,b){var c,d,e=n.ajaxSettings.flatOptions||{};for(d in b)void 0!==b[d]&&((e[d]?a:c||(c={}))[d]=b[d]);return c&&n.extend(!0,a,c),a}function Pc(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===e&&(e=a.mimeType||b.getResponseHeader("Content-Type"));if(e)for(g in h)if(h[g]&&h[g].test(e)){i.unshift(g);break}if(i[0]in c)f=i[0];else{for(g in c){if(!i[0]||a.converters[g+" "+i[0]]){f=g;break}d||(d=g)}f=f||d}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function Qc(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ac,type:"GET",isLocal:Ec.test(zc[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Kc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Oc(Oc(a,n.ajaxSettings),b):Oc(n.ajaxSettings,a)},ajaxPrefilter:Mc(Ic),ajaxTransport:Mc(Jc),ajax:function(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};var c,d,e,f,g,h,i,j,k=n.ajaxSetup({},b),l=k.context||k,m=k.context&&(l.nodeType||l.jquery)?n(l):n.event,o=n.Deferred(),p=n.Callbacks("once memory"),q=k.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!j){j={};while(b=Dc.exec(f))j[b[1].toLowerCase()]=b[2]}b=j[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?f:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(k.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return i&&i.abort(b),x(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,k.url=((a||k.url||Ac)+"").replace(Bc,"").replace(Gc,zc[1]+"//"),k.type=b.method||b.type||k.method||k.type,k.dataTypes=n.trim(k.dataType||"*").toLowerCase().match(F)||[""],null==k.crossDomain&&(c=Hc.exec(k.url.toLowerCase()),k.crossDomain=!(!c||c[1]===zc[1]&&c[2]===zc[2]&&(c[3]||("http:"===c[1]?"80":"443"))===(zc[3]||("http:"===zc[1]?"80":"443")))),k.data&&k.processData&&"string"!=typeof k.data&&(k.data=n.param(k.data,k.traditional)),Nc(Ic,k,b,v),2===t)return v;h=k.global,h&&0===n.active++&&n.event.trigger("ajaxStart"),k.type=k.type.toUpperCase(),k.hasContent=!Fc.test(k.type),e=k.url,k.hasContent||(k.data&&(e=k.url+=(xc.test(e)?"&":"?")+k.data,delete k.data),k.cache===!1&&(k.url=Cc.test(e)?e.replace(Cc,"$1_="+wc++):e+(xc.test(e)?"&":"?")+"_="+wc++)),k.ifModified&&(n.lastModified[e]&&v.setRequestHeader("If-Modified-Since",n.lastModified[e]),n.etag[e]&&v.setRequestHeader("If-None-Match",n.etag[e])),(k.data&&k.hasContent&&k.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",k.contentType),v.setRequestHeader("Accept",k.dataTypes[0]&&k.accepts[k.dataTypes[0]]?k.accepts[k.dataTypes[0]]+("*"!==k.dataTypes[0]?", "+Kc+"; q=0.01":""):k.accepts["*"]);for(d in k.headers)v.setRequestHeader(d,k.headers[d]);if(k.beforeSend&&(k.beforeSend.call(l,v,k)===!1||2===t))return v.abort();u="abort";for(d in{success:1,error:1,complete:1})v[d](k[d]);if(i=Nc(Jc,k,b,v)){v.readyState=1,h&&m.trigger("ajaxSend",[v,k]),k.async&&k.timeout>0&&(g=setTimeout(function(){v.abort("timeout")},k.timeout));try{t=1,i.send(r,x)}catch(w){if(!(2>t))throw w;x(-1,w)}}else x(-1,"No Transport");function x(a,b,c,d){var j,r,s,u,w,x=b;2!==t&&(t=2,g&&clearTimeout(g),i=void 0,f=d||"",v.readyState=a>0?4:0,j=a>=200&&300>a||304===a,c&&(u=Pc(k,v,c)),u=Qc(k,u,v,j),j?(k.ifModified&&(w=v.getResponseHeader("Last-Modified"),w&&(n.lastModified[e]=w),w=v.getResponseHeader("etag"),w&&(n.etag[e]=w)),204===a||"HEAD"===k.type?x="nocontent":304===a?x="notmodified":(x=u.state,r=u.data,s=u.error,j=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),v.status=a,v.statusText=(b||x)+"",j?o.resolveWith(l,[r,x,v]):o.rejectWith(l,[v,x,s]),v.statusCode(q),q=void 0,h&&m.trigger(j?"ajaxSuccess":"ajaxError",[v,k,j?r:s]),p.fireWith(l,[v,x]),h&&(m.trigger("ajaxComplete",[v,k]),--n.active||n.event.trigger("ajaxStop")))}return v},getJSON:function(a,b,c){return n.get(a,b,c,"json")},getScript:function(a,b){return n.get(a,void 0,b,"script")}}),n.each(["get","post"],function(a,b){n[b]=function(a,c,d,e){return n.isFunction(c)&&(e=e||d,d=c,c=void 0),n.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){n.fn[b]=function(a){return this.on(b,a)}}),n._evalUrl=function(a){return n.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},n.fn.extend({wrapAll:function(a){if(n.isFunction(a))return this.each(function(b){n(this).wrapAll(a.call(this,b))});if(this[0]){var b=n(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&1===a.firstChild.nodeType)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return this.each(n.isFunction(a)?function(b){n(this).wrapInner(a.call(this,b))}:function(){var b=n(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=n.isFunction(a);return this.each(function(c){n(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes)}).end()}}),n.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0||!l.reliableHiddenOffsets()&&"none"===(a.style&&a.style.display||n.css(a,"display"))},n.expr.filters.visible=function(a){return!n.expr.filters.hidden(a)};var Rc=/%20/g,Sc=/\[\]$/,Tc=/\r?\n/g,Uc=/^(?:submit|button|image|reset|file)$/i,Vc=/^(?:input|select|textarea|keygen)/i;function Wc(a,b,c,d){var e;if(n.isArray(b))n.each(b,function(b,e){c||Sc.test(a)?d(a,e):Wc(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==n.type(b))d(a,b);else for(e in b)Wc(a+"["+e+"]",b[e],c,d)}n.param=function(a,b){var c,d=[],e=function(a,b){b=n.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(a)||a.jquery&&!n.isPlainObject(a))n.each(a,function(){e(this.name,this.value)});else for(c in a)Wc(c,a[c],b,e);return d.join("&").replace(Rc,"+")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=n.prop(this,"elements");return a?n.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!n(this).is(":disabled")&&Vc.test(this.nodeName)&&!Uc.test(a)&&(this.checked||!X.test(a))}).map(function(a,b){var c=n(this).val();return null==c?null:n.isArray(c)?n.map(c,function(a){return{name:b.name,value:a.replace(Tc,"\r\n")}}):{name:b.name,value:c.replace(Tc,"\r\n")}}).get()}}),n.ajaxSettings.xhr=void 0!==a.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&$c()||_c()}:$c;var Xc=0,Yc={},Zc=n.ajaxSettings.xhr();a.ActiveXObject&&n(a).on("unload",function(){for(var a in Yc)Yc[a](void 0,!0)}),l.cors=!!Zc&&"withCredentials"in Zc,Zc=l.ajax=!!Zc,Zc&&n.ajaxTransport(function(a){if(!a.crossDomain||l.cors){var b;return{send:function(c,d){var e,f=a.xhr(),g=++Xc;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)void 0!==c[e]&&f.setRequestHeader(e,c[e]+"");f.send(a.hasContent&&a.data||null),b=function(c,e){var h,i,j;if(b&&(e||4===f.readyState))if(delete Yc[g],b=void 0,f.onreadystatechange=n.noop,e)4!==f.readyState&&f.abort();else{j={},h=f.status,"string"==typeof f.responseText&&(j.text=f.responseText);try{i=f.statusText}catch(k){i=""}h||!a.isLocal||a.crossDomain?1223===h&&(h=204):h=j.text?200:404}j&&d(h,i,j,f.getAllResponseHeaders())},a.async?4===f.readyState?setTimeout(b):f.onreadystatechange=Yc[g]=b:b()},abort:function(){b&&b(void 0,!0)}}}});function $c(){try{return new a.XMLHttpRequest}catch(b){}}function _c(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return n.globalEval(a),a}}}),n.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),n.ajaxTransport("script",function(a){if(a.crossDomain){var b,c=z.head||n("head")[0]||z.documentElement;return{send:function(d,e){b=z.createElement("script"),b.async=!0,a.scriptCharset&&(b.charset=a.scriptCharset),b.src=a.url,b.onload=b.onreadystatechange=function(a,c){(c||!b.readyState||/loaded|complete/.test(b.readyState))&&(b.onload=b.onreadystatechange=null,b.parentNode&&b.parentNode.removeChild(b),b=null,c||e(200,"success"))},c.insertBefore(b,c.firstChild)},abort:function(){b&&b.onload(void 0,!0)}}}});var ad=[],bd=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=ad.pop()||n.expando+"_"+wc++;return this[a]=!0,a}}),n.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(bd.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&bd.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=n.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(bd,"$1"+e):b.jsonp!==!1&&(b.url+=(xc.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||n.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,ad.push(e)),g&&n.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),n.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||z;var d=v.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=n.buildFragment([a],b,e),e&&e.length&&n(e).remove(),n.merge([],d.childNodes))};var cd=n.fn.load;n.fn.load=function(a,b,c){if("string"!=typeof a&&cd)return cd.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=a.slice(h,a.length),a=a.slice(0,h)),n.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(f="POST"),g.length>0&&n.ajax({url:a,type:f,dataType:"html",data:b}).done(function(a){e=arguments,g.html(d?n("<div>").append(n.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,e||[a.responseText,b,a])}),this},n.expr.filters.animated=function(a){return n.grep(n.timers,function(b){return a===b.elem}).length};var dd=a.document.documentElement;function ed(a){return n.isWindow(a)?a:9===a.nodeType?a.defaultView||a.parentWindow:!1}n.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=n.css(a,"position"),l=n(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=n.css(a,"top"),i=n.css(a,"left"),j=("absolute"===k||"fixed"===k)&&n.inArray("auto",[f,i])>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),n.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},n.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){n.offset.setOffset(this,a,b)});var b,c,d={top:0,left:0},e=this[0],f=e&&e.ownerDocument;if(f)return b=f.documentElement,n.contains(b,e)?(typeof e.getBoundingClientRect!==L&&(d=e.getBoundingClientRect()),c=ed(f),{top:d.top+(c.pageYOffset||b.scrollTop)-(b.clientTop||0),left:d.left+(c.pageXOffset||b.scrollLeft)-(b.clientLeft||0)}):d},position:function(){if(this[0]){var a,b,c={top:0,left:0},d=this[0];return"fixed"===n.css(d,"position")?b=d.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),n.nodeName(a[0],"html")||(c=a.offset()),c.top+=n.css(a[0],"borderTopWidth",!0),c.left+=n.css(a[0],"borderLeftWidth",!0)),{top:b.top-c.top-n.css(d,"marginTop",!0),left:b.left-c.left-n.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||dd;while(a&&!n.nodeName(a,"html")&&"static"===n.css(a,"position"))a=a.offsetParent;return a||dd})}}),n.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c=/Y/.test(b);n.fn[a]=function(d){return W(this,function(a,d,e){var f=ed(a);return void 0===e?f?b in f?f[b]:f.document.documentElement[d]:a[d]:void(f?f.scrollTo(c?n(f).scrollLeft():e,c?e:n(f).scrollTop()):a[d]=e)},a,d,arguments.length,null)}}),n.each(["top","left"],function(a,b){n.cssHooks[b]=Mb(l.pixelPosition,function(a,c){return c?(c=Kb(a,b),Ib.test(c)?n(a).position()[b]+"px":c):void 0})}),n.each({Height:"height",Width:"width"},function(a,b){n.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){n.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return W(this,function(b,c,d){var e;return n.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?n.css(b,c,g):n.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),n.fn.size=function(){return this.length},n.fn.andSelf=n.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return n});var fd=a.jQuery,gd=a.$;return n.noConflict=function(b){return a.$===n&&(a.$=gd),b&&a.jQuery===n&&(a.jQuery=fd),n},typeof b===L&&(a.jQuery=a.$=n),n});

/*! jQuery UI - v1.10.4 - 2014-05-01
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.position.js, jquery.ui.draggable.js, jquery.ui.droppable.js, jquery.ui.resizable.js, jquery.ui.sortable.js, jquery.ui.autocomplete.js, jquery.ui.menu.js, jquery.ui.slider.js, jquery.ui.tooltip.js, jquery.ui.effect.js
* Copyright 2014 jQuery Foundation and other contributors; Licensed MIT */

(function(e,t){function i(t,i){var s,a,o,r=t.nodeName.toLowerCase();return"area"===r?(s=t.parentNode,a=s.name,t.href&&a&&"map"===s.nodeName.toLowerCase()?(o=e("img[usemap=#"+a+"]")[0],!!o&&n(o)):!1):(/input|select|textarea|button|object/.test(r)?!t.disabled:"a"===r?t.href||i:i)&&n(t)}function n(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var s=0,a=/^ui-id-\d+$/;e.ui=e.ui||{},e.extend(e.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:function(t){return function(i,n){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),n&&n.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(i){if(i!==t)return this.css("zIndex",i);if(this.length)for(var n,s,a=e(this[0]);a.length&&a[0]!==document;){if(n=a.css("position"),("absolute"===n||"relative"===n||"fixed"===n)&&(s=parseInt(a.css("zIndex"),10),!isNaN(s)&&0!==s))return s;a=a.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++s)})},removeUniqueId:function(){return this.each(function(){a.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,n){return!!e.data(t,n[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),s=isNaN(n);return(s||n>=0)&&i(t,!s)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(i,n){function s(t,i,n,s){return e.each(a,function(){i-=parseFloat(e.css(t,"padding"+this))||0,n&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),s&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var a="Width"===n?["Left","Right"]:["Top","Bottom"],o=n.toLowerCase(),r={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+n]=function(i){return i===t?r["inner"+n].call(this):this.each(function(){e(this).css(o,s(this,i)+"px")})},e.fn["outer"+n]=function(t,i){return"number"!=typeof t?r["outer"+n].call(this,t):this.each(function(){e(this).css(o,s(this,t,!0,i)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,i,n){var s,a=e.ui[t].prototype;for(s in n)a.plugins[s]=a.plugins[s]||[],a.plugins[s].push([i,n[s]])},call:function(e,t,i){var n,s=e.plugins[t];if(s&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(n=0;s.length>n;n++)e.options[s[n][0]]&&s[n][1].apply(e.element,i)}},hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var n=i&&"left"===i?"scrollLeft":"scrollTop",s=!1;return t[n]>0?!0:(t[n]=1,s=t[n]>0,t[n]=0,s)}})})(jQuery);(function(t,e){var i=0,s=Array.prototype.slice,n=t.cleanData;t.cleanData=function(e){for(var i,s=0;null!=(i=e[s]);s++)try{t(i).triggerHandler("remove")}catch(o){}n(e)},t.widget=function(i,s,n){var o,a,r,h,l={},c=i.split(".")[0];i=i.split(".")[1],o=c+"-"+i,n||(n=s,s=t.Widget),t.expr[":"][o.toLowerCase()]=function(e){return!!t.data(e,o)},t[c]=t[c]||{},a=t[c][i],r=t[c][i]=function(t,i){return this._createWidget?(arguments.length&&this._createWidget(t,i),e):new r(t,i)},t.extend(r,a,{version:n.version,_proto:t.extend({},n),_childConstructors:[]}),h=new s,h.options=t.widget.extend({},h.options),t.each(n,function(i,n){return t.isFunction(n)?(l[i]=function(){var t=function(){return s.prototype[i].apply(this,arguments)},e=function(t){return s.prototype[i].apply(this,t)};return function(){var i,s=this._super,o=this._superApply;return this._super=t,this._superApply=e,i=n.apply(this,arguments),this._super=s,this._superApply=o,i}}(),e):(l[i]=n,e)}),r.prototype=t.widget.extend(h,{widgetEventPrefix:a?h.widgetEventPrefix||i:i},l,{constructor:r,namespace:c,widgetName:i,widgetFullName:o}),a?(t.each(a._childConstructors,function(e,i){var s=i.prototype;t.widget(s.namespace+"."+s.widgetName,r,i._proto)}),delete a._childConstructors):s._childConstructors.push(r),t.widget.bridge(i,r)},t.widget.extend=function(i){for(var n,o,a=s.call(arguments,1),r=0,h=a.length;h>r;r++)for(n in a[r])o=a[r][n],a[r].hasOwnProperty(n)&&o!==e&&(i[n]=t.isPlainObject(o)?t.isPlainObject(i[n])?t.widget.extend({},i[n],o):t.widget.extend({},o):o);return i},t.widget.bridge=function(i,n){var o=n.prototype.widgetFullName||i;t.fn[i]=function(a){var r="string"==typeof a,h=s.call(arguments,1),l=this;return a=!r&&h.length?t.widget.extend.apply(null,[a].concat(h)):a,r?this.each(function(){var s,n=t.data(this,o);return n?t.isFunction(n[a])&&"_"!==a.charAt(0)?(s=n[a].apply(n,h),s!==n&&s!==e?(l=s&&s.jquery?l.pushStack(s.get()):s,!1):e):t.error("no such method '"+a+"' for "+i+" widget instance"):t.error("cannot call methods on "+i+" prior to initialization; "+"attempted to call method '"+a+"'")}):this.each(function(){var e=t.data(this,o);e?e.option(a||{})._init():t.data(this,o,new n(a,this))}),l}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,s){s=t(s||this.defaultElement||this)[0],this.element=t(s),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=t(),this.hoverable=t(),this.focusable=t(),s!==this&&(t.data(s,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===s&&this.destroy()}}),this.document=t(s.style?s.ownerDocument:s.document||s),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:t.noop,widget:function(){return this.element},option:function(i,s){var n,o,a,r=i;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof i)if(r={},n=i.split("."),i=n.shift(),n.length){for(o=r[i]=t.widget.extend({},this.options[i]),a=0;n.length-1>a;a++)o[n[a]]=o[n[a]]||{},o=o[n[a]];if(i=n.pop(),1===arguments.length)return o[i]===e?null:o[i];o[i]=s}else{if(1===arguments.length)return this.options[i]===e?null:this.options[i];r[i]=s}return this._setOptions(r),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!e).attr("aria-disabled",e),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(i,s,n){var o,a=this;"boolean"!=typeof i&&(n=s,s=i,i=!1),n?(s=o=t(s),this.bindings=this.bindings.add(s)):(n=s,s=this.element,o=this.widget()),t.each(n,function(n,r){function h(){return i||a.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof r?a[r]:r).apply(a,arguments):e}"string"!=typeof r&&(h.guid=r.guid=r.guid||h.guid||t.guid++);var l=n.match(/^(\w+)\s*(.*)$/),c=l[1]+a.eventNamespace,u=l[2];u?o.delegate(u,c,h):s.bind(c,h)})},_off:function(t,e){e=(e||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(e).undelegate(e)},_delay:function(t,e){function i(){return("string"==typeof t?s[t]:t).apply(s,arguments)}var s=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,i,s){var n,o,a=this.options[e];if(s=s||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(n in o)n in i||(i[n]=o[n]);return this.element.trigger(i,s),!(t.isFunction(a)&&a.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(s,n,o){"string"==typeof n&&(n={effect:n});var a,r=n?n===!0||"number"==typeof n?i:n.effect||i:e;n=n||{},"number"==typeof n&&(n={duration:n}),a=!t.isEmptyObject(n),n.complete=o,n.delay&&s.delay(n.delay),a&&t.effects&&t.effects.effect[r]?s[e](n):r!==e&&s[r]?s[r](n.duration,n.easing,o):s.queue(function(i){t(this)[e](),o&&o.call(s[0]),i()})}})})(jQuery);(function(t){var e=!1;t(document).mouseup(function(){e=!1}),t.widget("ui.mouse",{version:"1.10.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).bind("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):undefined}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(i){if(!e){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var s=this,n=1===i.which,a="string"==typeof this.options.cancel&&i.target.nodeName?t(i.target).closest(this.options.cancel).length:!1;return n&&!a&&this._mouseCapture(i)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){s.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted)?(i.preventDefault(),!0):(!0===t.data(i.target,this.widgetName+".preventClickEvent")&&t.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return s._mouseMove(t)},this._mouseUpDelegate=function(t){return s._mouseUp(t)},t(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),i.preventDefault(),e=!0,!0)):!0}},_mouseMove:function(e){return t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button?this._mouseUp(e):this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){return t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),!1},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})})(jQuery);(function(t,e){function i(t,e,i){return[parseFloat(t[0])*(p.test(t[0])?e/100:1),parseFloat(t[1])*(p.test(t[1])?i/100:1)]}function s(e,i){return parseInt(t.css(e,i),10)||0}function n(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}t.ui=t.ui||{};var a,o=Math.max,r=Math.abs,l=Math.round,h=/left|center|right/,c=/top|center|bottom/,u=/[\+\-]\d+(\.[\d]+)?%?/,d=/^\w+/,p=/%$/,f=t.fn.position;t.position={scrollbarWidth:function(){if(a!==e)return a;var i,s,n=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=n.children()[0];return t("body").append(n),i=o.offsetWidth,n.css("overflow","scroll"),s=o.offsetWidth,i===s&&(s=n[0].clientWidth),n.remove(),a=i-s},getScrollInfo:function(e){var i=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),s=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),n="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth,a="scroll"===s||"auto"===s&&e.height<e.element[0].scrollHeight;return{width:a?t.position.scrollbarWidth():0,height:n?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),s=t.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:s,isDocument:n,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:s?i.width():i.outerWidth(),height:s?i.height():i.outerHeight()}}},t.fn.position=function(e){if(!e||!e.of)return f.apply(this,arguments);e=t.extend({},e);var a,p,g,m,v,_,b=t(e.of),y=t.position.getWithinInfo(e.within),k=t.position.getScrollInfo(y),w=(e.collision||"flip").split(" "),D={};return _=n(b),b[0].preventDefault&&(e.at="left top"),p=_.width,g=_.height,m=_.offset,v=t.extend({},m),t.each(["my","at"],function(){var t,i,s=(e[this]||"").split(" ");1===s.length&&(s=h.test(s[0])?s.concat(["center"]):c.test(s[0])?["center"].concat(s):["center","center"]),s[0]=h.test(s[0])?s[0]:"center",s[1]=c.test(s[1])?s[1]:"center",t=u.exec(s[0]),i=u.exec(s[1]),D[this]=[t?t[0]:0,i?i[0]:0],e[this]=[d.exec(s[0])[0],d.exec(s[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===e.at[0]?v.left+=p:"center"===e.at[0]&&(v.left+=p/2),"bottom"===e.at[1]?v.top+=g:"center"===e.at[1]&&(v.top+=g/2),a=i(D.at,p,g),v.left+=a[0],v.top+=a[1],this.each(function(){var n,h,c=t(this),u=c.outerWidth(),d=c.outerHeight(),f=s(this,"marginLeft"),_=s(this,"marginTop"),x=u+f+s(this,"marginRight")+k.width,C=d+_+s(this,"marginBottom")+k.height,M=t.extend({},v),T=i(D.my,c.outerWidth(),c.outerHeight());"right"===e.my[0]?M.left-=u:"center"===e.my[0]&&(M.left-=u/2),"bottom"===e.my[1]?M.top-=d:"center"===e.my[1]&&(M.top-=d/2),M.left+=T[0],M.top+=T[1],t.support.offsetFractions||(M.left=l(M.left),M.top=l(M.top)),n={marginLeft:f,marginTop:_},t.each(["left","top"],function(i,s){t.ui.position[w[i]]&&t.ui.position[w[i]][s](M,{targetWidth:p,targetHeight:g,elemWidth:u,elemHeight:d,collisionPosition:n,collisionWidth:x,collisionHeight:C,offset:[a[0]+T[0],a[1]+T[1]],my:e.my,at:e.at,within:y,elem:c})}),e.using&&(h=function(t){var i=m.left-M.left,s=i+p-u,n=m.top-M.top,a=n+g-d,l={target:{element:b,left:m.left,top:m.top,width:p,height:g},element:{element:c,left:M.left,top:M.top,width:u,height:d},horizontal:0>s?"left":i>0?"right":"center",vertical:0>a?"top":n>0?"bottom":"middle"};u>p&&p>r(i+s)&&(l.horizontal="center"),d>g&&g>r(n+a)&&(l.vertical="middle"),l.important=o(r(i),r(s))>o(r(n),r(a))?"horizontal":"vertical",e.using.call(this,t,l)}),c.offset(t.extend(M,{using:h}))})},t.ui.position={fit:{left:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollLeft:s.offset.left,a=s.width,r=t.left-e.collisionPosition.marginLeft,l=n-r,h=r+e.collisionWidth-a-n;e.collisionWidth>a?l>0&&0>=h?(i=t.left+l+e.collisionWidth-a-n,t.left+=l-i):t.left=h>0&&0>=l?n:l>h?n+a-e.collisionWidth:n:l>0?t.left+=l:h>0?t.left-=h:t.left=o(t.left-r,t.left)},top:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollTop:s.offset.top,a=e.within.height,r=t.top-e.collisionPosition.marginTop,l=n-r,h=r+e.collisionHeight-a-n;e.collisionHeight>a?l>0&&0>=h?(i=t.top+l+e.collisionHeight-a-n,t.top+=l-i):t.top=h>0&&0>=l?n:l>h?n+a-e.collisionHeight:n:l>0?t.top+=l:h>0?t.top-=h:t.top=o(t.top-r,t.top)}},flip:{left:function(t,e){var i,s,n=e.within,a=n.offset.left+n.scrollLeft,o=n.width,l=n.isWindow?n.scrollLeft:n.offset.left,h=t.left-e.collisionPosition.marginLeft,c=h-l,u=h+e.collisionWidth-o-l,d="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,p="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,f=-2*e.offset[0];0>c?(i=t.left+d+p+f+e.collisionWidth-o-a,(0>i||r(c)>i)&&(t.left+=d+p+f)):u>0&&(s=t.left-e.collisionPosition.marginLeft+d+p+f-l,(s>0||u>r(s))&&(t.left+=d+p+f))},top:function(t,e){var i,s,n=e.within,a=n.offset.top+n.scrollTop,o=n.height,l=n.isWindow?n.scrollTop:n.offset.top,h=t.top-e.collisionPosition.marginTop,c=h-l,u=h+e.collisionHeight-o-l,d="top"===e.my[1],p=d?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,f="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,g=-2*e.offset[1];0>c?(s=t.top+p+f+g+e.collisionHeight-o-a,t.top+p+f+g>c&&(0>s||r(c)>s)&&(t.top+=p+f+g)):u>0&&(i=t.top-e.collisionPosition.marginTop+p+f+g-l,t.top+p+f+g>u&&(i>0||u>r(i))&&(t.top+=p+f+g))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}},function(){var e,i,s,n,a,o=document.getElementsByTagName("body")[0],r=document.createElement("div");e=document.createElement(o?"div":"body"),s={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},o&&t.extend(s,{position:"absolute",left:"-1000px",top:"-1000px"});for(a in s)e.style[a]=s[a];e.appendChild(r),i=o||document.documentElement,i.insertBefore(e,i.firstChild),r.style.cssText="position: absolute; left: 10.7432222px;",n=t(r).offset().left,t.support.offsetFractions=n>10&&11>n,e.innerHTML="",i.removeChild(e)}()})(jQuery);(function(t){t.widget("ui.draggable",t.ui.mouse,{version:"1.10.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(e){var i=this.options;return this.helper||i.disabled||t(e.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(e),this.handle?(t(i.iframeFix===!0?"iframe":i.iframeFix).each(function(){t("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(t(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_mouseDrag:function(e,i){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",e,s)===!1)return this._mouseUp({}),!1;this.position=s.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=this,s=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(s=t.ui.ddmanager.drop(this,e)),this.dropped&&(s=this.dropped,this.dropped=!1),"original"!==this.options.helper||t.contains(this.element[0].ownerDocument,this.element[0])?("invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",e)!==!1&&i._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1):!1},_mouseUp:function(e){return t("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(e){return this.options.handle?!!t(e.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return s.parents("body").length||s.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s[0]===this.element[0]||/(fixed|absolute)/.test(s.css("position"))||s.css("position","absolute"),s},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.element.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options;return n.containment?"window"===n.containment?(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],undefined):"document"===n.containment?(this.containment=[0,0,t(document).width()-this.helperProportions.width-this.margins.left,(t(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],undefined):n.containment.constructor===Array?(this.containment=n.containment,undefined):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=t(n.containment),s=i[0],s&&(e="hidden"!==i.css("overflow"),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=i),undefined):(this.containment=null,undefined)},_convertPositionTo:function(e,i){i||(i=this.position);var s="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:n.scrollTop(),left:n.scrollLeft()}),{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*s}},_generatePosition:function(e){var i,s,n,a,o=this.options,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=e.pageX,h=e.pageY;return this.offset.scroll||(this.offset.scroll={top:r.scrollTop(),left:r.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(s=this.relative_container.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,e.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(h=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(h=i[3]+this.offset.click.top)),o.grid&&(n=o.grid[1]?this.originalPageY+Math.round((h-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,h=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-o.grid[1]:n+o.grid[1]:n,a=o.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,l=i?a-this.offset.click.left>=i[0]||a-this.offset.click.left>i[2]?a:a-this.offset.click.left>=i[0]?a-o.grid[0]:a+o.grid[0]:a)),{top:h-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(e,i,s){return s=s||this._uiHash(),t.ui.plugin.call(this,e,[i,s]),"drag"===e&&(this.positionAbs=this._convertPositionTo("absolute")),t.Widget.prototype._trigger.call(this,e,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i){var s=t(this).data("ui-draggable"),n=s.options,a=t.extend({},i,{item:s.element});s.sortables=[],t(n.connectToSortable).each(function(){var i=t.data(this,"ui-sortable");i&&!i.options.disabled&&(s.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",e,a))})},stop:function(e,i){var s=t(this).data("ui-draggable"),n=t.extend({},i,{item:s.element});t.each(s.sortables,function(){this.instance.isOver?(this.instance.isOver=0,s.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(e),this.instance.options.helper=this.instance.options._helper,"original"===s.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",e,n))})},drag:function(e,i){var s=t(this).data("ui-draggable"),n=this;t.each(s.sortables,function(){var a=!1,o=this;this.instance.positionAbs=s.positionAbs,this.instance.helperProportions=s.helperProportions,this.instance.offset.click=s.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(a=!0,t.each(s.sortables,function(){return this.instance.positionAbs=s.positionAbs,this.instance.helperProportions=s.helperProportions,this.instance.offset.click=s.offset.click,this!==o&&this.instance._intersectsWith(this.instance.containerCache)&&t.contains(o.instance.element[0],this.instance.element[0])&&(a=!1),a})),a?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=t(n).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},e.target=this.instance.currentItem[0],this.instance._mouseCapture(e,!0),this.instance._mouseStart(e,!0,!0),this.instance.offset.click.top=s.offset.click.top,this.instance.offset.click.left=s.offset.click.left,this.instance.offset.parent.left-=s.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=s.offset.parent.top-this.instance.offset.parent.top,s._trigger("toSortable",e),s.dropped=this.instance.element,s.currentItem=s.element,this.instance.fromOutside=s),this.instance.currentItem&&this.instance._mouseDrag(e)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",e,this.instance._uiHash(this.instance)),this.instance._mouseStop(e,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),s._trigger("fromSortable",e),s.dropped=!1)})}}),t.ui.plugin.add("draggable","cursor",{start:function(){var e=t("body"),i=t(this).data("ui-draggable").options;e.css("cursor")&&(i._cursor=e.css("cursor")),e.css("cursor",i.cursor)},stop:function(){var e=t(this).data("ui-draggable").options;e._cursor&&t("body").css("cursor",e._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i){var s=t(i.helper),n=t(this).data("ui-draggable").options;s.css("opacity")&&(n._opacity=s.css("opacity")),s.css("opacity",n.opacity)},stop:function(e,i){var s=t(this).data("ui-draggable").options;s._opacity&&t(i.helper).css("opacity",s._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(){var e=t(this).data("ui-draggable");e.scrollParent[0]!==document&&"HTML"!==e.scrollParent[0].tagName&&(e.overflowOffset=e.scrollParent.offset())},drag:function(e){var i=t(this).data("ui-draggable"),s=i.options,n=!1;i.scrollParent[0]!==document&&"HTML"!==i.scrollParent[0].tagName?(s.axis&&"x"===s.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-e.pageY<s.scrollSensitivity?i.scrollParent[0].scrollTop=n=i.scrollParent[0].scrollTop+s.scrollSpeed:e.pageY-i.overflowOffset.top<s.scrollSensitivity&&(i.scrollParent[0].scrollTop=n=i.scrollParent[0].scrollTop-s.scrollSpeed)),s.axis&&"y"===s.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-e.pageX<s.scrollSensitivity?i.scrollParent[0].scrollLeft=n=i.scrollParent[0].scrollLeft+s.scrollSpeed:e.pageX-i.overflowOffset.left<s.scrollSensitivity&&(i.scrollParent[0].scrollLeft=n=i.scrollParent[0].scrollLeft-s.scrollSpeed))):(s.axis&&"x"===s.axis||(e.pageY-t(document).scrollTop()<s.scrollSensitivity?n=t(document).scrollTop(t(document).scrollTop()-s.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<s.scrollSensitivity&&(n=t(document).scrollTop(t(document).scrollTop()+s.scrollSpeed))),s.axis&&"y"===s.axis||(e.pageX-t(document).scrollLeft()<s.scrollSensitivity?n=t(document).scrollLeft(t(document).scrollLeft()-s.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<s.scrollSensitivity&&(n=t(document).scrollLeft(t(document).scrollLeft()+s.scrollSpeed)))),n!==!1&&t.ui.ddmanager&&!s.dropBehaviour&&t.ui.ddmanager.prepareOffsets(i,e)}}),t.ui.plugin.add("draggable","snap",{start:function(){var e=t(this).data("ui-draggable"),i=e.options;e.snapElements=[],t(i.snap.constructor!==String?i.snap.items||":data(ui-draggable)":i.snap).each(function(){var i=t(this),s=i.offset();this!==e.element[0]&&e.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:s.top,left:s.left})})},drag:function(e,i){var s,n,a,o,r,l,h,c,u,d,p=t(this).data("ui-draggable"),g=p.options,f=g.snapTolerance,m=i.offset.left,_=m+p.helperProportions.width,v=i.offset.top,b=v+p.helperProportions.height;for(u=p.snapElements.length-1;u>=0;u--)r=p.snapElements[u].left,l=r+p.snapElements[u].width,h=p.snapElements[u].top,c=h+p.snapElements[u].height,r-f>_||m>l+f||h-f>b||v>c+f||!t.contains(p.snapElements[u].item.ownerDocument,p.snapElements[u].item)?(p.snapElements[u].snapping&&p.options.snap.release&&p.options.snap.release.call(p.element,e,t.extend(p._uiHash(),{snapItem:p.snapElements[u].item})),p.snapElements[u].snapping=!1):("inner"!==g.snapMode&&(s=f>=Math.abs(h-b),n=f>=Math.abs(c-v),a=f>=Math.abs(r-_),o=f>=Math.abs(l-m),s&&(i.position.top=p._convertPositionTo("relative",{top:h-p.helperProportions.height,left:0}).top-p.margins.top),n&&(i.position.top=p._convertPositionTo("relative",{top:c,left:0}).top-p.margins.top),a&&(i.position.left=p._convertPositionTo("relative",{top:0,left:r-p.helperProportions.width}).left-p.margins.left),o&&(i.position.left=p._convertPositionTo("relative",{top:0,left:l}).left-p.margins.left)),d=s||n||a||o,"outer"!==g.snapMode&&(s=f>=Math.abs(h-v),n=f>=Math.abs(c-b),a=f>=Math.abs(r-m),o=f>=Math.abs(l-_),s&&(i.position.top=p._convertPositionTo("relative",{top:h,left:0}).top-p.margins.top),n&&(i.position.top=p._convertPositionTo("relative",{top:c-p.helperProportions.height,left:0}).top-p.margins.top),a&&(i.position.left=p._convertPositionTo("relative",{top:0,left:r}).left-p.margins.left),o&&(i.position.left=p._convertPositionTo("relative",{top:0,left:l-p.helperProportions.width}).left-p.margins.left)),!p.snapElements[u].snapping&&(s||n||a||o||d)&&p.options.snap.snap&&p.options.snap.snap.call(p.element,e,t.extend(p._uiHash(),{snapItem:p.snapElements[u].item})),p.snapElements[u].snapping=s||n||a||o||d)}}),t.ui.plugin.add("draggable","stack",{start:function(){var e,i=this.data("ui-draggable").options,s=t.makeArray(t(i.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});s.length&&(e=parseInt(t(s[0]).css("zIndex"),10)||0,t(s).each(function(i){t(this).css("zIndex",e+i)}),this.css("zIndex",e+s.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i){var s=t(i.helper),n=t(this).data("ui-draggable").options;s.css("zIndex")&&(n._zIndex=s.css("zIndex")),s.css("zIndex",n.zIndex)},stop:function(e,i){var s=t(this).data("ui-draggable").options;s._zIndex&&t(i.helper).css("zIndex",s._zIndex)}})})(jQuery);(function(t){function e(t,e,i){return t>e&&e+i>t}t.widget("ui.droppable",{version:"1.10.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(s)?s:function(t){return t.is(s)},this.proportions=function(){return arguments.length?(e=arguments[0],undefined):e?e:e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},t.ui.ddmanager.droppables[i.scope]=t.ui.ddmanager.droppables[i.scope]||[],t.ui.ddmanager.droppables[i.scope].push(this),i.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var e=0,i=t.ui.ddmanager.droppables[this.options.scope];i.length>e;e++)i[e]===this&&i.splice(e,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(e,i){"accept"===e&&(this.accept=t.isFunction(i)?i:function(t){return t.is(i)}),t.Widget.prototype._setOption.apply(this,arguments)},_activate:function(e){var i=t.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",e,this.ui(i))},_deactivate:function(e){var i=t.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",e,this.ui(i))},_over:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",e,this.ui(i)))},_out:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",e,this.ui(i)))},_drop:function(e,i){var s=i||t.ui.ddmanager.current,n=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var e=t.data(this,"ui-droppable");return e.options.greedy&&!e.options.disabled&&e.options.scope===s.options.scope&&e.accept.call(e.element[0],s.currentItem||s.element)&&t.ui.intersect(s,t.extend(e,{offset:e.element.offset()}),e.options.tolerance)?(n=!0,!1):undefined}),n?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",e,this.ui(s)),this.element):!1):!1},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}}}),t.ui.intersect=function(t,i,s){if(!i.offset)return!1;var n,a,o=(t.positionAbs||t.position.absolute).left,r=(t.positionAbs||t.position.absolute).top,l=o+t.helperProportions.width,h=r+t.helperProportions.height,c=i.offset.left,u=i.offset.top,d=c+i.proportions().width,p=u+i.proportions().height;switch(s){case"fit":return o>=c&&d>=l&&r>=u&&p>=h;case"intersect":return o+t.helperProportions.width/2>c&&d>l-t.helperProportions.width/2&&r+t.helperProportions.height/2>u&&p>h-t.helperProportions.height/2;case"pointer":return n=(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,a=(t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top,e(a,u,i.proportions().height)&&e(n,c,i.proportions().width);case"touch":return(r>=u&&p>=r||h>=u&&p>=h||u>r&&h>p)&&(o>=c&&d>=o||l>=c&&d>=l||c>o&&l>d);default:return!1}},t.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(e,i){var s,n,a=t.ui.ddmanager.droppables[e.options.scope]||[],o=i?i.type:null,r=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(s=0;a.length>s;s++)if(!(a[s].options.disabled||e&&!a[s].accept.call(a[s].element[0],e.currentItem||e.element))){for(n=0;r.length>n;n++)if(r[n]===a[s].element[0]){a[s].proportions().height=0;continue t}a[s].visible="none"!==a[s].element.css("display"),a[s].visible&&("mousedown"===o&&a[s]._activate.call(a[s],i),a[s].offset=a[s].element.offset(),a[s].proportions({width:a[s].element[0].offsetWidth,height:a[s].element[0].offsetHeight}))}},drop:function(e,i){var s=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&t.ui.intersect(e,this,this.options.tolerance)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(e,i){e.element.parentsUntil("body").bind("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)})},drag:function(e,i){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,i),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,n,a,o=t.ui.intersect(e,this,this.options.tolerance),r=!o&&this.isover?"isout":o&&!this.isover?"isover":null;r&&(this.options.greedy&&(n=this.options.scope,a=this.element.parents(":data(ui-droppable)").filter(function(){return t.data(this,"ui-droppable").options.scope===n}),a.length&&(s=t.data(a[0],"ui-droppable"),s.greedyChild="isover"===r)),s&&"isover"===r&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,i),s&&"isout"===r&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(e,i){e.element.parentsUntil("body").unbind("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}}})(jQuery);(function(t){function e(t){return parseInt(t,10)||0}function i(t){return!isNaN(parseInt(t,10))}t.widget("ui.resizable",t.ui.mouse,{version:"1.10.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var e,i,s,n,a,o=this,r=this.options;if(this.element.addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!r.aspectRatio,aspectRatio:r.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:r.helper||r.ghost||r.animate?r.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=r.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),e=this.handles.split(","),this.handles={},i=0;e.length>i;i++)s=t.trim(e[i]),a="ui-resizable-"+s,n=t("<div class='ui-resizable-handle "+a+"'></div>"),n.css({zIndex:r.zIndex}),"se"===s&&n.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[s]=".ui-resizable-"+s,this.element.append(n);this._renderAxis=function(e){var i,s,n,a;e=e||this.element;for(i in this.handles)this.handles[i].constructor===String&&(this.handles[i]=t(this.handles[i],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(s=t(this.handles[i],this.element),a=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(n,a),this._proportionallyResize()),t(this.handles[i]).length},this._renderAxis(this.element),this._handles=t(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){o.resizing||(this.className&&(n=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),o.axis=n&&n[1]?n[1]:"se")}),r.autoHide&&(this._handles.hide(),t(this.element).addClass("ui-resizable-autohide").mouseenter(function(){r.disabled||(t(this).removeClass("ui-resizable-autohide"),o._handles.show())}).mouseleave(function(){r.disabled||o.resizing||(t(this).addClass("ui-resizable-autohide"),o._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,i=function(e){t(e).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(e){var i,s,n=!1;for(i in this.handles)s=t(this.handles[i])[0],(s===e.target||t.contains(s,e.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(i){var s,n,a,o=this.options,r=this.element.position(),h=this.element;return this.resizing=!0,/absolute/.test(h.css("position"))?h.css({position:"absolute",top:h.css("top"),left:h.css("left")}):h.is(".ui-draggable")&&h.css({position:"absolute",top:r.top,left:r.left}),this._renderProxy(),s=e(this.helper.css("left")),n=e(this.helper.css("top")),o.containment&&(s+=t(o.containment).scrollLeft()||0,n+=t(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:s,top:n},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:h.width(),height:h.height()},this.originalSize=this._helper?{width:h.outerWidth(),height:h.outerHeight()}:{width:h.width(),height:h.height()},this.originalPosition={left:s,top:n},this.sizeDiff={width:h.outerWidth()-h.width(),height:h.outerHeight()-h.height()},this.originalMousePosition={left:i.pageX,top:i.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,a=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===a?this.axis+"-resize":a),h.addClass("ui-resizable-resizing"),this._propagate("start",i),!0},_mouseDrag:function(e){var i,s=this.helper,n={},a=this.originalMousePosition,o=this.axis,r=this.position.top,h=this.position.left,l=this.size.width,c=this.size.height,u=e.pageX-a.left||0,d=e.pageY-a.top||0,p=this._change[o];return p?(i=p.apply(this,[e,u,d]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(i=this._updateRatio(i,e)),i=this._respectSize(i,e),this._updateCache(i),this._propagate("resize",e),this.position.top!==r&&(n.top=this.position.top+"px"),this.position.left!==h&&(n.left=this.position.left+"px"),this.size.width!==l&&(n.width=this.size.width+"px"),this.size.height!==c&&(n.height=this.size.height+"px"),s.css(n),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(n)||this._trigger("resize",e,this.ui()),!1):!1},_mouseStop:function(e){this.resizing=!1;var i,s,n,a,o,r,h,l=this.options,c=this;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),n=s&&t.ui.hasScroll(i[0],"left")?0:c.sizeDiff.height,a=s?0:c.sizeDiff.width,o={width:c.helper.width()-a,height:c.helper.height()-n},r=parseInt(c.element.css("left"),10)+(c.position.left-c.originalPosition.left)||null,h=parseInt(c.element.css("top"),10)+(c.position.top-c.originalPosition.top)||null,l.animate||this.element.css(t.extend(o,{top:h,left:r})),c.helper.height(c.size.height),c.helper.width(c.size.width),this._helper&&!l.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(t){var e,s,n,a,o,r=this.options;o={minWidth:i(r.minWidth)?r.minWidth:0,maxWidth:i(r.maxWidth)?r.maxWidth:1/0,minHeight:i(r.minHeight)?r.minHeight:0,maxHeight:i(r.maxHeight)?r.maxHeight:1/0},(this._aspectRatio||t)&&(e=o.minHeight*this.aspectRatio,n=o.minWidth/this.aspectRatio,s=o.maxHeight*this.aspectRatio,a=o.maxWidth/this.aspectRatio,e>o.minWidth&&(o.minWidth=e),n>o.minHeight&&(o.minHeight=n),o.maxWidth>s&&(o.maxWidth=s),o.maxHeight>a&&(o.maxHeight=a)),this._vBoundaries=o},_updateCache:function(t){this.offset=this.helper.offset(),i(t.left)&&(this.position.left=t.left),i(t.top)&&(this.position.top=t.top),i(t.height)&&(this.size.height=t.height),i(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,s=this.size,n=this.axis;return i(t.height)?t.width=t.height*this.aspectRatio:i(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===n&&(t.left=e.left+(s.width-t.width),t.top=null),"nw"===n&&(t.top=e.top+(s.height-t.height),t.left=e.left+(s.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,s=this.axis,n=i(t.width)&&e.maxWidth&&e.maxWidth<t.width,a=i(t.height)&&e.maxHeight&&e.maxHeight<t.height,o=i(t.width)&&e.minWidth&&e.minWidth>t.width,r=i(t.height)&&e.minHeight&&e.minHeight>t.height,h=this.originalPosition.left+this.originalSize.width,l=this.position.top+this.size.height,c=/sw|nw|w/.test(s),u=/nw|ne|n/.test(s);return o&&(t.width=e.minWidth),r&&(t.height=e.minHeight),n&&(t.width=e.maxWidth),a&&(t.height=e.maxHeight),o&&c&&(t.left=h-e.minWidth),n&&c&&(t.left=h-e.maxWidth),r&&u&&(t.top=l-e.minHeight),a&&u&&(t.top=l-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var t,e,i,s,n,a=this.helper||this.element;for(t=0;this._proportionallyResizeElements.length>t;t++){if(n=this._proportionallyResizeElements[t],!this.borderDif)for(this.borderDif=[],i=[n.css("borderTopWidth"),n.css("borderRightWidth"),n.css("borderBottomWidth"),n.css("borderLeftWidth")],s=[n.css("paddingTop"),n.css("paddingRight"),n.css("paddingBottom"),n.css("paddingLeft")],e=0;i.length>e;e++)this.borderDif[e]=(parseInt(i[e],10)||0)+(parseInt(s[e],10)||0);n.css({height:a.height()-this.borderDif[0]-this.borderDif[2]||0,width:a.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var e=this.element,i=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){var i=this.originalSize,s=this.originalPosition;return{left:s.left+e,width:i.width-e}},n:function(t,e,i){var s=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:s.height-i}},s:function(t,e,i){return{height:this.originalSize.height+i}},se:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},sw:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,s]))},ne:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},nw:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,s]))}},_propagate:function(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!==e&&this._trigger(e,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var i=t(this).data("ui-resizable"),s=i.options,n=i._proportionallyResizeElements,a=n.length&&/textarea/i.test(n[0].nodeName),o=a&&t.ui.hasScroll(n[0],"left")?0:i.sizeDiff.height,r=a?0:i.sizeDiff.width,h={width:i.size.width-r,height:i.size.height-o},l=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,c=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(h,c&&l?{top:c,left:l}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};n&&n.length&&t(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var i,s,n,a,o,r,h,l=t(this).data("ui-resizable"),c=l.options,u=l.element,d=c.containment,p=d instanceof t?d.get(0):/parent/.test(d)?u.parent().get(0):d;p&&(l.containerElement=t(p),/document/.test(d)||d===document?(l.containerOffset={left:0,top:0},l.containerPosition={left:0,top:0},l.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(i=t(p),s=[],t(["Top","Right","Left","Bottom"]).each(function(t,n){s[t]=e(i.css("padding"+n))}),l.containerOffset=i.offset(),l.containerPosition=i.position(),l.containerSize={height:i.innerHeight()-s[3],width:i.innerWidth()-s[1]},n=l.containerOffset,a=l.containerSize.height,o=l.containerSize.width,r=t.ui.hasScroll(p,"left")?p.scrollWidth:o,h=t.ui.hasScroll(p)?p.scrollHeight:a,l.parentData={element:p,left:n.left,top:n.top,width:r,height:h}))},resize:function(e){var i,s,n,a,o=t(this).data("ui-resizable"),r=o.options,h=o.containerOffset,l=o.position,c=o._aspectRatio||e.shiftKey,u={top:0,left:0},d=o.containerElement;d[0]!==document&&/static/.test(d.css("position"))&&(u=h),l.left<(o._helper?h.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-h.left:o.position.left-u.left),c&&(o.size.height=o.size.width/o.aspectRatio),o.position.left=r.helper?h.left:0),l.top<(o._helper?h.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-h.top:o.position.top),c&&(o.size.width=o.size.height*o.aspectRatio),o.position.top=o._helper?h.top:0),o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top,i=Math.abs((o._helper?o.offset.left-u.left:o.offset.left-u.left)+o.sizeDiff.width),s=Math.abs((o._helper?o.offset.top-u.top:o.offset.top-h.top)+o.sizeDiff.height),n=o.containerElement.get(0)===o.element.parent().get(0),a=/relative|absolute/.test(o.containerElement.css("position")),n&&a&&(i-=Math.abs(o.parentData.left)),i+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-i,c&&(o.size.height=o.size.width/o.aspectRatio)),s+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-s,c&&(o.size.width=o.size.height*o.aspectRatio))},stop:function(){var e=t(this).data("ui-resizable"),i=e.options,s=e.containerOffset,n=e.containerPosition,a=e.containerElement,o=t(e.helper),r=o.offset(),h=o.outerWidth()-e.sizeDiff.width,l=o.outerHeight()-e.sizeDiff.height;e._helper&&!i.animate&&/relative/.test(a.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:h,height:l}),e._helper&&!i.animate&&/static/.test(a.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:h,height:l})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var e=t(this).data("ui-resizable"),i=e.options,s=function(e){t(e).each(function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseInt(e.width(),10),height:parseInt(e.height(),10),left:parseInt(e.css("left"),10),top:parseInt(e.css("top"),10)})})};"object"!=typeof i.alsoResize||i.alsoResize.parentNode?s(i.alsoResize):i.alsoResize.length?(i.alsoResize=i.alsoResize[0],s(i.alsoResize)):t.each(i.alsoResize,function(t){s(t)})},resize:function(e,i){var s=t(this).data("ui-resizable"),n=s.options,a=s.originalSize,o=s.originalPosition,r={height:s.size.height-a.height||0,width:s.size.width-a.width||0,top:s.position.top-o.top||0,left:s.position.left-o.left||0},h=function(e,s){t(e).each(function(){var e=t(this),n=t(this).data("ui-resizable-alsoresize"),a={},o=s&&s.length?s:e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(o,function(t,e){var i=(n[e]||0)+(r[e]||0);i&&i>=0&&(a[e]=i||null)}),e.css(a)})};"object"!=typeof n.alsoResize||n.alsoResize.nodeType?h(n.alsoResize):t.each(n.alsoResize,function(t,e){h(t,e)})},stop:function(){t(this).removeData("resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).data("ui-resizable"),i=e.options,s=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:s.height,width:s.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).data("ui-resizable");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).data("ui-resizable");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e=t(this).data("ui-resizable"),i=e.options,s=e.size,n=e.originalSize,a=e.originalPosition,o=e.axis,r="number"==typeof i.grid?[i.grid,i.grid]:i.grid,h=r[0]||1,l=r[1]||1,c=Math.round((s.width-n.width)/h)*h,u=Math.round((s.height-n.height)/l)*l,d=n.width+c,p=n.height+u,f=i.maxWidth&&d>i.maxWidth,g=i.maxHeight&&p>i.maxHeight,m=i.minWidth&&i.minWidth>d,v=i.minHeight&&i.minHeight>p;i.grid=r,m&&(d+=h),v&&(p+=l),f&&(d-=h),g&&(p-=l),/^(se|s|e)$/.test(o)?(e.size.width=d,e.size.height=p):/^(ne)$/.test(o)?(e.size.width=d,e.size.height=p,e.position.top=a.top-u):/^(sw)$/.test(o)?(e.size.width=d,e.size.height=p,e.position.left=a.left-c):(p-l>0?(e.size.height=p,e.position.top=a.top-u):(e.size.height=l,e.position.top=a.top+n.height-l),d-h>0?(e.size.width=d,e.position.left=a.left-c):(e.size.width=h,e.position.left=a.left+n.width-h))}})})(jQuery);(function(t){function e(t,e,i){return t>e&&e+i>t}function i(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))}t.widget("ui.sortable",t.ui.mouse,{version:"1.10.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var t=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===t.axis||i(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_setOption:function(e,i){"disabled"===e?(this.options[e]=i,this.widget().toggleClass("ui-sortable-disabled",!!i)):t.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(e,i){var s=null,n=!1,o=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,o.widgetName+"-item")===o?(s=t(this),!1):undefined}),t.data(e.target,o.widgetName+"-item")===o&&(s=t(e.target)),s?!this.options.handle||i||(t(this.options.handle,s).find("*").addBack().each(function(){this===e.target&&(n=!0)}),n)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(e,i,s){var n,o,a=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&"auto"!==a.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",a.cursor),this.storedStylesheet=t("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(o)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,s,n,o,a=this.options,r=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<a.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+a.scrollSpeed:e.pageY-this.overflowOffset.top<a.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-a.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<a.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+a.scrollSpeed:e.pageX-this.overflowOffset.left<a.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-a.scrollSpeed)):(e.pageY-t(document).scrollTop()<a.scrollSensitivity?r=t(document).scrollTop(t(document).scrollTop()-a.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<a.scrollSensitivity&&(r=t(document).scrollTop(t(document).scrollTop()+a.scrollSpeed)),e.pageX-t(document).scrollLeft()<a.scrollSensitivity?r=t(document).scrollLeft(t(document).scrollLeft()-a.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<a.scrollSensitivity&&(r=t(document).scrollLeft(t(document).scrollLeft()+a.scrollSpeed))),r!==!1&&t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],o=this._intersectsWithPointer(s),o&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==n&&!t.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!t.contains(this.element[0],n):!0)){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(e,s),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var s=this,n=this.placeholder.offset(),o=this.options.axis,a={};o&&"x"!==o||(a.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(a.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(a,parseInt(this.options.revert,10)||500,function(){s._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&s.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!s.length&&e.key&&s.push(e.key+"="),s.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},i.each(function(){s.push(t(e.item||this).attr(e.attribute||"id")||"")}),s},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,o=t.left,a=o+t.width,r=t.top,h=r+t.height,l=this.offset.click.top,c=this.offset.click.left,u="x"===this.options.axis||s+l>r&&h>s+l,d="y"===this.options.axis||e+c>o&&a>e+c,p=u&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?p:e+this.helperProportions.width/2>o&&a>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&h>n-this.helperProportions.height/2},_intersectsWithPointer:function(t){var i="x"===this.options.axis||e(this.positionAbs.top+this.offset.click.top,t.top,t.height),s="y"===this.options.axis||e(this.positionAbs.left+this.offset.click.left,t.left,t.width),n=i&&s,o=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return n?this.floating?a&&"right"===a||"down"===o?2:1:o&&("down"===o?2:1):!1},_intersectsWithSides:function(t){var i=e(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),s=e(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),n=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return this.floating&&o?"right"===o&&s||"left"===o&&!s:n&&("down"===n&&i||"up"===n&&!i)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){r.push(this)}var s,n,o,a,r=[],h=[],l=this._connectWith();if(l&&e)for(s=l.length-1;s>=0;s--)for(o=t(l[s]),n=o.length-1;n>=0;n--)a=t.data(o[n],this.widgetFullName),a&&a!==this&&!a.options.disabled&&h.push([t.isFunction(a.options.items)?a.options.items.call(a.element):t(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a]);for(h.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=h.length-1;s>=0;s--)h[s][0].each(i);return t(r)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,s,n,o,a,r,h,l,c=this.items,u=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--)for(n=t(d[i]),s=n.length-1;s>=0;s--)o=t.data(n[s],this.widgetFullName),o&&o!==this&&!o.options.disabled&&(u.push([t.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):t(o.options.items,o.element),o]),this.containers.push(o));for(i=u.length-1;i>=0;i--)for(a=u[i][1],r=u[i][0],s=0,l=r.length;l>s;s++)h=t(r[s]),h.data(this.widgetName+"-item",a),c.push({item:h,instance:a,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,o;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?t(this.options.toleranceElement,s.item):s.item,e||(s.width=n.outerWidth(),s.height=n.outerHeight()),o=n.offset(),s.left=o.left,s.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var i,s=e.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=e.currentItem[0].nodeName.toLowerCase(),n=t("<"+s+">",e.document[0]).addClass(i||e.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===s?e.currentItem.children().each(function(){t("<td>&#160;</td>",e.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(n)}):"img"===s&&n.attr("src",e.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(t,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(s.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),s.placeholder.update(e,e.placeholder)},_contactContainers:function(s){var n,o,a,r,h,l,c,u,d,p,f=null,g=null;for(n=this.containers.length-1;n>=0;n--)if(!t.contains(this.currentItem[0],this.containers[n].element[0]))if(this._intersectsWith(this.containers[n].containerCache)){if(f&&t.contains(this.containers[n].element[0],f.element[0]))continue;f=this.containers[n],g=n}else this.containers[n].containerCache.over&&(this.containers[n]._trigger("out",s,this._uiHash(this)),this.containers[n].containerCache.over=0);if(f)if(1===this.containers.length)this.containers[g].containerCache.over||(this.containers[g]._trigger("over",s,this._uiHash(this)),this.containers[g].containerCache.over=1);else{for(a=1e4,r=null,p=f.floating||i(this.currentItem),h=p?"left":"top",l=p?"width":"height",c=this.positionAbs[h]+this.offset.click[h],o=this.items.length-1;o>=0;o--)t.contains(this.containers[g].element[0],this.items[o].item[0])&&this.items[o].item[0]!==this.currentItem[0]&&(!p||e(this.positionAbs.top+this.offset.click.top,this.items[o].top,this.items[o].height))&&(u=this.items[o].item.offset()[h],d=!1,Math.abs(u-c)>Math.abs(u+this.items[o][l]-c)&&(d=!0,u+=this.items[o][l]),a>Math.abs(u-c)&&(a=Math.abs(u-c),r=this.items[o],this.direction=d?"up":"down"));if(!r&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[g])return;r?this._rearrange(s,r,null,!0):this._rearrange(s,null,this.containers[g].element,!0),this._trigger("change",s,this._uiHash()),this.containers[g]._trigger("change",s,this._uiHash(this)),this.currentContainer=this.containers[g],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[g]._trigger("over",s,this._uiHash(this)),this.containers[g].containerCache.over=1}},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,t("document"===n.containment?document:window).width()-this.helperProportions.width-this.margins.left,(t("document"===n.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(e=t(n.containment)[0],i=t(n.containment).offset(),s="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var s="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())*s}},_generatePosition:function(e){var i,s,n=this.options,o=e.pageX,a=e.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((a-this.originalPageY)/n.grid[1])*n.grid[1],a=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0],o=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():h?0:r.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():h?0:r.scrollLeft())}},_rearrange:function(t,e,i,s){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(t,e){function i(t,e,i){return function(s){i._trigger(t,s,e._uiHash(e))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&n.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||n.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(n.push(function(t){this._trigger("remove",t,this._uiHash())}),n.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)e||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!e){for(this._trigger("beforeStop",t,this._uiHash()),s=0;n.length>s;s++)n[s].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!1}if(e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!e){for(s=0;n.length>s;s++)n[s].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}})})(jQuery);(function(e){e.widget("ui.autocomplete",{version:"1.10.4",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var t,i,s,n=this.element[0].nodeName.toLowerCase(),a="textarea"===n,o="input"===n;this.isMultiLine=a?!0:o?!1:this.element.prop("isContentEditable"),this.valueMethod=this.element[a||o?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return t=!0,s=!0,i=!0,undefined;t=!1,s=!1,i=!1;var a=e.ui.keyCode;switch(n.keyCode){case a.PAGE_UP:t=!0,this._move("previousPage",n);break;case a.PAGE_DOWN:t=!0,this._move("nextPage",n);break;case a.UP:t=!0,this._keyEvent("previous",n);break;case a.DOWN:t=!0,this._keyEvent("next",n);break;case a.ENTER:case a.NUMPAD_ENTER:this.menu.active&&(t=!0,n.preventDefault(),this.menu.select(n));break;case a.TAB:this.menu.active&&this.menu.select(n);break;case a.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(s){if(t)return t=!1,(!this.isMultiLine||this.menu.element.is(":visible"))&&s.preventDefault(),undefined;if(!i){var n=e.ui.keyCode;switch(s.keyCode){case n.PAGE_UP:this._move("previousPage",s);break;case n.PAGE_DOWN:this._move("nextPage",s);break;case n.UP:this._keyEvent("previous",s);break;case n.DOWN:this._keyEvent("next",s)}}},input:function(e){return s?(s=!1,e.preventDefault(),undefined):(this._searchTimeout(e),undefined)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){return this.cancelBlur?(delete this.cancelBlur,undefined):(clearTimeout(this.searching),this.close(e),this._change(e),undefined)}}),this._initSource(),this.menu=e("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().data("ui-menu"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];e(t.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;this.document.one("mousedown",function(s){s.target===t.element[0]||s.target===i||e.contains(i,s.target)||t.close()})})},menufocus:function(t,i){if(this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type)))return this.menu.blur(),this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent)}),undefined;var s=i.item.data("ui-autocomplete-item");!1!==this._trigger("focus",t,{item:s})?t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(s.value):this.liveRegion.text(s.value)},menuselect:function(e,t){var i=t.item.data("ui-autocomplete-item"),s=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=s,this._delay(function(){this.previous=s,this.selectedItem=i})),!1!==this._trigger("select",e,{item:i})&&this._value(i.value),this.term=this._value(),this.close(e),this.selectedItem=i}}),this.liveRegion=e("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertBefore(this.element),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this._appendTo()),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t},_initSource:function(){var t,i,s=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(i,s){s(e.ui.autocomplete.filter(t,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(t,n){s.xhr&&s.xhr.abort(),s.xhr=e.ajax({url:i,data:t,dataType:"json",success:function(e){n(e)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):this._trigger("search",t)!==!1?this._search(e):undefined},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var t=++this.requestIndex;return e.proxy(function(e){t===this.requestIndex&&this.__response(e),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},this)},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return"string"==typeof t?{label:t,value:t}:e.extend({label:t.label||t.value,value:t.value||t.label},t)})},_suggest:function(t){var i=this.menu.element.empty();this._renderMenu(i,t),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,i){var s=this;e.each(i,function(e,i){s._renderItemData(t,i)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,i){return e("<li>").append(e("<a>").text(i.label)).appendTo(t)},_move:function(e,t){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this._value(this.term),this.menu.blur(),undefined):(this.menu[e](t),undefined):(this.search(null,t),undefined)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(e,t),t.preventDefault())}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,i){var s=RegExp(e.ui.autocomplete.escapeRegex(i),"i");return e.grep(t,function(e){return s.test(e.label||e.value||e)})}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var t;this._superApply(arguments),this.options.disabled||this.cancelSearch||(t=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.text(t))}})})(jQuery);(function(t){t.widget("ui.menu",{version:"1.10.4",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,t.proxy(function(t){this.options.disabled&&t.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(t){t.preventDefault()},"click .ui-state-disabled > a":function(t){t.preventDefault()},"click .ui-menu-item:has(a)":function(e){var i=t(e.target).closest(".ui-menu-item");!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(e),e.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(e):!this.element.is(":focus")&&t(this.document[0].activeElement).closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(e){var i=t(e.currentTarget);i.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(e,i)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(t,e){var i=this.active||this.element.children(".ui-menu-item").eq(0);e||this.focus(t,i)},blur:function(e){this._delay(function(){t.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(e)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(e){t(e.target).closest(".ui-menu").length||this.collapseAll(e),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var e=t(this);e.data("ui-menu-submenu-carat")&&e.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(e){function i(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var s,n,a,o,r,l=!0;switch(e.keyCode){case t.ui.keyCode.PAGE_UP:this.previousPage(e);break;case t.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case t.ui.keyCode.HOME:this._move("first","first",e);break;case t.ui.keyCode.END:this._move("last","last",e);break;case t.ui.keyCode.UP:this.previous(e);break;case t.ui.keyCode.DOWN:this.next(e);break;case t.ui.keyCode.LEFT:this.collapse(e);break;case t.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(e);break;case t.ui.keyCode.ENTER:case t.ui.keyCode.SPACE:this._activate(e);break;case t.ui.keyCode.ESCAPE:this.collapse(e);break;default:l=!1,n=this.previousFilter||"",a=String.fromCharCode(e.keyCode),o=!1,clearTimeout(this.filterTimer),a===n?o=!0:a=n+a,r=RegExp("^"+i(a),"i"),s=this.activeMenu.children(".ui-menu-item").filter(function(){return r.test(t(this).children("a").text())}),s=o&&-1!==s.index(this.active.next())?this.active.nextAll(".ui-menu-item"):s,s.length||(a=String.fromCharCode(e.keyCode),r=RegExp("^"+i(a),"i"),s=this.activeMenu.children(".ui-menu-item").filter(function(){return r.test(t(this).children("a").text())})),s.length?(this.focus(e,s),s.length>1?(this.previousFilter=a,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}l&&e.preventDefault()},_activate:function(t){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(t):this.select(t))},refresh:function(){var e,i=this.options.icons.submenu,s=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length),s.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=t(this),s=e.prev("a"),n=t("<span>").addClass("ui-menu-icon ui-icon "+i).data("ui-menu-submenu-carat",!0);s.attr("aria-haspopup","true").prepend(n),e.attr("aria-labelledby",s.attr("id"))}),e=s.add(this.element),e.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),e.children(":not(.ui-menu-item)").each(function(){var e=t(this);/[^\-\u2014\u2013\s]/.test(e.text())||e.addClass("ui-widget-content ui-menu-divider")}),e.children(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!t.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(t,e){"icons"===t&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(e.submenu),this._super(t,e)},focus:function(t,e){var i,s;this.blur(t,t&&"focus"===t.type),this._scrollIntoView(e),this.active=e.first(),s=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",s.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),t&&"keydown"===t.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=e.children(".ui-menu"),i.length&&t&&/^mouse/.test(t.type)&&this._startOpening(i),this.activeMenu=e.parent(),this._trigger("focus",t,{item:e})},_scrollIntoView:function(e){var i,s,n,a,o,r;this._hasScroll()&&(i=parseFloat(t.css(this.activeMenu[0],"borderTopWidth"))||0,s=parseFloat(t.css(this.activeMenu[0],"paddingTop"))||0,n=e.offset().top-this.activeMenu.offset().top-i-s,a=this.activeMenu.scrollTop(),o=this.activeMenu.height(),r=e.height(),0>n?this.activeMenu.scrollTop(a+n):n+r>o&&this.activeMenu.scrollTop(a+n-o+r))},blur:function(t,e){e||clearTimeout(this.timer),this.active&&(this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",t,{item:this.active}))},_startOpening:function(t){clearTimeout(this.timer),"true"===t.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(t)},this.delay))},_open:function(e){var i=t.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(e,i){clearTimeout(this.timer),this.timer=this._delay(function(){var s=i?this.element:t(e&&e.target).closest(this.element.find(".ui-menu"));s.length||(s=this.element),this._close(s),this.blur(e),this.activeMenu=s},this.delay)},_close:function(t){t||(t=this.active?this.active.parent():this.element),t.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(t){var e=this.active&&this.active.parent().closest(".ui-menu-item",this.element);e&&e.length&&(this._close(),this.focus(t,e))},expand:function(t){var e=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();e&&e.length&&(this._open(e.parent()),this._delay(function(){this.focus(t,e)}))},next:function(t){this._move("next","first",t)},previous:function(t){this._move("prev","last",t)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(t,e,i){var s;this.active&&(s="first"===t||"last"===t?this.active["first"===t?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[t+"All"](".ui-menu-item").eq(0)),s&&s.length&&this.active||(s=this.activeMenu.children(".ui-menu-item")[e]()),this.focus(i,s)},nextPage:function(e){var i,s,n;return this.active?(this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=t(this),0>i.offset().top-s-n}),this.focus(e,i)):this.focus(e,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]())),undefined):(this.next(e),undefined)},previousPage:function(e){var i,s,n;return this.active?(this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=t(this),i.offset().top-s+n>0}),this.focus(e,i)):this.focus(e,this.activeMenu.children(".ui-menu-item").first())),undefined):(this.next(e),undefined)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||t(e.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,i)}})})(jQuery);(function(t){var e=5;t.widget("ui.slider",t.ui.mouse,{version:"1.10.4",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var e,i,s=this.options,n=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),a="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",o=[];for(i=s.values&&s.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),e=n.length;i>e;e++)o.push(a);this.handles=n.add(t(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(e){t(this).data("ui-slider-handle-index",e)})},_createRange:function(){var e=this.options,i="";e.range?(e.range===!0&&(e.values?e.values.length&&2!==e.values.length?e.values=[e.values[0],e.values[0]]:t.isArray(e.values)&&(e.values=e.values.slice(0)):e.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=t("<div></div>").appendTo(this.element),i="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(i+("min"===e.range||"max"===e.range?" ui-slider-range-"+e.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){var t=this.handles.add(this.range).filter("a");this._off(t),this._on(t,this._handleEvents),this._hoverable(t),this._focusable(t)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(e){var i,s,n,a,o,r,l,h,u=this,c=this.options;return c.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:e.pageX,y:e.pageY},s=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(e){var i=Math.abs(s-u.values(e));(n>i||n===i&&(e===u._lastChangedValue||u.values(e)===c.min))&&(n=i,a=t(this),o=e)}),r=this._start(e,o),r===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,a.addClass("ui-state-active").focus(),l=a.offset(),h=!t(e.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=h?{left:0,top:0}:{left:e.pageX-l.left-a.width()/2,top:e.pageY-l.top-a.height()/2-(parseInt(a.css("borderTopWidth"),10)||0)-(parseInt(a.css("borderBottomWidth"),10)||0)+(parseInt(a.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,o,s),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var e={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(e);return this._slide(t,this._handleIndex,i),!1},_mouseStop:function(t){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e,i,s,n,a;return"horizontal"===this.orientation?(e=this.elementSize.width,i=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,i=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),s=i/e,s>1&&(s=1),0>s&&(s=0),"vertical"===this.orientation&&(s=1-s),n=this._valueMax()-this._valueMin(),a=this._valueMin()+s*n,this._trimAlignValue(a)},_start:function(t,e){var i={handle:this.handles[e],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("start",t,i)},_slide:function(t,e,i){var s,n,a;this.options.values&&this.options.values.length?(s=this.values(e?0:1),2===this.options.values.length&&this.options.range===!0&&(0===e&&i>s||1===e&&s>i)&&(i=s),i!==this.values(e)&&(n=this.values(),n[e]=i,a=this._trigger("slide",t,{handle:this.handles[e],value:i,values:n}),s=this.values(e?0:1),a!==!1&&this.values(e,i))):i!==this.value()&&(a=this._trigger("slide",t,{handle:this.handles[e],value:i}),a!==!1&&this.value(i))},_stop:function(t,e){var i={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("stop",t,i)},_change:function(t,e){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._lastChangedValue=e,this._trigger("change",t,i)}},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),this._change(null,0),undefined):this._value()},values:function(e,i){var s,n,a;if(arguments.length>1)return this.options.values[e]=this._trimAlignValue(i),this._refreshValue(),this._change(null,e),undefined;if(!arguments.length)return this._values();if(!t.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(e):this.value();for(s=this.options.values,n=arguments[0],a=0;s.length>a;a+=1)s[a]=this._trimAlignValue(n[a]),this._change(null,a);this._refreshValue()},_setOption:function(e,i){var s,n=0;switch("range"===e&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),t.isArray(this.options.values)&&(n=this.options.values.length),t.Widget.prototype._setOption.apply(this,arguments),e){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=0;n>s;s+=1)this._change(null,s);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var t=this.options.value;return t=this._trimAlignValue(t)},_values:function(t){var e,i,s;if(arguments.length)return e=this.options.values[t],e=this._trimAlignValue(e);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),s=0;i.length>s;s+=1)i[s]=this._trimAlignValue(i[s]);return i}return[]},_trimAlignValue:function(t){if(this._valueMin()>=t)return this._valueMin();if(t>=this._valueMax())return this._valueMax();var e=this.options.step>0?this.options.step:1,i=(t-this._valueMin())%e,s=t-i;return 2*Math.abs(i)>=e&&(s+=i>0?e:-e),parseFloat(s.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var e,i,s,n,a,o=this.options.range,r=this.options,l=this,h=this._animateOff?!1:r.animate,u={};this.options.values&&this.options.values.length?this.handles.each(function(s){i=100*((l.values(s)-l._valueMin())/(l._valueMax()-l._valueMin())),u["horizontal"===l.orientation?"left":"bottom"]=i+"%",t(this).stop(1,1)[h?"animate":"css"](u,r.animate),l.options.range===!0&&("horizontal"===l.orientation?(0===s&&l.range.stop(1,1)[h?"animate":"css"]({left:i+"%"},r.animate),1===s&&l.range[h?"animate":"css"]({width:i-e+"%"},{queue:!1,duration:r.animate})):(0===s&&l.range.stop(1,1)[h?"animate":"css"]({bottom:i+"%"},r.animate),1===s&&l.range[h?"animate":"css"]({height:i-e+"%"},{queue:!1,duration:r.animate}))),e=i}):(s=this.value(),n=this._valueMin(),a=this._valueMax(),i=a!==n?100*((s-n)/(a-n)):0,u["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[h?"animate":"css"](u,r.animate),"min"===o&&"horizontal"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({width:i+"%"},r.animate),"max"===o&&"horizontal"===this.orientation&&this.range[h?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:r.animate}),"min"===o&&"vertical"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({height:i+"%"},r.animate),"max"===o&&"vertical"===this.orientation&&this.range[h?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:r.animate}))},_handleEvents:{keydown:function(i){var s,n,a,o,r=t(i.target).data("ui-slider-handle-index");switch(i.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(i.preventDefault(),!this._keySliding&&(this._keySliding=!0,t(i.target).addClass("ui-state-active"),s=this._start(i,r),s===!1))return}switch(o=this.options.step,n=a=this.options.values&&this.options.values.length?this.values(r):this.value(),i.keyCode){case t.ui.keyCode.HOME:a=this._valueMin();break;case t.ui.keyCode.END:a=this._valueMax();break;case t.ui.keyCode.PAGE_UP:a=this._trimAlignValue(n+(this._valueMax()-this._valueMin())/e);break;case t.ui.keyCode.PAGE_DOWN:a=this._trimAlignValue(n-(this._valueMax()-this._valueMin())/e);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(n===this._valueMax())return;a=this._trimAlignValue(n+o);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(n===this._valueMin())return;a=this._trimAlignValue(n-o)}this._slide(i,r,a)},click:function(t){t.preventDefault()},keyup:function(e){var i=t(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,i),this._change(e,i),t(e.target).removeClass("ui-state-active"))}}})})(jQuery);(function(t){function e(e,i){var s=(e.attr("aria-describedby")||"").split(/\s+/);s.push(i),e.data("ui-tooltip-id",i).attr("aria-describedby",t.trim(s.join(" ")))}function i(e){var i=e.data("ui-tooltip-id"),s=(e.attr("aria-describedby")||"").split(/\s+/),n=t.inArray(i,s);-1!==n&&s.splice(n,1),e.removeData("ui-tooltip-id"),s=t.trim(s.join(" ")),s?e.attr("aria-describedby",s):e.removeAttr("aria-describedby")}var s=0;t.widget("ui.tooltip",{version:"1.10.4",options:{content:function(){var e=t(this).attr("title")||"";return t("<a>").text(e).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable()},_setOption:function(e,i){var s=this;return"disabled"===e?(this[i?"_disable":"_enable"](),this.options[e]=i,void 0):(this._super(e,i),"content"===e&&t.each(this.tooltips,function(t,e){s._updateContent(e)}),void 0)},_disable:function(){var e=this;t.each(this.tooltips,function(i,s){var n=t.Event("blur");n.target=n.currentTarget=s[0],e.close(n,!0)}),this.element.find(this.options.items).addBack().each(function(){var e=t(this);e.is("[title]")&&e.data("ui-tooltip-title",e.attr("title")).attr("title","")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var e=t(this);e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title"))})},open:function(e){var i=this,s=t(e?e.target:this.element).closest(this.options.items);s.length&&!s.data("ui-tooltip-id")&&(s.attr("title")&&s.data("ui-tooltip-title",s.attr("title")),s.data("ui-tooltip-open",!0),e&&"mouseover"===e.type&&s.parents().each(function(){var e,s=t(this);s.data("ui-tooltip-open")&&(e=t.Event("blur"),e.target=e.currentTarget=this,i.close(e,!0)),s.attr("title")&&(s.uniqueId(),i.parents[this.id]={element:this,title:s.attr("title")},s.attr("title",""))}),this._updateContent(s,e))},_updateContent:function(t,e){var i,s=this.options.content,n=this,o=e?e.type:null;return"string"==typeof s?this._open(e,t,s):(i=s.call(t[0],function(i){t.data("ui-tooltip-open")&&n._delay(function(){e&&(e.type=o),this._open(e,t,i)})}),i&&this._open(e,t,i),void 0)},_open:function(i,s,n){function o(t){l.of=t,a.is(":hidden")||a.position(l)}var a,r,h,l=t.extend({},this.options.position);if(n){if(a=this._find(s),a.length)return a.find(".ui-tooltip-content").html(n),void 0;s.is("[title]")&&(i&&"mouseover"===i.type?s.attr("title",""):s.removeAttr("title")),a=this._tooltip(s),e(s,a.attr("id")),a.find(".ui-tooltip-content").html(n),this.options.track&&i&&/^mouse/.test(i.type)?(this._on(this.document,{mousemove:o}),o(i)):a.position(t.extend({of:s},this.options.position)),a.hide(),this._show(a,this.options.show),this.options.show&&this.options.show.delay&&(h=this.delayedShow=setInterval(function(){a.is(":visible")&&(o(l.of),clearInterval(h))},t.fx.interval)),this._trigger("open",i,{tooltip:a}),r={keyup:function(e){if(e.keyCode===t.ui.keyCode.ESCAPE){var i=t.Event(e);i.currentTarget=s[0],this.close(i,!0)}},remove:function(){this._removeTooltip(a)}},i&&"mouseover"!==i.type||(r.mouseleave="close"),i&&"focusin"!==i.type||(r.focusout="close"),this._on(!0,s,r)}},close:function(e){var s=this,n=t(e?e.currentTarget:this.element),o=this._find(n);this.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&n.attr("title",n.data("ui-tooltip-title")),i(n),o.stop(!0),this._hide(o,this.options.hide,function(){s._removeTooltip(t(this))}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),e&&"mouseleave"===e.type&&t.each(this.parents,function(e,i){t(i.element).attr("title",i.title),delete s.parents[e]}),this.closing=!0,this._trigger("close",e,{tooltip:o}),this.closing=!1)},_tooltip:function(e){var i="ui-tooltip-"+s++,n=t("<div>").attr({id:i,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return t("<div>").addClass("ui-tooltip-content").appendTo(n),n.appendTo(this.document[0].body),this.tooltips[i]=e,n},_find:function(e){var i=e.data("ui-tooltip-id");return i?t("#"+i):t()},_removeTooltip:function(t){t.remove(),delete this.tooltips[t.attr("id")]},_destroy:function(){var e=this;t.each(this.tooltips,function(i,s){var n=t.Event("blur");n.target=n.currentTarget=s[0],e.close(n,!0),t("#"+i).remove(),s.data("ui-tooltip-title")&&(s.attr("title",s.data("ui-tooltip-title")),s.removeData("ui-tooltip-title"))})}})})(jQuery);(function(t,e){var i="ui-effects-";t.effects={effect:{}},function(t,e){function i(t,e,i){var s=u[e.type]||{};return null==t?i||!e.def?null:e.def:(t=s.floor?~~t:parseFloat(t),isNaN(t)?e.def:s.mod?(t+s.mod)%s.mod:0>t?0:t>s.max?s.max:t)}function s(i){var s=h(),n=s._rgba=[];return i=i.toLowerCase(),f(l,function(t,a){var o,r=a.re.exec(i),l=r&&a.parse(r),h=a.space||"rgba";return l?(o=s[h](l),s[c[h].cache]=o[c[h].cache],n=s._rgba=o._rgba,!1):e}),n.length?("0,0,0,0"===n.join()&&t.extend(n,a.transparent),s):a[i]}function n(t,e,i){return i=(i+1)%1,1>6*i?t+6*(e-t)*i:1>2*i?e:2>3*i?t+6*(e-t)*(2/3-i):t}var a,o="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",r=/^([\-+])=\s*(\d+\.?\d*)/,l=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],h=t.Color=function(e,i,s,n){return new t.Color.fn.parse(e,i,s,n)},c={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},u={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},d=h.support={},p=t("<p>")[0],f=t.each;p.style.cssText="background-color:rgba(1,1,1,.5)",d.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(c,function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}}),h.fn=t.extend(h.prototype,{parse:function(n,o,r,l){if(n===e)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=t(n).css(o),o=e);var u=this,d=t.type(n),p=this._rgba=[];return o!==e&&(n=[n,o,r,l],d="array"),"string"===d?this.parse(s(n)||a._default):"array"===d?(f(c.rgba.props,function(t,e){p[e.idx]=i(n[e.idx],e)}),this):"object"===d?(n instanceof h?f(c,function(t,e){n[e.cache]&&(u[e.cache]=n[e.cache].slice())}):f(c,function(e,s){var a=s.cache;f(s.props,function(t,e){if(!u[a]&&s.to){if("alpha"===t||null==n[t])return;u[a]=s.to(u._rgba)}u[a][e.idx]=i(n[t],e,!0)}),u[a]&&0>t.inArray(null,u[a].slice(0,3))&&(u[a][3]=1,s.from&&(u._rgba=s.from(u[a])))}),this):e},is:function(t){var i=h(t),s=!0,n=this;return f(c,function(t,a){var o,r=i[a.cache];return r&&(o=n[a.cache]||a.to&&a.to(n._rgba)||[],f(a.props,function(t,i){return null!=r[i.idx]?s=r[i.idx]===o[i.idx]:e})),s}),s},_space:function(){var t=[],e=this;return f(c,function(i,s){e[s.cache]&&t.push(i)}),t.pop()},transition:function(t,e){var s=h(t),n=s._space(),a=c[n],o=0===this.alpha()?h("transparent"):this,r=o[a.cache]||a.to(o._rgba),l=r.slice();return s=s[a.cache],f(a.props,function(t,n){var a=n.idx,o=r[a],h=s[a],c=u[n.type]||{};null!==h&&(null===o?l[a]=h:(c.mod&&(h-o>c.mod/2?o+=c.mod:o-h>c.mod/2&&(o-=c.mod)),l[a]=i((h-o)*e+o,n)))}),this[n](l)},blend:function(e){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=h(e)._rgba;return h(t.map(i,function(t,e){return(1-s)*n[e]+s*t}))},toRgbaString:function(){var e="rgba(",i=t.map(this._rgba,function(t,e){return null==t?e>2?1:0:t});return 1===i[3]&&(i.pop(),e="rgb("),e+i.join()+")"},toHslaString:function(){var e="hsla(",i=t.map(this.hsla(),function(t,e){return null==t&&(t=e>2?1:0),e&&3>e&&(t=Math.round(100*t)+"%"),t});return 1===i[3]&&(i.pop(),e="hsl("),e+i.join()+")"},toHexString:function(e){var i=this._rgba.slice(),s=i.pop();return e&&i.push(~~(255*s)),"#"+t.map(i,function(t){return t=(t||0).toString(16),1===t.length?"0"+t:t}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),h.fn.parse.prototype=h.fn,c.hsla.to=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e,i,s=t[0]/255,n=t[1]/255,a=t[2]/255,o=t[3],r=Math.max(s,n,a),l=Math.min(s,n,a),h=r-l,c=r+l,u=.5*c;return e=l===r?0:s===r?60*(n-a)/h+360:n===r?60*(a-s)/h+120:60*(s-n)/h+240,i=0===h?0:.5>=u?h/c:h/(2-c),[Math.round(e)%360,i,u,null==o?1:o]},c.hsla.from=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/360,i=t[1],s=t[2],a=t[3],o=.5>=s?s*(1+i):s+i-s*i,r=2*s-o;return[Math.round(255*n(r,o,e+1/3)),Math.round(255*n(r,o,e)),Math.round(255*n(r,o,e-1/3)),a]},f(c,function(s,n){var a=n.props,o=n.cache,l=n.to,c=n.from;h.fn[s]=function(s){if(l&&!this[o]&&(this[o]=l(this._rgba)),s===e)return this[o].slice();var n,r=t.type(s),u="array"===r||"object"===r?s:arguments,d=this[o].slice();return f(a,function(t,e){var s=u["object"===r?t:e.idx];null==s&&(s=d[e.idx]),d[e.idx]=i(s,e)}),c?(n=h(c(d)),n[o]=d,n):h(d)},f(a,function(e,i){h.fn[e]||(h.fn[e]=function(n){var a,o=t.type(n),l="alpha"===e?this._hsla?"hsla":"rgba":s,h=this[l](),c=h[i.idx];return"undefined"===o?c:("function"===o&&(n=n.call(this,c),o=t.type(n)),null==n&&i.empty?this:("string"===o&&(a=r.exec(n),a&&(n=c+parseFloat(a[2])*("+"===a[1]?1:-1))),h[i.idx]=n,this[l](h)))})})}),h.hook=function(e){var i=e.split(" ");f(i,function(e,i){t.cssHooks[i]={set:function(e,n){var a,o,r="";if("transparent"!==n&&("string"!==t.type(n)||(a=s(n)))){if(n=h(a||n),!d.rgba&&1!==n._rgba[3]){for(o="backgroundColor"===i?e.parentNode:e;(""===r||"transparent"===r)&&o&&o.style;)try{r=t.css(o,"backgroundColor"),o=o.parentNode}catch(l){}n=n.blend(r&&"transparent"!==r?r:"_default")}n=n.toRgbaString()}try{e.style[i]=n}catch(l){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=h(e.elem,i),e.end=h(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}})},h.hook(o),t.cssHooks.borderColor={expand:function(t){var e={};return f(["Top","Right","Bottom","Left"],function(i,s){e["border"+s+"Color"]=t}),e}},a=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),function(){function i(e){var i,s,n=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,a={};if(n&&n.length&&n[0]&&n[n[0]])for(s=n.length;s--;)i=n[s],"string"==typeof n[i]&&(a[t.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(a[i]=n[i]);return a}function s(e,i){var s,n,o={};for(s in i)n=i[s],e[s]!==n&&(a[s]||(t.fx.step[s]||!isNaN(parseFloat(n)))&&(o[s]=n));return o}var n=["add","remove","toggle"],a={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,i){t.fx.step[i]=function(t){("none"!==t.end&&!t.setAttr||1===t.pos&&!t.setAttr)&&(jQuery.style(t.elem,i,t.end),t.setAttr=!0)}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.effects.animateClass=function(e,a,o,r){var l=t.speed(a,o,r);return this.queue(function(){var a,o=t(this),r=o.attr("class")||"",h=l.children?o.find("*").addBack():o;h=h.map(function(){var e=t(this);return{el:e,start:i(this)}}),a=function(){t.each(n,function(t,i){e[i]&&o[i+"Class"](e[i])})},a(),h=h.map(function(){return this.end=i(this.el[0]),this.diff=s(this.start,this.end),this}),o.attr("class",r),h=h.map(function(){var e=this,i=t.Deferred(),s=t.extend({},l,{queue:!1,complete:function(){i.resolve(e)}});return this.el.animate(this.diff,s),i.promise()}),t.when.apply(t,h.get()).done(function(){a(),t.each(arguments,function(){var e=this.el;t.each(this.diff,function(t){e.css(t,"")})}),l.complete.call(o[0])})})},t.fn.extend({addClass:function(e){return function(i,s,n,a){return s?t.effects.animateClass.call(this,{add:i},s,n,a):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(i,s,n,a){return arguments.length>1?t.effects.animateClass.call(this,{remove:i},s,n,a):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(i){return function(s,n,a,o,r){return"boolean"==typeof n||n===e?a?t.effects.animateClass.call(this,n?{add:s}:{remove:s},a,o,r):i.apply(this,arguments):t.effects.animateClass.call(this,{toggle:s},n,a,o)}}(t.fn.toggleClass),switchClass:function(e,i,s,n,a){return t.effects.animateClass.call(this,{add:i,remove:e},s,n,a)}})}(),function(){function s(e,i,s,n){return t.isPlainObject(e)&&(i=e,e=e.effect),e={effect:e},null==i&&(i={}),t.isFunction(i)&&(n=i,s=null,i={}),("number"==typeof i||t.fx.speeds[i])&&(n=s,s=i,i={}),t.isFunction(s)&&(n=s,s=null),i&&t.extend(e,i),s=s||i.duration,e.duration=t.fx.off?0:"number"==typeof s?s:s in t.fx.speeds?t.fx.speeds[s]:t.fx.speeds._default,e.complete=n||i.complete,e}function n(e){return!e||"number"==typeof e||t.fx.speeds[e]?!0:"string"!=typeof e||t.effects.effect[e]?t.isFunction(e)?!0:"object"!=typeof e||e.effect?!1:!0:!0}t.extend(t.effects,{version:"1.10.4",save:function(t,e){for(var s=0;e.length>s;s++)null!==e[s]&&t.data(i+e[s],t[0].style[e[s]])},restore:function(t,s){var n,a;for(a=0;s.length>a;a++)null!==s[a]&&(n=t.data(i+s[a]),n===e&&(n=""),t.css(s[a],n))},setMode:function(t,e){return"toggle"===e&&(e=t.is(":hidden")?"show":"hide"),e},getBaseline:function(t,e){var i,s;switch(t[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=t[0]/e.height}switch(t[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=t[1]/e.width}return{x:s,y:i}},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var i={width:e.outerWidth(!0),height:e.outerHeight(!0),"float":e.css("float")},s=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:e.width(),height:e.height()},a=document.activeElement;try{a.id}catch(o){a=document.body}return e.wrap(s),(e[0]===a||t.contains(e[0],a))&&t(a).focus(),s=e.parent(),"static"===e.css("position")?(s.css({position:"relative"}),e.css({position:"relative"})):(t.extend(i,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,s){i[s]=e.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(n),s.css(i).show()},removeWrapper:function(e){var i=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===i||t.contains(e[0],i))&&t(i).focus()),e},setTransition:function(e,i,s,n){return n=n||{},t.each(i,function(t,i){var a=e.cssUnit(i);a[0]>0&&(n[i]=a[0]*s+a[1])}),n}}),t.fn.extend({effect:function(){function e(e){function s(){t.isFunction(a)&&a.call(n[0]),t.isFunction(e)&&e()}var n=t(this),a=i.complete,r=i.mode;(n.is(":hidden")?"hide"===r:"show"===r)?(n[r](),s()):o.call(n[0],i,s)}var i=s.apply(this,arguments),n=i.mode,a=i.queue,o=t.effects.effect[i.effect];return t.fx.off||!o?n?this[n](i.duration,i.complete):this.each(function(){i.complete&&i.complete.call(this)}):a===!1?this.each(e):this.queue(a||"fx",e)},show:function(t){return function(e){if(n(e))return t.apply(this,arguments);var i=s.apply(this,arguments);return i.mode="show",this.effect.call(this,i)}}(t.fn.show),hide:function(t){return function(e){if(n(e))return t.apply(this,arguments);var i=s.apply(this,arguments);return i.mode="hide",this.effect.call(this,i)}}(t.fn.hide),toggle:function(t){return function(e){if(n(e)||"boolean"==typeof e)return t.apply(this,arguments);var i=s.apply(this,arguments);return i.mode="toggle",this.effect.call(this,i)}}(t.fn.toggle),cssUnit:function(e){var i=this.css(e),s=[];return t.each(["em","px","%","pt"],function(t,e){i.indexOf(e)>0&&(s=[parseFloat(i),e])}),s}})}(),function(){var e={};t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,i){e[i]=function(e){return Math.pow(e,t+2)}}),t.extend(e,{Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2)},Bounce:function(t){for(var e,i=4;((e=Math.pow(2,--i))-1)/11>t;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)}}),t.each(e,function(e,i){t.easing["easeIn"+e]=i,t.easing["easeOut"+e]=function(t){return 1-i(1-t)},t.easing["easeInOut"+e]=function(t){return.5>t?i(2*t)/2:1-i(-2*t+2)/2}})}()})(jQuery);
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(g,F,L){g instanceof String&&(g=String(g));for(var R=g.length,fa=0;fa<R;fa++){var ma=g[fa];if(F.call(L,ma,fa,g))return{i:fa,v:ma}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(g,F,L){if(g==Array.prototype||g==Object.prototype)return g;g[F]=L.value;return g};$jscomp.getGlobal=function(g){g=["object"==typeof globalThis&&globalThis,g,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var F=0;F<g.length;++F){var L=g[F];if(L&&L.Math==Math)return L}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(g,F){var L=$jscomp.propertyToPolyfillSymbol[F];if(null==L)return g[F];L=g[L];return void 0!==L?L:g[F]};$jscomp.polyfill=function(g,F,L,R){F&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(g,F,L,R):$jscomp.polyfillUnisolated(g,F,L,R))};$jscomp.polyfillUnisolated=function(g,F,L,R){L=$jscomp.global;g=g.split(".");for(R=0;R<g.length-1;R++){var fa=g[R];if(!(fa in L))return;L=L[fa]}g=g[g.length-1];R=L[g];F=F(R);F!=R&&null!=F&&$jscomp.defineProperty(L,g,{configurable:!0,writable:!0,value:F})};$jscomp.polyfillIsolated=function(g,F,L,R){var fa=g.split(".");g=1===fa.length;R=fa[0];R=!g&&R in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var ma=0;ma<fa.length-1;ma++){var Aa=fa[ma];if(!(Aa in R))return;R=R[Aa]}fa=fa[fa.length-1];L=$jscomp.IS_SYMBOL_NATIVE&&"es6"===L?R[fa]:null;F=F(L);null!=F&&(g?$jscomp.defineProperty($jscomp.polyfills,fa,{configurable:!0,writable:!0,value:F}):F!==L&&(void 0===$jscomp.propertyToPolyfillSymbol[fa]&&(L=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[fa]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(fa):$jscomp.POLYFILL_PREFIX+L+"$"+fa),$jscomp.defineProperty(R,$jscomp.propertyToPolyfillSymbol[fa],{configurable:!0,writable:!0,value:F})))};$jscomp.polyfill("Array.prototype.find",function(g){return g?g:function(F,L){return $jscomp.findInternal(this,F,L).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(g){var F=0;return function(){return F<g.length?{done:!1,value:g[F++]}:{done:!0}}};$jscomp.arrayIterator=function(g){return{next:$jscomp.arrayIteratorImpl(g)}};$jscomp.initSymbol=function(){};$jscomp.polyfill("Symbol",function(g){if(g)return g;var F=function(ma,Aa){this.$jscomp$symbol$id_=ma;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:Aa})};F.prototype.toString=function(){return this.$jscomp$symbol$id_};var L="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",R=0,fa=function(ma){if(this instanceof fa)throw new TypeError("Symbol is not a constructor");return new F(L+(ma||"")+"_"+R++,ma)};return fa},"es6","es3");$jscomp.polyfill("Symbol.iterator",function(g){if(g)return g;g=Symbol("Symbol.iterator");for(var F="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),L=0;L<F.length;L++){var R=$jscomp.global[F[L]];"function"===typeof R&&"function"!=typeof R.prototype[g]&&$jscomp.defineProperty(R.prototype,g,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return g},"es6","es3");$jscomp.iteratorPrototype=function(g){g={next:g};g[Symbol.iterator]=function(){return this};return g};$jscomp.iteratorFromArray=function(g,F){g instanceof String&&(g+="");var L=0,R=!1,fa={next:function(){if(!R&&L<g.length){var ma=L++;return{value:F(ma,g[ma]),done:!1}}R=!0;return{done:!0,value:void 0}}};fa[Symbol.iterator]=function(){return fa};return fa};$jscomp.polyfill("Array.prototype.entries",function(g){return g?g:function(){return $jscomp.iteratorFromArray(this,function(F,L){return[F,L]})}},"es6","es3");$jscomp.owns=function(g,F){return Object.prototype.hasOwnProperty.call(g,F)};$jscomp.assign=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(g,F){for(var L=1;L<arguments.length;L++){var R=arguments[L];if(R)for(var fa in R)$jscomp.owns(R,fa)&&(g[fa]=R[fa])}return g};$jscomp.polyfill("Object.assign",function(g){return g||$jscomp.assign},"es6","es3");$jscomp.polyfill("Array.prototype.keys",function(g){return g?g:function(){return $jscomp.iteratorFromArray(this,function(F){return F})}},"es6","es3");$jscomp.checkStringArgs=function(g,F,L){if(null==g)throw new TypeError("The 'this' value for String.prototype."+L+" must not be null or undefined");if(F instanceof RegExp)throw new TypeError("First argument to String.prototype."+L+" must not be a regular expression");return g+""};$jscomp.polyfill("String.prototype.repeat",function(g){return g?g:function(F){var L=$jscomp.checkStringArgs(this,null,"repeat");if(0>F||1342177279<F)throw new RangeError("Invalid count value");F|=0;for(var R="";F;)if(F&1&&(R+=L),F>>>=1)L+=L;return R}},"es6","es3");$jscomp.polyfill("Object.values",function(g){return g?g:function(F){var L=[],R;for(R in F)$jscomp.owns(F,R)&&L.push(F[R]);return L}},"es8","es3");$jscomp.polyfill("Array.prototype.values",function(g){return g?g:function(){return $jscomp.iteratorFromArray(this,function(F,L){return L})}},"es8","es3");(function(g,F,L,R){function fa(b){this.foreach=function(l,p,q){if("[object Object]"===Object.prototype.toString.call(l))for(var m in l)Object.prototype.hasOwnProperty.call(l,m)&&p.call(q,l[m],m,l);else{m=0;for(var t=l.length;m<t;m++)p.call(q,l[m],m,l)}};this.options=function(l,p){for(var q in p)l[q]=p[q];return l}({zone:"#wrapper",elements:"a",selectedClass:"ds-active",key:!1,moreUsing:"shiftKey",enabled:!0,start:null,stop:null,onSelect:null,onDeselect:null},b||{});this.on=!1;var c=this;this.enable=function(){if(this.on)throw Error(this.constructor.name+" :: is alredy enabled");this.zone=Array.prototype.slice.call(L.querySelectorAll(this.options.zone),0);if(!this.zone)throw Error(this.constructor.name+" :: no zone defined in options. Please use element with ID");this.items=L.querySelectorAll(this.options.zone+" "+this.options.elements);this.disable();this.zone.forEach(function(l){l.addEventListener("mousedown",c.rectOpen)});this.on=!0;return this};this.disable=function(){this.zone.forEach(function(l){l.removeEventListener("mousedown",c.rectOpen)});this.on=!1;return this};var f=function(l){l=l.getBoundingClientRect();return{top:l.top+L.body.scrollTop,left:l.left+L.body.scrollLeft}};this.suspend=function(l){l.preventDefault();l.stopPropagation();return!1};this.rectOpen=function(l){c.options.start&&c.options.start(l);if((!c.options.key||l[c.options.key])&&1===l.which){L.body.classList.add("s-noselect");c.foreach(c.items,function(q){q.addEventListener("click",c.suspend,!0);l[c.options.moreUsing]||q.classList.remove(c.options.selectedClass)});c.ipos=[l.pageX,l.pageY];if(!h()){var p=L.createElement("div");p.id="s-rectBox";p.style.left=l.pageX+"px";p.style.top=l.pageY+"px";L.body.appendChild(p)}L.body.addEventListener("mousemove",c.rectDraw);L.body.addEventListener("mouseup",c.select)}};var h=function(){return L.getElementById("s-rectBox")},k=function(l,p){var q=f(l).top,m=f(l).left,t=f(p).top,v=f(p).left;return!(q+l.offsetHeight<t||q>t+p.offsetHeight||m+l.offsetWidth<v||m>v+p.offsetWidth)};this.select=function(l){var p=h();if(p){delete c.ipos;L.body.classList.remove("s-noselect");L.body.removeEventListener("mousemove",c.rectDraw);L.body.removeEventListener("mouseup",c.select);var q=c.options.selectedClass;c.foreach(c.items,function(m){!0===k(p,m)&&(m.classList.contains(q)?(m.classList.remove(q),c.options.onDeselect&&c.options.onDeselect(m)):(m.classList.add(q),c.options.onSelect&&c.options.onSelect(m)));setTimeout(function(){m.removeEventListener("click",c.suspend,!0)},100)});p.parentNode.removeChild(p);c.options.stop&&c.options.stop(l)}};this.rectDraw=function(l){var p=h();if(c.ipos&&null!==p){var q=c.ipos[0],m=c.ipos[1],t=l.pageX,v=l.pageY;q>t&&(l=t,t=q,q=l);m>v&&(l=v,v=m,m=l);p.style.left=q+"px";p.style.top=m+"px";p.style.width=t-q+"px";p.style.height=v-m+"px"}};this.options.selectables=this;return this.options.enabled?this.enable():this}function ma(b,c){if(fb){var f=Array.prototype.slice.apply(arguments,[1]),h=new Date;h=h.getHours()+":"+h.getMinutes()+":"+h.getSeconds()+"."+h.getMilliseconds();f[0]=h+" - "+f[0];try{switch(b){case"info":F.console.info.apply(F.console,f);break;case"warn":F.console.warn.apply(F.console,f);break;default:F.console.log.apply(F.console,f)}}catch(k){F.console||(fb=!1)}}}function Aa(b){Array.prototype.unshift.apply(arguments,["debug"]);ma.apply(this,arguments)}function ua(b){this.table=b;this.tableHead=b.querySelector("thead");this.tableBody=b.querySelector("tbody");this.scrollHandler=this.syncHeadScroll.bind(this);this.observeBody();this.handleWindowResize()}function gb(b,c,f){f=f.substring(b[c-2].pos,b[c-1].pos);2<=f.length&&"<"===f.charAt(0)&&">"===f.charAt(f.length-1)&&(f=f.substr(1,f.length-2));var h=f;h=/^mailto:/.test(h)?!1:-1!==h.indexOf("@");h&&(f="mailto:"+f);b[c-2].node.href=f}function tb(b){var c=[""];c.index=b.length;c.input=b;return c}function ub(b,c){if(/Konqueror/.test(navigator.userAgent)&&!c.konquered){for(var f=0;f<c.length;f++)for(var h=0;h<c[f].length;h++){var k=c[f][h][0];"$"===k.source&&(k.exec=tb)}c.konquered=!0}var l=L.createElement("a"),p=L.createElement("span"),q=[],m=0,t=[],v=0,w=null;f=function(Q,N){Q=Q.length;if(0!==Q){if(!N){var X=t.length;0!==X&&(X=t[X-1],X[3]||(N=X[1]))}w!==N&&(w&&(q[m++]={pos:v},"sh_url"===w&&gb(q,m,b)),N&&(X="sh_url"===N?l.cloneNode(!1):p.cloneNode(!1),X.className=N,q[m++]={node:X,pos:v}));v+=Q;w=N}};h=/\r\n|\r|\n/g;h.lastIndex=0;for(k=b.length;v<k;){var z=v,B;var D=h.exec(b);null===D?D=B=k:(B=D.index,D=h.lastIndex);B=b.substring(z,B);for(var E=[];;){var G=v-z;var I=t.length;I=0===I?0:t[I-1][2];var K=c[I],S=K.length,U=E[I];U||(U=E[I]=[]);I=null;for(var T=-1,V=0;V<S;V++){if(V<U.length&&(null===U[V]||G<=U[V].index))var O=U[V];else O=K[V][0],O.lastIndex=G,O=O.exec(B),U[V]=O;if(null!==O&&(null===I||O.index<I.index)&&(I=O,T=V,O.index===G))break}if(null===I){f(B.substring(G),null);break}else{I.index>G&&f(B.substring(G,I.index),null);G=K[T];K=G[1];if(K instanceof Array)for(U=0;U<K.length;U++)S=I[U+1],f(S,K[U]);else S=I[0],f(S,K);switch(G[2]){case-1:break;case-2:t.pop();break;case-3:t.length=0;break;default:t.push(G)}}}w&&(q[m++]={pos:v},"sh_url"===w&&gb(q,m,b),w=null);v=D}return q}function hb(b){var c=[];if((b=b.className)&&0<b.length){b=b.split(" ");for(var f=0;f<b.length;f++)0<b[f].length&&c.push(b[f])}return c}function ib(b,c){for(var f=b.length,h=0;h<f;h++){var k=b.item(h);switch(k.nodeType){case 1:"br"===k.nodeName.toLowerCase()?(k=/MSIE/.test(navigator.userAgent)?"\r":"\n",c.text.push(k),c.pos++):(c.tags.push({node:k.cloneNode(!1),pos:c.pos}),ib(k.childNodes,c),c.tags.push({pos:c.pos}));break;case 3:case 4:c.text.push(k.data),c.pos+=k.length}}}var pa=function(){};pa.extend=function(b,c){var f=pa.prototype.extend;pa._prototyping=!0;var h=new this;f.call(h,b);delete pa._prototyping;var k=h.constructor,l=h.constructor=function(){if(!pa._prototyping)if(this._constructing||this.constructor==l)this._constructing=!0,k.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||f).call(arguments[0],h)};l.ancestor=this;l.extend=this.extend;l.forEach=this.forEach;l.implement=this.implement;l.prototype=h;l.toString=this.toString;l.valueOf=function(p){return"object"==p?l:k.valueOf()};f.call(l,c);"function"==typeof l.init&&l.init();return l};pa.prototype={extend:function(b,c){if(1<arguments.length){var f=this[b];if(f&&"function"==typeof c&&(!f.valueOf||f.valueOf()!=c.valueOf())&&/\bbase\b/.test(c)){var h=c.valueOf();c=function(){var t=this.base||pa.prototype.base;this.base=f;var v=h.apply(this,arguments);this.base=t;return v};c.valueOf=function(t){return"object"==t?c:h};c.toString=pa.toString}this[b]=c}else if(b){var k=pa.prototype.extend;pa._prototyping||"function"==typeof this||(k=this.extend||k);for(var l={toSource:null},p=["constructor","toString","valueOf"],q=pa._prototyping?0:1;m=p[q++];)b[m]!=l[m]&&k.call(this,m,b[m]);for(var m in b)l[m]||k.call(this,m,b[m])}return this},base:function(){}};pa=pa.extend({constructor:function(b){this.extend(b)}},{ancestor:Object,version:"1.1",forEach:function(b,c,f){for(var h in b)this.prototype[h]===R&&c.call(f,b[h],h,b)},implement:function(){for(var b=0;b<arguments.length;b++)if("function"==typeof arguments[b])arguments[b](this.prototype);else this.prototype.extend(arguments[b]);return this},toString:function(){return String(this.valueOf())}});F.Base=pa;(function(b){function c(B,D,E){var G=[];E||(E={});b.each(B,function(I,K){G.push([I,K])});G.sort(function(I,K){var S=I[0].toLowerCase(),U=K[0].toLowerCase();E[I[0]]&&(S=E[I[0]]);E[K[0]]&&(U=E[K[0]]);return S<U?-1:S>U?1:0});b.each(G,function(I,K){D(K[0],K[1])})}function f(B){return B.then(function(D){var E=b.Deferred();setTimeout(function(){E.resolve(D)},0);return E})}function h(B,D,E,G){return B.then(function(I){var K=[];b.each(I,function(U,T){K.push([U,T])});d=b.Deferred().resolve(K);var S=[];for(I=0;I<K.length;I+=E)(function(U){d=f(d.then(function(T){for(T=0;T<E&&U+T<K.length;T++){var V=D(K[U+T][0],K[U+T][1]);V!==R&&S.push(V)}return b.Deferred().resolve(S)}))})(I);return d})}function k(B,D){return B.then(function(E){D();return b.Deferred().resolve(E)})}function l(B,D,E){var G="",I=R;E.letter||(E.letter=[]);for(var K=0;K<B.length;K++)K<E.letter.length&&(I=E.letter[K]),G=I?G+D.letter[I]:G+B.substr(K,1);return G}function p(B){var D=R,E=[];if(!b.isArray(B))return B;for(var G=0;G<B.length;G++)if(0>B[G])for(var I=0;I<-B[G];I++)E.push(D);else E.push(B[G]),D=B[G];return E}function q(B,D){var E=[];b.each(B,function(K,S){for(var U=R,T=0;T<D;T++)T<S.length&&(U=S[T]),E[T]||(E[T]={}),E[T][K]=U});var G=null;b.each(E,function(K,S){if(G){var U=0;b.each(B,function(T,V){"letter"!=T&&(G[T]||S[T])&&(G[T]&&S[T]&&G[T]==S[T]||(U=1))});U||(S.__repeat=1)}G=S});var I=[];b.each(E,function(K,S){S.__repeat?I[I.length-1].__len++:(S.__len=1,I.push(S))});return I}function m(B,D,E){var G="span",I="span";D.href&&(G="a class='sequence_info' draggable='false'",I="a");D.tag&&(G=B.tag[D.tag],I=B.tag[D.tag]);b.each(["href","title","style"],function(K,S){D[S]&&(G+=" "+S+'="'+B[S][D[S]]+'"')});return"<"+G+">"+E+"</"+I+">"}function t(B,D,E){B=l(B,D,E);E=q(E,B.length);var G=0,I="";b.each(E,function(K,S){I+=m(D,S,B.substr(G,S.__len));G+=S.__len});return I}function v(B,D){var E=B.closest(".initial_panel"),G=B.parents(".js_panel").find(".ad-markup-loading");B=B.parents(".js_panel").find(".ad-markup-loaded");var I=E.data("number");I||(I=0);I+=D;E.data("number",I);I?(B.hide(),G.show()):(B.show(),G.hide())}function w(B,D,E){var G=B.parents(".js_panel").find("._adornment_key"),I=G.data("data");I||(I={});D&&b.each(D,function(T,V){I[T]&&-1!==I[T]||(I[T]={});"_messages"==T?b.each(V,function(O,Q){I[T][Q]=1}):b.each(V,function(O,Q){I[T][O]=Q})});delete I["Basic Annotation"];var K=0;b.each(I,function(T,V){K=1});K||(I["Basic Annotation"]=-1);b.each(I,function(T,V){-1==V&&delete I[T]});b.each(E,function(T,V){I[V]||(I[V]=-1)});G.data("data",I);var S="";c(I,function(T,V){if("_messages"!=T){var O="";-1===V?O+='<li><span class="ad-loading">loading</span></li>':c(V,function(Q,N){O+='<li><span class="adorn-key-entry" style="';O+=N["default"]?"background-color:"+N["default"]+";":"";O+=N.label?"color:"+N.label+";":"";O+=N.extra_css?N.extra_css:"";O+='">';N.title?(O+='<span title="'+N.title+'"',O+=N.label?' style="border-color:'+
N.label+'"':"",O+=">"+N.text+"</span>"):O+=N.text;O+="</span></li>"});O&&(T=T.substr(0,1).toUpperCase()+T.substr(1),T=T.replace(/([\/-])/g,"$1 "),S+="<dt>"+T+"</dt><dd><ul>"+O+"</ul></dd>")}},{other:"~"});var U="";I._messages&&b.each(I._messages,function(T,V){U+="<li>"+T+"</li>"});D="";S+='<dt>Markup</dt><dd><ul><li><span class="ad-markup-loading ad-loading">loading</span><span class="ad-markup-loaded" style="display: none">loaded</span></li></ul></dd>';G=B.parents(".js_panel").find("._adornment_key");S&&(D+="<dl>"+S+"</dl>");U&&(D+='<ul class="alignment-key">'+U+"</ul>");G.html(D).toggle(!!D).find("span[title]").helptip();v(B,0)}function z(B,D,E){var G=b(B);if(G.hasClass("adornment-running")&&!E||G.hasClass("adornment-done"))return b.Deferred().resolve(0);var I=G.wrap("<div></div>").parent();G.addClass("adornment-running");E||(E=b.parseJSON(b(".adornment-data",B).text()));w(G,null,E.expect||E.provisional.expect);var K=E.url?b.Deferred().resolve(E.provisional):b.Deferred().resolve(E);K=K.then(function(S){b.each(S.ref,function(U,T){T=S.ref;for(var V=S.ref[U],O=0,Q=0;Q<V.length;Q++)O+=V[Q][0],V[Q][0]=O?V[Q-1].substr(0,O):"",V[Q]=V[Q][0]+V[Q][1];T[U]=V});b.each(S.seq,function(U,T){b.isPlainObject(S.seq[U])&&b.each(S.seq[U],function(V,O){S.seq[U][V]=p(S.seq[U][V])})});S.seq=p(S.seq);return h(b.Deferred().resolve(S.seq),function(U,T){if(T){var V=b(".adorn-"+U,B);if(V.length){var O={};b.each(S.flourishes,function(Q,N){N=N[U];var X=b(".ad-"+Q+"-"+U,B);N&&X.length&&(O[Q]=[X,b.parseJSON(N).v])});return[V,V.text(),S.ref,T,O]}return R}},1E3,"a")});K=h(K,function(S,U){S=t(U[1],U[2],U[3]);return[U[0],S,U[4]]},1E3,"b");K=h(K,function(S,U){U[0].html(U[1]);b.each(U[2],function(T,V){V[0].html(V[1])})},1E3,"c");K=k(K,function(){b(".adornment-data",B).remove();G.appendTo(I);w(G,E.legend||E.provisional.legend,E.expect||E.provisional.expect)});K=E.url?K.then(function(){var S=G.parents(".adornment-load");S.length&&S.hasClass("adornment-loaded")||(S.addClass("adornment-loaded"),b.paced_ajax({dataType:"html",url:E.url}).then(function(U){var T=G;S.length&&(T=S.get(0));T=b(".adornment",T).addBack(".adornment");U=b(".adornment-data",U);for(var V=0;V<T.length;V++)z(T[V],D,b.parseJSON(b(U[V]).text()));v(G,-1)}),v(G,1))}):k(K,function(){G.addClass("adornment-done");G.removeClass("adornment-running");G.closest(".initial_panel").find(".markup-loading").html("Finished")});return K=K.then(function(){D(B)})}b.fn.adorn=function(B){this.each(function(D,E){f(z(E,B))});return d}})(jQuery);(function(b){b.fn.afterimage=function(){var c=this;b(F).load(function(){$el=b(c);$el.each(function(){b("._afterimage",$el).each(function(){var f=b("<img/>").attr({"class":b(this).attr("class"),src:b(this).data("url")});b(this).replaceWith(f)})})})};b("html").afterimage()})(jQuery);(function(b,c){b.ajaxPrefilter(function(f,h,k){if(f.comet)return"comet"});b.ajaxTransport("comet",function(f,h,k){function l(){b(form).remove();b(p).off("load").attr("src","javascript:false;").remove();p=form=null;delete F.cUpdate[q]}var p=null,q="cIframe_"+b.now();f.dataTypes.shift();F.cUpdate||(F.cUpdate={});F.cUpdate[q]=function(){(f.update||b.noop).apply(f.context||F,arguments)};form=b("<form>",function(v){v.method.match(/post/i)&&(v.enctype="multipart/form-data");return v}({action:f.url,name:q,target:q,method:f.type||"POST"}));h=h.data||[];if(!b.isArray(h)){var m=[];if(!b.isPlainObject(h)){var t={};b.each(h.split("&|;"),function(v,w){w=w.split("=");t[w[0]]=decodeURIComponent(w[1].replace(/\+/g,"%20"))});h=t;t=null}b.each(h,function(v,w){m.push({name:v,value:w})});h=m;m=null}b.each(b.merge([{name:"X-Requested-With",value:"iframe"},{name:"X-Comet-Request",value:"true"},{name:"_cupdate",value:"parent.cUpdate."+q}],h),function(v,w){b('<input type="hidden" />').attr(w).appendTo(form)});return{send:function(v,w){p=b('<iframe name="'+q+'" id="'+q+'" src="javascript:false;" style="display:none">').on("load.initial",function(){p.off("load").on("load",function(){var z=b(this.contentWindow?this.contentWindow.document:this.contentDocument?this.contentDocument:this.document).find("body");l();w(200,"OK",{html:z.html(),text:z.text()},null)});form[0].submit()});b("body").append(form,p);p.triggerHandler("load.initial")},abort:l}})})(jQuery);(function(b,c,f){b.fn.dataTableSettings=[];var h=b.fn.dataTableSettings;b.fn.dataTableExt={};var k=b.fn.dataTableExt;k.sVersion="1.8.1";k.sErrMode="alert";k.iApiIndex=0;k.oApi={};k.afnFiltering=[];k.aoFeatures=[];k.ofnSearch={};k.afnSortData=[];k.oStdClasses={sPagePrevEnabled:"paginate_enabled_previous",sPagePrevDisabled:"paginate_disabled_previous",sPageNextEnabled:"paginate_enabled_next",sPageNextDisabled:"paginate_disabled_next",sPageJUINext:"",sPageJUIPrev:"",sPageButton:"paginate_button",sPageButtonActive:"paginate_active",sPageButtonStaticDisabled:"paginate_button paginate_button_disabled",sPageFirst:"first",sPagePrevious:"previous",sPageNext:"next",sPageLast:"last",sStripOdd:"odd",sStripEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",sSortDesc:"sorting_desc",sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",sSortableDesc:"sorting_desc_disabled",sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",sSortJUIAscAllowed:"",sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sFooterTH:""};k.oJUIClasses={sPagePrevEnabled:"fg-button ui-button ui-state-default ui-corner-left",sPagePrevDisabled:"fg-button ui-button ui-state-default ui-corner-left ui-state-disabled",sPageNextEnabled:"fg-button ui-button ui-state-default ui-corner-right",sPageNextDisabled:"fg-button ui-button ui-state-default ui-corner-right ui-state-disabled",sPageJUINext:"ui-icon ui-icon-circle-arrow-e",sPageJUIPrev:"ui-icon ui-icon-circle-arrow-w",sPageButton:"fg-button ui-button ui-state-default",sPageButtonActive:"fg-button ui-button ui-state-default ui-state-disabled",sPageButtonStaticDisabled:"fg-button ui-button ui-state-default ui-state-disabled",sPageFirst:"first ui-corner-tl ui-corner-bl",sPagePrevious:"previous",sPageNext:"next",sPageLast:"last ui-corner-tr ui-corner-br",sStripOdd:"odd",sStripEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi ui-buttonset-multi paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"ui-state-default",sSortDesc:"ui-state-default",sSortable:"ui-state-default",sSortableAsc:"ui-state-default",sSortableDesc:"ui-state-default",sSortableNone:"ui-state-default",sSortColumn:"sorting_",sSortJUIAsc:"css_right ui-icon ui-icon-triangle-1-n",sSortJUIDesc:"css_right ui-icon ui-icon-triangle-1-s",sSortJUI:"css_right ui-icon ui-icon-carat-2-n-s",sSortJUIAscAllowed:"css_right ui-icon ui-icon-carat-1-n",sSortJUIDescAllowed:"css_right ui-icon ui-icon-carat-1-s",sSortJUIWrapper:"DataTables_sort_wrapper",sSortIcon:"DataTables_sort_icon",sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead ui-state-default",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot ui-state-default",sScrollFootInner:"dataTables_scrollFootInner",sFooterTH:"ui-state-default"};k.oPagination={two_button:{fnInit:function(l,p,q){if(l.bJUI){var m=f.createElement("a");var t=f.createElement("a");var v=f.createElement("span");v.className=l.oClasses.sPageJUINext;t.appendChild(v);v=f.createElement("span");v.className=l.oClasses.sPageJUIPrev;m.appendChild(v)}else m=f.createElement("div"),t=f.createElement("div");m.className=l.oClasses.sPagePrevDisabled;t.className=l.oClasses.sPageNextDisabled;m.title=l.oLanguage.oPaginate.sPrevious;t.title=l.oLanguage.oPaginate.sNext;p.appendChild(m);p.appendChild(t);b(m).on("click.DT",function(){l.oApi._fnPageChange(l,"previous")&&q(l)});b(t).on("click.DT",function(){l.oApi._fnPageChange(l,"next")&&q(l)});b(m).on("selectstart.DT",function(){return!1});b(t).on("selectstart.DT",function(){return!1});""!==l.sTableId&&"undefined"==typeof l.aanFeatures.p&&(p.setAttribute("id",l.sTableId+"_paginate"),m.setAttribute("id",l.sTableId+"_previous"),t.setAttribute("id",l.sTableId+"_next"))},fnUpdate:function(l){if(l.aanFeatures.p)for(var p=l.aanFeatures.p,q=0,m=p.length;q<m;q++)0!==p[q].childNodes.length&&(p[q].childNodes[0].className=0===l._iDisplayStart?l.oClasses.sPagePrevDisabled:l.oClasses.sPagePrevEnabled,p[q].childNodes[1].className=l.fnDisplayEnd()==l.fnRecordsDisplay()?l.oClasses.sPageNextDisabled:l.oClasses.sPageNextEnabled)}},iFullNumbersShowPages:5,full_numbers:{fnInit:function(l,p,q){var m=f.createElement("span"),t=f.createElement("span"),v=f.createElement("span"),w=f.createElement("span"),z=f.createElement("span");m.innerHTML=l.oLanguage.oPaginate.sFirst;t.innerHTML=l.oLanguage.oPaginate.sPrevious;w.innerHTML=l.oLanguage.oPaginate.sNext;z.innerHTML=l.oLanguage.oPaginate.sLast;var B=l.oClasses;m.className=B.sPageButton+
" "+B.sPageFirst;t.className=B.sPageButton+" "+B.sPagePrevious;w.className=B.sPageButton+" "+B.sPageNext;z.className=B.sPageButton+" "+B.sPageLast;p.appendChild(m);p.appendChild(t);p.appendChild(v);p.appendChild(w);p.appendChild(z);b(m).on("click.DT",function(){l.oApi._fnPageChange(l,"first")&&q(l)});b(t).on("click.DT",function(){l.oApi._fnPageChange(l,"previous")&&q(l)});b(w).on("click.DT",function(){l.oApi._fnPageChange(l,"next")&&q(l)});b(z).on("click.DT",function(){l.oApi._fnPageChange(l,"last")&&q(l)});b("span",p).on("mousedown.DT",function(){return!1}).on("selectstart.DT",function(){return!1});""!==l.sTableId&&"undefined"==typeof l.aanFeatures.p&&(p.setAttribute("id",l.sTableId+"_paginate"),m.setAttribute("id",l.sTableId+"_first"),t.setAttribute("id",l.sTableId+"_previous"),w.setAttribute("id",l.sTableId+"_next"),z.setAttribute("id",l.sTableId+"_last"))},fnUpdate:function(l,p){if(l.aanFeatures.p){var q=k.oPagination.iFullNumbersShowPages,m=Math.floor(q/2),t=Math.ceil(l.fnRecordsDisplay()/
l._iDisplayLength),v=Math.ceil(l._iDisplayStart/l._iDisplayLength)+1,w="",z=l.oClasses;if(t<q){m=1;var B=t}else v<=m?(m=1,B=q):v>=t-m?(m=t-q+1,B=t):(m=v-Math.ceil(q/2)+1,B=m+q-1);for(q=m;q<=B;q++)w+=v!=q?'<span class="'+z.sPageButton+'">'+q+"</span>":'<span class="'+z.sPageButtonActive+'">'+q+"</span>";B=l.aanFeatures.p;var D=function(I){l._iDisplayStart=(1*this.innerHTML-1)*l._iDisplayLength;p(l);I.preventDefault()},E=function(){return!1};q=0;for(m=B.length;q<m;q++)if(0!==B[q].childNodes.length){var G=b("span:eq(2)",B[q]);G.html(w);b("span",G).on("click.DT",D).on("mousedown.DT",E).on("selectstart.DT",E);G=B[q].getElementsByTagName("span");G=[G[0],G[1],G[G.length-2],G[G.length-1]];b(G).removeClass(z.sPageButton+" "+z.sPageButtonActive+" "+z.sPageButtonStaticDisabled);1==v?(G[0].className+=" "+z.sPageButtonStaticDisabled,G[1].className+=" "+z.sPageButtonStaticDisabled):(G[0].className+=" "+z.sPageButton,G[1].className+=" "+z.sPageButton);0===t||v==t||-1==l._iDisplayLength?(G[2].className+=" "+z.sPageButtonStaticDisabled,G[3].className+=" "+z.sPageButtonStaticDisabled):(G[2].className+=" "+z.sPageButton,G[3].className+=" "+z.sPageButton)}}}}};k.oSort={"string-asc":function(l,p){"string"!=typeof l&&(l="");"string"!=typeof p&&(p="");l=l.toLowerCase();p=p.toLowerCase();return l<p?-1:l>p?1:0},"string-desc":function(l,p){"string"!=typeof l&&(l="");"string"!=typeof p&&(p="");l=l.toLowerCase();p=p.toLowerCase();return l<p?1:l>p?-1:0},"html-asc":function(l,p){l=l.replace(/<.*?>/g,"").toLowerCase();p=p.replace(/<.*?>/g,"").toLowerCase();return l<p?-1:l>p?1:0},"html-desc":function(l,p){l=l.replace(/<.*?>/g,"").toLowerCase();p=p.replace(/<.*?>/g,"").toLowerCase();return l<p?1:l>p?-1:0},"date-asc":function(l,p){l=Date.parse(l);p=Date.parse(p);if(isNaN(l)||""===l)l=Date.parse("01/01/1970 00:00:00");if(isNaN(p)||""===p)p=Date.parse("01/01/1970 00:00:00");return l-p},"date-desc":function(l,p){l=Date.parse(l);p=Date.parse(p);if(isNaN(l)||""===l)l=Date.parse("01/01/1970 00:00:00");if(isNaN(p)||""===p)p=Date.parse("01/01/1970 00:00:00");return p-l},"numeric-asc":function(l,p){return("-"==l||""===l?0:1*l)-("-"==p||""===p?0:1*p)},"numeric-desc":function(l,p){return("-"==p||""===p?0:1*p)-("-"==l||""===l?0:1*l)}};k.aTypes=[function(l){if("number"==typeof l)return"numeric";if("string"!=typeof l)return null;var p=!1;var q=l.charAt(0);if(-1=="0123456789-".indexOf(q))return null;for(var m=1;m<l.length;m++){q=l.charAt(m);if(-1=="0123456789.".indexOf(q))return null;if("."==q){if(p)return null;p=!0}}return"numeric"},function(l){var p=Date.parse(l);return null!==p&&!isNaN(p)||"string"==typeof l&&0===l.length?"date":null},function(l){return"string"==typeof l&&-1!=l.indexOf("<")&&-1!=l.indexOf(">")?"html":null}];k.fnVersionCheck=function(l){var p=function(z,B){for(;z.length<B;)z+="0";return z},q=k.sVersion.split(".");l=l.split(".");for(var m="",t="",v=0,w=l.length;v<w;v++)m+=p(q[v],3),t+=p(l[v],3);return parseInt(m,10)>=parseInt(t,10)};k._oExternConfig={iNextUnique:0};b.fn.dataTable=function(l){function p(){this.fnRecordsTotal=function(){return this.oFeatures.bServerSide?parseInt(this._iRecordsTotal,10):this.aiDisplayMaster.length};this.fnRecordsDisplay=function(){return this.oFeatures.bServerSide?parseInt(this._iRecordsDisplay,10):this.aiDisplay.length};this.fnDisplayEnd=function(){return this.oFeatures.bServerSide?!1===this.oFeatures.bPaginate||-1==this._iDisplayLength?this._iDisplayStart+this.aiDisplay.length:Math.min(this._iDisplayStart+this._iDisplayLength,this._iRecordsDisplay):this._iDisplayEnd};this.sInstance=this.oInstance=null;this.oFeatures={bPaginate:!0,bLengthChange:!0,bFilter:!0,bSort:!0,bInfo:!0,bAutoWidth:!0,bProcessing:!1,bSortClasses:!0,bStateSave:!1,bServerSide:!1,bDeferRender:!1};this.oScroll={sX:"",sXInner:"",sY:"",bCollapse:!1,bInfinite:!1,iLoadGap:100,iBarWidth:0,bAutoCss:!0};this.aanFeatures=[];this.oLanguage={sProcessing:"Processing...",sLengthMenu:"Show _MENU_ entries",sZeroRecords:"No matching records found",sEmptyTable:"No data available in table",sLoadingRecords:"Loading...",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sSearch:"Search:",sUrl:"",oPaginate:{sFirst:"First",sPrevious:"Previous",sNext:"Next",sLast:"Last"},fnInfoCallback:null};this.aoData=[];this.aiDisplay=[];this.aiDisplayMaster=[];this.aoColumns=[];this.aoHeader=[];this.aoFooter=[];this.iNextId=0;this.asDataSearch=[];this.oPreviousSearch={sSearch:"",bRegex:!1,bSmart:!0};this.aoPreSearchCols=[];this.aaSorting=[[0,"asc",0]];this.aaSortingFixed=null;this.asStripClasses=[];this.asDestoryStrips=[];this.sDestroyWidth=0;this.fnFooterCallback=this.fnHeaderCallback=this.fnRowCallback=null;this.aoDrawCallback=[];this.fnInitComplete=this.fnPreDrawCallback=null;this.sTableId="";this.nTableWrapper=this.nTBody=this.nTFoot=this.nTHead=this.nTable=null;this.bInitialised=this.bDeferLoading=!1;this.aoOpenRows=[];this.sDom="lfrtip";this.sPaginationType="two_button";this.iCookieDuration=7200;this.sCookiePrefix="SpryMedia_DataTables_";this.fnCookieCallback=null;this.aoStateSave=[];this.aoStateLoad=[];this.sAjaxSource=this.oLoadedState=null;this.sAjaxDataProp="aaData";this.bAjaxDataGet=!0;this.jqXHR=null;this.fnServerData=function(n,x,A,y){y.jqXHR=b.ajax({url:n,data:x,success:A,dataType:"json",cache:!1,error:function(C,H){"parsererror"==H&&alert("DataTables warning: JSON data from server could not be parsed. This is caused by a JSON formatting error.")}})};this.fnFormatNumber=function(n){if(1E3>n)return n;var x=n+"";n=x.split("");var A="";x=x.length;for(var y=0;y<x;y++)0===y%3&&0!==y&&(A=","+A),A=n[x-y-1]+A;return A};this.aLengthMenu=[10,25,50,100];this.bDrawing=this.iDraw=0;this.iDrawError=-1;this._iDisplayLength=10;this._iDisplayStart=0;this._iDisplayEnd=10;this._iRecordsDisplay=this._iRecordsTotal=0;this.bJUI=!1;this.oClasses=k.oStdClasses;this.bSortCellsTop=this.bSorted=this.bFiltered=!1;this.oInit=null}function q(n){return function(){var x=[na(this[k.iApiIndex])].concat(Array.prototype.slice.call(arguments));return k.oApi[n].apply(this,x)}}function m(n){var x,A=n.iInitDisplayStart;if(!1===n.bInitialised)setTimeout(function(){m(n)},200);else{V(n);G(n);I(n,n.aoHeader);n.nTFoot&&I(n,n.aoFooter);xa(n,!0);n.oFeatures.bAutoWidth&&Ua(n);var y=0;for(x=n.aoColumns.length;y<x;y++)null!==n.aoColumns[y].sWidth&&(n.aoColumns[y].nTh.style.width=da(n.aoColumns[y].sWidth));n.oFeatures.bSort?ka(n):n.oFeatures.bFilter?Z(n,n.oPreviousSearch):(n.aiDisplay=n.aiDisplayMaster.slice(),ta(n),K(n));null===n.sAjaxSource||n.oFeatures.bServerSide?n.oFeatures.bServerSide||(xa(n,!1),t(n)):n.fnServerData.call(n.oInstance,n.sAjaxSource,[],function(C){var H=C;""!==n.sAjaxDataProp&&(H=Pa(n.sAjaxDataProp)(C));for(y=0;y<H.length;y++)B(n,H[y]);n.iInitDisplayStart=A;n.oFeatures.bSort?ka(n):(n.aiDisplay=n.aiDisplayMaster.slice(),ta(n),K(n));xa(n,!1);t(n,C)},n)}}function t(n,x){n._bInitComplete=!0;"function"==typeof n.fnInitComplete&&("undefined"!=typeof x?n.fnInitComplete.call(n.oInstance,n,x):n.fnInitComplete.call(n.oInstance,n))}function v(n,x,A){Y(n.oLanguage,x,"sProcessing");Y(n.oLanguage,x,"sLengthMenu");Y(n.oLanguage,x,"sEmptyTable");Y(n.oLanguage,x,"sLoadingRecords");Y(n.oLanguage,x,"sZeroRecords");Y(n.oLanguage,x,"sInfo");Y(n.oLanguage,x,"sInfoEmpty");Y(n.oLanguage,x,"sInfoFiltered");Y(n.oLanguage,x,"sInfoPostFix");Y(n.oLanguage,x,"sSearch");"undefined"!=typeof x.oPaginate&&(Y(n.oLanguage.oPaginate,x.oPaginate,"sFirst"),Y(n.oLanguage.oPaginate,x.oPaginate,"sPrevious"),Y(n.oLanguage.oPaginate,x.oPaginate,"sNext"),Y(n.oLanguage.oPaginate,x.oPaginate,"sLast"));"undefined"==typeof x.sEmptyTable&&"undefined"!=typeof x.sZeroRecords&&Y(n.oLanguage,x,"sZeroRecords","sEmptyTable");"undefined"==typeof x.sLoadingRecords&&"undefined"!=typeof x.sZeroRecords&&Y(n.oLanguage,x,"sZeroRecords","sLoadingRecords");A&&m(n)}function w(n,x){var A=n.aoColumns.length;x={sType:null,_bAutoType:!0,bVisible:!0,bSearchable:!0,bSortable:!0,asSorting:["asc","desc"],sSortingClass:n.oClasses.sSortable,sSortingClassJUI:n.oClasses.sSortJUI,sTitle:x?x.innerHTML:"",sName:"",sWidth:null,sWidthOrig:null,sClass:null,fnRender:null,bUseRendered:!0,iDataSort:A,mDataProp:A,fnGetData:null,fnSetData:null,sSortDataType:"std",sDefaultContent:null,sContentPadding:"",nTh:x?x:f.createElement("th"),nTf:null};n.aoColumns.push(x);"undefined"==typeof n.aoPreSearchCols[A]||null===n.aoPreSearchCols[A]?n.aoPreSearchCols[A]={sSearch:"",bRegex:!1,bSmart:!0}:("undefined"==typeof n.aoPreSearchCols[A].bRegex&&(n.aoPreSearchCols[A].bRegex=!0),"undefined"==typeof n.aoPreSearchCols[A].bSmart&&(n.aoPreSearchCols[A].bSmart=!0));z(n,A,null)}function z(n,x,A){x=n.aoColumns[x];"undefined"!=typeof A&&null!==A&&("undefined"!=typeof A.sType&&(x.sType=A.sType,x._bAutoType=!1),Y(x,A,"bVisible"),Y(x,A,"bSearchable"),Y(x,A,"bSortable"),Y(x,A,"sTitle"),Y(x,A,"sName"),Y(x,A,"sWidth"),Y(x,A,"sWidth","sWidthOrig"),Y(x,A,"sClass"),Y(x,A,"fnRender"),Y(x,A,"bUseRendered"),Y(x,A,"iDataSort"),Y(x,A,"mDataProp"),Y(x,A,"asSorting"),Y(x,A,"sSortDataType"),Y(x,A,"sDefaultContent"),Y(x,A,"sContentPadding"));x.fnGetData=Pa(x.mDataProp);x.fnSetData=jb(x.mDataProp);n.oFeatures.bSort||(x.bSortable=!1);!x.bSortable||-1==b.inArray("asc",x.asSorting)&&-1==b.inArray("desc",x.asSorting)?(x.sSortingClass=n.oClasses.sSortableNone,x.sSortingClassJUI=""):x.bSortable||-1==b.inArray("asc",x.asSorting)&&-1==b.inArray("desc",x.asSorting)?(x.sSortingClass=n.oClasses.sSortable,x.sSortingClassJUI=n.oClasses.sSortJUI):-1!=b.inArray("asc",x.asSorting)&&-1==b.inArray("desc",x.asSorting)?(x.sSortingClass=n.oClasses.sSortableAsc,x.sSortingClassJUI=n.oClasses.sSortJUIAscAllowed):-1==b.inArray("asc",x.asSorting)&&-1!=b.inArray("desc",x.asSorting)&&(x.sSortingClass=n.oClasses.sSortableDesc,x.sSortingClassJUI=n.oClasses.sSortJUIDescAllowed)}function B(n,x){var A="number"==typeof x.length?x.slice():b.extend(!0,{},x);x=n.aoData.length;var y={nTr:null,_iId:n.iNextId++,_aData:A,_anHidden:[],_sRowStripe:""};n.aoData.push(y);for(var C,H=0,J=n.aoColumns.length;H<J;H++)A=n.aoColumns[H],"function"==typeof A.fnRender&&A.bUseRendered&&null!==A.mDataProp&&Ba(n,x,H,A.fnRender({iDataRow:x,iDataColumn:H,aData:y._aData,oSettings:n})),A._bAutoType&&"string"!=A.sType&&(C=va(n,x,H,"type"),null!==C&&""!==C&&(C=Va(C),null===A.sType?A.sType=C:A.sType!=C&&(A.sType="string")));n.aiDisplayMaster.push(x);n.oFeatures.bDeferRender||D(n,x);return x}function D(n,x){var A=n.aoData[x];if(null===A.nTr){A.nTr=f.createElement("tr");"undefined"!=typeof A._aData.DT_RowId&&A.nTr.setAttribute("id",A._aData.DT_RowId);"undefined"!=typeof A._aData.DT_RowClass&&b(A.nTr).addClass(A._aData.DT_RowClass);for(var y=0,C=n.aoColumns.length;y<C;y++){var H=n.aoColumns[y];var J=f.createElement("td");J.innerHTML="function"!=typeof H.fnRender||H.bUseRendered&&null!==H.mDataProp?va(n,x,y,"display"):H.fnRender({iDataRow:x,iDataColumn:y,aData:A._aData,oSettings:n});null!==H.sClass&&(J.className=H.sClass);H.bVisible?(A.nTr.appendChild(J),A._anHidden[y]=null):A._anHidden[y]=J}}}function E(n){var x,A,y;if(n.bDeferLoading||null===n.sAjaxSource){var C=n.nTBody.childNodes;var H=0;for(x=C.length;H<x;H++)if("TR"==C[H].nodeName.toUpperCase()){var J=n.aoData.length;n.aoData.push({nTr:C[H],_iId:n.iNextId++,_aData:[],_anHidden:[],_sRowStripe:""});n.aiDisplayMaster.push(J);var P=C[H].childNodes;var M=y=0;for(A=P.length;M<A;M++){var W=P[M].nodeName.toUpperCase();if("TD"==W||"TH"==W)Ba(n,J,y,b.trim(P[M].innerHTML)),y++}}}C=Qa(n);P=[];H=0;for(x=C.length;H<x;H++)for(M=0,A=C[H].childNodes.length;M<A;M++)y=C[H].childNodes[M],W=y.nodeName.toUpperCase(),"TD"!=W&&"TH"!=W||P.push(y);P.length!=C.length*n.aoColumns.length&&ya(n,1,"Unexpected number of TD elements. Expected "+C.length*n.aoColumns.length+" and got "+P.length+". DataTables does not support rowspan / colspan in the table body, and there must be one cell for each row/column combination.");M=0;for(A=n.aoColumns.length;M<A;M++)if(null===n.aoColumns[M].sTitle&&(n.aoColumns[M].sTitle=n.aoColumns[M].nTh.innerHTML),C=n.aoColumns[M]._bAutoType,W="function"==typeof n.aoColumns[M].fnRender,y=null!==n.aoColumns[M].sClass,J=n.aoColumns[M].bVisible,C||W||y||!J)for(H=0,x=n.aoData.length;H<x;H++){var ba=P[H*A+M];if(C&&"string"!=n.aoColumns[M].sType){var ca=va(n,H,M,"type");""!==ca&&(ca=Va(ca),null===n.aoColumns[M].sType?n.aoColumns[M].sType=ca:n.aoColumns[M].sType!=ca&&(n.aoColumns[M].sType="string"))}W&&(ca=n.aoColumns[M].fnRender({iDataRow:H,iDataColumn:M,aData:n.aoData[H]._aData,oSettings:n}),ba.innerHTML=ca,n.aoColumns[M].bUseRendered&&Ba(n,H,M,ca));y&&(ba.className+=" "+n.aoColumns[M].sClass);J?n.aoData[H]._anHidden[M]=null:(n.aoData[H]._anHidden[M]=ba,ba.parentNode.removeChild(ba))}}function G(n){var x;n.nTHead.getElementsByTagName("tr");if(0!==n.nTHead.getElementsByTagName("th").length){var A=0;for(x=n.aoColumns.length;A<x;A++){var y=n.aoColumns[A].nTh;null!==n.aoColumns[A].sClass&&b(y).addClass(n.aoColumns[A].sClass);n.aoColumns[A].sTitle!=y.innerHTML&&(y.innerHTML=n.aoColumns[A].sTitle)}}else{var C=f.createElement("tr");A=0;for(x=n.aoColumns.length;A<x;A++)y=n.aoColumns[A].nTh,y.innerHTML=n.aoColumns[A].sTitle,null!==n.aoColumns[A].sClass&&b(y).addClass(n.aoColumns[A].sClass),C.appendChild(y);b(n.nTHead).html("")[0].appendChild(C);Ka(n.aoHeader,n.nTHead)}if(n.bJUI)for(A=0,x=n.aoColumns.length;A<x;A++){y=n.aoColumns[A].nTh;C=f.createElement("div");C.className=n.oClasses.sSortJUIWrapper;b(y).contents().appendTo(C);var H=f.createElement("span");H.className=n.oClasses.sSortIcon;C.appendChild(H);y.appendChild(C)}x=function(){this.onselectstart=function(){return!1};return!1};if(n.oFeatures.bSort)for(A=0;A<n.aoColumns.length;A++)!1!==n.aoColumns[A].bSortable?(qa(n,n.aoColumns[A].nTh,A),b(n.aoColumns[A].nTh).on("mousedown.DT",x)):b(n.aoColumns[A].nTh).addClass(n.oClasses.sSortableNone);""!==n.oClasses.sFooterTH&&b(">tr>th",n.nTFoot).addClass(n.oClasses.sFooterTH);if(null!==n.nTFoot)for(y=Ea(n,null,n.aoFooter),A=0,x=n.aoColumns.length;A<x;A++)"undefined"!=typeof y[A]&&(n.aoColumns[A].nTf=y[A])}function I(n,x,A){var y,C,H=[],J=[],P=n.aoColumns.length;"undefined"==typeof A&&(A=!1);var M=0;for(y=x.length;M<y;M++){H[M]=x[M].slice();H[M].nTr=x[M].nTr;for(C=P-1;0<=C;C--)n.aoColumns[C].bVisible||A||H[M].splice(C,1);J.push([])}M=0;for(y=H.length;M<y;M++){if(H[M].nTr)for(n=0,C=H[M].nTr.childNodes.length;n<C;n++)H[M].nTr.removeChild(H[M].nTr.childNodes[0]);C=0;for(x=H[M].length;C<x;C++)if(P=A=1,"undefined"==typeof J[M][C]){H[M].nTr.appendChild(H[M][C].cell);for(J[M][C]=1;"undefined"!=typeof H[M+A]&&H[M][C].cell==H[M+A][C].cell;)J[M+A][C]=1,A++;for(;"undefined"!=typeof H[M][C+P]&&H[M][C].cell==H[M][C+P].cell;){for(n=0;n<A;n++)J[M+n][C+P]=1;P++}H[M][C].cell.setAttribute("rowspan",A);H[M][C].cell.setAttribute("colspan",P)}}}function K(n){var x=[],A=0,y=!1;var C=n.asStripClasses.length;var H=n.aoOpenRows.length;if(null===n.fnPreDrawCallback||!1!==n.fnPreDrawCallback.call(n.oInstance,n)){n.bDrawing=!0;"undefined"!=typeof n.iInitDisplayStart&&-1!=n.iInitDisplayStart&&(n._iDisplayStart=n.oFeatures.bServerSide?n.iInitDisplayStart:n.iInitDisplayStart>=n.fnRecordsDisplay()?0:n.iInitDisplayStart,n.iInitDisplayStart=-1,ta(n));if(n.bDeferLoading)n.bDeferLoading=!1,n.iDraw++;else if(n.oFeatures.bServerSide){if(!n.bDestroying&&!U(n))return}else n.iDraw++;if(0!==n.aiDisplay.length){var J=n._iDisplayStart,P=n._iDisplayEnd;n.oFeatures.bServerSide&&(J=0,P=n.aoData.length);for(;J<P;J++){var M=n.aoData[n.aiDisplay[J]];null===M.nTr&&D(n,n.aiDisplay[J]);var W=M.nTr;if(0!==C){var ba=n.asStripClasses[A%C];M._sRowStripe!=ba&&(b(W).removeClass(M._sRowStripe).addClass(ba),M._sRowStripe=ba)}"function"==typeof n.fnRowCallback&&(W=n.fnRowCallback.call(n.oInstance,W,n.aoData[n.aiDisplay[J]]._aData,A,J),W||y||(ya(n,0,"A node was not returned by fnRowCallback"),y=!0));x.push(W);A++;if(0!==H)for(M=0;M<H;M++)W==n.aoOpenRows[M].nParent&&x.push(n.aoOpenRows[M].nTr)}}else x[0]=f.createElement("tr"),"undefined"!=typeof n.asStripClasses[0]&&(x[0].className=n.asStripClasses[0]),y=n.oLanguage.sZeroRecords.replace("_MAX_",n.fnFormatNumber(n.fnRecordsTotal())),1!=n.iDraw||null===n.sAjaxSource||n.oFeatures.bServerSide?"undefined"!=typeof n.oLanguage.sEmptyTable&&0===n.fnRecordsTotal()&&(y=n.oLanguage.sEmptyTable):y=n.oLanguage.sLoadingRecords,C=f.createElement("td"),C.setAttribute("valign","top"),C.colSpan=La(n),C.className=n.oClasses.sRowEmpty,C.innerHTML=y,x[A].appendChild(C);"function"==typeof n.fnHeaderCallback&&n.fnHeaderCallback.call(n.oInstance,b(">tr",n.nTHead)[0],Ra(n),n._iDisplayStart,n.fnDisplayEnd(),n.aiDisplay);"function"==typeof n.fnFooterCallback&&n.fnFooterCallback.call(n.oInstance,b(">tr",n.nTFoot)[0],Ra(n),n._iDisplayStart,n.fnDisplayEnd(),n.aiDisplay);A=f.createDocumentFragment();C=f.createDocumentFragment();if(n.nTBody){y=n.nTBody.parentNode;C.appendChild(n.nTBody);if(!n.oScroll.bInfinite||!n._bInitComplete||n.bSorted||n.bFiltered)for(H=n.nTBody.childNodes,C=H.length-1;0<=C;C--)H[C].parentNode.removeChild(H[C]);C=0;for(H=x.length;C<H;C++)A.appendChild(x[C]);n.nTBody.appendChild(A);null!==y&&y.appendChild(n.nTBody)}for(C=n.aoDrawCallback.length-1;0<=C;C--)n.aoDrawCallback[C].fn.call(n.oInstance,n);n.bSorted=!1;n.bFiltered=!1;n.bDrawing=!1;n.oFeatures.bServerSide&&(xa(n,!1),"undefined"==typeof n._bInitComplete&&t(n))}}function S(n){n.oFeatures.bSort?ka(n,n.oPreviousSearch):n.oFeatures.bFilter?Z(n,n.oPreviousSearch):(ta(n),K(n))}function U(n){if(n.bAjaxDataGet){xa(n,!0);var x=n.aoColumns.length,A=[],y;n.iDraw++;A.push({name:"sEcho",value:n.iDraw});A.push({name:"iColumns",value:x});A.push({name:"sColumns",value:Wa(n)});A.push({name:"iDisplayStart",value:n._iDisplayStart});A.push({name:"iDisplayLength",value:!1!==n.oFeatures.bPaginate?n._iDisplayLength:-1});for(y=0;y<x;y++){var C=n.aoColumns[y].mDataProp;A.push({name:"mDataProp_"+y,value:"function"==typeof C?"function":C})}if(!1!==n.oFeatures.bFilter)for(A.push({name:"sSearch",value:n.oPreviousSearch.sSearch}),A.push({name:"bRegex",value:n.oPreviousSearch.bRegex}),y=0;y<x;y++)A.push({name:"sSearch_"+y,value:n.aoPreSearchCols[y].sSearch}),A.push({name:"bRegex_"+y,value:n.aoPreSearchCols[y].bRegex}),A.push({name:"bSearchable_"+y,value:n.aoColumns[y].bSearchable});if(!1!==n.oFeatures.bSort){C=null!==n.aaSortingFixed?n.aaSortingFixed.length:0;var H=n.aaSorting.length;A.push({name:"iSortingCols",value:C+H});for(y=0;y<C;y++)A.push({name:"iSortCol_"+y,value:n.aaSortingFixed[y][0]}),A.push({name:"sSortDir_"+y,value:n.aaSortingFixed[y][1]});for(y=0;y<H;y++)A.push({name:"iSortCol_"+(y+C),value:n.aaSorting[y][0]}),A.push({name:"sSortDir_"+(y+C),value:n.aaSorting[y][1]});for(y=0;y<x;y++)A.push({name:"bSortable_"+y,value:n.aoColumns[y].bSortable})}n.fnServerData.call(n.oInstance,n.sAjaxSource,A,function(J){T(n,J)},n);return!1}return!0}function T(n,x){if("undefined"!=typeof x.sEcho){if(1*x.sEcho<n.iDraw)return;n.iDraw=1*x.sEcho}(!n.oScroll.bInfinite||n.oScroll.bInfinite&&(n.bSorted||n.bFiltered))&&Xa(n);n._iRecordsTotal=x.iTotalRecords;n._iRecordsDisplay=x.iTotalDisplayRecords;var A=Wa(n);if(A="undefined"!=typeof x.sColumns&&""!==A&&x.sColumns!=A)var y=kb(n,x.sColumns);x=Pa(n.sAjaxDataProp)(x);for(var C=0,H=x.length;C<H;C++)if(A){for(var J=[],P=0,M=n.aoColumns.length;P<M;P++)J.push(x[C][y[P]]);B(n,J)}else B(n,x[C]);n.aiDisplay=n.aiDisplayMaster.slice();n.bAjaxDataGet=!1;K(n);n.bAjaxDataGet=!0;xa(n,!1)}function V(n){var x=f.createElement("div");n.nTable.parentNode.insertBefore(x,n.nTable);n.nTableWrapper=f.createElement("div");n.nTableWrapper.className=n.oClasses.sWrapper;""!==n.sTableId&&n.nTableWrapper.setAttribute("id",n.sTableId+"_wrapper");n.nTableReinsertBefore=n.nTable.nextSibling;for(var A=n.nTableWrapper,y=n.sDom.split(""),C,H,J,P,M,W,ba,ca=0;ca<y.length;ca++){H=0;J=y[ca];if("<"==J){P=f.createElement("div");M=y[ca+1];if("'"==M||'"'==M){W="";for(ba=2;y[ca+ba]!=M;)W+=y[ca+ba],ba++;"H"==W?W="fg-toolbar ui-toolbar ui-widget-header ui-corner-tl ui-corner-tr ui-helper-clearfix":"F"==W&&(W="fg-toolbar ui-toolbar ui-widget-header ui-corner-bl ui-corner-br ui-helper-clearfix");-1!=W.indexOf(".")?(M=W.split("."),P.setAttribute("id",M[0].substr(1,M[0].length-1)),P.className=M[1]):"#"==W.charAt(0)?P.setAttribute("id",W.substr(1,W.length-1)):P.className=W;ca+=ba}A.appendChild(P);A=P}else if(">"==J)A=A.parentNode;else if("l"==J&&n.oFeatures.bPaginate&&n.oFeatures.bLengthChange)C=Ma(n),H=1;else if("f"==J&&n.oFeatures.bFilter)C=X(n),H=1;else if("r"==J&&n.oFeatures.bProcessing)C=Fa(n),H=1;else if("t"==J)C=O(n),H=1;else if("i"==J&&n.oFeatures.bInfo)C=Na(n),H=1;else if("p"==J&&n.oFeatures.bPaginate)C=Oa(n),H=1;else if(0!==k.aoFeatures.length)for(P=k.aoFeatures,ba=0,M=P.length;ba<M;ba++)if(J==P[ba].cFeature){if(C=P[ba].fnInit(n))H=1;break}1==H&&null!==C&&("object"!=typeof n.aanFeatures[J]&&(n.aanFeatures[J]=[]),n.aanFeatures[J].push(C),A.appendChild(C))}x.parentNode.replaceChild(n.nTableWrapper,x)}function O(n){if(""===n.oScroll.sX&&""===n.oScroll.sY)return n.nTable;var x=f.createElement("div"),A=f.createElement("div"),y=f.createElement("div"),C=f.createElement("div"),H=f.createElement("div"),J=f.createElement("div"),P=n.nTable.cloneNode(!1),M=n.nTable.cloneNode(!1),W=n.nTable.getElementsByTagName("thead")[0],ba=0===n.nTable.getElementsByTagName("tfoot").length?null:n.nTable.getElementsByTagName("tfoot")[0],ca="undefined"!=typeof l.bJQueryUI&&l.bJQueryUI?k.oJUIClasses:k.oStdClasses;A.appendChild(y);H.appendChild(J);C.appendChild(n.nTable);x.appendChild(A);x.appendChild(C);y.appendChild(P);P.appendChild(W);null!==ba&&(x.appendChild(H),J.appendChild(M),M.appendChild(ba));x.className=ca.sScrollWrapper;A.className=ca.sScrollHead;y.className=ca.sScrollHeadInner;C.className=ca.sScrollBody;H.className=ca.sScrollFoot;J.className=ca.sScrollFootInner;n.oScroll.bAutoCss&&(A.style.overflow="hidden",A.style.position="relative",H.style.overflow="hidden",C.style.overflow="auto");A.style.border="0";A.style.width="100%";H.style.border="0";y.style.width="150%";P.removeAttribute("id");P.style.marginLeft="0";n.nTable.style.marginLeft="0";null!==ba&&(M.removeAttribute("id"),M.style.marginLeft="0");y=b(">caption",n.nTable);J=0;for(M=y.length;J<M;J++)P.appendChild(y[J]);""!==n.oScroll.sX&&(A.style.width=da(n.oScroll.sX),C.style.width=da(n.oScroll.sX),null!==ba&&(H.style.width=da(n.oScroll.sX)),b(C).scroll(function(){A.scrollLeft=this.scrollLeft;null!==ba&&(H.scrollLeft=this.scrollLeft)}));""!==n.oScroll.sY&&(C.style.height=da(n.oScroll.sY));n.aoDrawCallback.push({fn:Q,sName:"scrolling"});n.oScroll.bInfinite&&b(C).scroll(function(){!n.bDrawing&&b(this).scrollTop()+b(this).height()>b(n.nTable).height()-n.oScroll.iLoadGap&&n.fnDisplayEnd()<n.fnRecordsDisplay()&&(Ga(n,"next"),ta(n),K(n))});n.nScrollHead=A;n.nScrollFoot=H;return x}function Q(n){var x=n.nScrollHead.getElementsByTagName("div")[0],A=x.getElementsByTagName("table")[0],y=n.nTable.parentNode,C,H,J,P=[];var M=n.nTable.getElementsByTagName("thead");0<M.length&&n.nTable.removeChild(M[0]);if(null!==n.nTFoot){var W=n.nTable.getElementsByTagName("tfoot");0<W.length&&n.nTable.removeChild(W[0])}M=n.nTHead.cloneNode(!0);n.nTable.insertBefore(M,n.nTable.childNodes[0]);null!==n.nTFoot&&(W=n.nTFoot.cloneNode(!0),n.nTable.insertBefore(W,n.nTable.childNodes[1]));""===n.oScroll.sX&&(y.style.width="100%",x.parentNode.style.width="100%");var ba=Ea(n,M);var ca=0;for(C=ba.length;ca<C;ca++){var Ya=Sa(n,ca);ba[ca].style.width=n.aoColumns[Ya].sWidth}null!==n.nTFoot&&Ca(function(sa){sa.style.width=""},W.getElementsByTagName("tr"));ca=b(n.nTable).outerWidth();""===n.oScroll.sX?(n.nTable.style.width="100%",b.browser.msie&&7>=b.browser.version&&(n.nTable.style.width=da(b(n.nTable).outerWidth()-n.oScroll.iBarWidth))):""!==n.oScroll.sXInner?n.nTable.style.width=da(n.oScroll.sXInner):ca==b(y).width()&&b(y).height()<b(n.nTable).height()?(n.nTable.style.width=da(ca-n.oScroll.iBarWidth),b(n.nTable).outerWidth()>ca-n.oScroll.iBarWidth&&(n.nTable.style.width=da(ca))):n.nTable.style.width=da(ca);ca=b(n.nTable).outerWidth();""===n.oScroll.sX&&(y.style.width=da(ca+n.oScroll.iBarWidth),x.parentNode.style.width=da(ca+n.oScroll.iBarWidth));C=n.nTHead.getElementsByTagName("tr");M=M.getElementsByTagName("tr");Ca(function(sa,za){H=sa.style;H.paddingTop="0";H.paddingBottom="0";H.borderTopWidth="0";H.borderBottomWidth="0";H.height=0;J=b(sa).width();za.style.width=da(J);P.push(J)},M,C);b(M).height(0);if(null!==n.nTFoot){var wa=W.getElementsByTagName("tr");W=n.nTFoot.getElementsByTagName("tr");Ca(function(sa,za){H=sa.style;H.paddingTop="0";H.paddingBottom="0";H.borderTopWidth="0";H.borderBottomWidth="0";H.height=0;J=b(sa).width();za.style.width=da(J);P.push(J)},wa,W);b(wa).height(0)}Ca(function(sa){sa.innerHTML="";sa.style.width=da(P.shift())},M);null!==n.nTFoot&&Ca(function(sa){sa.innerHTML="";sa.style.width=da(P.shift())},wa);b(n.nTable).outerWidth()<ca&&(""===n.oScroll.sX?ya(n,1,"The table cannot fit into the current element which will cause column misalignment. It is suggested that you enable x-scrolling or increase the width the table has in which to be drawn"):""!==n.oScroll.sXInner&&ya(n,1,"The table cannot fit into the current element which will cause column misalignment. It is suggested that you increase the sScrollXInner property to allow it to draw in a larger area, or simply remove that parameter to allow automatic calculation"));""===n.oScroll.sY&&b.browser.msie&&7>=b.browser.version&&(y.style.height=da(n.nTable.offsetHeight+n.oScroll.iBarWidth));""!==n.oScroll.sY&&n.oScroll.bCollapse&&(y.style.height=da(n.oScroll.sY),wa=""!==n.oScroll.sX&&n.nTable.offsetWidth>y.offsetWidth?n.oScroll.iBarWidth:0,n.nTable.offsetHeight<y.offsetHeight&&(y.style.height=da(b(n.nTable).height()+wa)));wa=b(n.nTable).outerWidth();A.style.width=da(wa);x.style.width=da(wa+n.oScroll.iBarWidth);null!==n.nTFoot&&(x=n.nScrollFoot.getElementsByTagName("div")[0],A=x.getElementsByTagName("table")[0],x.style.width=da(n.nTable.offsetWidth+n.oScroll.iBarWidth),A.style.width=da(n.nTable.offsetWidth));if(n.bSorted||n.bFiltered)y.scrollTop=0}function N(n){if(!1===n.oFeatures.bAutoWidth)return!1;Ua(n);for(var x=0,A=n.aoColumns.length;x<A;x++)n.aoColumns[x].nTh.style.width=n.aoColumns[x].sWidth}function X(n){var x=n.oLanguage.sSearch;x=-1!==x.indexOf("_INPUT_")?x.replace("_INPUT_",'<input data-role="none" type="text" />'):""===x?'<input data-role="none" type="text" />':x+' <input data-role="none" type="text" />';var A=f.createElement("div");A.className=n.oClasses.sFilter;A.innerHTML="<label>"+x+"</label>";""!==n.sTableId&&"undefined"==typeof n.aanFeatures.f&&A.setAttribute("id",n.sTableId+"_filter");x=b("input",A);x.val(n.oPreviousSearch.sSearch.replace('"',"&quot;"));x.on("keyup.DT",function(){for(var y=n.aanFeatures.f,C=0,H=y.length;C<H;C++)y[C]!=this.parentNode&&b("input",y[C]).val(this.value);this.value!=n.oPreviousSearch.sSearch&&Z(n,{sSearch:this.value,bRegex:n.oPreviousSearch.bRegex,bSmart:n.oPreviousSearch.bSmart})});x.on("keypress.DT",function(y){if(13==y.keyCode)return!1});return A}function Z(n,x,A){ha(n,x.sSearch,A,x.bRegex,x.bSmart);for(x=0;x<n.aoPreSearchCols.length;x++)ja(n,n.aoPreSearchCols[x].sSearch,x,n.aoPreSearchCols[x].bRegex,n.aoPreSearchCols[x].bSmart);0!==k.afnFiltering.length&&ea(n);n.bFiltered=!0;n._iDisplayStart=0;ta(n);K(n);aa(n,0)}function ea(n){for(var x=k.afnFiltering,A=0,y=x.length;A<y;A++)for(var C=0,H=0,J=n.aiDisplay.length;H<J;H++){var P=n.aiDisplay[H-
C];x[A](n,Ta(n,P,"filter"),P)||(n.aiDisplay.splice(H-C,1),C++)}}function ja(n,x,A,y,C){if(""!==x){var H=0;x=la(x,y,C);for(y=n.aiDisplay.length-1;0<=y;y--)C=oa(va(n,n.aiDisplay[y],A,"filter"),n.aoColumns[A].sType),x.test(C)||(n.aiDisplay.splice(y,1),H++)}}function ha(n,x,A,y,C){var H=la(x,y,C);if("undefined"==typeof A||null===A)A=0;0!==k.afnFiltering.length&&(A=1);if(0>=x.length)n.aiDisplay.splice(0,n.aiDisplay.length),n.aiDisplay=n.aiDisplayMaster.slice();else if(n.aiDisplay.length==n.aiDisplayMaster.length||n.oPreviousSearch.sSearch.length>x.length||1==A||0!==x.indexOf(n.oPreviousSearch.sSearch))for(n.aiDisplay.splice(0,n.aiDisplay.length),aa(n,1),A=0;A<n.aiDisplayMaster.length;A++)H.test(n.asDataSearch[A])&&n.aiDisplay.push(n.aiDisplayMaster[A]);else{var J=0;for(A=0;A<n.asDataSearch.length;A++)H.test(n.asDataSearch[A])||(n.aiDisplay.splice(A-J,1),J++)}n.oPreviousSearch.sSearch=x;n.oPreviousSearch.bRegex=y;n.oPreviousSearch.bSmart=C}function aa(n,x){n.asDataSearch.splice(0,n.asDataSearch.length);x="undefined"!=typeof x&&1==x?n.aiDisplayMaster:n.aiDisplay;for(var A=0,y=x.length;A<y;A++)n.asDataSearch[A]=ia(n,Ta(n,x[A],"filter"))}function ia(n,x){var A="";"undefined"==typeof n.__nTmpFilter&&(n.__nTmpFilter=f.createElement("div"));for(var y=n.__nTmpFilter,C=0,H=n.aoColumns.length;C<H;C++)n.aoColumns[C].bSearchable&&(A+=oa(x[C],n.aoColumns[C].sType)+"  ");-1!==A.indexOf("&")&&(y.innerHTML=A,A=y.textContent?y.textContent:y.innerText,A=A.replace(/\n/g," ").replace(/\r/g,""));return A}function la(n,x,A){A?(n=x?n.split(" "):Za(n).split(" "),n="^(?=.*?"+n.join(")(?=.*?")+").*$"):n=x?n:Za(n);return new RegExp(n,"i")}function oa(n,x){return"function"==typeof k.ofnSearch[x]?k.ofnSearch[x](n):"html"==x?n.replace(/\n/g," ").replace(/<.*?>/g,""):"string"==typeof n?n.replace(/\n/g," "):null===n?"":n}function ka(n,x){var A,y=[],C=[],H=k.oSort;var J=n.aoData;var P=n.aoColumns;if(!n.oFeatures.bServerSide&&(0!==n.aaSorting.length||null!==n.aaSortingFixed)){y=null!==n.aaSortingFixed?n.aaSortingFixed.concat(n.aaSorting):n.aaSorting.slice();for(A=0;A<y.length;A++){var M=y[A][0];var W=Ha(n,M);var ba=n.aoColumns[M].sSortDataType;if("undefined"!=typeof k.afnSortData[ba]){var ca=k.afnSortData[ba](n,M,W);W=0;for(ba=J.length;W<ba;W++)Ba(n,W,M,ca[W])}}A=0;for(J=n.aiDisplayMaster.length;A<J;A++)C[n.aiDisplayMaster[A]]=A;var Ya=y.length;n.aiDisplayMaster.sort(function(wa,sa){for(A=0;A<Ya;A++){var za=P[y[A][0]].iDataSort;var lb=P[za].sType;za=H[(lb?lb:"string")+"-"+y[A][1]](va(n,wa,za,"sort"),va(n,sa,za,"sort"));if(0!==za)return za}return H["numeric-asc"](C[wa],C[sa])})}"undefined"!=typeof x&&!x||n.oFeatures.bDeferRender||ra(n);n.bSorted=!0;n.oFeatures.bFilter?Z(n,n.oPreviousSearch,1):(n.aiDisplay=n.aiDisplayMaster.slice(),n._iDisplayStart=0,ta(n),K(n))}function qa(n,x,A,y){b(x).on("click.DT",function(C){if(!1!==n.aoColumns[A].bSortable){var H=function(){if(C.shiftKey){for(var J=!1,P=0;P<n.aaSorting.length;P++)if(n.aaSorting[P][0]==A){J=!0;var M=n.aaSorting[P][0];var W=n.aaSorting[P][2]+1;"undefined"==typeof n.aoColumns[M].asSorting[W]?n.aaSorting.splice(P,1):(n.aaSorting[P][1]=n.aoColumns[M].asSorting[W],n.aaSorting[P][2]=W);break}!1===J&&n.aaSorting.push([A,n.aoColumns[A].asSorting[0],0])}else 1==n.aaSorting.length&&n.aaSorting[0][0]==A?(M=n.aaSorting[0][0],W=n.aaSorting[0][2]+1,"undefined"==typeof n.aoColumns[M].asSorting[W]&&(W=0),n.aaSorting[0][1]=n.aoColumns[M].asSorting[W],n.aaSorting[0][2]=W):(n.aaSorting.splice(0,n.aaSorting.length),n.aaSorting.push([A,n.aoColumns[A].asSorting[0],0]));ka(n)};n.oFeatures.bProcessing?(xa(n,!0),setTimeout(function(){H();n.oFeatures.bServerSide||xa(n,!1)},0)):H();"function"==typeof y&&y(n)}})}function ra(n){var x,A,y=n.aoColumns.length,C=n.oClasses;for(x=0;x<y;x++)n.aoColumns[x].bSortable&&b(n.aoColumns[x].nTh).removeClass(C.sSortAsc+" "+C.sSortDesc+" "+n.aoColumns[x].sSortingClass);var H=null!==n.aaSortingFixed?n.aaSortingFixed.concat(n.aaSorting):n.aaSorting.slice();for(x=0;x<n.aoColumns.length;x++)if(n.aoColumns[x].bSortable){var J=n.aoColumns[x].sSortingClass;var P=-1;for(A=0;A<H.length;A++)if(H[A][0]==x){J="asc"==H[A][1]?C.sSortAsc:C.sSortDesc;P=A;break}b(n.aoColumns[x].nTh).addClass(J);n.bJUI&&(A=b("span",n.aoColumns[x].nTh),A.removeClass(C.sSortJUIAsc+" "+C.sSortJUIDesc+" "+C.sSortJUI+" "+C.sSortJUIAscAllowed+" "+C.sSortJUIDescAllowed),A.addClass(-1==P?n.aoColumns[x].sSortingClassJUI:"asc"==H[P][1]?C.sSortJUIAsc:C.sSortJUIDesc))}else b(n.aoColumns[x].nTh).addClass(n.aoColumns[x].sSortingClass);J=C.sSortColumn;if(n.oFeatures.bSort&&n.oFeatures.bSortClasses){P=Da(n);if(n.oFeatures.bDeferRender)b(P).removeClass(J+
"1 "+J+"2 "+J+"3");else if(P.length>=y)for(x=0;x<y;x++)if(-1!=P[x].className.indexOf(J+"1"))for(A=0,n=P.length/y;A<n;A++)P[y*A+x].className=b.trim(P[y*A+x].className.replace(J+"1",""));else if(-1!=P[x].className.indexOf(J+"2"))for(A=0,n=P.length/y;A<n;A++)P[y*A+x].className=b.trim(P[y*A+x].className.replace(J+"2",""));else if(-1!=P[x].className.indexOf(J+"3"))for(A=0,n=P.length/y;A<n;A++)P[y*A+x].className=b.trim(P[y*A+x].className.replace(" "+J+"3",""));C=1;for(x=0;x<H.length;x++){var M=parseInt(H[x][0],10);A=0;for(n=P.length/y;A<n;A++)P[y*A+M].className+=" "+J+C;3>C&&C++}}}function Oa(n){if(n.oScroll.bInfinite)return null;var x=f.createElement("div");x.className=n.oClasses.sPaging+n.sPaginationType;k.oPagination[n.sPaginationType].fnInit(n,x,function(A){ta(A);K(A)});"undefined"==typeof n.aanFeatures.p&&n.aoDrawCallback.push({fn:function(A){k.oPagination[A.sPaginationType].fnUpdate(A,function(y){ta(y);K(y)})},sName:"pagination"});return x}function Ga(n,x){var A=n._iDisplayStart;"first"==x?n._iDisplayStart=0:"previous"==x?(n._iDisplayStart=0<=n._iDisplayLength?n._iDisplayStart-n._iDisplayLength:0,0>n._iDisplayStart&&(n._iDisplayStart=0)):"next"==x?0<=n._iDisplayLength?n._iDisplayStart+n._iDisplayLength<n.fnRecordsDisplay()&&(n._iDisplayStart+=n._iDisplayLength):n._iDisplayStart=0:"last"==x?0<=n._iDisplayLength?(x=parseInt((n.fnRecordsDisplay()-1)/n._iDisplayLength,10)+1,n._iDisplayStart=(x-1)*n._iDisplayLength):n._iDisplayStart=0:ya(n,0,"Unknown paging action: "+x);return A!=n._iDisplayStart}function Na(n){var x=f.createElement("div");x.className=n.oClasses.sInfo;"undefined"==typeof n.aanFeatures.i&&(n.aoDrawCallback.push({fn:Ia,sName:"information"}),""!==n.sTableId&&x.setAttribute("id",n.sTableId+"_info"));return x}function Ia(n){if(n.oFeatures.bInfo&&0!==n.aanFeatures.i.length){var x=n._iDisplayStart+1,A=n.fnDisplayEnd(),y=n.fnRecordsTotal(),C=n.fnRecordsDisplay(),H=n.fnFormatNumber(x),J=n.fnFormatNumber(A),P=n.fnFormatNumber(y),M=n.fnFormatNumber(C);n.oScroll.bInfinite&&(H=n.fnFormatNumber(1));H=0===n.fnRecordsDisplay()&&n.fnRecordsDisplay()==n.fnRecordsTotal()?n.oLanguage.sInfoEmpty+n.oLanguage.sInfoPostFix:0===n.fnRecordsDisplay()?n.oLanguage.sInfoEmpty+" "+n.oLanguage.sInfoFiltered.replace("_MAX_",P)+n.oLanguage.sInfoPostFix:n.fnRecordsDisplay()==n.fnRecordsTotal()?n.oLanguage.sInfo.replace("_START_",H).replace("_END_",J).replace("_TOTAL_",M)+n.oLanguage.sInfoPostFix:n.oLanguage.sInfo.replace("_START_",H).replace("_END_",J).replace("_TOTAL_",M)+" "+n.oLanguage.sInfoFiltered.replace("_MAX_",n.fnFormatNumber(n.fnRecordsTotal()))+
n.oLanguage.sInfoPostFix;null!==n.oLanguage.fnInfoCallback&&(H=n.oLanguage.fnInfoCallback(n,x,A,y,C,H));n=n.aanFeatures.i;x=0;for(A=n.length;x<A;x++)b(n[x]).html(H)}}function Ma(n){if(n.oScroll.bInfinite)return null;var x='<select data-role="none" size="1" '+(""===n.sTableId?"":'name="'+n.sTableId+'_length"')+">",A;if(2==n.aLengthMenu.length&&"object"==typeof n.aLengthMenu[0]&&"object"==typeof n.aLengthMenu[1]){var y=0;for(A=n.aLengthMenu[0].length;y<A;y++)x+='<option value="'+n.aLengthMenu[0][y]+
'">'+n.aLengthMenu[1][y]+"</option>"}else for(y=0,A=n.aLengthMenu.length;y<A;y++)x+='<option value="'+n.aLengthMenu[y]+'">'+n.aLengthMenu[y]+"</option>";x+="</select>";var C=f.createElement("div");""!==n.sTableId&&"undefined"==typeof n.aanFeatures.l&&C.setAttribute("id",n.sTableId+"_length");C.className=n.oClasses.sLength;C.innerHTML="<label>"+n.oLanguage.sLengthMenu.replace("_MENU_",x)+"</label>";b('select option[value="'+n._iDisplayLength+'"]',C).attr("selected",!0);b("select",C).on("change.DT",function(){var H=b(this).val(),J=n.aanFeatures.l;y=0;for(A=J.length;y<A;y++)J[y]!=this.parentNode&&b("select",J[y]).val(H);n._iDisplayLength=parseInt(H,10);ta(n);n.fnDisplayEnd()==n.fnRecordsDisplay()&&(n._iDisplayStart=n.fnDisplayEnd()-n._iDisplayLength,0>n._iDisplayStart&&(n._iDisplayStart=0));-1==n._iDisplayLength&&(n._iDisplayStart=0);K(n)});return C}function Fa(n){var x=f.createElement("div");""!==n.sTableId&&"undefined"==typeof n.aanFeatures.r&&x.setAttribute("id",n.sTableId+"_processing");x.innerHTML=n.oLanguage.sProcessing;x.className=n.oClasses.sProcessing;n.nTable.parentNode.insertBefore(x,n.nTable);return x}function xa(n,x){if(n.oFeatures.bProcessing){n=n.aanFeatures.r;for(var A=0,y=n.length;A<y;A++)n[A].style.visibility=x?"visible":"hidden"}}function Sa(n,x){for(var A=-1,y=0;y<n.aoColumns.length;y++)if(!0===n.aoColumns[y].bVisible&&A++,A==x)return y;return null}function Ha(n,x){for(var A=-1,y=0;y<n.aoColumns.length;y++)if(!0===n.aoColumns[y].bVisible&&A++,y==x)return!0===n.aoColumns[y].bVisible?A:null;return null}function Ja(n,x){var A;var y=n._iDisplayStart;for(A=n._iDisplayEnd;y<A;y++)if(n.aoData[n.aiDisplay[y]].nTr==x)return n.aiDisplay[y];y=0;for(A=n.aoData.length;y<A;y++)if(n.aoData[y].nTr==x)return y;return null}function La(n){for(var x=0,A=0;A<n.aoColumns.length;A++)!0===n.aoColumns[A].bVisible&&x++;return x}function ta(n){n._iDisplayEnd=!1===n.oFeatures.bPaginate?n.aiDisplay.length:n._iDisplayStart+n._iDisplayLength>n.aiDisplay.length||-1==n._iDisplayLength?n.aiDisplay.length:n._iDisplayStart+
n._iDisplayLength}function mb(n,x){if(!n||null===n||""===n)return 0;"undefined"==typeof x&&(x=f.getElementsByTagName("body")[0]);var A=f.createElement("div");A.style.width=da(n);x.appendChild(A);n=A.offsetWidth;x.removeChild(A);return n}function Ua(n){var x=0,A=0,y=n.aoColumns.length,C,H=b("th",n.nTHead);for(C=0;C<y;C++)if(n.aoColumns[C].bVisible&&(A++,null!==n.aoColumns[C].sWidth)){var J=mb(n.aoColumns[C].sWidthOrig,n.nTable.parentNode);null!==J&&(n.aoColumns[C].sWidth=da(J));x++}if(y==H.length&&0===x&&A==y&&""===n.oScroll.sX&&""===n.oScroll.sY)for(C=0;C<n.aoColumns.length;C++)J=b(H[C]).width(),null!==J&&(n.aoColumns[C].sWidth=da(J));else{x=n.nTable.cloneNode(!1);C=n.nTHead.cloneNode(!0);A=f.createElement("tbody");J=f.createElement("tr");x.removeAttribute("id");x.appendChild(C);null!==n.nTFoot&&(x.appendChild(n.nTFoot.cloneNode(!0)),Ca(function(M){M.style.width=""},x.getElementsByTagName("tr")));x.appendChild(A);A.appendChild(J);A=b("thead th",x);0===A.length&&(A=b("tbody tr:eq(0)>td",x));H=Ea(n,C);for(C=A=0;C<y;C++){var P=n.aoColumns[C];P.bVisible&&null!==P.sWidthOrig&&""!==P.sWidthOrig?H[C-A].style.width=da(P.sWidthOrig):P.bVisible?H[C-A].style.width="":A++}for(C=0;C<y;C++)n.aoColumns[C].bVisible&&(A=nb(n,C),null!==A&&(A=A.cloneNode(!0),""!==n.aoColumns[C].sContentPadding&&(A.innerHTML+=n.aoColumns[C].sContentPadding),J.appendChild(A)));y=n.nTable.parentNode;y.appendChild(x);""!==n.oScroll.sX&&""!==n.oScroll.sXInner?x.style.width=da(n.oScroll.sXInner):""!==n.oScroll.sX?(x.style.width="",b(x).width()<y.offsetWidth&&(x.style.width=da(y.offsetWidth))):""!==n.oScroll.sY&&(x.style.width=da(y.offsetWidth));x.style.visibility="hidden";ob(n,x);y=b("tbody tr:eq(0)",x).children();0===y.length&&(y=Ea(n,b("thead",x)[0]));if(""!==n.oScroll.sX){for(C=A=J=0;C<n.aoColumns.length;C++)n.aoColumns[C].bVisible&&(J+=null===n.aoColumns[C].sWidthOrig?b(y[A]).outerWidth():parseInt(n.aoColumns[C].sWidth.replace("px",""),10)+(b(y[A]).outerWidth()-b(y[A]).width()),A++);x.style.width=da(J);n.nTable.style.width=da(J)}for(C=A=0;C<n.aoColumns.length;C++)n.aoColumns[C].bVisible&&(J=b(y[A]).width(),null!==J&&0<J&&(n.aoColumns[C].sWidth=da(J)),A++);n.nTable.style.width=da(b(x).outerWidth());x.parentNode.removeChild(x)}}function ob(n,x){""===n.oScroll.sX&&""!==n.oScroll.sY?(b(x).width(),x.style.width=da(b(x).outerWidth()-n.oScroll.iBarWidth)):""!==n.oScroll.sX&&(x.style.width=da(b(x).outerWidth()))}function nb(n,x){var A=pb(n,x);if(0>A)return null;if(null===n.aoData[A].nTr){var y=f.createElement("td");y.innerHTML=va(n,A,x,"");return y}return Da(n,A)[x]}function pb(n,x){for(var A=-1,y=-1,C=0;C<n.aoData.length;C++){var H=va(n,C,x,"display")+"";H=H.replace(/<.*?>/g,"");H.length>A&&(A=H.length,y=C)}return y}function da(n){if(null===n)return"0px";if("number"==typeof n)return 0>n?"0px":n+"px";var x=n.charCodeAt(n.length-1);return 48>x||57<x?n:n+"px"}function Va(n){for(var x=k.aTypes,A=x.length,y=0;y<A;y++){var C=x[y](n);if(null!==C)return C}return"string"}function na(n){for(var x=0;x<h.length;x++)if(h[x].nTable==n)return h[x];return null}function Ra(n){for(var x=[],A=n.aoData.length,y=0;y<A;y++)x.push(n.aoData[y]._aData);return x}function Qa(n){for(var x=[],A=0,y=n.aoData.length;A<y;A++)null!==n.aoData[A].nTr&&x.push(n.aoData[A].nTr);return x}function Da(n,x){var A=[],y;var C=0;var H=n.aoData.length;"undefined"!=typeof x&&(C=x,H=x+1);for(;C<H;C++){var J=n.aoData[C];if(null!==J.nTr){x=[];var P=0;for(y=J.nTr.childNodes.length;P<y;P++){var M=J.nTr.childNodes[P].nodeName.toLowerCase();"td"!=M&&"th"!=M||x.push(J.nTr.childNodes[P])}P=M=0;for(y=n.aoColumns.length;P<y;P++)n.aoColumns[P].bVisible?A.push(x[P-M]):(A.push(J._anHidden[P]),M++)}}return A}function Za(n){return n.replace(/(\/|\.|\*|\+|\?|\||\(|\)|\[|\]|\{|\}|\\|\$|\^)/g,"\\$1")}function ab(n,x){for(var A=-1,y=0,C=n.length;y<C;y++)n[y]==x?A=y:n[y]>x&&n[y]--;-1!=A&&n.splice(A,1)}function kb(n,x){x=x.split(",");for(var A=[],y=0,C=n.aoColumns.length;y<C;y++)for(var H=0;H<C;H++)if(n.aoColumns[y].sName==x[H]){A.push(H);break}return A}function Wa(n){for(var x="",A=0,y=n.aoColumns.length;A<y;A++)x+=n.aoColumns[A].sName+",";return x.length==y?"":x.slice(0,-1)}function ya(n,x,A){n=""===n.sTableId?"DataTables warning: "+A:"DataTables warning (table id = '"+n.sTableId+"'): "+A;if(0===x)if("alert"==k.sErrMode)alert(n);else throw n;else"undefined"!=typeof console&&"undefined"!=typeof console.log&&console.log(n)}function Xa(n){n.aoData.splice(0,n.aoData.length);n.aiDisplayMaster.splice(0,n.aiDisplayMaster.length);n.aiDisplay.splice(0,n.aiDisplay.length);ta(n)}function bb(n){if(n.oFeatures.bStateSave&&"undefined"==typeof n.bDestroying){var x,A;var y='{"iCreate":'+((new Date).getTime()+",");y+='"iStart":'+(n.oScroll.bInfinite?0:n._iDisplayStart)+",";y+='"iEnd":'+(n.oScroll.bInfinite?n._iDisplayLength:n._iDisplayEnd)+",";y+='"iLength":'+n._iDisplayLength+",";y+='"sFilter":"'+encodeURIComponent(n.oPreviousSearch.sSearch)+'",';y+='"sFilterEsc":'+!n.oPreviousSearch.bRegex+",";y+='"aaSorting":[ ';for(x=0;x<n.aaSorting.length;x++)y+="["+n.aaSorting[x][0]+',"'+n.aaSorting[x][1]+'"],';y=y.substring(0,y.length-
1);y+='],"aaSearchCols":[ ';for(x=0;x<n.aoPreSearchCols.length;x++)y+='["'+encodeURIComponent(n.aoPreSearchCols[x].sSearch)+'",'+!n.aoPreSearchCols[x].bRegex+"],";y=y.substring(0,y.length-1);y+='],"abVisCols":[ ';for(x=0;x<n.aoColumns.length;x++)y+=n.aoColumns[x].bVisible+",";y=y.substring(0,y.length-1);y+="]";x=0;for(A=n.aoStateSave.length;x<A;x++){var C=n.aoStateSave[x].fn(n,y);""!==C&&(y=C)}qb(n.sCookiePrefix+n.sInstance,y+"}",n.iCookieDuration,n.sCookiePrefix,n.fnCookieCallback)}}function rb(n,x){if(n.oFeatures.bStateSave){var A;var y=cb(n.sCookiePrefix+n.sInstance);if(null!==y&&""!==y){try{var C="function"==typeof b.parseJSON?b.parseJSON(y.replace(/'/g,'"')):eval("("+y+")")}catch(H){return}y=0;for(A=n.aoStateLoad.length;y<A;y++)if(!n.aoStateLoad[y].fn(n,C))return;n.oLoadedState=b.extend(!0,{},C);n._iDisplayStart=C.iStart;n.iInitDisplayStart=C.iStart;n._iDisplayEnd=C.iEnd;n._iDisplayLength=C.iLength;n.oPreviousSearch.sSearch=decodeURIComponent(C.sFilter);n.aaSorting=C.aaSorting.slice();n.saved_aaSorting=C.aaSorting.slice();"undefined"!=typeof C.sFilterEsc&&(n.oPreviousSearch.bRegex=!C.sFilterEsc);if("undefined"!=typeof C.aaSearchCols)for(y=0;y<C.aaSearchCols.length;y++)n.aoPreSearchCols[y]={sSearch:decodeURIComponent(C.aaSearchCols[y][0]),bRegex:!C.aaSearchCols[y][1]};if("undefined"!=typeof C.abVisCols)for(x.saved_aoColumns=[],y=0;y<C.abVisCols.length;y++)x.saved_aoColumns[y]={},x.saved_aoColumns[y].bVisible=C.abVisCols[y]}}}function qb(n,x,A,y,C){var H=new Date;H.setTime(H.getTime()+
1E3*A);A=c.location.pathname.split("/");n=n+"_"+A.pop().replace(/[\/:]/g,"").toLowerCase();if(null!==C){var J="function"==typeof b.parseJSON?b.parseJSON(x):eval("("+x+")");x=C(n,J,H.toGMTString(),A.join("/")+"/")}else x=n+"="+encodeURIComponent(x)+"; expires="+H.toGMTString()+"; path="+A.join("/")+"/";C="";H=9999999999999;if(4096<(null!==cb(n)?f.cookie.length:x.length+f.cookie.length)+10){n=f.cookie.split(";");for(var P=0,M=n.length;P<M;P++)if(-1!=n[P].indexOf(y)){var W=n[P].split("=");try{J=eval("("+
decodeURIComponent(W[1])+")")}catch(ba){continue}"undefined"!=typeof J.iCreate&&J.iCreate<H&&(C=W[0],H=J.iCreate)}""!==C&&(f.cookie=C+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; path="+A.join("/")+"/")}f.cookie=x}function cb(n){var x=c.location.pathname.split("/");n=n+"_"+x[x.length-1].replace(/[\/:]/g,"").toLowerCase()+"=";x=f.cookie.split(";");for(var A=0;A<x.length;A++){for(var y=x[A];" "==y.charAt(0);)y=y.substring(1,y.length);if(0===y.indexOf(n))return decodeURIComponent(y.substring(n.length,y.length))}return null}function Ka(n,x){x=x.getElementsByTagName("tr");var A,y,C,H;n.splice(0,n.length);var J=0;for(C=x.length;J<C;J++)n.push([]);J=0;for(C=x.length;J<C;J++){var P=0;for(H=x[J].childNodes.length;P<H;P++){var M=x[J].childNodes[P];if("TD"==M.nodeName.toUpperCase()||"TH"==M.nodeName.toUpperCase()){var W=1*M.getAttribute("colspan"),ba=1*M.getAttribute("rowspan");W=W&&0!==W&&1!==W?W:1;ba=ba&&0!==ba&&1!==ba?ba:1;for(A=0;"undefined"!=typeof n[J][A];)A++;var ca=A;for(y=0;y<W;y++)for(A=0;A<ba;A++)n[J+A][ca+y]={cell:M,unique:1==W?!0:!1},n[J+A].nTr=x[J]}}}}function Ea(n,x,A){var y=[];"undefined"==typeof A&&(A=n.aoHeader,"undefined"!=typeof x&&(A=[],Ka(A,x)));x=0;for(var C=A.length;x<C;x++)for(var H=0,J=A[x].length;H<J;H++)!A[x][H].unique||"undefined"!=typeof y[H]&&n.bSortCellsTop||(y[H]=A[x][H].cell);return y}function sb(){var n=f.createElement("p"),x=n.style;x.width="100%";x.height="200px";var A=f.createElement("div");x=A.style;x.position="absolute";x.top="0px";x.left="0px";x.visibility="hidden";x.width="200px";x.height="150px";x.overflow="hidden";A.appendChild(n);f.body.appendChild(A);x=n.offsetWidth;A.style.overflow="scroll";n=n.offsetWidth;x==n&&(n=A.clientWidth);f.body.removeChild(A);return x-n}function Ca(n,x,A){for(var y=0,C=x.length;y<C;y++)for(var H=0,J=x[y].childNodes.length;H<J;H++)1==x[y].childNodes[H].nodeType&&("undefined"!=typeof A?n(x[y].childNodes[H],A[y].childNodes[H]):n(x[y].childNodes[H]))}function Y(n,x,A,y){"undefined"==typeof y&&(y=A);"undefined"!=typeof x[A]&&(n[y]=x[A])}function Ta(n,x,A){for(var y=[],C=0,H=n.aoColumns.length;C<H;C++)y.push(va(n,x,C,A));return y}function va(n,x,A,y){var C=n.aoColumns[A];if((A=C.fnGetData(n.aoData[x]._aData))===R)return n.iDrawError!=n.iDraw&&null===C.sDefaultContent&&(ya(n,0,"Requested unknown parameter '"+C.mDataProp+"' from the data source for row "+x),n.iDrawError=n.iDraw),C.sDefaultContent;null===A&&null!==C.sDefaultContent&&(A=C.sDefaultContent);return"display"==y&&null===A?"":A}function Ba(n,x,A,y){n.aoColumns[A].fnSetData(n.aoData[x]._aData,y)}function Pa(n){if(null===n)return function(){return null};if("function"==typeof n)return function(A){return n(A)};if("string"==typeof n&&-1!=n.indexOf(".")){var x=n.split(".");return 2==x.length?function(A){return A[x[0]][x[1]]}:3==x.length?function(A){return A[x[0]][x[1]][x[2]]}:function(A){for(var y=0,C=x.length;y<C;y++)A=A[x[y]];return A}}return function(A){return A[n]}}function jb(n){if(null===n)return function(){};if("function"==typeof n)return function(A,y){return n(A,y)};if("string"==typeof n&&-1!=n.indexOf(".")){var x=n.split(".");return 2==x.length?function(A,y){A[x[0]][x[1]]=y}:3==x.length?function(A,y){A[x[0]][x[1]][x[2]]=y}:function(A,y){for(var C=0,H=x.length-1;C<H;C++)A=A[x[C]];A[x[x.length-1]]=y}}return function(A,y){A[n]=y}}this.oApi={};this.fnDraw=function(n){var x=na(this[k.iApiIndex]);"undefined"!=typeof n&&!1===n?(ta(x),K(x)):S(x)};this.fnFilter=function(n,x,A,y,C){var H=na(this[k.iApiIndex]);if(H.oFeatures.bFilter)if("undefined"==typeof A&&(A=!1),"undefined"==typeof y&&(y=!0),"undefined"==typeof C&&(C=!0),"undefined"==typeof x||null===x){if(Z(H,{sSearch:n,bRegex:A,bSmart:y},1),C&&"undefined"!=typeof H.aanFeatures.f)for(x=H.aanFeatures.f,A=0,y=x.length;A<y;A++)b("input",x[A]).val(n)}else H.aoPreSearchCols[x].sSearch=n,H.aoPreSearchCols[x].bRegex=A,H.aoPreSearchCols[x].bSmart=y,Z(H,H.oPreviousSearch,1)};this.fnSettings=function(){return na(this[k.iApiIndex])};this.fnVersionCheck=k.fnVersionCheck;this.fnSort=function(n){var x=na(this[k.iApiIndex]);x.aaSorting=n;ka(x)};this.fnSortListener=function(n,x,A){qa(na(this[k.iApiIndex]),n,x,A)};this.fnAddData=function(n,x){if(0===n.length)return[];var A=[],y=na(this[k.iApiIndex]);if("object"==typeof n[0])for(var C=0;C<n.length;C++){var H=B(y,n[C]);if(-1==H)return A;A.push(H)}else{H=B(y,n);if(-1==H)return A;A.push(H)}y.aiDisplay=y.aiDisplayMaster.slice();("undefined"==typeof x||x)&&S(y);return A};this.fnDeleteRow=function(n,x,A){var y=na(this[k.iApiIndex]);n="object"==typeof n?Ja(y,n):n;var C=y.aoData.splice(n,1),H=b.inArray(n,y.aiDisplay);y.asDataSearch.splice(H,1);ab(y.aiDisplayMaster,n);ab(y.aiDisplay,n);"function"==typeof x&&x.call(this,y,C);y._iDisplayStart>=y.aiDisplay.length&&(y._iDisplayStart-=y._iDisplayLength,0>y._iDisplayStart&&(y._iDisplayStart=0));if("undefined"==typeof A||A)ta(y),K(y);return C};this.fnClearTable=function(n){var x=na(this[k.iApiIndex]);Xa(x);("undefined"==typeof n||n)&&K(x)};this.fnOpen=function(n,x,A){var y=na(this[k.iApiIndex]);this.fnClose(n);var C=f.createElement("tr"),H=f.createElement("td");C.appendChild(H);H.className=A;H.colSpan=La(y);"undefined"!=typeof x.jquery||"object"==typeof x?H.appendChild(x):H.innerHTML=x;x=b("tr",y.nTBody);-1!=b.inArray(n,x)&&b(C).insertAfter(n);y.aoOpenRows.push({nTr:C,nParent:n});return C};this.fnClose=function(n){for(var x=na(this[k.iApiIndex]),A=0;A<x.aoOpenRows.length;A++)if(x.aoOpenRows[A].nParent==n)return(n=x.aoOpenRows[A].nTr.parentNode)&&n.removeChild(x.aoOpenRows[A].nTr),x.aoOpenRows.splice(A,1),0;return 1};this.fnGetData=function(n,x){var A=na(this[k.iApiIndex]);return"undefined"!=typeof n?(n="object"==typeof n?Ja(A,n):n,"undefined"!=typeof x?va(A,n,x,""):"undefined"!=typeof A.aoData[n]?A.aoData[n]._aData:null):Ra(A)};this.fnGetNodes=function(n){var x=na(this[k.iApiIndex]);return"undefined"!=typeof n?"undefined"!=typeof x.aoData[n]?x.aoData[n].nTr:null:Qa(x)};this.fnGetPosition=function(n){var x=na(this[k.iApiIndex]),A=n.nodeName.toUpperCase();if("TR"==A)return Ja(x,n);if("TD"==A||"TH"==A){A=Ja(x,n.parentNode);for(var y=Da(x,A),C=0;C<x.aoColumns.length;C++)if(y[C]==n)return[A,Ha(x,C),C]}return null};this.fnUpdate=function(n,x,A,y,C){var H=na(this[k.iApiIndex]);x="object"==typeof x?Ja(H,x):x;if(b.isArray(n)&&"object"==typeof n)for(H.aoData[x]._aData=n.slice(),A=0;A<H.aoColumns.length;A++)this.fnUpdate(va(H,x,A),x,A,!1,!1);else if("object"==typeof n)for(H.aoData[x]._aData=b.extend(!0,{},n),A=0;A<H.aoColumns.length;A++)this.fnUpdate(va(H,x,A),x,A,!1,!1);else Ba(H,x,A,n),null!==H.aoColumns[A].fnRender&&(n=H.aoColumns[A].fnRender({iDataRow:x,iDataColumn:A,aData:H.aoData[x]._aData,oSettings:H}),H.aoColumns[A].bUseRendered&&Ba(H,x,A,n)),null!==H.aoData[x].nTr&&(Da(H,x)[A].innerHTML=n);A=b.inArray(x,H.aiDisplay);H.asDataSearch[A]=ia(H,Ta(H,x,"filter"));("undefined"==typeof C||C)&&N(H);("undefined"==typeof y||y)&&S(H);return 0};this.fnSetColumnVis=function(n,x,A){var y=na(this[k.iApiIndex]),C;var H=y.aoColumns.length;var J;if(y.aoColumns[n].bVisible!=x){if(x){for(C=J=0;C<n;C++)y.aoColumns[C].bVisible&&J++;J=J>=La(y);if(!J)for(C=n;C<H;C++)if(y.aoColumns[C].bVisible){var P=C;break}C=0;for(H=y.aoData.length;C<H;C++)null!==y.aoData[C].nTr&&(J?y.aoData[C].nTr.appendChild(y.aoData[C]._anHidden[n]):y.aoData[C].nTr.insertBefore(y.aoData[C]._anHidden[n],Da(y,C)[P]))}else for(C=0,H=y.aoData.length;C<H;C++)null!==y.aoData[C].nTr&&(P=Da(y,C)[n],y.aoData[C]._anHidden[n]=P,P.parentNode.removeChild(P));y.aoColumns[n].bVisible=x;I(y,y.aoHeader);y.nTFoot&&I(y,y.aoFooter);C=0;for(H=y.aoOpenRows.length;C<H;C++)y.aoOpenRows[C].nTr.colSpan=La(y);if("undefined"==typeof A||A)N(y),K(y);bb(y)}};this.fnPageChange=function(n,x){var A=na(this[k.iApiIndex]);Ga(A,n);ta(A);("undefined"==typeof x||x)&&K(A)};this.fnDestroy=function(){var n=na(this[k.iApiIndex]),x=n.nTableWrapper.parentNode,A=n.nTBody,y;n.bDestroying=!0;var C=0;for(y=n.aoColumns.length;C<y;C++)!1===n.aoColumns[C].bVisible&&this.fnSetColumnVis(C,!0);b(n.nTableWrapper).find("*").andSelf().off(".DT");b("tbody>tr>td."+n.oClasses.sRowEmpty,n.nTable).parent().remove();n.nTable!=n.nTHead.parentNode&&(b(">thead",n.nTable).remove(),n.nTable.appendChild(n.nTHead));n.nTFoot&&n.nTable!=n.nTFoot.parentNode&&(b(">tfoot",n.nTable).remove(),n.nTable.appendChild(n.nTFoot));n.nTable.parentNode.removeChild(n.nTable);b(n.nTableWrapper).remove();n.aaSorting=[];n.aaSortingFixed=[];ra(n);b(Qa(n)).removeClass(n.asStripClasses.join(" "));n.bJUI?(b("th",n.nTHead).removeClass([k.oStdClasses.sSortable,k.oJUIClasses.sSortableAsc,k.oJUIClasses.sSortableDesc,k.oJUIClasses.sSortableNone].join(" ")),b("th span."+k.oJUIClasses.sSortIcon,n.nTHead).remove(),b("th",n.nTHead).each(function(){var H=b("div."+k.oJUIClasses.sSortJUIWrapper,this),J=H.contents();b(this).append(J);H.remove()})):b("th",n.nTHead).removeClass([k.oStdClasses.sSortable,k.oStdClasses.sSortableAsc,k.oStdClasses.sSortableDesc,k.oStdClasses.sSortableNone].join(" "));n.nTableReinsertBefore?x.insertBefore(n.nTable,n.nTableReinsertBefore):x.appendChild(n.nTable);C=0;for(y=n.aoData.length;C<y;C++)null!==n.aoData[C].nTr&&A.appendChild(n.aoData[C].nTr);!0===n.oFeatures.bAutoWidth&&(n.nTable.style.width=da(n.sDestroyWidth));b(">tr:even",A).addClass(n.asDestoryStrips[0]);b(">tr:odd",A).addClass(n.asDestoryStrips[1]);C=0;for(y=h.length;C<y;C++)h[C]==n&&h.splice(C,1);n=null};this.fnAdjustColumnSizing=function(n){var x=na(this[k.iApiIndex]);N(x);"undefined"==typeof n||n?this.fnDraw(!1):(""!==x.oScroll.sX||""!==x.oScroll.sY)&&this.oApi._fnScrollDraw(x)};for(var db in k.oApi)db&&(this[db]=q(db));this.oApi._fnExternApiFunc=q;this.oApi._fnInitalise=m;this.oApi._fnInitComplete=t;this.oApi._fnLanguageProcess=v;this.oApi._fnAddColumn=w;this.oApi._fnColumnOptions=z;this.oApi._fnAddData=B;this.oApi._fnCreateTr=D;this.oApi._fnGatherData=E;this.oApi._fnBuildHead=G;this.oApi._fnDrawHead=I;this.oApi._fnDraw=K;this.oApi._fnReDraw=S;this.oApi._fnAjaxUpdate=U;this.oApi._fnAjaxUpdateDraw=T;this.oApi._fnAddOptionsHtml=V;this.oApi._fnFeatureHtmlTable=O;this.oApi._fnScrollDraw=Q;this.oApi._fnAjustColumnSizing=N;this.oApi._fnFeatureHtmlFilter=X;this.oApi._fnFilterComplete=Z;this.oApi._fnFilterCustom=ea;this.oApi._fnFilterColumn=ja;this.oApi._fnFilter=ha;this.oApi._fnBuildSearchArray=aa;this.oApi._fnBuildSearchRow=ia;this.oApi._fnFilterCreateSearch=la;this.oApi._fnDataToSearch=oa;this.oApi._fnSort=ka;this.oApi._fnSortAttachListener=qa;this.oApi._fnSortingClasses=ra;this.oApi._fnFeatureHtmlPaginate=Oa;this.oApi._fnPageChange=Ga;this.oApi._fnFeatureHtmlInfo=Na;this.oApi._fnUpdateInfo=Ia;this.oApi._fnFeatureHtmlLength=Ma;this.oApi._fnFeatureHtmlProcessing=Fa;this.oApi._fnProcessingDisplay=xa;this.oApi._fnVisibleToColumnIndex=Sa;this.oApi._fnColumnIndexToVisible=Ha;this.oApi._fnNodeToDataIndex=Ja;this.oApi._fnVisbleColumns=La;this.oApi._fnCalculateEnd=ta;this.oApi._fnConvertToWidth=mb;this.oApi._fnCalculateColumnWidths=Ua;this.oApi._fnScrollingWidthAdjust=ob;this.oApi._fnGetWidestNode=nb;this.oApi._fnGetMaxLenString=pb;this.oApi._fnStringToCss=da;this.oApi._fnArrayCmp=function(n,x){if(n.length!=x.length)return 1;for(var A=0;A<n.length;A++)if(n[A]!=x[A])return 2;return 0};this.oApi._fnDetectType=Va;this.oApi._fnSettingsFromNode=na;this.oApi._fnGetDataMaster=Ra;this.oApi._fnGetTrNodes=Qa;this.oApi._fnGetTdNodes=Da;this.oApi._fnEscapeRegex=Za;this.oApi._fnDeleteIndex=ab;this.oApi._fnReOrderIndex=kb;this.oApi._fnColumnOrdering=Wa;this.oApi._fnLog=ya;this.oApi._fnClearTable=Xa;this.oApi._fnSaveState=bb;this.oApi._fnLoadState=rb;this.oApi._fnCreateCookie=qb;this.oApi._fnReadCookie=cb;this.oApi._fnDetectHeader=Ka;this.oApi._fnGetUniqueThs=Ea;this.oApi._fnScrollBarWidth=sb;this.oApi._fnApplyToChildren=Ca;this.oApi._fnMap=Y;this.oApi._fnGetRowData=Ta;this.oApi._fnGetCellData=va;this.oApi._fnSetCellData=Ba;this.oApi._fnGetObjectDataFn=Pa;this.oApi._fnSetObjectDataFn=jb;var eb=this;return this.each(function(){var n=0,x,A;n=0;for(x=h.length;n<x;n++){if(h[n].nTable==this){if("undefined"==typeof l||"undefined"!=typeof l.bRetrieve&&!0===l.bRetrieve)return h[n].oInstance;if("undefined"!=typeof l.bDestroy&&!0===l.bDestroy){h[n].oInstance.fnDestroy();break}else{ya(h[n],0,"Cannot reinitialise DataTable.\n\nTo retrieve the DataTables object for this table, please pass either no arguments to the dataTable() function, or set bRetrieve to true. Alternatively, to destory the old table and create a new one, set bDestroy to true (note that a lot of changes to the configuration can be made through the API which is usually much faster).");return}}if(""!==h[n].sTableId&&h[n].sTableId==this.getAttribute("id")){h.splice(n,1);break}}var y=new p;h.push(y);var C=!1,H=!1;n=this.getAttribute("id");null!==n?(y.sTableId=n,y.sInstance=n):y.sInstance=k._oExternConfig.iNextUnique++;if("table"!=this.nodeName.toLowerCase())ya(y,0,"Attempted to initialise DataTables on a node which is not a table: "+this.nodeName);else{y.nTable=this;y.oInstance=1==eb.length?eb:b(this).dataTable();y.oApi=eb.oApi;y.sDestroyWidth=b(this).width();if("undefined"!=typeof l&&null!==l){y.oInit=l;Y(y.oFeatures,l,"bPaginate");Y(y.oFeatures,l,"bLengthChange");Y(y.oFeatures,l,"bFilter");Y(y.oFeatures,l,"bSort");Y(y.oFeatures,l,"bInfo");Y(y.oFeatures,l,"bProcessing");Y(y.oFeatures,l,"bAutoWidth");Y(y.oFeatures,l,"bSortClasses");Y(y.oFeatures,l,"bServerSide");Y(y.oFeatures,l,"bDeferRender");Y(y.oScroll,l,"sScrollX","sX");Y(y.oScroll,l,"sScrollXInner","sXInner");Y(y.oScroll,l,"sScrollY","sY");Y(y.oScroll,l,"bScrollCollapse","bCollapse");Y(y.oScroll,l,"bScrollInfinite","bInfinite");Y(y.oScroll,l,"iScrollLoadGap","iLoadGap");Y(y.oScroll,l,"bScrollAutoCss","bAutoCss");Y(y,l,"asStripClasses");Y(y,l,"fnPreDrawCallback");Y(y,l,"fnRowCallback");Y(y,l,"fnHeaderCallback");Y(y,l,"fnFooterCallback");Y(y,l,"fnCookieCallback");Y(y,l,"fnInitComplete");Y(y,l,"fnServerData");Y(y,l,"fnFormatNumber");Y(y,l,"aaSorting");Y(y,l,"aaSortingFixed");Y(y,l,"aLengthMenu");Y(y,l,"sPaginationType");Y(y,l,"sAjaxSource");Y(y,l,"sAjaxDataProp");Y(y,l,"iCookieDuration");Y(y,l,"sCookiePrefix");Y(y,l,"sDom");Y(y,l,"bSortCellsTop");Y(y,l,"oSearch","oPreviousSearch");Y(y,l,"aoSearchCols","aoPreSearchCols");Y(y,l,"iDisplayLength","_iDisplayLength");Y(y,l,"bJQueryUI","bJUI");Y(y.oLanguage,l,"fnInfoCallback");"function"==typeof l.fnDrawCallback&&y.aoDrawCallback.push({fn:l.fnDrawCallback,sName:"user"});"function"==typeof l.fnStateSaveCallback&&y.aoStateSave.push({fn:l.fnStateSaveCallback,sName:"user"});"function"==typeof l.fnStateLoadCallback&&y.aoStateLoad.push({fn:l.fnStateLoadCallback,sName:"user"});y.oFeatures.bServerSide&&y.oFeatures.bSort&&y.oFeatures.bSortClasses?y.aoDrawCallback.push({fn:ra,sName:"server_side_sort_classes"}):y.oFeatures.bDeferRender&&y.aoDrawCallback.push({fn:ra,sName:"defer_sort_classes"});"undefined"!=typeof l.bJQueryUI&&l.bJQueryUI&&(y.oClasses=k.oJUIClasses,"undefined"==typeof l.sDom&&(y.sDom='<"H"lfr>t<"F"ip>'));if(""!==y.oScroll.sX||""!==y.oScroll.sY)y.oScroll.iBarWidth=sb();"undefined"!=typeof l.iDisplayStart&&"undefined"==typeof y.iInitDisplayStart&&(y.iInitDisplayStart=l.iDisplayStart,y._iDisplayStart=l.iDisplayStart);"undefined"!=typeof l.bStateSave&&(y.oFeatures.bStateSave=l.bStateSave,rb(y,l),y.aoDrawCallback.push({fn:bb,sName:"state_save"}));"undefined"!=typeof l.iDeferLoading&&(y.bDeferLoading=!0,y._iRecordsTotal=l.iDeferLoading,y._iRecordsDisplay=l.iDeferLoading);"undefined"!=typeof l.aaData&&(H=!0);"undefined"!=typeof l&&"undefined"!=typeof l.aoData&&(l.aoColumns=l.aoData);"undefined"!=typeof l.oLanguage&&("undefined"!=typeof l.oLanguage.sUrl&&""!==l.oLanguage.sUrl?(y.oLanguage.sUrl=l.oLanguage.sUrl,b.getJSON(y.oLanguage.sUrl,null,function(ba){v(y,ba,!0)}),C=!0):v(y,l.oLanguage,!1))}else l={};"undefined"==typeof l.asStripClasses&&(y.asStripClasses.push(y.oClasses.sStripOdd),y.asStripClasses.push(y.oClasses.sStripEven));var J=!1;var P=b(">tbody>tr",this);n=0;for(x=y.asStripClasses.length;n<x;n++)if(P.filter(":lt(2)").hasClass(y.asStripClasses[n])){J=!0;break}J&&(y.asDestoryStrips=["",""],b(P[0]).hasClass(y.oClasses.sStripOdd)&&(y.asDestoryStrips[0]+=y.oClasses.sStripOdd+" "),b(P[0]).hasClass(y.oClasses.sStripEven)&&(y.asDestoryStrips[0]+=y.oClasses.sStripEven),b(P[1]).hasClass(y.oClasses.sStripOdd)&&(y.asDestoryStrips[1]+=y.oClasses.sStripOdd+" "),b(P[1]).hasClass(y.oClasses.sStripEven)&&(y.asDestoryStrips[1]+=y.oClasses.sStripEven),P.removeClass(y.asStripClasses.join(" ")));J=[];n=this.getElementsByTagName("thead");0!==n.length&&(Ka(y.aoHeader,n[0]),J=Ea(y));if("undefined"==typeof l.aoColumns){var M=[];n=0;for(x=J.length;n<x;n++)M.push(null)}else M=l.aoColumns;n=0;for(x=M.length;n<x;n++)"undefined"!=typeof l.saved_aoColumns&&l.saved_aoColumns.length==x&&(null===M[n]&&(M[n]={}),M[n].bVisible=l.saved_aoColumns[n].bVisible),w(y,J?J[n]:null);if("undefined"!=typeof l.aoColumnDefs)for(n=l.aoColumnDefs.length-1;0<=n;n--){var W=l.aoColumnDefs[n].aTargets;b.isArray(W)||ya(y,1,"aTargets must be an array of targets, not a "+typeof W);J=0;for(P=W.length;J<P;J++)if("number"==typeof W[J]&&0<=W[J]){for(;y.aoColumns.length<=W[J];)w(y);z(y,W[J],l.aoColumnDefs[n])}else if("number"==typeof W[J]&&0>W[J])z(y,y.aoColumns.length+W[J],l.aoColumnDefs[n]);else if("string"==typeof W[J])for(x=0,A=y.aoColumns.length;x<A;x++)("_all"==W[J]||b(y.aoColumns[x].nTh).hasClass(W[J]))&&z(y,x,l.aoColumnDefs[n])}if("undefined"!=typeof M)for(n=0,x=M.length;n<x;n++)z(y,n,M[n]);n=0;for(x=y.aaSorting.length;n<x;n++)for(y.aaSorting[n][0]>=y.aoColumns.length&&(y.aaSorting[n][0]=0),M=y.aoColumns[y.aaSorting[n][0]],"undefined"==typeof y.aaSorting[n][2]&&(y.aaSorting[n][2]=0),"undefined"==typeof l.aaSorting&&"undefined"==typeof y.saved_aaSorting&&(y.aaSorting[n][1]=M.asSorting[0]),J=0,P=M.asSorting.length;J<P;J++)if(y.aaSorting[n][1]==M.asSorting[J]){y.aaSorting[n][2]=J;break}ra(y);n=b(">thead",this);0===n.length&&(n=[f.createElement("thead")],this.appendChild(n[0]));y.nTHead=n[0];n=b(">tbody",this);0===n.length&&(n=[f.createElement("tbody")],this.appendChild(n[0]));y.nTBody=n[0];n=b(">tfoot",this);0<n.length&&(y.nTFoot=n[0],Ka(y.aoFooter,y.nTFoot));if(H)for(n=0;n<l.aaData.length;n++)B(y,l.aaData[n]);else E(y);y.aiDisplay=y.aiDisplayMaster.slice();y.bInitialised=!0;!1===C&&m(y)}})}})(jQuery,F,L);g.extend(g.fn.dataTableExt.oSort,{"numeric-asc":function(b,c){b=parseFloat(b);c=parseFloat(c);b=isNaN(b)||" "===b||""===b?1E100:b;c=isNaN(c)||" "===c||""===c?1E100:c;return b-c},"numeric-desc":function(b,c){b=parseFloat(b);c=parseFloat(c);b=isNaN(b)||" "===b||""===b?-1E100:b;return(isNaN(c)||" "===c||""===c?-1E100:c)-b},position:function(b,c,f){var h=!(!c.match(/:/)&&!f.match(/:/));c=c.split(/[:\-(]/).reverse();f=f.split(/[:\-(]/).reverse();if(c.length!==f.length){var k=c.length<f.length?c:f;k.unshift(k[0])}k=0;if(h&&(h=c.pop(),k=f.pop(),k=isNaN(h)&&isNaN(k)?this["string-"+b](h,k):isNaN(h)?"asc"===b?1:-1:isNaN(k)?"asc"===b?-1:1:this["numeric-"+b](parseInt(h,10),parseInt(k,10))))return k;for(h=c.length;h--&&!(k=this["numeric-"+b](parseInt(c[h],10),parseInt(f[h],10))););return k},"position-asc":function(b,c){return this.position("asc",b,c)},"position-desc":function(b,c){return this.position("desc",b,c)},"position_html-asc":function(b,c){return this.position("asc",b.replace(/<.*?>/g,""),c.replace(/<.*?>/g,""))},"position_html-desc":function(b,c){return this.position("desc",b.replace(/<.*?>/g,""),c.replace(/<.*?>/g,""))},"string-asc":function(b,c){b=" "===b||"-"===b||"n/a"===b.toLowerCase()?"zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz":b.toLowerCase();c=" "===c||"-"===c||"n/a"===c.toLowerCase()?"zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz":c.toLowerCase();return b<c?-1:b>c?1:0},"string-desc":function(b,c){b=" "===b||"-"===b||"n/a"===b.toLowerCase()?"":b.toLowerCase();c=" "===c||"-"===c||"n/a"===c.toLowerCase()?"":c.toLowerCase();return b<c?1:b>c?-1:0},"string_hidden-asc":function(b,c){return this["string-asc"]((b.match(/<.*?>(.+)<\/.*?>/)||["",b])[1],(c.match(/<.*?>(.+)<\/.*?>/)||["",c])[1])},"string_hidden-desc":function(b,c){return this["string-desc"]((b.match(/<.*?>(.+)<\/.*?>/)||["",b])[1],(c.match(/<.*?>(.+)<\/.*?>/)||["",c])[1])},"numeric_hidden-asc":function(b,c){return this["numeric-asc"]((b.match(/<.*?>(.+)<\/.*?>/)||b.match(/^(\d+)$/)||[])[1],(c.match(/<.*?>(.+)<\/.*?>/)||c.match(/^(\d+)$/)||[])[1])},"numeric_hidden-desc":function(b,c){return this["numeric-desc"]((b.match(/<.*?>(.+)<\/.*?>/)||b.match(/^(\d+)$/)||[])[1],(c.match(/<.*?>(.+)<\/.*?>/)||c.match(/^(\d+)$/)||[])[1])},"html-asc":function(b,c){return this["string-asc"](b.replace(/<.*?>/g,""),c.replace(/<.*?>/g,""))},"html-desc":function(b,c){return this["string-desc"](b.replace(/<.*?>/g,""),c.replace(/<.*?>/g,""))},"html_numeric-asc":function(b,c){return this["numeric-asc"](b.replace(/<.*?>/g,"").replace(/[^0-9]/g,""),c.replace(/<.*?>/g,"").replace(/[^0-9]/g,""))},"html_numeric-desc":function(b,c){return this["numeric-desc"](b.replace(/<.*?>/g,"").replace(/[^0-9]/g,""),c.replace(/<.*?>/g,"").replace(/[^0-9]/g,""))}});(function(b){b.fn.dynaLoad=function(c){c=c||{};return this.each(function(){var f=b(this),h=f.data("dynaLoad")||{};if(!h.loaded||c.url&&c.url!==h.url)c.url=c.url||h.url||f.find("a").first().attr("href"),c.fallBack=c.fallBack||h.fallBack||f.find("a").first().text()||"Request failed",c.responseFilter=c.responseFilter||h.responseFilter||function(k){return k},c.complete=c.complete||h.complete||b.noop,c.loaded=!0,f.empty().data("dynaLoad",c),c.url?b.ajax({cache:!0,context:f,url:c.url,dataType:"html",success:function(k){this.html(this.data("dynaLoad").responseFilter(k)||this.data("dynaLoad").fallBack)},error:function(){this.html(this.data("dynaLoad").fallBack).data("dynaLoad").loaded=!1},complete:function(){this.data("dynaLoad").complete.call(this)}}):f.html(c.fallBack)})}})(jQuery);var fb=!0;(function(b){function c(m){var t=m.options.dnd||null;t&&(t.onDragStart||t.onDrop)&&q();t&&t.onDragStart&&m.$tree.draggable({addClasses:!1,appendTo:"body",containment:!1,delay:0,distance:4,revert:!1,scroll:!0,scrollSpeed:7,scrollSensitivity:10,connectToDynatree:!0,helper:function(v){var w=b.ui.dynatree.getNode(v.target);return w?w.tree._onDragEvent("helper",w,null,v,null,null):"<div></div>"},start:function(v,w){return!!w.helper.data("dtSourceNode")},_last:null});t&&t.onDrop&&m.$tree.droppable({addClasses:!1,tolerance:"intersect",greedy:!1,_last:null})}var f={create:function(){return function(){this.initialize.apply(this,arguments)}}},h=f.create();h.prototype={initialize:function(m,t,v){this.parent=m;this.tree=t;"string"===typeof v&&(v={title:v});v.key===R&&(v.key="_"+t._nodeCount++);this.data=b.extend({},b.ui.dynatree.nodedatadefaults,v);this.childList=this.ul=this.span=this.li=null;this.bSelected=this.bExpanded=this.hasSubSel=this._isLoading=!1},toString:function(){return"DynaTreeNode<"+this.data.key+
">: '"+this.data.synonym||this.data.synonym+"'"},toDict:function(m,t){var v=b.extend({},this.data);v.activate=this.tree.activeNode===this;v.focus=this.tree.focusNode===this;v.expand=this.bExpanded;v.select=this.bSelected;t&&t(v);if(m&&this.childList){v.children=[];m=0;for(var w=this.childList.length;m<w;m++)v.children.push(this.childList[m].toDict(!0,t))}else delete v.children;return v},fromDict:function(m){var t=m.children;t===R?(this.data=b.extend(this.data,m),this.render()):(m=b.extend({},m),m.children=R,this.data=b.extend(this.data,m),this.removeChildren(),this.addChild(t))},_getInnerHtml:function(){var m=this.tree,t=m.options,v=m.cache,w=this.getLevel(),z=this.data,B="";w<t.minExpandLevel?1<w&&(B+=v.tagConnector):B=!1!==this.hasChildren()?B+v.tagExpander:B+v.tagConnector;t.checkbox&&1!==z.hideCheckbox&&!z.isStatusNode&&(B+=v.tagCheckbox);z.icon?(v="/"===z.icon.charAt(0)?z.icon:t.imagePath+z.icon,B+="<img src='"+v+"' alt='' />"):!1!==z.icon&&(B+=v.tagNodeIcon);v="";t.onCustomRender&&(v=t.onCustomRender.call(m,this)||"");v||(m=z.tooltip?' title="'+z.tooltip.replace(/"/g,"&quot;")+'"':"",v=z.href||"#",v=t.noLink||z.noLink?'<span style="display:inline-block;" class="'+t.classNames.title+' "'+m+">"+z.title+"</span>":'<a href="'+v+'" class="'+t.classNames.title+' "'+m+">"+z.title+"</a>");return B+v},_fixOrder:function(){var m=this.childList;if(m&&this.ul)for(var t=this.ul.firstChild,v=0,w=m.length-1;v<w;v++){var z=m[v],B=t.dtnode;z!==B?(this.tree.logDebug("_fixOrder: mismatch at index "+v+": "+z+" != "+B),this.ul.insertBefore(z.li,B.li)):t=t.nextSibling}},render:function(m,t){var v=this.tree,w=this.parent,z=this.data,B=v.options,D=B.classNames,E=this.isLastSibling(),G=!1;if(!w&&!this.ul)this.li=this.span=null,this.ul=L.createElement("ul"),this.ul.className=1<B.minExpandLevel?D.container+" "+D.noConnector:D.container;else if(w){this.li||(G=!0,this.li=L.createElement("li"),this.li.dtnode=this,z.key&&B.generateIds&&(this.li.id=B.idPrefix+z.key),this.span=L.createElement("span"),this.span.className=D.title,this.li.appendChild(this.span),w.ul||(w.ul=L.createElement("ul"),w.ul.style.display="none",w.li.appendChild(w.ul)),w.ul.appendChild(this.li));this.span.innerHTML=this._getInnerHtml();var I=[];I.push(D.node);z.isFolder&&I.push(D.folder);this.bExpanded&&I.push(D.expanded);!1!==this.hasChildren()&&I.push(D.hasChildren);z.isLazy&&null===this.childList&&I.push(D.lazy);E&&I.push(D.lastsib);this.bSelected&&I.push(D.selected);this.hasSubSel&&I.push(D.partsel);v.activeNode===this&&I.push(D.active);z.addClass&&I.push(z.addClass);I.push(D.combinedExpanderPrefix+(this.bExpanded?"e":"c")+(z.isLazy&&null===this.childList?"d":"")+(E?"l":""));I.push(D.combinedIconPrefix+(this.bExpanded?"e":"c")+(z.isFolder?"f":""));this.span.className=I.join(" ");this.li.className=E?D.lastsib:"";G&&B.onCreate&&B.onCreate.call(v,this,this.span);B.onRender&&B.onRender.call(v,this,this.span)}if((this.bExpanded||!0===t)&&this.childList){v=0;for(z=this.childList.length;v<z;v++)this.childList[v].render(!1,t);this._fixOrder()}this.ul&&(t="none"===this.ul.style.display,v=!!this.bExpanded,m&&B.fx&&t===v?(m=B.fx.duration||200,b(this.ul).animate(B.fx,m)):this.ul.style.display=this.bExpanded||!w?"":"none")},getKeyPath:function(m,t){var v=[];t=t||"title";this.visitParents(function(w){w.parent&&v.unshift(w.data[t])},!m);return"/"+v.join(this.tree.options.keyPathSeparator)},getParent:function(){return this.parent},getChildren:function(){return this.hasChildren()===R?R:this.childList},hasChildren:function(){return this.data.isLazy?null===this.childList||this.childList===R?R:0===this.childList.length?!1:1===this.childList.length&&this.childList[0].isStatusNode()?R:!0:!!this.childList},isFirstSibling:function(){var m=this.parent;return!m||m.childList[0]===this},isLastSibling:function(){var m=this.parent;return!m||m.childList[m.childList.length-1]===this},isLoading:function(){return!!this._isLoading},getPrevSibling:function(){if(!this.parent)return null;for(var m=this.parent.childList,t=1,v=m.length;t<v;t++)if(m[t]===this)return m[t-
1];return null},getNextSibling:function(){if(!this.parent)return null;for(var m=this.parent.childList,t=0,v=m.length-1;t<v;t++)if(m[t]===this)return m[t+1];return null},isStatusNode:function(){return!0===this.data.isStatusNode},isChildOf:function(m){return this.parent&&this.parent===m},isDescendantOf:function(m){if(!m)return!1;for(var t=this.parent;t;){if(t===m)return!0;t=t.parent}return!1},countChildren:function(){var m=this.childList;if(!m)return 0;for(var t=m.length,v=0,w=t;v<w;v++)t+=m[v].countChildren();return t},sortChildren:function(m,t){var v=this.childList;if(v){m=m||function(B,D){B=B.data.title.toLowerCase();D=D.data.title.toLowerCase();return B===D?0:B>D?1:-1};v.sort(m);if(t)for(var w=0,z=v.length;w<z;w++)v[w].childList&&v[w].sortChildren(m,"$norender$");"$norender$"!==t&&this.render()}},_setStatusNode:function(m){var t=this.childList?this.childList[0]:null;if(m)t?(m.isStatusNode=!0,m.key="_statusNode",t.data=m,t.render()):(m.isStatusNode=!0,m.key="_statusNode",this.addChild(m));else if(t&&t.isStatusNode()){try{this.ul&&(this.ul.removeChild(t.li),t.li=null)}catch(v){}1===this.childList.length?this.childList=[]:this.childList.shift()}},setLazyNodeStatus:function(m,t){var v=t&&t.tooltip?t.tooltip:null;t=t&&t.info?" ("+t.info+")":"";switch(m){case 0:this._setStatusNode(null);b(this.span).removeClass(this.tree.options.classNames.nodeLoading);this._isLoading=!1;this.tree.options.autoFocus&&(this===this.tree.tnRoot&&this.childList&&0<this.childList.length?this.childList[0].focus():this.focus());break;case 1:this._isLoading=!0;b(this.span).addClass(this.tree.options.classNames.nodeLoading);this.parent||this._setStatusNode({title:this.tree.options.strings.loading+t,tooltip:v,addClass:this.tree.options.classNames.nodeWait});break;case-1:this._isLoading=!1;this._setStatusNode({title:this.tree.options.strings.loadError+t,tooltip:v,addClass:this.tree.options.classNames.nodeError});break;default:throw"Bad LazyNodeStatus: '"+m+"'.";}},_parentList:function(m,t){var v=[];for(t=t?this:this.parent;t;)(m||t.parent)&&v.unshift(t),t=t.parent;return v},getLevel:function(){for(var m=0,t=this.parent;t;)m++,t=t.parent;return m},_getTypeForOuterNodeEvent:function(m){var t=this.tree.options.classNames,v=m.target;if(0>v.className.indexOf(t.node))return null;var w=m.pageX-v.offsetLeft;m=m.pageY-v.offsetTop;for(var z=0,B=v.childNodes.length;z<B;z++){var D=v.childNodes[z],E=D.offsetLeft-v.offsetLeft,G=D.offsetTop-v.offsetTop,I=D.clientWidth,K=D.clientHeight;if(w>=E&&w<=E+I&&m>=G&&m<=G+K){if(D.className==t.title)return"title";if(D.className==t.expander)return"expander";if(D.className==t.checkbox)return"checkbox";if(D.className==t.nodeIcon)return"icon"}}return"prefix"},getEventTargetType:function(m){var t=m&&m.target?m.target.className:"",v=this.tree.options.classNames;return t===v.title?"title":t===v.expander?"expander":t===v.checkbox?"checkbox":t===v.nodeIcon?"icon":t===v.empty||t===v.vline||t===v.connector?"prefix":0<=t.indexOf(v.node)?this._getTypeForOuterNodeEvent(m):null},isVisible:function(){for(var m=this._parentList(!0,!1),t=0,v=m.length;t<v;t++)if(!m[t].bExpanded)return!1;return!0},makeVisible:function(){for(var m=this._parentList(!0,!1),t=0,v=m.length;t<v;t++)m[t]._expand(!0)},focus:function(){this.makeVisible();try{b(this.span).find(">a").focus()}catch(m){}},isFocused:function(){return this.tree.tnFocused===this},_activate:function(m,t){this.tree.logDebug("dtnode._activate(%o, fireEvents=%o) - %o",m,t,this);var v=this.tree.options;if(!(this.data.isStatusNode||t&&v.onQueryActivate&&!1===v.onQueryActivate.call(this.tree,m,this)))if(m){if(this.tree.activeNode){if(this.tree.activeNode===this)return;this.tree.activeNode.deactivate()}v.activeVisible&&this.makeVisible();this.tree.activeNode=this;v.persist&&b.cookie(v.cookieId+"-active",this.data.key,v.cookie);this.tree.persistence.activeKey=this.data.key;b(this.span).addClass(v.classNames.active);t&&v.onActivate&&v.onActivate.call(this.tree,this)}else this.tree.activeNode!==this||v.onQueryActivate&&!1===v.onQueryActivate.call(this.tree,!1,this)||(b(this.span).removeClass(v.classNames.active),v.persist&&b.cookie(v.cookieId+"-active","",v.cookie),this.tree.persistence.activeKey=null,this.tree.activeNode=null,t&&v.onDeactivate&&v.onDeactivate.call(this.tree,this))},activate:function(){this._activate(!0,!0)},activateSilently:function(){this._activate(!0,!1)},deactivate:function(){this._activate(!1,!0)},isActive:function(){return this.tree.activeNode===this},_userActivate:function(){var m=!0,t=!1;if(this.data.isFolder)switch(this.tree.options.clickFolderMode){case 2:m=!1;t=!0;break;case 3:m=t=!0}null===this.parent&&(t=!1);t&&(this.toggleExpand(),this.focus());m&&this.activate()},_setSubSel:function(m){m?(this.hasSubSel=!0,b(this.span).addClass(this.tree.options.classNames.partsel)):(this.hasSubSel=!1,b(this.span).removeClass(this.tree.options.classNames.partsel))},_updatePartSelectionState:function(){if(!this.hasChildren()){var m=this.bSelected&&!this.data.unselectable&&!this.data.isStatusNode;this._setSubSel(!1);return m}var t,v=this.childList,w=!0,z=!0;m=0;for(t=v.length;m<t;m++){var B=v[m]._updatePartSelectionState();!1!==B&&(z=!1);!0!==B&&(w=!1)}m=w?!0:z?!1:R;this._setSubSel(m===R);this.bSelected=!0===m;return m},_fixSelectionState:function(){var m,t;if(this.bSelected)for(this.visit(function(B){B.parent._setSubSel(!0);B.data.unselectable||B._select(!0,!1,!1)}),m=this.parent;m;){m._setSubSel(!0);var v=!0;var w=0;for(t=m.childList.length;w<t;w++){var z=m.childList[w];if(!z.bSelected&&!z.data.isStatusNode&&!z.data.unselectable){v=!1;break}}v&&m._select(!0,!1,!1);m=m.parent}else for(this._setSubSel(!1),this.visit(function(B){B._setSubSel(!1);B._select(!1,!1,!1)}),m=this.parent;m;){m._select(!1,!1,!1);v=!1;w=0;for(t=m.childList.length;w<t;w++)if(m.childList[w].bSelected||m.childList[w].hasSubSel){v=!0;break}m._setSubSel(v);m=m.parent}},_select:function(m,t,v){var w=this.tree.options;this.data.isStatusNode||this.bSelected===m||t&&w.onQuerySelect&&!1===w.onQuerySelect.call(this.tree,m,this)||(1==w.selectMode&&m&&this.tree.visit(function(z){if(z.bSelected)return z._select(!1,!1,!1),!1}),(this.bSelected=m)?(w.persist&&this.tree.persistence.addSelect(this.data.key),b(this.span).addClass(w.classNames.selected),v&&3===w.selectMode&&this._fixSelectionState(),t&&w.onSelect&&w.onSelect.call(this.tree,!0,this)):(w.persist&&this.tree.persistence.clearSelect(this.data.key),b(this.span).removeClass(w.classNames.selected),v&&3===w.selectMode&&this._fixSelectionState(),t&&w.onSelect&&w.onSelect.call(this.tree,!1,this)))},select:function(m){return this.data.unselectable?this.bSelected:this._select(!1!==m,!0,!0)},toggleSelect:function(){return this.select(!this.bSelected)},isSelected:function(){return this.bSelected},isLazy:function(){return!!this.data.isLazy},_loadContent:function(){try{var m=this.tree.options;this.tree.logDebug("_loadContent: start - %o",this);this.setLazyNodeStatus(1);!0===m.onLazyRead.call(this.tree,this)&&(this.setLazyNodeStatus(0),this.tree.logDebug("_loadContent: succeeded - %o",this))}catch(t){this.tree.logWarning("_loadContent: failed - %o",t),this.setLazyNodeStatus(-1,{tooltip:""+
t})}},_expand:function(m,t){if(this.bExpanded===m)this.tree.logDebug("dtnode._expand(%o) IGNORED - %o",m,this);else{this.tree.logDebug("dtnode._expand(%o) - %o",m,this);var v=this.tree.options;if(!m&&this.getLevel()<v.minExpandLevel)this.tree.logDebug("dtnode._expand(%o) prevented collapse - %o",m,this);else if(!v.onQueryExpand||!1!==v.onQueryExpand.call(this.tree,m,this)){this.bExpanded=m;v.persist&&(m?this.tree.persistence.addExpand(this.data.key):this.tree.persistence.clearExpand(this.data.key));this.render(!(this.data.isLazy&&null===this.childList)&&!this._isLoading&&!t);if(this.bExpanded&&this.parent&&v.autoCollapse){t=this._parentList(!1,!0);for(var w=0,z=t.length;w<z;w++)t[w].collapseSiblings()}v.activeVisible&&this.tree.activeNode&&!this.tree.activeNode.isVisible()&&this.tree.activeNode.deactivate();m&&this.data.isLazy&&null===this.childList&&!this._isLoading?this._loadContent():v.onExpand&&v.onExpand.call(this.tree,m,this)}}},isExpanded:function(){return this.bExpanded},expand:function(m){m=!1!==m;!this.childList&&!this.data.isLazy&&m||null===this.parent&&!m||this._expand(m)},scheduleAction:function(m,t){this.tree.timer&&(clearTimeout(this.tree.timer),this.tree.logDebug("clearTimeout(%o)",this.tree.timer));var v=this;switch(m){case"cancel":break;case"expand":this.tree.timer=setTimeout(function(){v.tree.logDebug("setTimeout: trigger expand");v.expand(!0)},t);break;case"activate":this.tree.timer=setTimeout(function(){v.tree.logDebug("setTimeout: trigger activate");v.activate()},t);break;default:throw"Invalid mode "+m;}this.tree.logDebug("setTimeout(%s, %s): %s",m,t,this.tree.timer)},toggleExpand:function(){this.expand(!this.bExpanded)},collapseSiblings:function(){if(null!==this.parent)for(var m=this.parent.childList,t=0,v=m.length;t<v;t++)m[t]!==this&&m[t].bExpanded&&m[t]._expand(!1)},_onClick:function(m){var t=this.getEventTargetType(m);if("expander"===t)this.toggleExpand(),this.focus();else if("checkbox"===t)this.toggleSelect(),this.focus();else if(this._userActivate(),t=this.span.getElementsByTagName("a"),t[0])!b.browser||b.browser.msie&&9>parseInt(b.browser.version,10)||t[0].focus();else return!0;m.preventDefault()},_onDblClick:function(m){},_onKeydown:function(m){var t=!0,v;switch(m.which){case 107:case 187:this.bExpanded||this.toggleExpand();break;case 109:case 189:this.bExpanded&&this.toggleExpand();break;case 32:this._userActivate();break;case 8:this.parent&&this.parent.focus();break;case 37:this.bExpanded?(this.toggleExpand(),this.focus()):this.parent&&this.parent.parent&&this.parent.focus();break;case 39:this.bExpanded||!this.childList&&!this.data.isLazy?this.childList&&this.childList[0].focus():(this.toggleExpand(),this.focus());break;case 38:for(v=this.getPrevSibling();v&&v.bExpanded&&v.childList;)v=v.childList[v.childList.length-1];!v&&this.parent&&this.parent.parent&&(v=this.parent);v&&v.focus();break;case 40:if(this.bExpanded&&this.childList)v=this.childList[0];else for(var w=this._parentList(!1,!0),z=w.length-1;0<=z&&!(v=w[z].getNextSibling());z--);v&&v.focus();break;default:t=!1}t&&m.preventDefault()},_onKeypress:function(m){},_onFocus:function(m){var t=this.tree.options;if("blur"==m.type||"focusout"==m.type)t.onBlur&&t.onBlur.call(this.tree,this),this.tree.tnFocused&&b(this.tree.tnFocused.span).removeClass(t.classNames.focused),this.tree.tnFocused=null,t.persist&&b.cookie(t.cookieId+"-focus","",t.cookie);else if("focus"==m.type||"focusin"==m.type)this.tree.tnFocused&&this.tree.tnFocused!==this&&(this.tree.logDebug("dtnode.onFocus: out of sync: curFocus: %o",this.tree.tnFocused),b(this.tree.tnFocused.span).removeClass(t.classNames.focused)),this.tree.tnFocused=this,t.onFocus&&t.onFocus.call(this.tree,this),b(this.tree.tnFocused.span).addClass(t.classNames.focused),t.persist&&b.cookie(t.cookieId+"-focus",this.data.key,t.cookie)},visit:function(m,t){var v=!0;if(!0===t&&(v=m(this),!1===v||"skip"==v))return v;if(this.childList){t=0;for(var w=this.childList.length;t<w&&(v=this.childList[t].visit(m,!0),!1!==v);t++);}return v},visitParents:function(m,t){if(t&&!1===m(this))return!1;for(t=this.parent;t;){if(!1===m(t))return!1;t=t.parent}return!0},remove:function(){if(this===this.tree.root)throw"Cannot remove system root";return this.parent.removeChild(this)},removeChild:function(m){var t=this.childList;if(1==t.length){if(m!==t[0])throw"removeChild: invalid child";return this.removeChildren()}m===this.tree.activeNode&&m.deactivate();this.tree.options.persist&&(m.bSelected&&this.tree.persistence.clearSelect(m.data.key),m.bExpanded&&this.tree.persistence.clearExpand(m.data.key));m.removeChildren(!0);this.ul.removeChild(m.li);for(var v=0,w=t.length;v<w;v++)if(t[v]===m){this.childList.splice(v,1);break}},removeChildren:function(m,t){this.tree.logDebug("%s.removeChildren(%o)",this,m);var v=this.tree,w=this.childList;if(w){for(var z=0,B=w.length;z<B;z++){var D=w[z];D!==v.activeNode||t||D.deactivate();this.tree.options.persist&&!t&&(D.bSelected&&this.tree.persistence.clearSelect(D.data.key),D.bExpanded&&this.tree.persistence.clearExpand(D.data.key));D.removeChildren(!0,t);this.ul&&b("li",b(this.ul)).remove()}this.childList=null}m||(this._isLoading=!1,this.render())},setTitle:function(m){this.fromDict({title:m})},reload:function(m){throw"Use reloadChildren() instead";},reloadChildren:function(m){if(null===this.parent)throw"Use tree.reload() instead";if(!this.data.isLazy)throw"node.reloadChildren() requires lazy nodes.";if(m){var t=this,v="nodeLoaded.dynatree."+this.tree.$tree.attr("id")+"."+this.data.key;this.tree.$tree.bind(v,function(w,z,B){t.tree.$tree.unbind(v);t.tree.logDebug("loaded %o, %o, %o",w,z,B);if(z!==t)throw"got invalid load event";m.call(t.tree,z,B)})}this.removeChildren();this._loadContent()},_loadKeyPath:function(m,t){var v=this.tree;v.logDebug("%s._loadKeyPath(%s)",this,m);if(""===m)throw"Key path must not be empty";var w=m.split(v.options.keyPathSeparator);if(""===w[0])throw"Key path must be relative (don't start with '/')";var z=w.shift();if(this.childList)for(var B=0,D=this.childList.length;B<D;B++){var E=this.childList[B];if(E.data.key===z){if(0===w.length)t.call(v,E,"ok");else if(!E.data.isLazy||null!==E.childList&&E.childList!==R)t.call(v,E,"loaded"),E._loadKeyPath(w.join(v.options.keyPathSeparator),t);else{v.logDebug("%s._loadKeyPath(%s) -> reloading %s...",this,m,E);var G=this;E.reloadChildren(function(I,K){K?(v.logDebug("%s._loadKeyPath(%s) -> reloaded %s.",I,m,I),t.call(v,E,"loaded"),I._loadKeyPath(w.join(v.options.keyPathSeparator),t)):(v.logWarning("%s._loadKeyPath(%s) -> reloadChildren() failed.",G,m),t.call(v,E,"error"))})}return}}t.call(v,R,"notfound",z,0===w.length);v.logWarning("Node not found: "+z)},resetLazy:function(){if(null===this.parent)throw"Use tree.reload() instead";if(!this.data.isLazy)throw"node.resetLazy() requires lazy nodes.";this.expand(!1);this.removeChildren()},_addChildNode:function(m,t){var v=this.tree,w=v.options,z=v.persistence;m.parent=this;null===this.childList?this.childList=[]:t||0<this.childList.length&&b(this.childList[this.childList.length-1].span).removeClass(w.classNames.lastsib);if(t){t=b.inArray(t,this.childList);if(0>t)throw"<beforeNode> must be a child of <this>";this.childList.splice(t,0,m)}else this.childList.push(m);t=v.isInitializing();w.persist&&z.cookiesFound&&t?(z.activeKey===m.data.key&&(v.activeNode=m),z.focusedKey===m.data.key&&(v.focusNode=m),m.bExpanded=0<=b.inArray(m.data.key,z.expandedKeyList),m.bSelected=0<=b.inArray(m.data.key,z.selectedKeyList)):(m.data.activate&&(v.activeNode=m,w.persist&&(z.activeKey=m.data.key)),m.data.focus&&(v.focusNode=m,w.persist&&(z.focusedKey=m.data.key)),m.bExpanded=!0===m.data.expand,m.bExpanded&&w.persist&&z.addExpand(m.data.key),m.bSelected=!0===m.data.select,m.bSelected&&w.persist&&z.addSelect(m.data.key));w.minExpandLevel>=m.getLevel()&&(this.bExpanded=!0);if(m.bSelected&&3==w.selectMode)for(w=this;w;)w.hasSubSel||w._setSubSel(!0),w=w.parent;v.bEnableUpdate&&this.render();return m},addChild:function(m,t){if("string"==typeof m)throw"Invalid data type for "+m;if(m&&0!==m.length){if(m instanceof h)return this._addChildNode(m,t);m.length||(m=[m]);for(var v=this.tree.enableUpdate(!1),w=null,z=0,B=m.length;z<B;z++){var D=m[z],E=this._addChildNode(new h(this,this.tree,D),t);w||(w=E);D.children&&E.addChild(D.children,null)}this.tree.enableUpdate(v);return w}},append:function(m){this.tree.logWarning("node.append() is deprecated (use node.addChild() instead).");return this.addChild(m,null)},appendAjax:function(m){var t=this;this.removeChildren(!1,!0);this.setLazyNodeStatus(1);if(m.debugLazyDelay){var v=m.debugLazyDelay;m.debugLazyDelay=0;this.tree.logInfo("appendAjax: waiting for debugLazyDelay "+
v);setTimeout(function(){t.appendAjax(m)},v)}else{var w=m.success,z=m.error,B="nodeLoaded.dynatree."+this.tree.$tree.attr("id")+"."+this.data.key,D=b.extend({},this.tree.options.ajaxDefaults,m,{success:function(E,G,I){I=t.tree.phase;t.tree.phase="init";D.postProcess?E=D.postProcess.call(this,E,this.dataType):E&&E.hasOwnProperty("d")&&(E="string"==typeof E.d?b.parseJSON(E.d):E.d);b.isArray(E)&&0===E.length||t.addChild(E,null);t.tree.phase="postInit";w&&w.call(D,t,E,G);t.tree.logDebug("trigger "+B);t.tree.$tree.trigger(B,[t,!0]);t.tree.phase=I;t.setLazyNodeStatus(0);b.isArray(E)&&0===E.length&&(t.childList=[],t.render())},error:function(E,G,I){t.tree.logWarning("appendAjax failed:",G,":\n",E,"\n",I);z&&z.call(D,t,E,G,I);t.tree.$tree.trigger(B,[t,!1]);t.setLazyNodeStatus(-1,{info:G,tooltip:""+I})}});b.ajax(D)}},move:function(m,t){if(this!==m){if(!this.parent)throw"Cannot move system root";if(t===R||"over"==t)t="child";var v=this.parent,w="child"===t?m:m.parent;if(w.isDescendantOf(this))throw"Cannot move a node to it's own descendant";if(1==this.parent.childList.length)this.parent.childList=this.parent.data.isLazy?[]:null,this.parent.bExpanded=!1;else{var z=b.inArray(this,this.parent.childList);if(0>z)throw"Internal error";this.parent.childList.splice(z,1)}this.parent.ul&&this.parent.ul.removeChild(this.li);this.parent=w;if(w.hasChildren())switch(t){case"child":w.childList.push(this);break;case"before":z=b.inArray(m,w.childList);if(0>z)throw"Internal error";w.childList.splice(z,0,this);break;case"after":z=b.inArray(m,w.childList);if(0>z)throw"Internal error";w.childList.splice(z+1,0,this);break;default:throw"Invalid mode "+t;}else w.childList=[this];w.ul||(w.ul=L.createElement("ul"),w.ul.style.display="none",w.li.appendChild(w.ul));this.li&&w.ul.appendChild(this.li);if(this.tree!==m.tree)throw this.visit(function(B){B.tree=m.tree},null,!0),"Not yet implemented.";v.isDescendantOf(w)||v.render();w.isDescendantOf(v)||w.render()}},lastentry:R};var k=f.create();k._getTreePersistData=function(m,t){m=new k(m,t);m.read();return m.toDict()};k.prototype={initialize:function(m,t){m===R&&(m=b.ui.dynatree.prototype.options.cookieId);t=b.extend({},b.ui.dynatree.prototype.options.cookie,t);this.cookieId=m;this.cookieOpts=t;this.cookiesFound=R;this.selectedKeyList=this.expandedKeyList=this.focusedKey=this.activeKey=null},_log:function(m){Array.prototype.unshift.apply(arguments,["debug"]);ma.apply(this,arguments)},read:function(){this.cookiesFound=!1;var m=b.cookie(this.cookieId+"-active");this.activeKey=null===m?"":m;null!==m&&(this.cookiesFound=!0);m=b.cookie(this.cookieId+"-focus");this.focusedKey=null===m?"":m;null!==m&&(this.cookiesFound=!0);m=b.cookie(this.cookieId+"-expand");this.expandedKeyList=null===m?[]:m.split(",");null!==m&&(this.cookiesFound=!0);m=b.cookie(this.cookieId+"-select");this.selectedKeyList=null===m?[]:m.split(",");null!==m&&(this.cookiesFound=!0)},write:function(){b.cookie(this.cookieId+"-active",null===this.activeKey?"":this.activeKey,this.cookieOpts);b.cookie(this.cookieId+"-focus",null===this.focusedKey?"":this.focusedKey,this.cookieOpts);b.cookie(this.cookieId+"-expand",null===this.expandedKeyList?"":this.expandedKeyList.join(","),this.cookieOpts);b.cookie(this.cookieId+"-select",null===this.selectedKeyList?"":this.selectedKeyList.join(","),this.cookieOpts)},addExpand:function(m){0>b.inArray(m,this.expandedKeyList)&&(this.expandedKeyList.push(m),b.cookie(this.cookieId+"-expand",this.expandedKeyList.join(","),this.cookieOpts))},clearExpand:function(m){m=b.inArray(m,this.expandedKeyList);0<=m&&(this.expandedKeyList.splice(m,1),b.cookie(this.cookieId+"-expand",this.expandedKeyList.join(","),this.cookieOpts))},addSelect:function(m){0>b.inArray(m,this.selectedKeyList)&&(this.selectedKeyList.push(m),b.cookie(this.cookieId+"-select",this.selectedKeyList.join(","),this.cookieOpts))},clearSelect:function(m){m=b.inArray(m,this.selectedKeyList);0<=m&&(this.selectedKeyList.splice(m,1),b.cookie(this.cookieId+"-select",this.selectedKeyList.join(","),this.cookieOpts))},isReloading:function(){return!0===this.cookiesFound},toDict:function(){return{cookiesFound:this.cookiesFound,activeKey:this.activeKey,focusedKey:this.activeKey,expandedKeyList:this.expandedKeyList,selectedKeyList:this.selectedKeyList}},lastentry:R};var l=f.create();l.version="$Version: 1.2.2$";l.prototype={initialize:function(m){this.phase="init";this.$widget=m;this.options=m.options;this.$tree=m.element;this.timer=null;this.divTree=this.$tree.get(0);c(this)},_load:function(m){var t=this.options,v=this;this.bEnableUpdate=!0;this._nodeCount=1;this.focusNode=this.activeNode=null;t.rootVisible!==R&&this.logWarning("Option 'rootVisible' is no longer supported.");1>t.minExpandLevel&&(this.logWarning("Option 'minExpandLevel' must be >= 1."),t.minExpandLevel=1);t.classNames!==b.ui.dynatree.prototype.options.classNames&&(t.classNames=b.extend({},b.ui.dynatree.prototype.options.classNames,t.classNames));t.ajaxDefaults!==b.ui.dynatree.prototype.options.ajaxDefaults&&(t.ajaxDefaults=b.extend({},b.ui.dynatree.prototype.options.ajaxDefaults,t.ajaxDefaults));t.dnd!==b.ui.dynatree.prototype.options.dnd&&(t.dnd=b.extend({},b.ui.dynatree.prototype.options.dnd,t.dnd));t.imagePath||b("script").each(function(){if(0<=this.src.search(/.*dynatree[^\/]*\.js$/i))return 0<=this.src.indexOf("/")?t.imagePath=this.src.slice(0,this.src.lastIndexOf("/"))+"/skin/":t.imagePath="skin/",v.logDebug("Guessing imagePath from '%s': '%s'",this.src,t.imagePath),!1});this.persistence=new k(t.cookieId,t.cookie);t.persist&&(b.cookie||ma("warn","Please include jquery.cookie.js to use persistence."),this.persistence.read());this.logDebug("DynaTree.persistence: %o",this.persistence.toDict());this.cache={tagEmpty:"<span class='"+t.classNames.empty+"'></span>",tagVline:"<span class='"+t.classNames.vline+"'></span>",tagExpander:"<span class='"+t.classNames.expander+"'></span>",tagConnector:"<span class='"+t.classNames.connector+"'></span>",tagNodeIcon:"<span class='"+t.classNames.nodeIcon+"'></span>",tagCheckbox:"<span class='"+t.classNames.checkbox+"'></span>",lastentry:R};(t.children||t.initAjax&&t.initAjax.url||t.initId)&&b(this.divTree).empty();var w=this.$tree.find(">ul:first").hide();this.tnRoot=new h(null,this,{});this.tnRoot.bExpanded=!0;this.tnRoot.render();this.divTree.appendChild(this.tnRoot.ul);var z=this.tnRoot,B=t.persist&&this.persistence.isReloading(),D=!1,E=this.enableUpdate(!1);this.logDebug("Dynatree._load(): read tree structure...");t.children?z.addChild(t.children):t.initAjax&&t.initAjax.url?(D=!0,z.data.isLazy=!0,this._reloadAjax(m)):t.initId?this._createFromTag(z,b("#"+t.initId)):(this._createFromTag(z,w),w.remove());this._checkConsistency();D||3!=t.selectMode||z._updatePartSelectionState();this.logDebug("Dynatree._load(): render nodes...");this.enableUpdate(E);this.logDebug("Dynatree._load(): bind events...");this.$widget.bind();this.logDebug("Dynatree._load(): postInit...");this.phase="postInit";t.persist&&this.persistence.write();this.focusNode&&this.focusNode.isVisible()&&(this.logDebug("Focus on init: %o",this.focusNode),this.focusNode.focus());D||(t.onPostInit&&t.onPostInit.call(this,B,!1),m&&m.call(this,"ok"));this.phase="idle"},_reloadAjax:function(m){var t=this.options;if(!t.initAjax||!t.initAjax.url)throw"tree.reload() requires 'initAjax' mode.";var v=this.persistence,w=b.extend({},t.initAjax);w.addActiveKey&&(w.data.activeKey=v.activeKey);w.addFocusedKey&&(w.data.focusedKey=v.focusedKey);w.addExpandedKeyList&&(w.data.expandedKeyList=v.expandedKeyList.join(","));w.addSelectedKeyList&&(w.data.selectedKeyList=v.selectedKeyList.join(","));w.success&&this.logWarning("initAjax: success callback is ignored; use onPostInit instead.");w.error&&this.logWarning("initAjax: error callback is ignored; use onPostInit instead.");var z=v.isReloading();w.success=function(B,D,E){3==t.selectMode&&B.tree.tnRoot._updatePartSelectionState();t.onPostInit&&t.onPostInit.call(B.tree,z,!1);m&&m.call(B.tree,"ok")};w.error=function(B,D,E,G){t.onPostInit&&t.onPostInit.call(B.tree,z,!0,D,E,G);m&&m.call(B.tree,"error",D,E,G)};this.logDebug("Dynatree._init(): send Ajax request...");this.tnRoot.appendAjax(w)},toString:function(){return"Dynatree '"+this.$tree.attr("id")+"'"},toDict:function(){return this.tnRoot.toDict(!0)},serializeArray:function(m){m=this.getSelectedNodes(m);for(var t=this.$tree.attr("name")||this.$tree.attr("id"),v=[],w=0,z=m.length;w<z;w++)v.push({name:t,value:m[w].data.key});return v},getPersistData:function(){return this.persistence.toDict()},logDebug:function(m){2<=this.options.debugLevel&&(Array.prototype.unshift.apply(arguments,["debug"]),ma.apply(this,arguments))},logInfo:function(m){1<=this.options.debugLevel&&(Array.prototype.unshift.apply(arguments,["info"]),ma.apply(this,arguments))},logWarning:function(m){Array.prototype.unshift.apply(arguments,["warn"]);ma.apply(this,arguments)},isInitializing:function(){return"init"==this.phase||"postInit"==this.phase},isReloading:function(){return("init"==this.phase||"postInit"==this.phase)&&this.options.persist&&this.persistence.cookiesFound},isUserEvent:function(){return"userEvent"==this.phase},redraw:function(){this.tnRoot.render(!1,!1)},renderInvisibleNodes:function(){this.tnRoot.render(!1,!0)},reload:function(m){this._load(m)},getRoot:function(){return this.tnRoot},enable:function(){this.$widget.enable()},disable:function(){this.$widget.disable()},getNodeByKey:function(m){var t=L.getElementById(this.options.idPrefix+m);if(t)return t.dtnode?t.dtnode:null;var v=null;this.visit(function(w){if(w.data.key==m)return v=w,!1},!0);return v},getNodeInTree:function(m){var t=L.getElementById(this.options.idPrefix+m);if(t)return t.dtnode?t.dtnode:null;var v=null;this.visit(function(w){b.each(w.data,function(z,B){if(w.data[z]===m)return v=w,!1})},!0);return v},getActiveNode:function(){return this.activeNode},reactivate:function(m){var t=this.activeNode;t&&(this.activeNode=null,t.activate(),m&&t.focus())},getSelectedNodes:function(m){var t=[];this.tnRoot.visit(function(v){if(v.bSelected&&(t.push(v),!0===m))return"skip"});return t},activateKey:function(m){m=null===m?null:this.getNodeByKey(m);if(!m)return this.activeNode&&this.activeNode.deactivate(),this.activeNode=null;m.focus();m.activate();return m},loadKeyPath:function(m,t){m=m.split(this.options.keyPathSeparator);""===m[0]&&m.shift();m[0]==this.tnRoot.data.key&&(this.logDebug("Removed leading root key."),m.shift());m=m.join(this.options.keyPathSeparator);return this.tnRoot._loadKeyPath(m,t)},selectKey:function(m,t){m=this.getNodeByKey(m);if(!m)return null;m.select(t);return m},enableUpdate:function(m){if(this.bEnableUpdate==m)return m;(this.bEnableUpdate=m)&&this.redraw();return!m},count:function(){return this.tnRoot.countChildren()},visit:function(m,t){return this.tnRoot.visit(m,t)},_createFromTag:function(m,t){var v=this;t.find(">li").each(function(){var w=b(this),z=w.find(">span:first"),B=w.find(">a:first"),D=null,E=null;if(z.length)z=z.html();else if(B.length){z=B.html();D=B.attr("href");E=B.attr("target");var G=B.attr("title")}else z=w.html(),B=z.search(/<ul/i),z=0<=B?b.trim(z.substring(0,B)):b.trim(z);G={title:z,tooltip:G,isFolder:w.hasClass("folder"),isLazy:w.hasClass("lazy"),expand:w.hasClass("expanded"),select:w.hasClass("selected"),activate:w.hasClass("active"),focus:w.hasClass("focused"),noLink:w.hasClass("noLink")};D&&(G.href=D,G.target=E);w.attr("title")&&(G.tooltip=w.attr("title"));w.attr("id")&&(G.key=w.attr("id"));if(w.attr("data")&&(D=b.trim(w.attr("data")))){"{"!=D.charAt(0)&&(D="{"+D+"}");try{b.extend(G,eval("("+D+")"))}catch(I){throw"Error parsing node data: "+I+"\ndata:\n'"+D+"'";}}D=m.addChild(G);w=w.find(">ul:first");w.length&&v._createFromTag(D,w)})},_checkConsistency:function(){},_setDndStatus:function(m,t,v,w,z){m=m?b(m.span):null;t=b(t.span);this.$dndMarker||(this.$dndMarker=b("<div id='dynatree-drop-marker'></div>").hide().css({"z-index":1E3}).prependTo(b(this.divTree).parent()));if("after"===w||"before"===w||"over"===w){switch(w){case"before":this.$dndMarker.removeClass("dynatree-drop-after dynatree-drop-over");this.$dndMarker.addClass("dynatree-drop-before");var B="0 -8";break;case"after":this.$dndMarker.removeClass("dynatree-drop-before dynatree-drop-over");this.$dndMarker.addClass("dynatree-drop-after");B="0 8";break;default:this.$dndMarker.removeClass("dynatree-drop-after dynatree-drop-before"),this.$dndMarker.addClass("dynatree-drop-over"),t.addClass("dynatree-drop-target"),B="8 0"}this.$dndMarker.show().position({my:"left top",at:"left top",of:t,offset:B})}else t.removeClass("dynatree-drop-target"),this.$dndMarker.hide();"after"===w?t.addClass("dynatree-drop-after"):t.removeClass("dynatree-drop-after");"before"===w?t.addClass("dynatree-drop-before"):t.removeClass("dynatree-drop-before");!0===z?(m&&m.addClass("dynatree-drop-accept"),t.addClass("dynatree-drop-accept"),v.addClass("dynatree-drop-accept")):(m&&m.removeClass("dynatree-drop-accept"),t.removeClass("dynatree-drop-accept"),v.removeClass("dynatree-drop-accept"));!1===z?(m&&m.addClass("dynatree-drop-reject"),t.addClass("dynatree-drop-reject"),v.addClass("dynatree-drop-reject")):(m&&m.removeClass("dynatree-drop-reject"),t.removeClass("dynatree-drop-reject"),v.removeClass("dynatree-drop-reject"))},_onDragEvent:function(m,t,v,w,z,B){var D=this.options.dnd,E=null,G=b(t.span);switch(m){case"helper":v=b("<div class='dynatree-drag-helper'><span class='dynatree-drag-helper-img' /></div>").append(b(w.target).closest("a").clone());b("ul.dynatree-container",t.tree.divTree).append(v);v.data("dtSourceNode",t);E=v;break;case"start":t.isStatusNode()?E=!1:D.onDragStart&&(E=D.onDragStart(t));!1===E?(this.logDebug("tree.onDragStart() cancelled"),z.helper.trigger("mouseup"),z.helper.hide()):G.addClass("dynatree-drag-source");break;case"enter":E=(E=D.onDragEnter?D.onDragEnter(t,v):null)?{over:!0===E||"over"===E||0<=b.inArray("over",E),before:!0===E||"before"===E||0<=b.inArray("before",E),after:!0===E||"after"===E||0<=b.inArray("after",E)}:!1;z.helper.data("enterResponse",E);break;case"over":B=z.helper.data("enterResponse");m=null;if(!1!==B)if("string"===typeof B)m=B;else{var I=G.offset();w=w.pageY-I.top;G.width();G=w/G.height();B.after&&.75<G?m="after":!B.over&&B.after&&.5<G?m="after":B.before&&.25>=G?m="before":!B.over&&B.before&&.5>=G?m="before":B.over&&(m="over");D.preventVoidMoves&&(t===v?m=null:"before"===m&&v&&t===v.getNextSibling()?m=null:"after"===m&&v&&t===v.getPrevSibling()?m=null:"over"===m&&v&&v.parent===t&&v.isLastSibling()&&(m=null));z.helper.data("hitMode",m)}"over"===m&&D.autoExpandMS&&!1!==t.hasChildren()&&!t.bExpanded&&t.scheduleAction("expand",D.autoExpandMS);m&&D.onDragOver&&(E=D.onDragOver(t,v,m),"over"===E||"before"===E||"after"===E)&&(m=E);this._setDndStatus(v,t,z.helper,m,!1!==E&&null!==m);break;case"drop":G=z.helper.hasClass("dynatree-drop-reject");if((m=z.helper.data("hitMode"))&&D.onDrop&&!G)D.onDrop(t,v,m,z,B);break;case"leave":t.scheduleAction("cancel");z.helper.data("enterResponse",null);z.helper.data("hitMode",null);this._setDndStatus(v,t,z.helper,"out",R);if(D.onDragLeave)D.onDragLeave(t,v);break;case"stop":G.removeClass("dynatree-drag-source");if(D.onDragStop)D.onDragStop(t);break;default:throw"Unsupported drag event: "+m;}return E},cancelDrag:function(){var m=b.ui.ddmanager.current;m&&m.cancel()},lastentry:R};b.widget("ui.dynatree",{_init:function(){if(1.8>parseFloat(b.ui.version))return 0<=this.options.debugLevel&&ma("warn","ui.dynatree._init() was called; you should upgrade to jquery.ui.core.js v1.8 or higher."),this._create();2<=this.options.debugLevel&&ma("debug","ui.dynatree._init() was called; no current default functionality.")},_create:function(){1<=this.options.debugLevel&&Aa("Dynatree._create(): version='%s', debugLevel=%o.",b.ui.dynatree.version,this.options.debugLevel);this.options.event+=".dynatree";this.element.get(0);this.tree=new l(this);this.tree._load();this.tree.logDebug("Dynatree._init(): done.")},bind:function(){function m(v){v=b.event.fix(v||F.event);var w=b.ui.dynatree.getNode(v.target);return w?w._onFocus(v):!1}this.unbind();var t="click.dynatree dblclick.dynatree";this.options.keyboard&&(t+=" keypress.dynatree keydown.dynatree");this.element.bind(t,function(v){var w=b.ui.dynatree.getNode(v.target);if(!w)return!0;var z=w.tree,B=z.options;z.logDebug("event(%s): dtnode: %s",v.type,w);var D=z.phase;z.phase="userEvent";try{switch(v.type){case"click":return B.onClick&&!1===B.onClick.call(z,w,v)?!1:w._onClick(v);case"dblclick":return B.onDblClick&&!1===B.onDblClick.call(z,w,v)?!1:w._onDblClick(v);case"keydown":return B.onKeydown&&!1===B.onKeydown.call(z,w,v)?!1:w._onKeydown(v);case"keypress":return B.onKeypress&&!1===B.onKeypress.call(z,w,v)?!1:w._onKeypress(v)}}catch(E){z.logWarning("bind(%o): dtnode: %o, error: %o",v,w,E)}finally{z.phase=D}});t=this.tree.divTree;t.addEventListener?(t.addEventListener("focus",m,!0),t.addEventListener("blur",m,!0)):t.onfocusin=t.onfocusout=m},unbind:function(){this.element.unbind(".dynatree")},enable:function(){this.bind();b.Widget.prototype.enable.apply(this,arguments)},disable:function(){this.unbind();b.Widget.prototype.disable.apply(this,arguments)},getTree:function(){return this.tree},getRoot:function(){return this.tree.getRoot()},getActiveNode:function(){return this.tree.getActiveNode()},getSelectedNodes:function(){return this.tree.getSelectedNodes()},lastentry:R});1.8>parseFloat(b.ui.version)&&(b.ui.dynatree.getter="getTree getRoot getActiveNode getSelectedNodes");b.ui.dynatree.version="$Version: 1.2.2$";b.ui.dynatree.getNode=function(m){if(m instanceof
h)return m;for(m.selector!==R&&(m=m[0]);m;){if(m.dtnode)return m.dtnode;m=m.parentNode}return null};b.ui.dynatree.getPersistData=k._getTreePersistData;b.ui.dynatree.prototype.options={title:"Dynatree",minExpandLevel:1,imagePath:null,children:null,initId:null,initAjax:null,autoFocus:!0,keyboard:!0,persist:!1,autoCollapse:!1,clickFolderMode:3,activeVisible:!0,checkbox:!1,selectMode:2,fx:null,noLink:!1,onClick:null,onDblClick:null,onKeydown:null,onKeypress:null,onFocus:null,onBlur:null,onQueryActivate:null,onQuerySelect:null,onQueryExpand:null,onPostInit:null,onActivate:null,onDeactivate:null,onSelect:null,onExpand:null,onLazyRead:null,onCustomRender:null,onCreate:null,onRender:null,postProcess:null,dnd:{onDragStart:null,onDragStop:null,autoExpandMS:1E3,preventVoidMoves:!0,onDragEnter:null,onDragOver:null,onDrop:null,onDragLeave:null},ajaxDefaults:{cache:!1,timeout:0,dataType:"json"},strings:{loading:"Loading&#8230;",loadError:"Load error!"},generateIds:!1,idPrefix:"dynatree-id-",keyPathSeparator:"/",cookieId:"dynatree",cookie:{expires:null},classNames:{container:"dynatree-container",node:"dynatree-node",folder:"dynatree-folder",empty:"dynatree-empty",vline:"dynatree-vline",expander:"dynatree-expander",connector:"dynatree-connector",checkbox:"dynatree-checkbox",nodeIcon:"dynatree-icon",title:"dynatree-title",strain:"ss-strain",noConnector:"dynatree-no-connector",nodeError:"dynatree-statusnode-error",nodeWait:"dynatree-statusnode-wait",hidden:"dynatree-hidden",combinedExpanderPrefix:"dynatree-exp-",combinedIconPrefix:"dynatree-ico-",nodeLoading:"dynatree-loading",hasChildren:"dynatree-has-children",active:"dynatree-active",selected:"dynatree-selected",expanded:"dynatree-expanded",lazy:"dynatree-lazy",focused:"dynatree-focused",partsel:"dynatree-partsel",lastsib:"dynatree-lastsib"},debugLevel:1,lastentry:R};1.8>parseFloat(b.ui.version)&&(b.ui.dynatree.defaults=b.ui.dynatree.prototype.options);b.ui.dynatree.nodedatadefaults={title:null,key:null,isFolder:!1,isLazy:!1,tooltip:null,href:null,icon:null,addClass:null,noLink:!1,activate:!1,focus:!1,expand:!0,select:!1,hideCheckbox:!1,unselectable:!1,children:null,lastentry:R};var p=!1,q=function(){p||(b.ui.plugin.add("draggable","connectToDynatree",{start:function(m,t){var v=b(this).data("draggable"),w=t.helper.data("dtSourceNode")||null;if(w)return v.offset.click.top=-2,v.offset.click.left=16,w.tree._onDragEvent("start",w,null,m,t,v)},drag:function(m,t){var v=b(this).data("draggable"),w=t.helper.data("dtSourceNode")||null,z=t.helper.data("dtTargetNode")||null,B=b.ui.dynatree.getNode(m.target);m.target&&!B&&0<b(m.target).closest("div.dynatree-drag-helper,#dynatree-drop-marker").length||(t.helper.data("dtTargetNode",B),z&&z!==B&&z.tree._onDragEvent("leave",z,w,m,t,v),B&&B.tree.options.dnd.onDrop&&(B===z?B.tree._onDragEvent("over",B,w,m,t,v):B.tree._onDragEvent("enter",B,w,m,t,v)))},stop:function(m,t){var v=b(this).data("draggable"),w=t.helper.data("dtSourceNode")||null,z=t.helper.data("dtTargetNode")||null,B="mouseup"==m.type&&1==m.which;B||Aa("Drag was cancelled");z&&(B&&z.tree._onDragEvent("drop",z,w,m,t,v),z.tree._onDragEvent("leave",z,w,m,t,v));w&&w.tree._onDragEvent("stop",w,null,m,t,v)}}),p=!0)}})(jQuery);(function(b){b.fn.externalLinks=function(){return this.each(function(){b(this).find('a[rel!=external][rel!=notexternal][target!=_blank][href^="http"]:not(:empty):not(:has(img))').filter(function(){return this.hostname!==F.location.hostname}).attr("rel","external")})}})(jQuery);(function(b){b.fn.filterableDropdown=function(c){return this.each(function(){b.filterableDropdown(b(this),c)})};b.filterableDropdown=function(c,f){f=b.extend({},f);if(c.data("filterableDropdown")){if(f.change)c.off("afterAddRemove.filterableDropdown").on("afterAddRemove.filterableDropdown",f.change);f.refresh&&c.trigger("open").trigger("close").find("label").trigger("refresh")}else{c.on({"focusInput.filterableDropdown":function(){c.find("._fd_filter input").trigger("focus")},"open.filterableDropdown":function(){c.data("filterableDropdown").closed&&(c.data("filterableDropdown").closed=!1,c.addClass("open").find("._fd_filter").show().find("input").trigger("focus").trigger("keyup").next().html("&#9650;"),b(L).off(".filterableDropdown").on("mousedown.filterableDropdown",function(){c.trigger("close")}))},"close.filterableDropdown":function(){var k=c.data("filterableDropdown").tag,l=c.find("input[type=checkbox]:checked, input[type=radio]:checked");c.data("filterableDropdown").closed=!0;c.removeClass("open").find("._fd_tag").remove().end().find("._fd_filter input").trigger("reset").next().html("&#9660;").end().end().prepend(l.map(function(){return k.clone().data("input",this).show().find("span").first().html(this.nextSibling.innerHTML).end().end()}).toArray()).trigger("afterAddRemove");l.length&&"radio"===l.prop("type")&&c.find("._fd_filter").hide();b(L).off(".filterableDropdown");k=l=null},"afterAddRemove.filterableDropdown":f.change||b.noop}).on("click","._fdt_button",function(){var k=b(b(this).parent().data("input"));b(this.parentNode).remove();"checkbox"===k.prop("type")?(k.prop("checked",!1),h.trigger("refresh"),c.trigger("afterAddRemove")):c.trigger("open")}).children().on({"mousedown.filterableDropdown":function(k){k.stopPropagation()}}).find("input[type=checkbox], input[type=radio]").on({"keydown.filterableDropdown":function(k){k.preventDefault()},"click.filterableDropdown":function(k){k.originalEvent&&b(this).triggerHandler("afterClick","radio"!==this.type&&(k.metaKey||k.ctrlKey))},"afterClick.filterableDropdown":function(k,l){h.trigger("refresh");c.trigger(l?"focusInput":"close")}});var h=c.find("label").on({"mouseenter.filterableDropdown":function(){h.removeClass("highlight");b(this).addClass("highlight")},"refresh.filterableDropdown":function(){b(this).toggleClass("selected",b(this.parentNode).find("input").prop("checked"))},"click.filterableDropdown":function(k){var l=b(this).parent().find("input");"radio"!==l.prop("type")&&(k.metaKey||k.ctrlKey)&&(k.preventDefault(),l.prop("checked",function(){return!this.checked}).triggerHandler("afterClick",!0));l=null}}).trigger("refresh");c.find("._fd_filter input").on({"focus.filterableDropdown":function(){this.value==this.defaultValue&&b(this).val("");c.trigger("open")},"reset.filterableDropdown":function(){b(this).val(this.defaultValue).trigger("keyup").trigger("blur")},"keyup.filterableDropdown mouseup.filterableDropdown":function(k){var l=this.value;if(k.originalEvent&&(l===this.defaultValue||38===k.which||40===k.which||13===k.which||c.data("filterableDropdown").previousValue===l))return!1;c.data("filterableDropdown").previousValue=l;h.each(function(){var p=b(this);this.innerHTML=p.text();l.match(/^[a-z\s]+$/i)?(p.parent().hide(),this.innerHTML=this.innerHTML.replace(new RegExp("(^|[^a-z]{1})("+l+")","i"),function(q,m,t){p.parent().show();return m+'<span class="highlight">'+t+"</span>"})):(p.parent().show(),h.removeClass("highlight"))});h.filter(".highlight:visible").length||h.removeClass("highlight").filter(":visible").first().addClass("highlight");c.find("._fd_nomatch").toggle(!h.filter(":visible").parent().removeClass("first-child last-child").first().addClass("first-child").end().last().addClass("last-child").end().length);h.parent().parent().scrollTop(0)},"keydown.filterableDropdown paste.filterableDropdown":function(k){var l=!1;switch(k.which){case 13:k.preventDefault();var p=h.filter(".highlight:visible").parent().find("input");"radio"!==p.prop("type")&&(k.metaKey||k.ctrlKey)?p.prop("checked",!0).triggerHandler("afterClick",!0):p.prop("checked",!1).trigger("click").triggerHandler("afterClick",!1);p=null;break;case 9:case 27:c.trigger("close");break;case 38:p=b(h.get().reverse());case 40:k.preventDefault();(p||h).filter(":visible").each(function(){var q=b(this);if(q.hasClass("highlight"))q.removeClass("highlight"),l=!0;else{q.toggleClass("highlight",l);if(l){var m=q.parent();q=m.parent();var t=m.height(),v=q.height();m=m.offset().top-
q.offset().top-1;0<m&&(m=m+t-v,0>m&&(m=0));m&&q.scrollTop(q.scrollTop()+m)}l=!1}}).filter(".highlight").length||(p||h).filter(":visible").last().addClass("highlight");break;default:this.value&&this.value!=this.defaultValue||b(this).val("")}}}).next().on({"click.filterableDropdown":function(k){c.trigger(c.data("filterableDropdown").closed?"open":"close")}});c.data("filterableDropdown",{tag:c.find("._fd_tag").remove()}).trigger("close")}}})(jQuery);(function(b,c,f){function h(m){m=m||location.href;return"#"+m.replace(/^[^#]*#?(.*)$/,"$1")}var k=b.event.special,l=L.documentMode,p="onhashchange"in c&&(l===f||7<l);b.fn.hashchange=function(m){return m?this.on("hashchange",m):this.trigger("hashchange")};b.fn.hashchange.delay=50;k.hashchange=b.extend(k.hashchange,{setup:function(){if(p)return!1;b(q.start)},teardown:function(){if(p)return!1;b(q.stop)}});var q=function(){function m(){var E=h(),G=D(w);E!==w?(B(w=E,G),b(c).trigger("hashchange")):G!==w&&(location.href=location.href.replace(/#.*/,"")+
G);v=setTimeout(m,b.fn.hashchange.delay)}var t={},v,w=h(),z=function(E){return E},B=z,D=z;t.start=function(){v||m()};t.stop=function(){v&&clearTimeout(v);v=f};b("body").hasClass("ie")&&!p&&function(){var E,G;t.start=function(){E||(G=(G=b.fn.hashchange.src)&&G+h(),E=b('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){G||B(h());m()}).attr("src",G||"javascript:0").insertAfter("body")[0].contentWindow,L.onpropertychange=function(){try{"title"===event.propertyName&&(E.document.title=L.title)}catch(I){}})};t.stop=z;D=function(){return h(E.location.href)};B=function(I,K){var S=E.document,U=b.fn.hashchange.domain;I!==K&&(S.title=L.title,S.open(),U&&S.write('<script>document.domain="'+U+'"\x3c/script>'),S.close(),E.location.hash=I)}}();return t}()})(jQuery,this);(function(b){function c(f){if(!f.data("uiTooltip")){var h=f.data("opts")||{};h.content=h.content||(f.data("title")||"").replace(/\n/g,"<br />")||f.find(">._ht_tip").first().remove().text();h.track=h.track||f.hasClass("_ht_track");h.delay=h.delay||f.hasClass("_ht_delay")||b("<div>").html(h.content).find("a[href],form").length;h.position=b.extend({my:h.track?"center top+24":"center top+8",at:"center bottom",using:function(k,l){h.track&&"bottom"===l.vertical&&(k.top+=16);b(this).removeClass("helptip-top helptip-bottom helptip-middle").addClass("helptip-"+l.vertical).css(k)}},h.position||{});h.delay&&(h.origClose=h.close||b.noop,h.close=function(k,l){var p=b(this),q=p.data("uiTooltip").options.origClose;l.tooltip.on({"mouseenter.helptip":function(){b(this).clearQueue()},"mouseleave.helptip":function(m){b(this).remove();m.data.close.call(m.data.element,m,l,!0)}},{element:p,close:q});q.call(p,k,l)},h.hide={delay:200,duration:0});delete h.delay;f.tooltip(b.extend({show:{delay:100,duration:1},hide:!1,items:"*",open:function(k,l){if(k.originalEvent&&"focusin"===k.originalEvent.type&&!b(k.originalEvent.currentTarget).is("input,textarea"))return l.tooltip.remove(),!1;l.tooltip.externalLinks()}},h))}}b.fn.helptip=function(f){return"string"===typeof f?(c(b(this)),this.tooltip.apply(this,arguments)):this.each(function(){var h=b.extend({},f||{}),k=b(this);k.data("opts",h);k.data("title",k.attr("title"));k.removeAttr("title");k.on("mouseover",function(){c(k);k.tooltip("open");return!0})})}})(jQuery);(function(b){b.fn.hoverIntent=function(c,f){var h={sensitivity:7,interval:100,timeout:0,namespace:"hoverIntent"};h=b.extend(h,f?{over:c,out:f}:c);var k,l,p,q,m=function(v){k=v.pageX;l=v.pageY},t=function(v,w){w.hoverIntent_t=clearTimeout(w.hoverIntent_t);if(Math.abs(p-k)+Math.abs(q-l)<h.sensitivity)return b(w).off("mousemove."+
h.namespace,m),w.hoverIntent_s=1,h.over.apply(w,[v]);p=k;q=l;w.hoverIntent_t=setTimeout(function(){t(v,w)},h.interval)};c=function(v){var w=jQuery.extend({},v),z=this;z.hoverIntent_t&&(z.hoverIntent_t=clearTimeout(z.hoverIntent_t));"mouseenter"==v.type?(p=w.pageX,q=w.pageY,b(z).on("mousemove."+h.namespace,m),1!=z.hoverIntent_s&&(z.hoverIntent_t=setTimeout(function(){t(w,z)},h.interval))):(b(z).off("mousemove."+h.namespace,m),1==z.hoverIntent_s&&(z.hoverIntent_t=setTimeout(function(){z.hoverIntent_t=clearTimeout(z.hoverIntent_t);z.hoverIntent_s=0;h.out.apply(z,[w])},h.timeout)))};return this.on("mouseenter."+h.namespace,c).on("mouseleave."+h.namespace,c)}})(jQuery);(function(b,c){b.ajaxPrefilter(function(f,h,k){if(f.iframe)return"iframe"});b.ajaxTransport("iframe",function(f,h,k){function l(){p&&(m.clones.replaceWith(function(v){return m.originals[v]}),q.remove(),p.off("load").attr("src","javascript:false;").remove(),q=p=null)}var p=null,q=null,m={originals:f.form.find('input:file:enabled:not([value=""])')},t="iframe"+b.now();f.dataTypes.shift();if(m.originals.length)return q=b("<form>",{action:f.url||f.form.attr("href"),name:t,target:t,enctype:"multipart/form-data",method:"POST"}),b.each(b.merge([{name:"X-Requested-With",value:"iframe"}],f.form.serializeArray()),function(v,w){b('<input type="hidden" />').attr(w).appendTo(q)}),m.clones=m.originals.after(function(){return this.cloneNode(!0)}).next(),m.originals.appendTo(q),{send:function(v,w){p=b('<iframe name="'+t+'" id="'+t+'" src="javascript:false;" style="display:none">').on("load.initial",function(){p.off("load").on("load",function(){var z=this.contentWindow?this.contentWindow.document:this.contentDocument?this.contentDocument:this.document;z=z.documentElement||z.body;l();w(200,"OK",{html:z.innerHTML,text:z.textContent||z.innerText},null)});q[0].submit()});b("body").append(q,p);p.triggerHandler("load.initial")},abort:function(){l()}}})})(jQuery);(function(b){b.keepOnPage=function(c,f){c=b(c);if(c.data("keepOnPage")){var h=c.data("keepOnPage").eventId;"trigger"===f?b(F).triggerHandler("scroll.keepOnPage_"+
h,!0):"destroy"===f&&(b(F).off(".keepOnPage_"+h),c.removeData("keepOnPage"))}else"destroy"!==f&&(h=Math.random().toString().split(".")[1],c.data("keepOnPage",{active:!1,eventId:h}),b(F).on("load.keepOnPage_"+h+" scroll.keepOnPage_"+h,b.extend({el:c,options:f},function(k,l){return{clone:"static"===l.position?k.clone().hide().empty().css({visibility:"hidden",height:k.height(),width:k.width()}).insertAfter(k):!1,defaults:l}}(c,{cssTop:c.css("top"),offsetTop:c.offset().top,position:c.css("position")})),function(k,l){k.data.el.data("keepOnPage").active||(k.data.defaults.offsetTop=k.data.el.offset().top);var p=Math.max(b(F).scrollTop()-k.data.defaults.offsetTop+k.data.options.marginTop,0),q="relative"===k.data.defaults.position,m=k.data.el.data("keepOnPage").active===!p;if(l||m||p&&q)k.data.el.data("keepOnPage").active=!!p,k.data.clone&&k.data.clone.css(l&&p?{height:k.data.el.height(),width:k.data.el.width()}:{}).toggle(!!p),k.data.el.css(p?q?{top:p}:{position:"fixed",top:k.data.options.marginTop}:{position:k.data.defaults.position,top:q?k.data.defaults.cssTop:k.data.defaults.offsetTop}),m&&((p?k.data.options.onfix:k.data.options.onreset)||b.noop).apply(k.data.el[0])}))};b.fn.keepOnPage=function(c){c=c||{};c.marginTop=c.marginTop||0;this.each(function(){b.keepOnPage(this,c)});return this}})(jQuery);(function(b){function c(){if(f.length&&!(h>=k)){var l=f.shift();h+=1;b.ajax(l[0]).always(function(p){h--;c()}).done(function(p){l[1].resolve(p)}).fail(function(p){l[1].reject(p)})}}var f=[],h=0,k=b("body").data("pace")||2;b.extend({paced_ajax:function(l){e=b.Deferred();f.push([l,e]);c();return e}})})(jQuery);g(function(){function b(){c>=prefetch.length||(g("<img/>").attr({src:prefetch[c],style:"display: none"}).appendTo(g("body")),c++,setTimeout(b,1E3))}if("prefetch"in F&&prefetch){var c=0;setTimeout(b,3E3)}});(function(b){b.fn.scrollyTable=function(c){return this.each(function(){var f,h=b(this);if(f=(this.className.match(/_scrollytable_id_[0-9]+/)||[]).pop())switch(c){case"refresh":h.parent().prev().children().width(h.outerWidth()).filter(function(){return 1>b(this.parentNode).outerHeight()&&!!b(this).data("uiTooltip")}).helptip("close");break;case"destroy":h.removeClass(f).parent().prev().remove().end().replaceWith(h),b(F).off("."+f)}else c||(f=Math.random().toString().replace("0.","_scrollytable_id_"),h.addClass(f).wrap('<div style="overflow:auto">').parent().on("scroll.scrollyTable",function(){b(this.previousSibling).scrollLeft(b(this).scrollLeft())}).before('<div style="overflow:auto"><div style="height:1px"></div></div>').prev().on("scroll.scrollyTable",function(){b(this.nextSibling).scrollLeft(b(this).scrollLeft())}).children().width(h.outerWidth()).end().filter(function(){return 1<=b(this).outerHeight()}).children().helptip({content:"Scroll to see more columns &raquo;",position:{my:"right-20 top+12",at:"left+"+h.parent().width()+" top"},open:function(k,l){l.tooltip.css("cursor","default").one("click",function(){b(this).fadeOut()})},hide:400}).helptip("open").end().one("scroll.scrollyTable",function(){b(this).children().helptip("close")}),b(F).on("resize."+
f,{el:this},function(k){b(k.data.el).scrollyTable("refresh")}),h.hasClass("data_table")&&h.dataTable().fnSettings().aoDrawCallback.push({fn:function(){this.scrollyTable("refresh")}}));h=null})}})(jQuery);(function(b){b.fn.selectRange=function(c,f){return this.filter(":visible").each(function(){var h="function"===typeof c?c.call(this):c,k="function"===typeof f?f.call(this):f;if(this.setSelectionRange)this.focus(),this.setSelectionRange(h,k);else if(this.createTextRange){var l=this.createTextRange();l.collapse(!0);l.moveEnd("character",k);l.moveStart("character",h);l.select()}}).end()}})(jQuery);(function(b){b.selectToToggle=function(c){c.off(".selectToToggle").on("change.selectToToggle",function(){var f=b(this).data("selectToToggle"),h=f.wrapper;f=f.toggleMap;var k="INPUT"!==this.nodeName||"checkbox"!==this.type||this.checked?this.value:!1,l=function(m){if(m){var t=function(v){var w=0;return v?v.replace(/[.]/g,function(z){w+=1;return 1<w?"\\.":"."}):""};return m.split(",").map(function(v){return t(v)}).join(",")}};for(q in f)if(q!==k){var p=l(f[q]);h.find(p).hide().removeAttr("checked").filter("option").each(function(){var m=b(this);"undefined"===typeof m.data("sttDisabled")&&m.data("sttDisabled",!!this.disabled)}).prop("disabled",!0)}var q=l(f[k]);h.find(q).show().filter("option").prop("disabled",function(){return b(this).data("sttDisabled")}).filter("select option").parent().each(function(){var m=b(this);m.find("option:selected:enabled").length||(m.find("option:enabled").first().prop("selected",!0),m.data("selectToToggle")&&m.trigger("change.selectToToggle"))})}).filter("select, input:checked").first().triggerHandler("change.selectToToggle")};b.fn.selectToToggle=function(c,f){return this.each(function(){var h=b(this),k=h.data("selectToToggle"),l=function(q,m){return"INPUT"===q[0].nodeName?m.find("input[name="+q[0].name+"]"):q};if(k)"trigger"===c?("SELECT"===h[0].nodeName||h[0].checked)&&h.trigger("change.selectToToggle"):"destroy"===c&&l(h,k.wrapper).off(".selectToToggle").removeData("selectToToggle");else{var p=b.extend({},c);f=f||b(L.body);h=l(h,f);b.isEmptyObject(p)&&("SELECT"===this.nodeName?h.find("option"):h).each(function(){if(this.value){var q=b.map(this.className.match(/(\s+|^)_stt__([^\s]+)/g)||[],function(m){return m.replace("_stt__","._stt_")});q.push("._stt_"+this.value);p[this.value]=this.className.match(/(\s+|^)_sttmulti($|\s+)/)?q[1]||q.join(","):q[0]}});h.data("selectToToggle",{wrapper:f,toggleMap:p});b.selectToToggle(h)}})}})(jQuery);(function(b){b.fn.speciesDropdown=function(c){return this.each(function(){b.speciesDropdown(b(this),c)})};b.speciesDropdown=function(c,f){f&&f.change&&c.data("speciesDropdown",{change:f.change});b.filterableDropdown(c,b.extend({},f,{change:function(){var h=b(this).find("._fd_tag").each(function(){this.style.backgroundImage=this.style.backgroundImage.replace(/[^\/]+\.png/,b(b(this).data("input")).val()+".png")}).end().data("speciesDropdown");h&&h.change.apply(this,arguments);h=null}}))}})(jQuery);(function(b){b.fn.tabs=function(c,f){if(this.length===c.length){var h=[];this.each(function(k){h.push({button:b(this),target:c.eq(k),event:f})});b.each(h,function(k,l){l.button.data("tabs",{target:l.target,siblings:h}).on("click"===l.event?"click.tabs":"mouseenter.tabs",function(){b.each(b(this).data("tabs").siblings,function(p,q){q.button.add(q.target).removeClass("active")});b(this).add(b(this).data("tabs").target).addClass("active")})});h=null}return this}})(jQuery);(function(b){function c(h,k){return b.ajax({url:h,type:"POST",traditional:!0,cache:!1,context:this,dataType:"json",data:{state:k}}).fail(function(){$this.toggleClass("off")})}
function f(h){h=h.parent(".group");b("a.togglebutton.radiogroup",h).length&&2>b("a.togglebutton:not(.off)",h).length?b("a.togglebutton:not(.off)",h).addClass("inactive"):b("a.togglebutton",h).removeClass("inactive")}b.fn.toggleButtons=function(){return this.each(function(){var h=b(this),k=h.parent(".group");b("a.togglebutton.radiogroup",k);f(h);h.click(function(){if(h.hasClass("inactive")||h.hasClass("disabled"))return!1;h.toggleClass("off");f(h);var l=h.hasClass("off")?"0":"1",p=h.attr("href");p&&c(p,l).done(function(q){q.reload_panels&&b.each(q.reload_panels,function(m,t){u.EventManager.triggerSpecific("updatePanel",t)})});return!1})})}})(jQuery);(function(b){b.fn.toggleClass2=function(c,f){return this.each(function(){b(this)[("function"===typeof f?f.call(this):f)?"addClass":"removeClass"](c)})}})(jQuery);(function(b){b.togglewrap=function(c,f){function h(){c.each(function(){var z=b(this);if(!z.data("togglewrap")){"TABLE"===this.nodeName&&"fixed"!==z.css("table-layout")&&(b("th, td",z).width(function(D,E){return E}),z.css("table-layout","fixed"));b(F).on("resize.togglewrap",function(D){D.target.tagName||k()});var B=z.find(".toggle_img");B.hasClass("_bound")||(z.on("click",".height_wrap .toggle_img",function(){var D=b(this);m(D);D.toggleClass("open").parents().first().toggleClass("open");return!1}),B.addClass("_bound"));z.find(".toggle_img").addClass("_bound");z.data("togglewrap",!0).find(".toggle_div").each(function(){b(this).data("togglewrap",{})});k();t()}z=null})}function k(){b(".height_wrap",c).each(function(){var z=b(this),B=z.find("span.toggle_img");B.length||(B=b('<span class="toggle_img" />').appendTo(this));var D=z.hasClass("open"),E=z.find(".val,.cell_detail"),G=""===E.text();D&&z.removeClass("open");E[G?"addClass":"removeClass"]("empty");B[z.height()<E.height()?"show":"hide"]();D&&(z.addClass("open"),G&&B.trigger("click"))})}function l(z){return z.parents().filter(function(){return"inline"!==b(this).css("display")}).first()}function p(z,B,D,E){var G=1;if(E){E=b.now();G=B(z);var I=b.now();if(!G){D&&D();return}E=I-E;100<E&&(z/=2);25>E&&(z*=2);G=Math.min(10*E,2E3)}setTimeout(function(){p(z,B,D,1)},G)}function q(z,B){var D=0,E=b(".toggle_div",c);p(1,function(G){E.slice(D,D+G).each(z);D+=G;return D<E.length&&E.length},B)}function m(z){z.hasClass("toggle_img")||(z=b(".toggle_img",z));var B=z.parents(".toggleblock");B.length||(B=l(z.parents(".toggle_div")));B.data("togglewrap.fixWidth",B.width()-16)}function t(){q(function(){m(b(this))},function(){v()})}function v(){q(function(){b(this).data("togglewrap.innerWidth",b(".cell_detail",this).width()).data("togglewrap.summaryWidth",b(".toggle_summary",this).width()+100)},function(){w()})}function w(){q(function(){var z=b(this),B=l(z).data("togglewrap.fixWidth");z.data("togglewrap.innerWidth")<B?z.replaceWith(b(".cell_detail",z).removeClass("cell_detail")):B>z.data("togglewrap.summaryWidth")&&b("span.toggle-img",z).addClass("limpet")})}"update"===f?k():("redo"==f&&c.removeData("togglewrap"),c=c.filter(".heightwrap_inside, .cellwrap_inside").add(c.find(".heightwrap_inside, .cellwrap_inside")),h())};b.fn.togglewrap=function(c){return this.each(function(){b.togglewrap(b(this),c)})}})(jQuery);(function(b){b.extend(b.fn,{validate:function(c){return this.each(function(){if("FORM"===this.nodeName){var f=b(this).data("validator");f||(f=new b.validator(c,this),b(this).data("validator",f));f.validateInputs(null,"initial")}else this.nodeName.match(/SELECT|INPUT|TEXTAREA/)&&(f=b(this),f.parents("form").data("validator")&&f.data("required",!1===c?!1:!0))})}});b.validator=function(c,f){var h=this;this.settings=b.extend({},b.validator.defaults,c);this.rules=this.settings.rules;this.tests=this.settings.tests;this.trim=this.settings.trim;this.inputs=b('input[type="text"], input[type="password"], input[type="file"], textarea, select',f);this.submitButtons=b('input[type="submit"]',f);this.result=!0;b(f).on("submit.validate",function(k){h.result=!0;h.validateInputs(null,"showError");h.result||(k.stopImmediatePropagation(),k.preventDefault())});this.inputs.each(function(){var k=b(this),l={valid:!0};if(this.className){k.hasClass(h.settings.requiredClass)&&(l.required=!0);var p=this.className.match(/.*\b_(\w+)\b.*/);if(p){l.rule=p[1];p=this.className.match(/\bmin_(.+)\b/);var q=this.className.match(/\bmax_(.+)\b/),m=this.className.match(/\bdefault_([^\s]+)\b/);p&&(l.min=parseFloat(p[1],10));q&&(l.max=parseFloat(q[1],10));m&&(l["default"]=m[1])}}k.data(l)}).on({"keyup.validate":function(k){9!==k.keyCode&&h.validateInputs(b(this),"delay","keyup")},"change.validate":function(){h.validateInputs(b(this),"delay","change")},"blur.validate":function(){h.validateInputs(b(this),"showError","blur")}});f=null};b.extend(b.validator,{defaults:{validClass:"valid",invalidClass:"invalid",requiredClass:"required",trim:"int nonnegint posint float nonnegfloat posfloat email url".split(" "),tests:{"int":new RegExp(/^[\-+]?\d+$/),"float":new RegExp(/^([\-+]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([\-+]?\d+))?$/),password:new RegExp(/^\S{6,32}$/),email:new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i),url:new RegExp(/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i)},rules:{nonnegint:function(c){return this.tests["int"].test(c)&&0<=c},posint:function(c){return this.tests["int"].test(c)&&0<c},nonnegfloat:function(c){return this.tests["float"].test(c)&&0<=c},posfloat:function(c){return this.tests["float"].test(c)&&0<c}},messages:{required:"This field is required","int":"Please enter an integer",nonnegint:"Please enter an integer (minimum 0)",posint:"Please enter an integer (minimum 1)","float":"Please enter a number",nonnegfloat:"Please enter a number (minimum 0)",posfloat:"Please enter a number (minimum 1)",password:"The password you have entered is invalid",email:"Please enter a valid email address",url:"Please enter a valid URL"}},prototype:{validateInputs:function(c,f,h){function k(){var q=!0,m;c.each(function(){var t=b(this),v=b.extend({},t.data()),w=this.value;0<=l.trim.indexOf(v.rule)&&(w=w.trim());""===w&&"default"in v&&(w=v["default"]);var z="initial"!==f&&v.required||w?v.rule&&l.rules[v.rule]?l.rules[v.rule].call(l,w):v.rule&&l.tests[v.rule]?l.tests[v.rule].test(w):v.required?!!w:null:null;z&&v.min&&(z=parseFloat(w,10)>=v.min);z&&v.max&&(z=parseFloat(w,10)<=v.max);p[z](this);t.data("valid",z);if(!1===z){v.required&&!w&&(v.rule="required");z=l.settings.messages[v.rule];if(v.rule.match(/int$/))if(v.min&&v.max)z="Please enter an integer between "+v.min+" and "+v.max;else if(v.min||v.max)z="Please enter an integer ("+(v.min?"min":"max")+"imum "+(v.min||v.max)+")";v.error?v.error.rule!==v.rule&&(v.error.el.html(z),v.error.rule=v.rule):(v.error={rule:v.rule,el:b("<label>",{"class":l.settings.invalidClass,"for":this.id,html:z}).hide().appendTo(t.parent())},t.data("error",v.error));"showError"===f&&v.error.el.css("display","inline")}else v.error&&(v.error.el.remove(),t.data("error",!1));"keyup"!==h&&w!==this.value&&(this.value=w)});for(m in l.inputs.toArray())if(!1===b(l.inputs[m]).data("valid")){q=!1;break}"function"===typeof l.settings.validate&&(q=l.settings.validate.call(l,q,c,f));q?l.submitButtons.prop("disabled",!1).removeClass("disabled"):l.submitButtons.prop("disabled",!0).addClass("disabled");q||(l.result=!1)}c=c||this.inputs;var l=this,p={"true":function(q){b(q).removeClass(l.settings.invalidClass).addClass(l.settings.validClass)},"false":function(q){b(q).removeClass(l.settings.validClass).addClass(l.settings.invalidClass)},"null":function(q){b(q).removeClass(l.settings.validClass+" "+l.settings.invalidClass)}};this.timeout&&clearTimeout(this.timeout);"delay"===f?this.timeout=setTimeout(k,250):k()}}})})(jQuery);(function(b){b.fn.zMenuLink=function(){return this.on("click.zmenulink",function(c){c.preventDefault();var f=b(b(this).siblings("._zmenu_link")[0]||this);u.EventManager.trigger("makeZMenu",f.attr("href").replace(/\W/g,"_"),{event:c,area:{link:f}})})}})(jQuery);var u=new pa;u.extend({constructor:null,initialize:function(){var b=this.cookie.get("ENSEMBL_HINTS"),c=g(".image_panel"),f=F.location.hash.match(/(modal_.+)/);F.name||(F.name="ensembl_"+(new Date).getTime()+"_"+Math.floor(1E4*Math.random()));this.setSpecies();this.locationURL="function"===typeof F.history.pushState?"search":"hash";this.hashParamRegex="([#?;&])(__PARAM__=)[^;&]+((;&)?)";this.locationMatch=new RegExp(/[#?;&]r=([^;&]+)/);this.markLocationMatch=new RegExp(/[#?;&]mr=([^;&]+)/);this.locationReplace=new RegExp(this.hashParamRegex.replace("__PARAM__","r"));this.width=parseInt(this.cookie.get("ENSEMBL_WIDTH"),10)||this.setWidth(R,1);this.dynamicWidth=!!this.cookie.get("DYNAMIC_WIDTH");this.hideHints={};this.initialPanels=g(".initial_panel");this.minWidthEl=g("#min_width_container");this.maxRegionLength=parseInt(g("#max_region_length").val()||0,10);this.images={total:c.length,last:c.last()[0]};this.markedLocation=this.getMarkedLocation();this.lastMarkedLocation=!1;this.browser=function(h){var k={};h.match(/webkit/i)?(k.webkit=!0,h.match(/chrome/i)?k.chrome=!0:h.match(/safari/i)&&(k.safari=!0)):h.match(/firefox/)?k.firefox=!0:h.match(/msie|trident/i)&&(k.ie=!0);return k}(navigator.userAgent||"");this.dynamicWidth&&!F.name.match(/^popup_/)&&(c=this.imageWidth(),0<c&&this.width!==c&&(this.width=c,this.cookie.set("ENSEMBL_WIDTH",c)));b&&g.each(b.split(/:/),function(){u.hideHints[this]=1});c=null;this.setCoreParams();this.LayoutManager.initialize();c=(b="hash"===this.locationURL?"":F.location.hash.match("="))?F.location.hash.match(this.locationMatch):!1;g("input.ajax_load").val(function(h,k){return u.urlFromHash(k)});b&&F.history.replaceState({},"",u.urlFromHash(F.location.search));this.PanelManager.initialize();f&&(this.EventManager.deferTrigger("modalOpen",{className:"force",rel:f[1]}),F.location.hash="");c&&this.EventManager.trigger("hashChange",c[1])},setSpecies:function(){this.speciesPath=g("#species_path").val()||"";this.speciesCommon=g("#species_common_name").val()||"";this.speciesImagePath=g("#ensembl_image_root").val()+"species/"||"";this.species=this.speciesPath.split("/").pop();this.speciesImage=g("#ensembl_species_image").val()},cookie:{set:function(b,c,f,h,k){var l=null;k&&(k=L.domain.match(new RegExp(/(.*?)\.?([^\.]*?)\.(ac\.uk|org)$/)))&&(l=k[2]?k[2]+"."+k[3]:L.domain);b=[!0===h?b+"="+(c||""):escape(b)+"="+escape(c||""),(l?"; domain="+
l:"")+"; expires=",-1===f||""===c?"Thu, 01 Jan 1970 00:00:00 GMT":f?f:"Tue, 19 Jan 2038 00:00:00 GMT","; path=/"].join("");L.cookie=b;return c},get:function(b,c){return(b=L.cookie.match(new RegExp("(^|;)\\s*"+(!0===c?b:escape(b))+"=([^;\\s]*)")))?unescape(b[2]):""}},imageWidth:function(){return 100*Math.floor((g(F).width()-240)/100)},setWidth:function(b,c){var f=!isNaN(b);b=f?b:this.imageWidth();this.width=500>b?500:b;c&&(this.cookie.set("ENSEMBL_WIDTH",this.width),this.cookie.set("DYNAMIC_WIDTH",f?"":1),this.dynamicWidth=!f);return this.width},setCoreParams:function(){var b=F.location.search,c=F.location.hash,f="hash"===this.locationURL?c:b,h=this.coreParams?this.coreParams.r:"",k,l,p;this.hash=c;this.coreParams={};this.initialR=g("input[name=r]","#core_params").val();this.location={length:1E5};this.multiSpecies={};g("input","#core_params").each(function(){var q=f.match("[#?;&]%s=([^;&]+)".replace("%s",this.name));u.coreParams[this.name]=q?unescape(q[1]):this.value});this.lastR=h||(c?this.coreParams.r:this.initialR);if(c=this.coreParams.r?this.coreParams.r.match(/(.+):(\d+)-(\d+)/):!1)this.location={name:c[1],start:parseInt(c[2],10),end:parseInt(c[3],10)},this.location.length=this.location.end-this.location.start+1;(c=b.match(/s\d+=([^;&]+)/g))&&g.each(c,function(){k=this.split("=");l=k[0].substr(1);u.multiSpecies[l]={};g.each(["r","g","s"],function(q,m){u.multiSpecies[l][m]=b.match("[#?;&]%s=([^;&]+)".replace("%s",m+l));u.multiSpecies[l][m]&&(u.multiSpecies[l][m]=unescape(u.multiSpecies[l][m][1]));"r"===m&&u.multiSpecies[l].r&&(p=u.multiSpecies[l].r.match(/(.+):(\d+)-(\d+)/),u.multiSpecies[l].location={name:p[1],start:parseInt(p[2],10),end:parseInt(p[3],10)})})})},changeCoreParam:function(b,c){var f=g("#core_params input[name="+b+"]");f.length||(f=g("<input name="+b+">").appendTo(g("#core_params")));!1===c?f.remove():f.val(c)},cleanURL:function(b){return b.replace(/&/g,";").replace(/#.*$/g,"").replace(/([?;])time=[^;]+;?/g,"$1").replace(/[?;]$/g,"")},replaceTimestamp:function(b){var c=new Date;c=c.getTime()+c.getMilliseconds()/1E3;b=this.cleanURL(b);return b+=(b.match(/\?/)?";":"?")+"time="+c},prepareRequestParams:function(b,c){var f={};b=c&&decodeURIComponent(b)||b;1500<b.length||c?(g.each((b.split(/\?/)[1]||"").split(/&|;/),function(h,k){k=k.split("=");"undefined"===typeof k[0]||k[0]in f||(f[k[0]]=k[1])}),b=b.split(/\?/)[0],c="POST"):(b=this.replaceTimestamp(b),c="GET");return{requestURL:b,requestType:c,requestData:f}},redirect:function(b){for(var c in this.PanelManager.panels)this.PanelManager.panels[c].destructor("cleanup");b=b||this.replaceTimestamp(F.location.href);F.location.hash&&(b=this.urlFromHash(b));F.location=b},updateLocation:function(b){this.historyReady=!0;!0===this.updateURL({r:b})&&"search"===this.locationURL&&(this.setCoreParams(),this.EventManager.trigger("hashChange",b))},getMarkedLocation:function(b){return(b=((b||F.location.href).match(this.markLocationMatch)||[""]).pop().match(/(.+):(\d+)-(\d+)/))?[b[0],b[1],parseInt(b[2]),parseInt(b[3])]:null},markLocation:function(b){b&&"string"===typeof b&&(b=this.getMarkedLocation(b));if(b||!1===b)this.updateURL({mr:b&&b[0]}),this.changeCoreParam("mr",b[0]),this.setCoreParams(),this.lastMarkedLocation=this.markedLocation||this.lastMarkedLocation,this.markedLocation=b,this.EventManager.trigger("markLocation",b)},updateURL:function(b,c){var f=c||F.location[this.locationURL];f.match(/\?/)||(f+="?");for(var h in b)if(!1===b[h])f=f.replace(new RegExp(this.hashParamRegex.replace("__PARAM__",h)),"$1");else if(f.match(new RegExp("[#?;&]"+h+"="))){var k=new RegExp(this.hashParamRegex.replace("__PARAM__",h));f=f.match(k)?f.replace(k,"$1$2"+b[h]+"$3"):f.replace(h+"=",h+"="+b[h])}else f+=(f?";":"")+h+"="+b[h];f=f.replace(/([?;]);+/g,"$1").replace(/[?;&]$/,"");if(c)return f;if("hash"===this.locationURL){if(f=f.replace(/^\?/,""),F.location.hash!==f)return F.location.hash=f,!0}else if(F.location.search!==f)return F.history.pushState({},"",f),!0},urlFromHash:function(b,c){var f=(F.location[this.locationURL].replace(/^#/,"?")+";").match(this.locationMatch);f=f?f[1]:this.initialR||"";if(c)return f;var h=f&&"search"===this.locationURL?{r:f}:{};h.r&&g.each(["g","db","mr"],function(k,l){u.coreParams[l]&&(h[l]=u.coreParams[l])});g.each(F.location.hash.replace("#","").split(/[;&]/),function(){var k=this.split("=");2===k.length&&(h[k[0]]=k[1])});return this.updateURL(h,b)},thousandify:function(b){var c=/(\d+)(\d{3})/,f=(b+"").split(".");b=f[0];for(f=1<f.length?"."+f[1]:"";c.test(b);)b=b.replace(c,"$1,$2");return b+f},openMotifWidget:function(b){F.open("/motifWidget.htm?id="+b,"Motif Feature Widget","width=950,height=550")},populateTemplate:function(b,c){for(var f=/\{\{[\.\w]+\}\}/g,h=[],k;null!=(k=f.exec(b));)h.push({str:k[0],index:k.index});f=[];for(var l=h.length-1;0<=l;l--){k=h[l].str.replace(/\{|\}/g,"");try{for(var p,q=c,m=k.split(".");m.length;){var t=m.shift();if(t in q)q=q[t];else throw Error("Missing key '"+t+"'");}p=q}catch(v){throw Error("Ensembl.populateTemplate could not parse '"+k+"': "+v.message);}f.unshift(b.substring(h[l].index+h[l].str.length));f.unshift(p);b=b.substr(0,h[l].index)}f.unshift(b);return f.join("")}});u.Class={};F.Ensembl=u;u.EventLoop={_queue:[],push:function(b){this._queue.push(b);return this},execute:function(b){b&&this.push(b);this._timeout=F.setTimeout(function(){var c=u.EventLoop._queue.shift();c&&(c.method.apply(c.context,c.arguments),u.EventLoop._queue.length&&u.EventLoop.execute())},0);return this},pause:function(){this._timeout&&F.clearTimeout(this._timeout)},clear:function(){this.pause();this._queue=[]}};u.EventManager={registry:{},deferred:{},register:function(b,c,f){var h=c.id;this.registry[b]||(this.registry[b]={},this.registry[b].ref={},this.registry[b].count=0);for(var k in this.getCallIds(h))if(this.registry[b].ref[k]||this.registry[b].count++,this.registry[b].ref[k]={},this.registry[b].ref[k].func=f,this.registry[b].ref[k].obj=c,this.deferred[b])for(h=0;h<this.deferred[b].length;h++)this.triggerSpecific.apply(this,[b,k].concat(this.deferred[b][h]))},unregister:function(b,c){c=c.id;if(this.registry[b]&&this.registry[b].ref[c]){for(var f in this.getCallIds(c))delete this.registry[b].ref[f],this.registry[b].count--;this.deleteTest(b)}},remove:function(b){for(var c in this.registry){if(this.registry[c].ref[b])for(var f in this.getCallIds(b))delete this.registry[c].ref[f],this.registry[c].count--;this.deleteTest(c)}},getCallIds:function(b){var c=b.split(/--/),f={};1<c.length&&c.push(b);g.each(c,function(){f[this]=1});return f},clear:function(b){this.registry[b]&&delete this.registry[b]},deleteTest:function(b){0===this.registry[b].count&&delete this.registry[b]},trigger:function(b){var c=[].slice.call(arguments,1),f={},h=[],k;if(this.registry[b])for(k in this.registry[b].ref){var l=this.registry[b].ref[k].func.apply(this.registry[b].ref[k].obj,c);"undefined"!==typeof l&&(f[k]=l,h.push(k))}1===h.length?f=f[h[0]]:0===h.length&&(f=R);return f},deferTrigger:function(b){var c=[].slice.call(arguments,1);this.deferred[b]||(this.deferred[b]=[]);this.deferred[b].push(c);if(this.registry[b])return this.trigger.apply(this,arguments)},triggerSpecific:function(b,c){var f=[].slice.call(arguments,2);if(this.registry[b]&&this.registry[b].ref[c])return this.registry[b].ref[c].func.apply(this.registry[b].ref[c].obj,f)}};u.LayoutManager=new pa;u.LayoutManager.extend({constructor:null,initialize:function(){this.id="LayoutManager";u.EventManager.register("reloadPage",this,this.reloadPage);u.EventManager.register("validateForms",this,this.validateForms);u.EventManager.register("makeZMenu",this,this.makeZMenu);u.EventManager.register("hashChange",this,this.hashChange);u.EventManager.register("markLocation",this,this.updateMarkedLocation);u.EventManager.register("toggleContent",this,this.toggleContent);u.EventManager.register("changeWidth",this,this.changeWidth);g("#page_nav .tool_buttons > p").show();g("#header a:not(#tabs a)").addClass("constant");F.location.hash.match(u.locationMatch)&&(g(".ajax_load").val(function(b,c){return u.urlFromHash(c)}),this.hashChange(u.urlFromHash(F.location.href,!0)));g(L).find("#static").externalLinks();g(L).on("click",".modal_link",function(){if(u.EventManager.trigger("modalOpen",this))return!1}).on("click",".popup",function(){if(F.name.match(/^popup_/))return!0;F.open(this.href,"_blank","width=950,height=500,resizable,scrollbars");return!1}).on("click",'a[rel="external"]',function(){this.target="_blank"}).on("click","a.update_panel",function(){var b=this.rel,c=u.PanelManager.panels[b];if(c){var f={};g(this).find(".update_url").each(function(){f[this.name]=this.value}).length&&u.updateURL(f);f.update_panel=1;u.EventManager.triggerSpecific("updatePanel",b,u.updateURL(f,c.params.updateURL))}else console.log("Missing panel: "+
b);return!1}).on("submit","form.update_panel",function(b){b=g(this).serializeArray();var c={},f;for(f in b)switch(b[f].name){case"panel_id":var h=b[f].value;break;case"url":var k=b[f].value;break;case"element":var l=b[f].value;break;default:c[b[f].name]=b[f].value}k=u.updateURL(g.extend({update_panel:1},c),k);u.EventManager.triggerSpecific("updatePanel",h,k,l,null,c);return!1}).on({"keyup.ensembl":function(b){27===b.keyCode&&u.EventManager.trigger("modalClose",!0)},"mouseup.ensembl":function(b){b.which&&1!==b.which||u.EventManager.trigger("mouseUp",b)}});g(".modal_link").show();this.validateForms(L);g(F).on({"resize.ensembl":function(b){if(F.name.match(/^popup_/))return!1;b.target.tagName||(b=u.width,u.dynamicWidth&&u.setWidth(R,!0),u.EventManager.trigger("windowResize"),u.dynamicWidth&&u.width!==b&&(u.LayoutManager.changeWidth(),u.EventManager.trigger("imageResize")))},"hashchange.ensembl":g.proxy(this.popState,this),"popstate.ensembl":g.proxy(this.popState,this)});this.showGDPRCookieBanner();this.showTemporaryMessage();this.showMirrorMessage()},reloadPage:function(b,c){if("string"===typeof b)u.EventManager.triggerSpecific("updatePanel",b);else if("object"===typeof b)for(var f in b)u.EventManager.triggerSpecific("updatePanel",f);else return u.redirect(c);g(".session_messages").hide()},validateForms:function(b){g("form._check",b).validate().on("submit",function(){var c=g(this);if(c.parents("#modal_panel").length){for(var f=c.parents(".js_panel").map(function(){return this.id}).toArray(),h;f.length&&"undefined"===typeof h;)h=u.EventManager.triggerSpecific("modalFormSubmit",f.shift(),c);return h}})},makeZMenu:function(b,c){g("#"+b).length||u.Panel.ZMenu.template.clone().attr("id",b).appendTo("body");u.EventManager.trigger("addPanel",b,"ZMenu",R,R,c,"showExistingZMenu")},popState:function(){u.historyReady&&(F.location[u.locationURL].match(u.locationMatch)&&("search"!==u.locationURL||!F.location.hash||F.location.hash.match(u.locationMatch))||!F.location.hash&&u.hash.match(u.locationMatch))&&(u.setCoreParams(),u.EventManager.trigger("hashChange",u.urlFromHash(F.location.href,!0)))},hashChange:function(b){if(b){b=decodeURIComponent(b);var c=b.split(/\W/);c=c[0]+": "+u.thousandify(c[1])+"-"+u.thousandify(c[2]);g("a:not(.constant)").attr("href",function(){if("UCSC"===this.title)this.href=this.href.replace(/(&?position=)[^&]+(.?)/,"$1chr"+u.urlFromHash(this.href,!0)+"$2");else if("NCBI"===this.title){var f=u.urlFromHash(this.href,!0).split(/[:\-]/);this.href=this.href.replace(/(&?CHR=).+&BEG=.+&END=[^&]+(.?)/,"$1"+f[0]+"&BEG="+f[1]+"&END="+f[2]+"$2")}else return u.urlFromHash(this.href)});g("input[name=r]","form:not(#core_params)").val(b);g("h1.summary-heading").html(function(f,h){return h.replace(/^(Chromosome ).+/,"$1"+c)});L.title=L.title.replace(/(Chromosome ).+/,"$1"+c)}},updateMarkedLocation:function(b){g("a:not(.constant):not(._location_mark)").filter(function(){return this.hostname===F.location.hostname&&!!this.href.match(u.locationMatch)}).attr("href",function(){return u.updateURL({mr:b&&b[0]},this.href)})},toggleContent:function(b,c){b&&F.setTimeout(function(){g('a.toggle[rel="'+b+'"]').toggleClass("open closed")},c&&g('a.toggle[rel="'+b+'"]').hasClass("open")?c:0)},changeWidth:function(){var b=g("#modal_panel");g(".navbar, div.info, div.hint, div.warning, div.error").not(".fixed_width").not(function(){return b.find(this).length}).width(u.width);b=null},showMirrorMessage:function(){var b=decodeURIComponent(u.cookie.get("redirected_from_url"));b&&(u.cookie.set("redirected_from_url",""),b=g("<a>").attr("href",b+(b.match(/\?/)?";redirect=no":"?redirect=no")),b.prop("hostname")!=F.location.hostname&&(b.html("Click here to go back to <b>"+b.prop("hostname")+"</b>"),b=g('<div class="redirect-message hidden"><p class="msg">You have been redirected to your nearest mirror. <span class="_redirect_link"></span></p><span class="close">x</span></div>').find("span._redirect_link").append(b).end().appendTo(g("body")).fadeIn(),b.find(".close").on("click",{divs:b},function(c){c.preventDefault();c.data.divs.fadeOut(200)}),b=b=null))},showGDPRCookieBanner:function(){var b=g("#gdpr_cookie_name").val(),c=u.cookie.get(b);u.gdpr_version=g("#gdpr_version").val();u.gdpr_policy_url=g("#gdpr_policy_url").val();u.gdpr_terms_url=g("#gdpr_terms_url").val();return!u.gdpr_version||c&&c===u.gdpr_version?!1:(g(["<div class='cookie-message'><p class='msg'>This website requires cookies, and the limited processing of your personal data in order to function. By using the site you are agreeing to this as outlined in our <a target='_blank' href='",u.gdpr_policy_url,"'>Privacy Policy</a> and <a target='_blank' href='",u.gdpr_terms_url,"'> Terms of Use </a></p><div class='agree-button'><a id='gdpr-agree' class='button no-underline'> I Agree </a></div></div>"].join("")).appendTo(L.body).show().find("#gdpr-agree").on("click",function(f){u.cookie.set(b,u.gdpr_version,"",!0,!0);g(this).addClass("clicked").closest(".cookie-message").delay(1E3).fadeOut(100)}),!0)},showTemporaryMessage:function(){var b=u.cookie.get("tmp_message_ok"),c=g("#tmp_message").remove(),f=c.children("div").text(),h=c.children("input[name=md5]").val(),k=c.children("input[name=colour]").val(),l=parseInt(c.children("input[name=expiry]").val())||24;c=(c.children("input[name=position]").val()||"").split(/\s+/);return!f||b&&b===h?!1:(g(['<div class="tmp-message hidden '+g.makeArray(g.map(g.merge([k],c),function(p){return p?"tm-"+p:null})).join(" ")+'">',"<div>"+f+"</div>","<p><button>Close</button></p></div>"].join("")).appendTo(L.body).show().find("button").on("click",{cookieValue:h,cookieExpiry:(new Date((new Date).getTime()+36E5*l)).toUTCString()},function(p){p.preventDefault();u.cookie.set("tmp_message_ok",p.data.cookieValue,p.data.cookieExpiry);g(this).parents("div").first().fadeOut(200)}),!0)}});u.PanelManager=new pa;u.PanelManager.extend({constructor:null,initialize:function(){function b(){g(".ajax_load").length||u.EventManager.trigger("ajaxComplete")}this.id="PanelManager";this.panels={};this.nextId=1;this.panelNumber=0;this.zIndex=101;u.EventManager.register("createPanel",this,this.createPanel);u.EventManager.register("destroyPanel",this,this.destroyPanel);u.EventManager.register("addPanel",this,this.addPanel);u.EventManager.register("panelToFront",this,this.panelToFront);u.EventManager.register("ajaxLoaded",this,b);this.init(g(".js_panel"));b()},init:function(b){var c=[[],[]];b.each(function(){c[0+!!g(this).find(".ajax").length].push(this)});b=c[1].concat(c[0]);g.each(b,function(){(function(f){setTimeout(function(){var h=g("input.panel_type",f).val(),k={};u.PanelManager.generateId(f);g(f).parents(".js_panel").each(function(){k[u.PanelManager.panels[this.id].panelType]=1});k[h]||u.PanelManager.createPanel(f.id,h)},0)})(this)})},generateId:function(b){b.className.match(/js_panel/)||(b=g(".js_panel",b)[0]);if(b)return b.id||(b.id="ensembl_panel_"+this.nextId++),b.id},getPanels:function(b){var c=[],f=[],h;for(h in this.panels)(!b||this.panels[h]instanceof u.Panel[b])&&c.push("#"+this.panels[h].id);g.each(g(c.join(",")),function(){f.push(u.PanelManager.panels[this.id])});return f},addPanel:function(b,c,f,h,k,l){if(this.panels[b]&&l)u.EventManager.triggerSpecific(l,b,k),this.panelToFront(b);else if(k=k||{},h&&f&&(h.html(f),b=b||this.generateId(h[0])),b){this.createPanel(b,c,k);if(!this.panels[b].el)throw Error("Container div 'el' is missing for panel "+b+" ("+c+"). Perhaps panel.init is not called properly.");this.init(g(".js_panel",this.panels[b].el))}},createPanel:function(b,c,f){this.panels[b]&&this.destroyPanel(b,"cleanup");this.panels[b]=c?new u.Panel[c](b,f):new u.Panel(b,f);this.panels[b].panelNumber=this.panelNumber++;this.panels[b].panelType=c;this.panels[b].init();return this.panels[b]},destroyPanel:function(b,c){this.panels[b]!==R&&(this.panels[b].destructor(c),delete this.panels[b],u.EventManager.remove(b))},panelToFront:function(b){this.panels[b]!==R&&(this.panels[b].el.css("zIndex",++this.zIndex),1E6<this.zIndex&&this.resetZIndex())},resetZIndex:function(){function b(h,k){return h.index-k.index}var c=[],f;this.zIndex=101;for(f in this.panels)c.push({id:f,index:this.panels[f].el.css("zIndex")});for(f in c.sort(b))this.panels[c[f].id].el.css("zIndex",++this.zIndex)}});u.Panel=pa.extend({constructor:function(b,c){"undefined"!==typeof b&&(this.id=b);this.params="undefined"===typeof c?{}:c;this.initialised=!1},destructor:function(b){var c;"empty"===b?this.el.empty().off():"cleanup"!==b&&this.el.remove();for(c in this.elLk)this.elLk[c]=null;this.el=null},init:function(){var b=this;if(this.initialised)return!1;this.el=g("#"+this.id);if(!this.el.length)throw Error("Could not find "+this.id+", perhaps DOM is not ready");this.elLk={};g("input.js_param",this.el).each(function(){b.params[this.name]||(b.params[this.name]=g(this).hasClass("json")?JSON.parse(this.value):this.value)});this.initialised=!0},hide:function(){this.el.hide()},show:function(){this.el.show()},height:function(b){return this.el.height(b)},width:function(b){return this.el.width(b)}});u.DataTable={dataTableInit:function(){var b=this;this.elLk.dataTable.each(function(){for(var c in g.fn.dataTableSettings)if(g.fn.dataTableSettings[c].nTable===this)return;c=g(this);var f=c.hasClass("no_col_toggle"),h=c.hasClass("exportable"),k=b.getOptions(c,f,h);g.fn.dataTableExt.oStdClasses.sWrapper=c.hasClass("toggle_table")?"toggleable toggleTable_wrapper":"dataTables_wrapper";k=c.dataTable(k);var l=k.fnSettings(),p=g(".dataTables_filter input",l.nTableWrapper),q=p.after('<div class="overlay">Filter</div>').on({focus:function(){g(this).siblings(".overlay").hide()},blur:function(){this.value||g(this).siblings(".overlay").show()}});p.val()&&p.val().length&&q.siblings(".overlay").hide();f||b.columnToggle(l);h&&b.makeExportable(l.nTableWrapper);c.hasClass("editable")&&b.makeEditable(c);b.dataTables=b.dataTables||[];b.dataTables.push(k);c=k=null});this.elLk.colToggle=g(".col_toggle",this.el);this.tableFilters()},getOptions:function(b,c,f){var h=this,k=g("tbody tr",b).length,l=b.hasClass("no_sort"),p=[[],[]],q={sPaginationType:"full_numbers",aaSorting:[],aoColumnDefs:[],asStripClasses:["bg1","bg2"],iDisplayLength:-1,bAutoWidth:!1,oLanguage:{sSearch:"",oPaginate:{sFirst:"&lt;&lt;",sPrevious:"&lt;",sNext:"&gt;",sLast:"&gt;&gt;"}},fnInitComplete:function(m){var t=this.is(":hidden"),v=this.closest(".toggleTable_wrapper, .dataTables_wrapper"),w="none"===this.css("display");"100%"!==this[0].style.width&&(t&&this.show(),v.width(this.outerWidth()));t&&w&&(v.hide(),this.removeClass("hide"));h.makeHeaderSticky(m&&m.oInstance&&m.oInstance[0])},fnDrawCallback:function(m){this.togglewrap("redo");g(".dataTables_info, .dataTables_paginate, .dataTables_bottom",m.nTableWrapper)[-1===m._iDisplayLength?"hide":"show"]();var t=this.data(),v=m.aoColumns.reduce(function(B,D,E){return D.bVisible?B:B.concat(E)},[]).join(","),w=g.map(m.aaSorting,function(B){return'"'+B.join(" ")+'"'}).join(",");if(!0!==m._bInitComplete)this.data({hiddenCols:v,sorting:w});else{this.fnSettings().oInit.fnInitComplete.call(this);this.data("export",!1);for(var z=0;z<m.aoOpenRows.length;z++)m.aoOpenRows[z].nTr.className=m.aoOpenRows[z].nParent.className;if(t.hiddenCols!==v||t.sorting!==w)this.data({hiddenCols:v,sorting:w}),g.ajax({url:"/Ajax/data_table_config",data:{id:this.data("code"),sorting:w,hidden_columns:v}});u.EventManager.trigger("dataTableRedraw")}}};q.aoColumns=g("thead th",b).map(function(){var m=this.className.match(/\s*sort_(\w+)\s*/),t={};m=m?m[1]:"string";l||"none"===m?t.bSortable=!1:t.sType=g.fn.dataTableExt.oSort[m+"-asc"]?m:"string";return t}).toArray();10<k?(q.sDom='<"dataTables_top"l'+(c?"":'<"col_toggle">')+(f?'<"dataTables_export">':"")+'f<"invisible">>t<"dataTables_bottom"ip<"invisible">>',g.each([10,25,50,100],function(){this<k&&(p[0].push(this),p[1].push(this))}),p[0].push(-1),p[1].push("All")):q.sDom='<"dataTables_top"'+(c?"":'<"col_toggle left">')+(f?'<"dataTables_export">':"")+'<"dataTables_filter_overlay">f<"invisible">>t';q.aLengthMenu=p;g("input",b.siblings("div.data_table_config")).each(function(){if("code"===this.name)b.data("code",this.value);else{var m=JSON.parse(this.value.replace(/'/g,'"'));"hiddenColumns"===this.name?g.each(m,function(){q.aoColumns[this]&&(q.aoColumns[this].bVisible=!1)}):0!==this.name.indexOf("expopts")&&("object"===typeof q[this.name]?g.extend(!0,q[this.name],m):q[this.name]=m)}});q.defaultHiddenColumns&&(b.data("defaultHiddenColumns",q.defaultHiddenColumns),delete q.defaultHiddenColumns);b=null;return q},buttonText:function(b){var c=b.aoColumns,f=0;g.each(c,function(h){c[h].bVisible||f++});b="";f&&(b=" ("+f+" hidden)");return"Show/hide columns"+b},columnToggle:function(b){var c=this,f=b.aoColumns,h=g('<ul class="floating_popup"></ul>'),k=g('<div class="toggle">'+c.buttonText(b)+"</div>").append(h).on("click",function(l){l.target===this&&(h.toggle(),h.is(":hidden")&&(k.remove(),c.columnToggle(b)))});g.each(f,function(l){var p=g(this.nTh),q=g(p).clone().find(".hidden").remove().end().html();g("<li>",{html:'<input data-role="none" type="checkbox"'+(p.hasClass("no_hide")?" disabled":"")+(f[l].bVisible?" checked":"")+" /><span>"+q+"</span>",click:function(){var m=g("input",this);if(!m.prop("disabled")){var t=g.grep(c.dataTables,function(B){return!B.is(".no_col_toggle")});var v=!f[l].bVisible;if(1===c.elLk.colToggle.length)m.prop("checked",v);else{var w=g(this).index();var z=g(this).parent().text();t=[];c.elLk.colToggle.each(function(B){g(this).find("ul").text()===z&&(g("input",this).get(w).checked=v,t.push(c.dataTables[B]))})}g.each(t,function(){this.fnSetColumnVis(l,v)})}m=null}}).appendTo(h);p=null});g(".col_toggle",b.nTableWrapper).append(k)},makeExportable:function(b){function c(){g(this).children().toggle();u.browser.ie67&&g(this).siblings(".dataTables_filter").toggle()}g(".dataTables_top .dataTables_export",b).append('<div class="floating_popup"><a>Download what you see</a><a class="all">Download whole table</a></div>').hover(c,c).on("click",function(f){var h=g(this).parent().next(),k=h.dataTable().fnSettings(),l=g(k.nTableWrapper).siblings("form.data_table_export");if("all"===f.target.className){if(!h.data("exportAll")){var p=[[]];var q=[];g.each(k.aoColumns,function(m,t){if(g(t.nTh).hasClass("_no_export"))q.push(m);else{m=g("<div/>");m.append(t.sTitle);var v=g(".hidden:not(.export)",g(m));v.length?p[0].push(g.trim(g(m).find(v).remove().end().html())):p[0].push(t.sTitle)}});g.each(k.aoData,function(m,t){var v=[];g(t._aData).each(function(w,z){var B=g("<div/>");B.append(z);-1==g.inArray(w,q)&&(w=g(".hidden:not(.export), ._no_export",g(B)),w.length?v.push(g.trim(g(B).find(w).remove().end().html())):v.push(z))});p.push(v)});h.data("exportAll",p);l.find("input.data").val(JSON.stringify(p))}}else h.data("export")||(f=h.clone(),p=[],g(f).find(".hidden:not(.export), ._no_export").remove(),g("tr",f).each(function(m){p[m]=[];g(this.cells).each(function(){p[m].push(g(this).html())})}),h.data("export",p),l.find("input.data").val(JSON.stringify(p)));l.trigger("submit");h=l=null});b=null},makeEditable:function(b){function c(h){if(h.is(":hidden"))return h=null,!1;var k=h.parents("td"),l=h.hide().val().replace(/<[^>]+>/g,""),p=h.attr("name");h.siblings().show();h.data("oldVal")!==l&&(h.data("oldVal",l),h.parent().find(".val").html(l.replace(/\n/g,"<br />")),h.parents("table").dataTable().fnUpdate(k.html(),k.parent()[0],k.index()),"function"===typeof f.saveEdit?f.saveEdit(p,l,k):g.ajax({url:k.find("a.save").attr("href"),data:{param:p,value:l},success:function(q){"reload"===q&&(f instanceof u.Panel.ModalContent?f.el.append('<div class="modal_reload"></div>'):u.EventManager.trigger("queuePageReload","",!1,!1))}}));h=k=null}var f=this;b.on("click",".editable",function(h){g(h.target).is(".val")&&g(this).find(":input").val(g(this).find(".val").html().replace(/\n/g,"").replace(/<br( \/)?>/g,"\n").replace(/<[^>]+>/g,"")).show().trigger("focus").siblings().hide()}).on({blur:function(){c(g(this))},keydown:function(h){if(13===h.keyCode&&!h.shiftKey)return!1},keyup:function(h){13!==h.keyCode||h.shiftKey||c(g(this))}},".editable :input");b=null},tableFilters:function(){var b=this,c=g("input.table_filter",this.el);c.length&&(g.fn.dataTableExt.afnFiltering.push(function(f,h,k){if(f.classFilter){h=f.classFilter.length;for(k=" "+f.aoData[k].nTr.className+" ";h--;)if(-1!==k.indexOf(f.classFilter[h]))return!0;return!1}return!0}),c.on("click",function(){var f=[],h=g("#"+this.name,b.el).dataTable(),k=h.fnSettings();if(this.checked)if("all"===this.value)g("input.table_filter[name="+this.name+
"]",b.el).not("[value=all]",b.el).prop("checked",!1);else{!0===g("input.table_filter[name="+this.name+"][value=all]",b.el).prop("checked")&&g("input.table_filter[name="+this.name+"][value=all]",b.el).prop("checked",!1);var l=g("input.table_filter[name="+this.name+"]",b.el).length;g("input.table_filter[name="+this.name+"]:checked",b.el).length>=l-1&&(g("input.table_filter[name="+this.name+"]:checked",b.el).prop("checked",!1),g("input.table_filter[name="+this.name+"][value=all]",b.el).prop("checked",!0))}else 0===g("input.table_filter[name="+this.name+"]:checked",b.el).length&&g("input.table_filter[name="+this.name+"][value=all]",b.el).prop("checked",!0);g("input.table_filter[name="+this.name+"]",b.el).each(function(){this.checked&&f.push(" "+this.value+" ")});f.length?k.classFilter=f:delete k.classFilter;h.fnFilter(g(".dataTables_filter input",k.nTableWrapper).val());h=null;u.EventManager.trigger("dataTableFilterUpdated",f)}),c=null)},makeHeaderSticky:function(b){b&&!this.headerIsSticky&&b.offsetHeight>F.innerHeight&&(new ua(b),this.headerIsSticky=!0)}};ua.prototype.constructor=ua;ua.prototype.observeBody=function(){F.addEventListener("scroll",function(){F.requestAnimationFrame(function(){this.shouldStickHead()?this.stickHead():this.unstickHead()}.bind(this))}.bind(this))};ua.prototype.handleWindowResize=function(){F.addEventListener("resize",function(){F.requestAnimationFrame(function(){this.shouldStickHead()?(this.unstickHead(),this.stickHead()):this.unstickHead()}.bind(this))}.bind(this))};ua.prototype.shouldStickHead=function(){var b=this.tableBody.getBoundingClientRect(),c=b.bottom;return 0>b.top&&0<c-this.tableHead.offsetHeight};ua.prototype.buildStickyHeaderContainer=function(){var b=L.createElement("div"),c=this.getDimensionsForStickyHeaderContainer();b.style.position="fixed";b.style.top="0";b.style.left=c.left;b.style.width=c.width;b.style.overflow="hidden";return b};ua.prototype.getDimensionsForStickyHeaderContainer=function(){var b=g(this.table).parents("div").filter(function(k,l){return"auto"===F.getComputedStyle(l).getPropertyValue("overflow-x")})[0],c=b&&b.getBoundingClientRect(),f=this.table.getBoundingClientRect(),h=c&&c.width<f.width;h&&(this.scrollableWrapper=b);b=h?c:f;return{left:b.left+"px",width:b.width+"px"}};ua.prototype.stickHead=function(){if(!this.isHeaderStuck){this.tweenTableHead=this.tableHead.cloneNode(!0);var b=this.tableHead.offsetWidth;this.table.insertBefore(this.tweenTableHead,this.tableHead);this.container=this.container||this.buildStickyHeaderContainer();this.tableHead.style.width=b+"px";this.tableHead.style.display="table";this.tableHead.querySelector("tr").style.whiteSpace="nowrap";this.tableHead.querySelector("tr").style.display="table";this.tableHead.querySelector("tr").style.width="100%";this.table.removeChild(this.tableHead);this.table.insertBefore(this.container,this.tableBody);this.container.appendChild(this.tableHead);this.setColumnWidths();this.handleTableScroll();this.isHeaderStuck=!0}};ua.prototype.handleTableScroll=function(){this.scrollableWrapper&&(this.syncHeadScroll(),this.scrollableWrapper.addEventListener("scroll",this.scrollHandler))};ua.prototype.syncHeadScroll=function(){this.container.scrollLeft=this.table.parentElement.scrollLeft};ua.prototype.setColumnWidths=function(){var b=Array.prototype.slice.call(this.tableHead.querySelectorAll("th")),c=Array.prototype.slice.call(this.tweenTableHead.querySelectorAll("th"));b.every(function(f){return!f.style.width})&&(b.forEach(function(f,h){var k=c[h];h=k.offsetWidth;k=F.getComputedStyle(k);f.style.boxSizing="border-box";f.style.display="inline-block";f.style.width=h+"px";f.style.whiteSpace="nowrap"===k.getPropertyValue("white-space")?"nowrap":"normal"}),this.areColumnWidthsSet=!0)};ua.prototype.unsetColumnWidths=function(){this.areColumnWidthsSet&&(Array.prototype.slice.call(this.tableHead.querySelectorAll("th")).forEach(function(b){b.style.removeProperty("box-sizing");b.style.removeProperty("display");b.style.removeProperty("width")}),this.areColumnWidthsSet=!1)};ua.prototype.unstickHead=function(){this.isHeaderStuck&&(this.table.removeChild(this.tweenTableHead),this.table.insertBefore(this.tableHead,this.tableBody),this.tableHead.style.removeProperty("width"),this.tableHead.style.removeProperty("display"),this.tableHead.querySelector("tr").style.removeProperty("display"),this.unsetColumnWidths(),this.table.removeChild(this.container),this.container=null,this.isHeaderStuck=!1,this.table.parentElement.removeEventListener("scroll",this.scrollHandler))};u.Share={shareInit:function(b){var c=this;this.shareOptions=g.extend({species:{},type:"page",positionPopup:function(f,h){return f.css({top:g(h).offset().top+1,left:this.el.outerWidth(!0)})}},b);this.elLk.shareLink=g("a.share",this.el).on("click",function(){c.elLk.share?c.elLk.share.data("loading")||c.shareOptions.positionPopup.call(c,c.elLk.share,this).toggle():(c.elLk.share=g('<div class="share_page info_popup"><span class="close"></span></div>').appendTo("body").css("left",c.el.offset().left).data("loading",!0),c.elLk.shareSpinner=g('<div class="spinner"></div>').appendTo(c.elLk.share),c.share(this.href,this),c.elLk.share.on("click",".close, .cancel",function(){c.elLk.share.hide()}).on("click",".url",function(){g(this).select()}),c.elLk.shareLink.data("popup",c.elLk.share));return!1})},share:function(b,c){var f=this;this.elLk.share&&(this.shareOptions.positionPopup.call(this,this.elLk.share,c),this.shareTimeout=setTimeout(function(){f.elLk.share.add(f.elLk.shareSpinner).show()},200),!1===this.shareEnabled?this.shareWaiting=!0:g.ajax({url:b,dataType:"json",data:{species:JSON.stringify(this.shareOptions.species),hash:F.location.hash.replace("#","")},success:function(h){clearTimeout(f.shareTimeout);f.elLk.shareSpinner.hide();h.url?(h.url=g("<a>").attr("href",h.url).prop("href"),g(".url",f.elLk.share).val(h.url).add(".copy",f.elLk.share).show().length||(f.elLk.share.find(".fbutton").addClass("bottom-margin"),f.elLk.shareSpinner.before('<p class="copy">Copy this link:</p><input class="url" type="text" value="'+h.url+'" />'))):h.confirmShare&&(f.elLk.shareSpinner.before("<p>This "+f.shareOptions.type+" is displaying some custom tracks.<br />Select which of these you'd like to share:</p><ul>"+
g.map(h.confirmShare,function(k){return"<li><label>"+k[0]+'</label><input class="file" type="checkbox" value="'+k[1]+'" /></li>'}).join("")+'</ul><input type="button" class="go fbutton" value="Accept" /><input type="button" class="cancel fbutton" value="Cancel" />'),g(".go",f.elLk.share).on("click",function(){g(".url",f.elLk.share).add(".copy",f.elLk.share).hide();f.elLk.shareSpinner.show();f.share(b+";custom_data="+(g(".file",f.elLk.share).map(function(){return this.checked?this.value:R}).toArray().join(",")||"none"),c)}));f.elLk.share.show().removeData("loading")},error:function(){f.elLk.share.remove();delete f.elLk.share}}))},removeShare:function(){this.elLk.share&&(this.elLk.share.remove(),delete this.elLk.share)}};u.Panel.CloudMultiSelector=u.Panel.extend({constructor:function(b,c){this.base(b);this.urlParam=c.urlParam;this.params=c;this.userInteraction="";this.selection=[];u.EventManager.register("updateConfiguration",this,this.updateSelection)},set_selection:function(){var b=this;b.orig?(b.changed_on=[],b.changed_off=[],g(".cloud_multi_selector_list li",b.elLk.content).each(function(c){c=g(this).data("key");var f="on";g(this).hasClass("off")&&(f="off");g(this).hasClass("partial")&&(f="partial");f!=b.orig[c]&&("on"==f?b.changed_on.push(c):b.changed_off.push(c))}),b.changed=b.changed_on.length||b.changed_off.length):(b.orig={},g(".cloud_multi_selector_list li",b.elLk.content).each(function(c){c="on";g(this).hasClass("off")&&(c="off");g(this).hasClass("partial")&&(c="partial");b.orig[g(this).data("key")]=c}),b.changed=!1)},reset_selection:function(){delete this.orig_selection;this.set_selection()},init:function(){var b=this;this.base();this.elLk.content=g(".modal_wrapper",this.el);this.elLk.list=g(".cloud_multi_selector_list li",this.elLk.content);this.elLk.filter=g(".cloud_filter input",this.el);this.elLk.clear=g(".cloud_filter_clear",this.el);this.elLk.all=g(".all",this.el);this.elLk.none=g(".none",this.el);b.set_selection();g(b.el).on("filter",function(c,f){b.elLk.list.each(function(){var h=g(this);0==h.text().toLowerCase().indexOf(f.toLowerCase())?h.removeClass("hidden"):h.addClass("hidden")});f?b.elLk.clear.show():b.elLk.clear.hide();b.elLk.filter.focus()});this.elLk.list.click(function(){b.userInteraction="partial";g(this).hasClass("partial")?g(this).removeClass("partial"):g(this).toggleClass("off");b.set_selection();b.elLk.filter.focus();return!1});this.elLk.all.click(function(){b.userInteraction="all-on";b.elLk.list.removeClass("off");b.set_selection();return!1});this.elLk.none.click(function(){b.userInteraction="all-off";b.elLk.list.addClass("off");b.set_selection();return!1});this.set_selection();this.val="";b.elLk.filter.val("");b.elLk.clear.hide();this.elLk.filter.on({"keydown paste keyup mouseup blur":function(c){c=b.elLk.filter.val();b.val!=c&&(g(b.el).trigger("filter",[c]),b.val=c)}}).focus();g(this.el).click(function(){b.elLk.filter.focus()});b.elLk.clear.click(function(){b.val="";b.elLk.filter.val("");g(b.el).trigger("filter",[""])})}});u.Panel.Content=u.Panel.extend({init:function(){this.base();this.xhr=!1;var b={ajaxLoad:g(".ajax",this.el),hideHints:g(".hint",this.el),helpTips:g("._ht",this.el),zMenuLink:g("._zmenu",this.el),wrapping:g("table.cellwrap_inside, table.heightwrap_inside",this.el),selectToToggle:g("._stt",this.el),selectAll:g("input._selectall",this.el),filterable:g("._fd",this.el),speciesDropdown:g("._sdd",this.el),toggleButtons:g(".tool_buttons a.togglebutton",this.el),dataTable:g("table.data_table",this.el),redirectForm:g("form._redirect",this.el),newTable:g(".new_table",this.el)};this.el.hasClass("ajax")&&g.extend(b.ajaxLoad,this.el);g.extend(this.elLk,b);this.toggleable();g(this).afterimage();this.el.on("click","a._motif",function(f){f.preventDefault();u.openMotifWidget(g(this).html())});for(var c in b)if(b[c].length)this[c]();u.EventManager.register("updatePanel",this,this.getContent);this.el.parent(".initial_panel")[0]===u.initialPanels.get(-1)&&u.EventManager.register("hashChange",this,this.hashChange);u.EventManager.trigger("validateForms",this.el);u.EventManager.deferTrigger("relocateTools",this.el.find(".other_tool"));if(F.name.match(/^popup_/))g("a:not(.cp-internal, .popup)",this.el).on("click",function(){F.open(this.href,F.name.replace(/^popup_/,"")+"_1");return!1});this.el.externalLinks()},ajaxLoad:function(){var b=this;g(".navbar",this.el).width(u.width);if(g.find(".js_panel .error.fatal").length)return!1;this.elLk.ajaxLoad.each(function(){var c=g(this),f=c.find("input.ajax_load").val(),h={};f&&(f=f.match(/\?/)?u.replaceTimestamp(f):f+"?",c.find("input.ajax_post").each(function(k,l){h[l.name]=l.value}),b.getContent(f,g(this),{updateURL:f+";update_panel=1",updateType:g.isEmptyObject(h)?"get":"post",updateData:h}))})},getContent:function(b,c,f,h,k){k=k||{};var l=k.background||0;"string"===typeof c?(c=g(c,this.el),l||c.empty()):g(".js_panel",c||this.el).each(function(){u.EventManager.trigger("destroyPanel",this.id)});f=f||this.params;b=b||u.replaceTimestamp(f.updateURL);c=c||this.el;l||c.empty();switch(c[0].nodeName){case"DL":var p="dt";break;case"UL":case"OL":p="li";break;default:p="p"}l||c.append("<"+p+' class="spinner ajax_pending">Loading component</'+p+">");!0===h?F.location.hash=c[0].id:h&&u.updateURL(h);var q=f.updateData||("object"===typeof h?h:{})||{};"post"===f.updateType&&g.each((b.split(/\?/)[1]||"").split(/&|;/),function(m,t){t=t.split("=");"undefined"===typeof t[0]||t[0]in q||(q[t[0]]=t[1])});this.xhr=g[k.paced?"paced_ajax":"ajax"]({url:b,data:q,dataType:"html",context:this,type:f.updateType,success:function(m){l&&c.empty();m?(u.EventManager.trigger("addPanel",R,g((m.match(/<input[^<]*class="[^<]*panel_type[^<]*"[^<]*>/)||[])[0]).val()||"Content",m,c,f),!0===h&&(F.location.hash="_",F.location.hash=c[0].id)):c.html("");u.EventManager.trigger("ajaxLoaded")},error:function(m){0!==m.status&&c.html('<div class="error ajax_error"><h3>Ajax error</h3><div class="error-pad"><p>Sorry, the page request "'+b+'" failed to load.</p></div></div>')},complete:function(){c=null;this.xhr=!1}})},addContent:function(b,c){var f=g('<div class="js_panel">').appendTo(this.el),h=1;for(c?f.addClass(c):c="anchor";L.getElementById(c);)c+=h++;f.attr("id",c+"Panel");this.getContent(b,f,this.params,!0);return f},toggleable:function(){var b=this,c={};g("a.toggle, .ajax_add",this.el).on("click",function(f){f.preventDefault();f=f.which&&g(this).hasClass("_slide_toggle")?parseInt((this.className.match(/_slide_toggle_(\d+)/)||[300]).pop()):R;if(g(this).hasClass("ajax_add")){var h=g("input.url",this).val();h&&(b.elLk[this.rel]?(b.toggleContent(g(this),f),F.location.hash=b.elLk[this.rel][0].id):b.elLk[this.rel]=b.addContent(h,this.rel))}else b.toggleContent(g(this),f),b.elLk[this.rel]&&g(this).hasClass("closed")?b.elLk[this.rel][0].id&&(F.location.hash=b.elLk[this.rel][0].id):history.replaceState("",L.title,F.location.pathname+F.location.search);u.EventManager.trigger("toggleContent",this.rel,f);return!1}).filter("[rel]").each(function(){var f=u.cookie.get("toggle_"+this.rel);if(g(this).hasClass("closed")){var h="[#?;&]"+this.rel+"(Panel)?[&;]*";if("open"===f||u.hash.match(new RegExp(h)))c[this.rel]=this}else g(this).hasClass("open")&&"closed"===f&&(c[this.rel]=this)});g.each(c,function(){g(this).trigger("click")})},toggleContent:function(b,c){var f=b.attr("rel"),h=c?"slideToggle":"toggle",k=b.html();if(f){if(this.id===f+"Panel")this.el.find(".toggleable")[h](c);else if(this.elLk[f]||(this.elLk[f]=g("."+f,this.el)),!this.elLk[f].find(".toggleable:first").addBack(".toggleable")[h](c).length)b.siblings(".toggleable")[h](c);k.match(/Show/)&&b.hasClass("toggle_link")?b.html("Hide"):k.match(/Hide/)&&b.hasClass("toggle_link")&&b.html("Show");b.hasClass("set_cookie")&&u.cookie.set("toggle_"+f,b.hasClass("open")?"closed":"open")}else b.toggleClass("open closed").siblings(".toggleable")[h](c)},hashChange:function(){this.params.updateURL=u.urlFromHash(this.params.updateURL);this.xhr&&(this.xhr.abort(),this.xhr=!1);this.getContent(u.replaceTimestamp(this.params.updateURL+";hash_change="+u.lastR))},hideHints:function(){this.elLk.hideHints.each(function(){var b=g(this);g('<img src="/i/close.png" alt="Hide" title="" />').on("click",function(){var c=[];b.hide();u.hideHints[b[0].id]=1;for(var f in u.hideHints)c.push(f);u.cookie.set("ENSEMBL_HINTS",c.join(":"))}).prependTo(this.firstChild).helptip({content:"Hide this panel"})})},dataTable:function(){g.extend(this,u.DataTable);this.dataTableInit()},helpTips:function(){this.elLk.helpTips.helptip()},zMenuLink:function(){this.elLk.zMenuLink.zMenuLink()},wrapping:function(){this.elLk.wrapping.togglewrap()},selectToToggle:function(){this.elLk.selectToToggle.selectToToggle({},this.el)},selectAll:function(){this.elLk.selectAll.on("change",function(){g(this).parents("div._selectall").find("input[type=checkbox]").prop("checked",this.checked)})},filterable:function(){this.elLk.filterable.filterableDropdown()},speciesDropdown:function(){this.elLk.speciesDropdown.speciesDropdown()},toggleButtons:function(){this.elLk.toggleButtons.toggleButtons()},redirectForm:function(){this.elLk.redirectForm.on("submit",function(){this.action=g(this).find("select[name=url]").val()})},newTable:function(){this.elLk.newTable.newTable()}});u.Panel.LocalContext=u.Panel.extend({init:function(){var b=this;this.base();g.extend(this,u.Share);this.shareInit();u.EventManager.register("removeShare",this,this.removeShare);u.EventManager.register("hashChange",this,this.removeShare);u.EventManager.register("reloadPage",this,this.removeShare);u.EventManager.register("ajaxComplete",this,this.shareReady);u.EventManager.register("share",this,this.share);this.el.hasClass("modal_nav")||(u.EventManager.register("relocateTools",this,this.relocateTools),this.pulseToolButton());this.elLk.links=g("ul.local_context li",this.el);g("img.toggle",this.elLk.links).on("click",function(){var c=g(this).parent();c.toggleClass("closed");var f=c.hasClass("closed")?"closed":"open",h=(b instanceof u.Panel.ModalContent?b.params.url:F.location.pathname).replace(u.speciesPath+"/","").split("/")[0];g(this).attr("src",function(k,l){return l.replace(/closed|open/,f)});g.ajax({url:"/Ajax/nav_config",data:{code:h,menu:this.className.replace(/toggle|\s/g,""),state:"closed"===f^c.hasClass("default_closed")?1:0}});c=null;return!1});this.el.find("._ht").helptip()},relocateTools:function(b){var c=this.el.find(".tool_buttons");b.each(function(){var f=g(this).find("a")[0],h=f?g(".additional ."+f.className.replace(" ","."),c):[];h.length?h.replaceWith(f):g(this).children().addClass("additional").appendTo(c).not(".hidden").show()}).remove();this.pulseToolButton();b=null},pulseToolButton:function(){g(".tool_buttons a.pulse:not(.pulsing)",this.el).one("click",function(){clearInterval(g(this).stop().removeClass("pulse").css({backgroundColor:"",color:""}).data("interval"))}).addClass("pulsing").each(function(){var b=g(this).data({dark:!1,interval:setInterval(function(){var c=b.data();b.toggleClass("pulse",!c.dark,1E3);c.dark=!c.dark},1E3)})})},shareReady:function(){var b=this;this.shareOptions.species={};g.each(u.PanelManager.getPanels("ImageMap"),function(){b.shareOptions.species[this.id]=this.getSpecies()});0<this.elLk.shareLink.length&&this.elLk.shareLink[0].href&&u.EventManager.deferTrigger("share",this.elLk.shareLink[0].href,this.elLk.shareLink[0]);u.EventManager.unregister("ajaxLoaded",this)}});u.Panel.LocationNav=u.Panel.extend({constructor:function(b,c){this.base(b,c);this.geneCache={};this.geneIDCache={};this.sliderConfig=!1;this.extraParams={};this.refreshOnly=!0;this.alignmentPage=!1;u.EventManager.register("hashChange",this,this.getContent);u.EventManager.register("changeWidth",this,this.resize);u.EventManager.register("imageResize",this,this.resize);F.location.pathname.match(/\/Multi/)&&(this.extraParams={realign:1},this.refreshOnly=!1)},currentLocations:function(){var b={},c=new RegExp(/^([^:]*):([^-]*)-([^:]*)(:.*)?/);g.each(F.location.search.replace(/^\?/,"").split(/[;&]/),function(f,h){f=h.split("=");f[0].match(/^r[0-9]*$/)&&(h=decodeURIComponent(f[1]).match(c),b[f[0]]=[h[1],parseInt(h[2]),parseInt(h[3]),h[4]||""])});return b},newHref:function(b,c){var f=F.location.href.split("?"),h=[];c=c||{};g.each(f[1].split(/[;&]/),function(l,p){l=p.split("=");l[0].match(/^r[0-9]*$/)&&b[l[0]]?h.push(l[0]+"="+b[l[0]][0]+":"+b[l[0]][1]+
"-"+b[l[0]][2]+(b[l[0]][3]||"")):l[0]in c?(h.push(l[0]+"="+c[l[0]]),delete c[l[0]]):h.push(l[0]+"="+decodeURIComponent(l[1]))});for(var k in c)h.push(k+"="+c[k]);for(k in this.extraParams)h.push(k+"="+this.extraParams[k]);return f[0]+"?"+h.sort(function(l,p){return l.split("=")[0]>p.split("=")[0]}).join(";")},arrowHref:function(b){var c=this,f=this.currentLocations();g.each(f,function(h,k){k[1]+=b;k[2]+=b;"r"==h&&(k[1]>c.sliderConfig.length&&(k[1]=c.sliderConfig.length-c.sliderConfig.min),k[2]>c.sliderConfig.length&&(k[2]=c.sliderConfig.length),1>k[1]&&(k[1]=1),1>k[2]&&(k[2]=c.sliderConfig.min))});return this.newHref(f)},zoomHref:function(b){var c=this.currentLocations();c=this.rescale(c,(c.r[2]-c.r[1])*b);1<b&&g.each(c,function(f,h){h[1]==h[2]&&h[2]++});return this.newHref(c)},rescale:function(b,c){var f=this;c=Math.round(c);var h={};g.each(b,function(k,l){var p=Math.max(Math.round((Math.round(l[1]+l[2])-c)/2),1),q=p+c+1;"r"==k&&(p=Math.max(Math.min(p,f.sliderConfig.length-f.sliderConfig.min),1),q=Math.min(q,f.sliderConfig.length));h[k]=[l[0],p,q,l[3]]});return h},updateButtons:function(b){b=Math.round("undefined"===typeof b?this._val2pos():b);var c=this.currentLocations(),f=c.r[2]-c.r[1]+1;this.elLk.left1.attr("href",this.arrowHref(-f));this.elLk.left2.attr("href",this.arrowHref(-1E6));this.elLk.right1.attr("href",this.arrowHref(f));this.elLk.right2.attr("href",this.arrowHref(1E6));this.elLk.zoomIn.attr("href",this.zoomHref(.5)).toggleClass("disabled",0===b).helptip(0===b?"disable":"enable");this.elLk.zoomOut.attr("href",this.zoomHref(2)).toggleClass("disabled",100===b).helptip(100===b?"disable":"enable");this.elLk.regionInput.val(c.r[0]+":"+c.r[1]+"-"+c.r[2])},init:function(){this.base();this.elLk.navbar=this.el.find(".navbar");this.elLk.imageNav=this.elLk.navbar.find(".image_nav");this.elLk.forms=this.elLk.navbar.find("form");this.elLk.navLinks=this.elLk.imageNav.find("a");this.alignmentPage=!!this.elLk.forms.first().closest(".alignment_select").length;this.initNavForms();this.initNavLinks();this.initSlider();this.resize()},initNavForms:function(){var b=this;this.elLk.regionInput=this.elLk.forms.find("input[name=r]");this.elLk.geneInput=this.elLk.forms.find("input[name=q]");this.elLk.forms.on("submit",function(c){c.preventDefault();c={};if(b.alignmentPage)return u.redirect(b.newHref([],function(k){var l={};g.each(k.serializeArray(),function(p,q){l[q.name]=q.value});return l}(g(this))));if(this.className.match(/_nav_gene/)){var f=function(k,l,p){l?(k.elLk.geneInput.autocomplete("close").val(l.label||l.g),k.updateURL({g:l.g,db:l.db,r:l.r})):alert("No gene found for '"+p+"'")};var h=this.q.value.trim().toUpperCase();3>h.length?alert("Please type in at least 3 characters to get a list of matching genes"):(c=(b.geneCache[h.substr(0,3)]||{})[h]||b.geneIDCache[h])?f(b,c,h):g.ajax({url:u.speciesPath+"/Ajax/autocomplete_geneid",cache:!0,data:{q:h},dataType:"json",context:{panel:b,stableID:h,goToGene:f},success:function(k){this.stableID in k&&(this.panel.geneIDCache[this.stableID]=k[this.stableID]);this.goToGene(this.panel,this.panel.geneIDCache[this.stableID],this.stableID)}})}else b.updateURL({r:this.r.value.trim()})}).find("a").on("click",function(c){c.preventDefault();g(this).closest("form").trigger("submit")});this.elLk.geneInput.autocomplete({minLength:3,source:function(c,f){var h={panel:b,term:c.term,key:c.term.substr(0,3).toUpperCase(),callback:function(k,l){var p=new RegExp("^"+g.ui.autocomplete.escapeRegex(k),"i");return f(g.map(l,function(q,m){return p.test(m)?q.label:null}))}};if(h.key in b.geneCache)return h.callback(c.term,b.geneCache[h.key]);g.ajax({url:u.speciesPath+"/Ajax/autocomplete",cache:!0,data:{q:h.key},dataType:"json",context:h,success:function(k){this.panel.geneCache[this.key]=k},complete:function(){return this.callback(this.term,this.panel.geneCache[this.key])}})},select:function(c,f){g(this).closest("form").find("input[name=q]").val(f.item.value).end().trigger("submit")}})},updateURL:function(b){var c=b.r.match(/^([^:]+):\s?([0-9,]+)(-|_|\.\.)([0-9,]+)$/);!c||5!==c.length||0>c[4]-c[2]?alert("Invalid location: "+
b.r):this.refreshOnly?(u.updateURL(g.extend({},this.extraParams,{g:b.g,db:b.db})),b=c[1].replace(/^(chr)/,"")+":"+c[2].replace(/,/g,"")+c[3].replace(/(_|\.\.)/,"-")+c[4].replace(/,/g,""),b=b.replace(/\s/g,""),u.updateLocation(b)):u.redirect(this.newHref([],b))},initNavLinks:function(){var b=this;this.elLk.navLinks.helptip().addClass("constant").on("click",function(c){if(this.className.match(/disabled/))return!1;b.refreshOnly&&(c.preventDefault(),c=this.href.match(u.locationMatch)[1],c!==u.coreParams.r&&u.updateLocation(c))})},initSlider:function(){var b=this;try{this.sliderConfig=g.parseJSON(this.elLk.imageNav.find("span.ramp").remove().text())}catch(c){return}this.sliderConfig&&(this.elLk.slider=this.elLk.imageNav.find(".slider_wrapper").show().find(".slider"),this.elLk.sliderLabel=this.elLk.imageNav.find(".slider_label").hide(),this.elLk.zoomIn=this.elLk.navLinks.filter(".zoom_in"),this.elLk.zoomOut=this.elLk.navLinks.filter(".zoom_out"),this.elLk.left1=this.elLk.navLinks.filter(".left_1"),this.elLk.left2=this.elLk.navLinks.filter(".left_2"),this.elLk.right1=this.elLk.navLinks.filter(".right_1"),this.elLk.right2=this.elLk.navLinks.filter(".right_2"),this.elLk.slider.slider({value:this._val2pos(),step:1,min:0,max:100,force:!1,slide:function(c,f){b.elLk.sliderLabel.html(b._pos2val(f.value)+" bp").show()},change:function(c,f){b.elLk.slider.slider("option","fake")||(c=b.rescale(b.currentLocations(),b._pos2val(f.value)),1E6<c.r[2]-c.r[1]&&(c.r[2]=c.r[1]+1E6),b.refreshOnly?u.updateLocation(c.r[0]+":"+c.r[1]+
"-"+c.r[2]):u.redirect(b.newHref(c)))},stop:function(c,f){b.elLk.sliderLabel.hide();g(f.handle).trigger("blur")}}),this.updateButtons())},getContent:function(){if(this.elLk.slider){var b=this._val2pos();this.elLk.slider.slider("option","fake",!0);this.elLk.slider.slider("value",b);this.elLk.slider.slider("option","fake",!1);this.updateButtons(b)}},resize:function(){var b=this.elLk.navbar.width(),c=this.elLk.imageNav.width(),f=this.elLk.forms.width();b<f+c?this.elLk.navbar.removeClass("narrow1").addClass("narrow2"):b<f*this.elLk.forms.length+c?this.elLk.navbar.removeClass("narrow2").addClass("narrow1"):this.elLk.navbar.removeClass("narrow1 narrow2");this.elLk.slider&&this.updateButtons()},_val2pos:function(){var b=this.currentLocations();return Math.min(Math.max((Math.log(b.r[2]-b.r[1]+1)-Math.log(this.sliderConfig.min))/((Math.log(this.sliderConfig.max)-Math.log(this.sliderConfig.min))/100),0),100)},_pos2val:function(b){b=Math.exp((Math.log(this.sliderConfig.max)-Math.log(this.sliderConfig.min))/100*b+Math.log(this.sliderConfig.min));var c=Math.pow(10,2-Math.ceil(Math.log(b)/Math.LN10));return Math.round(Math.round(b*c)/c)}});u.Panel.Masthead=u.Panel.extend({constructor:function(b){this.moreShown=this.longTabs=!1;this.recentLocations={};this.base(b);u.EventManager.register("windowResize",this,this.resize);u.EventManager.register("hashChange",this,this.hashChange);u.EventManager.register("deleteBookmark",this,this.deleteBookmark)},init:function(){var b=this;this.base();var c=g(".tabs_holder",this.el),f=g(".tabs",c),h=g(".spbar_holder",this.el),k=g(".tools_holder",this.el),l=g(".logo_holder",this.el);this.elLk.allTabs=g("li",f);this.elLk.shortTabs=g("li.short_tab",f);this.elLk.longTabs=g("li.long_tab",f);this.elLk.toolsUl=g(".tools",k);this.elLk.tools=g("li",this.elLk.toolsUl);this.elLk.toolMore=g(".more",k);this.elLk.toolMoreUl=g('<ul class="more_tools" />').appendTo(this.elLk.toolMore);this.elLk.dropdowns=g("div.dropdown",c).on("click",function(){g(this).css("zIndex",++u.PanelManager.zIndex)});this.el.find("._ht").helptip();this.elLk.dropdowns.filter(".location").find("ul.recent li a").each(function(){b.recentLocations[g(this).text()]=1});g("a.clear_history",this.elLk.dropdowns).on("click",function(){var p=g(this).parent();g.ajax({url:this.href,success:function(){var q=p.parents(".dropdown").find(".recent li");p.remove();b.deleteFromDropdown(q);p=null}});return!1});F.location.hash&&this.hashChange(u.urlFromHash(F.location.href,!0),!0);g(".toggle",f).each(function(){g(this).data("cls","."+(this.rel||this.title)).removeAttr("title")}).on("click",function(){var p=g(this).data("cls"),q=b.elLk.dropdowns.filter(p);b.dropdownPosition(q,g(this).parents("li"));q.not(":visible").css("zIndex",++u.PanelManager.zIndex).end().toggle();b.elLk.allTabs.filter(p).find("a.toggle").html(q.is(":visible")?"&#9650;":"&#9660;");q.data("type",p);return!1});this.elLk.sppDropdown=g("div.dropdown",h).on("click",function(){g(this).css("zIndex",++u.PanelManager.zIndex)});this.elLk.sppToggle=g("a.toggle",h).on("click",function(){var p=b.elLk.sppDropdown;b.dropdownPosition(p,g(this));p.not(":visible").css("zIndex",++u.PanelManager.zIndex).end().toggle();g(this).html(p.is(":visible")?"&#9650;":"&#9660;");return!1});this.elLk.toolMore.children("a").on("click",function(){g(this).toggleClass("open");b.elLk.toolMoreUl.html(b.elLk.toolsOverflow.clone()).toggle();b.moreShown=!0;return!1});this.toolsShown=this.elLk.tools.length;this.widths={search:g(".search_holder",this.el).outerWidth(!0),logo:l.outerWidth(!0)+l.offset().left,more:this.elLk.toolMore.outerWidth(!0)};this.setWidth("tools");this.elLk.longTabs.show();this.setWidth("longTabs");this.elLk.longTabs.hide();this.resize();c=f=k=l=null},dropdownPosition:function(b,c,f){var h={};if(f||!b.data("positioning:"+this.longTabs)){f=c.outerWidth();var k=b.outerWidth();h.left=c.offset().left;c.hasClass("species")||(h.width=f>k?f-(k-b.width()):"auto");b.data("positioning:"+this.longTabs,h)}b.css(b.data("positioning:"+this.longTabs))},deleteFromDropdown:function(b){if(b.length){var c=b.parent();b.remove();c.children().length||c.hide().prev("h4").hide();c.siblings("ul:visible").length?this.dropdownPosition(c.parent(),this.elLk.allTabs.filter(c.parent().data("type")+":visible"),!0):this.elLk.allTabs.filter(c.parent().data("type")).find(".toggle").hide().first().trigger("click").end().parent().addClass("empty")}},deleteBookmark:function(b){this.deleteFromDropdown(g(".bookmarks ."+b,this.elLk.dropdowns).parent())},setWidth:function(b){var c=this;this.widths[b]=0;this.widths[b+"Array"]=[];this.elLk[b].each(function(){var f=g(this).outerWidth(!0);c.widths[b]+=f;c.widths[b+"Array"].unshift(f)})},resize:function(){if(this.widths){var b=this,c=u.minWidthEl.outerWidth(),f=g(F).width();c=f<c?c:f;f=this.widths.longTabs<c;var h=this.widths.tools>c-this.widths.search-this.widths.logo;if(f!==this.longTabs){if(f){this.elLk.shortTabs.hide();this.elLk.longTabs.show();var k=this.elLk.longTabs}else this.elLk.shortTabs.show(),this.elLk.longTabs.hide(),k=this.elLk.shortTabs;this.longTabs=f;this.elLk.dropdowns.filter(":visible").each(function(){b.dropdownPosition(g(this),k.filter(g(this).data("type")))});k=null}if(h){c=c-this.widths.search-this.widths.logo-
this.widths.more;f=this.widths.toolsArray.length;for(h=0;f--;){if(h+this.widths.toolsArray[f]>c){this.elLk.toolsOverflow=this.elLk.tools.filter(":gt("+(this.widths.toolsArray.length-f-2)+")");break}h+=this.widths.toolsArray[f]}this.elLk.toolsUl.width(c);this.elLk.toolMore.css("left",h).show();this.moreShown&&this.elLk.toolMoreUl.html(this.elLk.toolsOverflow.clone())}else this.elLk.tools.show(),this.elLk.toolMore.hide(),this.elLk.toolsUl.width("auto")}},hashChange:function(b,c){var f=this.elLk.shortTabs.filter(".location"),h=this.elLk.longTabs.filter(".location"),k=u.speciesCommon+": "+u.lastR;b=b.split(/\W/);b="Location: "+b[0]+":"+u.thousandify(b[1])+"-"+u.thousandify(b[2]);f.find("a:not(.toggle)").attr("title",b);h.find("a:not(.toggle)").html(b);c||(g.each([f,h],function(){this.children(".dropdown").removeClass("empty").children(".toggle").show()}),this.elLk.dropdowns.length&&!this.recentLocations[k]&&(this.elLk.dropdowns.filter(".location").find("ul.recent").prepend('<li><a href="'+u.urlFromHash(F.location.href).replace(/([\?;]r=)[^;]+(;?)/,"$1"+u.lastR+"$2")+'">'+k+"</a></li>").show().prev("h4").show(),this.recentLocations[k]=1))}});u.Panel.MultiSelector=u.Panel.extend({constructor:function(b,c){this.base(b);this.urlParam=c.urlParam;this.paramMode=c.paramMode;u.EventManager.register("updateConfiguration",this,this.updateSelection)},init:function(){var b=this;this.base();this.initialSelection="";this.selection=[];this.elLk.content=g(".modal_wrapper",this.el);this.elLk.list=g(".multi_selector_list",this.elLk.content);var c=g("ul",this.elLk.list),f=g("span",c),h=g("li",c);this.elLk.spans=f.filter(":not(.switch)");this.elLk.form=g("form",this.elLk.content);this.elLk.included=c.filter(".included");this.elLk.excluded=c.filter(".excluded");this.setSelection(!0);this.updateTitleCount();this.elLk.included.sortable({containment:this.elLk.included.parent(),stop:g.proxy(this.setSelection,this)});this.buttonWidth=h.on("click",function(){var k=g(this),l;var p=k.parent().data("category");if(k.parent().hasClass("included")){var q=b.elLk.excluded.filter("[data-category='"+
p+"']");q.length||(q=b.elLk.excluded.first());p=g("li",q);for(l=p.length;l--;)if(g(p[l]).text()<k.text()){g(p[l]).after(k);break}-1===l&&q.prepend(k);b.setSelection()}else p=b.elLk.included.filter("[data-category='"+p+"']"),p.length||(p=b.elLk.included.first()),p.append(k),b.selection.push(k.attr("class"));b.updateTitleCount()});this.buttonWidth=f.width();g(".select_by select",this.el).on("change",function(){switch(this.value){case"":break;case"all":var k=b.elLk.excluded.children();break;case"none":var l=b.elLk.included.children();break;default:k=b.elLk.excluded.children(":contains("+this.options[this.selectedIndex].innerHTML+")"),l=b.elLk.included.children().not(":contains("+this.options[this.selectedIndex].innerHTML+")")}k&&b.elLk.included.append(k);l&&l.add(b.elLk.excluded.children()).detach().sort(function(p,q){return g(p).text()>g(q).text()}).appendTo(b.elLk.excluded);b.setSelection();b.updateTitleCount();k=l=null});c=null},updateTitleCount:function(){var b=this.elLk.excluded.children().length,c=this.elLk.included.children().length;this.el.find("._unselected_species h2 span").html(b);this.el.find("._selected_species h2 span").html(c)},setSelection:function(b){this.selection=g.map(g("li",this.elLk.included),function(c,f){return c.className});!0===b&&(this.initialSelection=this.selection.join(","))},updateSelection:function(){var b=[],c;if("single"===this.paramMode)b.push(this.urlParam+"="+this.selection.join(","));else for(c=0;c<this.selection.length;c++)b.push(this.urlParam+(c+1)+"="+this.selection[c]);this.selection.join(",")!==this.initialSelection&&u.redirect(this.elLk.form.attr("action")+"?"+u.cleanURL(this.elLk.form.serialize()+";"+b.join(";")));return!0}});u.Panel.Overlay=u.Panel.extend({constructor:function(b){this.base(b);this.window=g(F);this.firstOpen=!0;this.setMinMax();u.EventManager.register("windowResize",this,this.pageResize)},init:function(){var b=this;this.customized=this.getCookie();this.base();u.browser.ie6||this.el.draggable({containment:"document",handle:"div.modal_title",stop:function(c,f){f.position.top<b.offsetTop&&(f.position.top=b.offsetTop,g(this).css("top",b.offsetTop));b.customized.left=f.position.left||1;b.customized.top=f.position.top;b.setCookie()}}).resizable({maxWidth:this.maxWidth,maxHeight:this.maxHeight,minWidth:this.minWidth,minHeight:this.minHeight,start:function(c,f){g(this).css("position","fixed")},stop:function(c,f){g.extend(b.customized,f.size);b.setCookie();g(this).css("position","fixed");u.EventManager.trigger("modalPanelResize")}});this.elLk.background=g("#modal_bg").on("click",function(){b.hide()})},setCookie:function(){var b=this,c=g.map(["width","height","left","top"],function(f){return b.customized[f]||0});u.cookie.set("modal",c.join("|"))},getCookie:function(){var b=u.cookie.get("modal").split("|");return 4!==b.length||u.browser.ie6?{}:{width:Math.min(parseInt(b[0],10),this.maxWidth),height:Math.min(parseInt(b[1],10),this.maxHeight),left:parseInt(b[2],10),top:parseInt(b[3],10)}},show:function(){this.elLk.background.show();this.firstOpen&&(this.setDimensions(),this.firstOpen=!1);if(u.browser.ie6){var b={marginTop:this.window.scrollTop(),marginLeft:this.window.scrollLeft()};this.el.css(b);this.elLk.background.css(b);g("body").css("overflow","hidden");g("select").hide();g("select",this.el).show()}this.base();this.offsetTop||(this.offsetTop=-g(".modal_title",this.el).position().top-g(".modal_close",this.el).position().top)},hide:function(){this.base();this.elLk.background.hide();u.browser.ie6&&(g("body").css("overflow","auto"),g("select").show())},setMinMax:function(){this.maxWidth=Math.round(.9*this.window.width());this.maxHeight=Math.round(.8*this.window.height());this.minWidth=Math.min(900,this.maxWidth);this.minHeight=Math.min(500,this.maxHeight)},setDimensions:function(){this.setMinMax();var b=this.customized.height?Math.min(this.customized.height,this.maxHeight):this.maxHeight,c=this.customized.width?Math.min(this.customized.width,this.maxWidth):this.maxWidth,f=this.el.offset(),h=this.window.width(),k=this.window.height();u.browser.ie6||this.el.resizable("option",{maxWidth:this.maxWidth,maxHeight:this.maxHeight,minWidth:this.minWidth,minHeight:this.minHeight});this.el.css({height:b,width:c,top:!this.customized.top||f.top+b>k||this.customized.top+b>k?(k-b)/2:this.customized.top,left:!this.customized.left||f.left+c>h||this.customized.left+c>h?(h-c)/2:this.customized.left})},pageResize:function(){this.setDimensions();this.el.is(":visible")&&u.EventManager.trigger("modalPanelResize")}});u.Panel.Piechart=u.Panel.Content.extend({init:function(){var b=this;this.base();"undefined"===typeof Raphael&&g.getScript("/raphael/raphael-min.js").done(function(){g.getScript("/raphael/g.raphael-min.js").done(function(){g.getScript("/raphael/g.pie-modified-min.js").done(function(){b.getContent()})})})},getContent:function(){var b=this,c=[];this.graphData=[];this.graphConfig={};this.graphEls={};this.dimensions=eval(g("input.graph_dimensions",this.el).val());g("input.graph_data",this.el).each(function(){b.graphData.push(eval(this.value))});g("input.graph_config",this.el).each(function(){b.graphConfig[this.name]=eval(this.value)});for(i in this.graphData)this.graphEls[i]=g("#graphHolder"+i),this.graphEls[i].is(":visible")&&c.push(i);this.makeGraphs(c)},makeGraphs:function(b){var c,f;for(c in b)if(!this.graphEls[b[c]].data("done")){var h={legend:[],colors:[]};var k=[];var l=0;for(f in this.graphData[b[c]])"object"===typeof this.graphData[b[c]][f]?(k.push(this.graphData[b[c]][f][0]),h.legend.push(this.graphData[b[c]][f][1]+": %%"),this.graphColours&&(h.colors.push(this.graphColours[this.graphData[b[c]][f][1]]||this.graphColours["default"][l++]),l===this.graphColours["default"].length&&(l=0))):k.push(this.graphData[b[c]][f]);l=Raphael("graphHolder"+b[c]);l.g.txtattr.font="12px 'Luxi Sans','Helvetica', sans-serif";l.g.piechart(this.dimensions[0],this.dimensions[1],this.dimensions[2],k,g.extend(h,this.graphConfig));this.graphEls[b[c]].data("done",!0)}}});u.Panel.SearchBox=u.Panel.extend({init:function(){var b=this;this.base();this.elLk.img=g(".search_image",this.el);this.elLk.sites=g(".sites",this.el);this.elLk.siteInput=g("input",this.elLk.sites);this.elLk.menu=g(".site_menu",this.el);this.elLk.input=g(".query",this.el);this.elLk.select=g("select[name=species]",this.el);this.label=this.elLk.input[0].defaultValue;this.species=this.elLk.select.val();this.updateSearch(u.cookie.get("ENSEMBL_SEARCH"));this.label!==this.elLk.input.val()&&this.elLk.input.removeClass("inactive");this.elLk.input.on({"click focus":function(){b.label===this.value&&g(this).selectRange(0,0)},"keydown paste":function(){this.className.match("inactive")&&g(this).removeClass("inactive").val("")},blur:function(){this.value||g(this).addClass("inactive").val(b.label)}});g("div",this.elLk.menu).on("click",function(){var c=this.className;b.updateSearch(c);b.elLk.menu.hide();u.cookie.set("ENSEMBL_SEARCH",c)});this.elLk.sites.on("click",function(){b.elLk.menu.toggle()});g("form",this.el).on("submit",function(){if(b.elLk.input.val()===b.label&&b.elLk.select.val()===b.species||""===b.elLk.input.val())return!1})},updateSearch:function(b){var c=b?this.elLk.menu.find("."+
b+" input").val():!1;c&&(this.elLk.img.attr("src",this.elLk.menu.find("."+b+" img").attr("src")),this.elLk.siteInput.val(b),this.elLk.input.val()===this.label&&this.elLk.input.val(c),this.label=c)}});u.Panel.SpeciesList=u.Panel.extend({init:function(){this.base();this.elLk.container=this.el.find("._species_fav_container");this.elLk.list=this.el.find("._species_sort_container");this.elLk.dropdown=this.el.find("select._all_species");this.elLk.finder=this.el.find(".finder input");this.elLk.buttonEdit=this.el.find("a._list_edit");this.elLk.buttonDone=this.el.find("a._list_done");this.elLk.buttonReset=this.el.find("a._list_reset");this.allSpecies=this.params.species_list||[];this.allStrains=this.params.strains_list||[];this.favTemplate=this.params.fav_template;this.listTemplate=this.params.list_template;this.refreshURL=this.params.ajax_refresh_url;this.saveURL=this.params.ajax_save_url;this.displayLimit=this.params.display_limit;this.favText=this.params.fave_text;this.taxonOrder=this.params.taxon_order;this.taxonLabels=this.params.taxon_labels;this.elLk.buttonEdit.on("click",{panel:this},function(b){b.preventDefault();u.isLoggedInUser&&(b.stopImmediatePropagation(),b.stopPropagation(),b.data.panel.toggleList(!0))});this.elLk.buttonDone.on("click",{panel:this},function(b){b.preventDefault();b.data.panel.toggleList(!1)});this.elLk.buttonReset.on("click",{panel:this},function(b){b.preventDefault();b.data.panel.updateFav("");b.data.panel.toggleList(!1)});this.elLk.dropdown.on("change",function(){var b=g(this).val();b&&(F.location.href=b)});this.refreshFav();this.renderDropdown()},renderFav:function(){this.elLk.container.empty();for(var b=0;b<this.allSpecies.length;b++){var c=this.allSpecies[b];if(!c.favourite||b>=this.displayLimit)break;this.elLk.container.append(u.populateTemplate(this.favTemplate,{species:c}))}},refreshFav:function(){this.elLk.container.addClass("faded");u.isLoggedInUser?g.ajax({url:this.refreshURL,context:this,dataType:"json",success:function(b){this.allSpecies=b;this.renderFav();this.renderList();this.elLk.container.removeClass("faded").externalLinks()}}):this.elLk.container.removeClass("faded").externalLinks()},renderList:function(){var b=this,c=this.listTemplate,f=this.elLk.list.find("ul._favourites").empty(),h=this.elLk.list.find("ul._species").empty();g.each(this.allSpecies,function(k,l){l.external||(l.favourite?f:h).append(u.populateTemplate(c,{species:l}))});f.add(h).sortable({connectWith:"._species, ._favourites",containment:this.el,stop:function(){b.updateFav(f.sortable("toArray").join(",").replace(/species\-/g,""))}})},toggleList:function(b){this.elLk.list.toggleClass("hidden",!b);this.elLk.buttonEdit.toggle(!b)},initAutoComplete:function(){var b=this;this.elLk.finder.autocomplete({minLength:3,source:function(c,f){var h=g();g.each(b.allSpecies,function(k,l){h.push({label:l.common===l.name?l.name:l.common+" ("+l.name+")",url:l.homepage})});g.each(b.allStrains,function(k,l){h.push({label:l.common+" ("+l.name+")",url:l.homepage})});f(b.filterArray(h,c.term))}}).data("ui-autocomplete")._renderItem=function(c,f){c.addClass("ss-autocomplete");var h=new RegExp("(?![^&;]+;)(?!<[^<>]*)("+g.ui.autocomplete.escapeRegex(this.term)+")(?![^<>]*>)(?![^&;]+;)","gi");f.label=f.label.replace(h,"<span class='ss-ac-highlight'>$1</span>");return g("<li/>").data("ui-autocomplete-item",f).addClass("ss-ac-result-li").append("<a href='"+f.url+"' class='ss-ac-result'>"+f.label+"</a>").appendTo(c)}},filterArray:function(b,c){c=c.replace(/[^a-zA-Z0-9 ]/g,"").toUpperCase();var f=new RegExp(g.ui.autocomplete.escapeRegex(c),"i");b=g.grep(b,function(h){return h&&f.test(h.label.replace(/[^a-zA-Z0-9 ]/g,""))});b.sort(function(h,k){var l=h.label.toUpperCase().substr(0,c.length)==c,p=k.label.toUpperCase().substr(0,c.length)==c;return l==p?h.label==k.label?0:h.label<k.label?-1:1:l?-1:1});return b},renderDropdown:function(){var b=this,c=this.taxonLabels,f=this.elLk.dropdown.children(":not(:first-child)").remove().end(),h=g(),k=g.map(this.allSpecies,function(m){return m.favourite?m:null}),l=this.allSpecies.slice(0).sort(function(m,t){return m.common>t.common?1:-1}),p=this.favText;g.each(k,function(m,t){m=h.filter(".favourites");m.length||(m=g('<optgroup class="favourites" label="'+p+'"></optgroup>'),h=h.add(m));b.addOption(m,t,!0)});g.each(l,function(m,t){if(!t.external){m=t.group;var v=h.filter("."+m);v.length||(v=g('<optgroup class="'+m+'" label="'+(c[t.group]||m)+'"></optgroup>'),h=h.add(v));b.addOption(v,t)}});h.filter(".favourites").appendTo(f);for(var q in this.taxonOrder)h.filter("."+this.taxonOrder[q]).appendTo(f)},addOption:function(b,c,f){b.append('<option value="'+c.homepage+'">'+c.common+"</option>");!f&&c.strainspage&&b.append('<option value="'+c.strainspage+'">'+c.straintitle+" "+c.strain_type+"</option>")},updateFav:function(b){g.ajax({url:this.saveURL,context:this,data:{favourites:b},dataType:"json",success:function(c){c.updated&&this.refreshFav()}})}});u.Panel.UserData=u.Panel.extend({formats:{bam:"BAM",bb:"BIGBED",bcf:"BCF",bed:"BED",bgr:"BEDGRAPH",bw:"BIGWIG",cram:"CRAM",gff:"GTF",gff3:"GFF3",gtf:"GTF",psl:"PSL",vcf:"VCF",vep:"VEP",wig:"WIG"},init:function(){var b=this;this.base.apply(this,arguments);this.elLk.activeLink=this.el.parents(".modal_wrapper").siblings(".modal_nav").find("ul.local_context li.active");this.elLk.form=this.el.find("form").off(".UserData").on("submit.UserData",function(f){f.preventDefault();b.formSubmit()});this.elLk.formatDropdown=this.elLk.form.find("select[name=format]").on("change",function(){b.showError()});var c=function(f){b.showError();var h=g(this).off("blur change paste");setTimeout(function(){h.trigger("finish").trigger("blur").on("blur change paste",c);h=null},100)};this.elLk.dataFieldText=this.elLk.form.find("._userdata_add textarea").on({focus:function(f){this.value&&this.value!==this.defaultValue||g(this).val("").removeClass("inactive")},finish:function(){(this.value=this.value.trim())&&this.value!==this.defaultValue?b.updateFormatDropdown(this.value,!1):(g(this).val(this.defaultValue).addClass("inactive"),b.resetFormatDropdown())},"blur change paste":c});this.elLk.dataFieldFile=this.elLk.form.find("._userdata_add input[type=file]").on("change",function(){b.updateFormatDropdown(this.value,!0)})},updateFormatDropdown:function(b,c){var f;this.elLk[c?"dataFieldText":"dataFieldFile"].val("").trigger("finish");c||(b.match(/^(ht|f)tp(s?):\/\//)?b.match(/\/hub\.txt$/)&&(f="TRACKHUB"):(c=!0,f="unknown"));f||(f=this.formats[b.replace(/\.gz$/,"").split(".").pop().toLowerCase()]);this.elLk.formatDropdown.find("option").prop("disabled",function(){return!(c?!this.className.match("_format_remote"):!this.className.match("_format_upload"))}).filter(":first, [value="+f+"]:enabled").last().prop("selected",!0);this.elLk.formatDropdown.removeClass("hide")},resetFormatDropdown:function(){this.elLk.dataFieldFile.val()||this.elLk.dataFieldText.val()&&this.elLk.dataFieldText.val()!==this.elLk.dataFieldText.prop("defaultValue")||this.elLk.formatDropdown.find("option").prop("disabled",!1).first().prop("selected",!0)},showError:function(b,c){b?(this.elLk.errorMessage||(this.elLk.errorMessage=g("<label>").addClass("invalid")),this.elLk.errorMessage.html("&nbsp;"+b).insertAfter(c)):g(this.elLk.errorMessage).empty().remove()},formSubmit:function(){if(!(this.elLk.dataFieldFile.val()||this.elLk.dataFieldText.val()&&this.elLk.dataFieldText.val()!==this.elLk.dataFieldText.prop("defaultValue")))return this.showError("Please provide some data",this.elLk.dataFieldText),!1;if(!this.elLk.formatDropdown.val())return this.showError("Please select a format",this.elLk.formatDropdown),!1;this.showError();this.elLk.activeLink.removeClass("active");return u.EventManager.trigger("modalFormSubmit",this.elLk.form)}});u.Panel.ZMenu=u.Panel.extend({constructor:function(b,c){this.base(b);this.data=c;b=c.area.a;c.area.link&&(b={klass:{},attrs:{href:c.area.link.attr("href"),title:c.area.link.attr("title")}});this.drag=b.klass.drag?"drag":b.klass.vdrag?"vdrag":!1;this.align=b.klass.align;this.group=b.klass.group||b.klass.pseudogroup;this.coloured=b.klass.coloured;this.href=b.attrs.href;this.title=b.attrs.title||"";this.das=!1;this.event=c.event;this.coords=c.coords||{};this.imageId=c.imageId;this.onclose=c.onclose;this.context=c.context;this.relatedEl=c.relatedEl;this.areaCoords=g.extend({},c.area);this.location=0;b.klass.das&&(this.das=b.klass.group?"group":b.klass.pseudogroup?"pseudogroup":"feature",this.logicName="",g.each(b.attrs,function(h,k){"das"!=h&&"pseudogroup"!=h&&"group"!=h&&(this.logicName+=h)}));if(this.drag){c=this.href.split("|");var f=parseInt(c[1],10)-1;this.speciesPath=c[3].replace(/-/,"/");this.species=this.speciesPath.split("/").pop();this.chr=c[4];this.start=parseInt(c[5],10);this.end=parseInt(c[6],10);this.strand=parseInt(c[7],10);this.multi=b.klass.multi?f:!1;this.speciesPath.match(/^\//)||(this.speciesPath="/"+this.speciesPath)}b=null;delete this.areaCoords.a;u.EventManager.register("showExistingZMenu",this,this.showExisting)},init:function(){var b=this,c=new RegExp("([\\?;]r"+(this.multi||"")+"=)[^;]+;?","g");this.base();this.elLk.container=g(".container",this.el);this.elLk.loading=g(".loading",this.el);this.el.on("click","a._motif",function(f){f.preventDefault();u.openMotifWidget(g(this).html())});this.el.on("mousedown",function(){u.EventManager.trigger("panelToFront",b.id)}).on("click","a._location_change",function(f){if(!F.location.pathname.match(/\/Location\/View(\/|$)/))return!0;var h=this.href.match(u.locationMatch);h&&(f.preventDefault(),h[1]!==u.coreParams.r&&u.updateLocation(h[1]),b.hide())}).on("click","a._location_mark",function(f){f.preventDefault();u.markLocation(this.href);b.hide()});g(".close",this.el).on("click",function(){b.hide();b.onclose&&b.onclose.call(b.context||b)});this.baseURL=F.location.href.replace(/&/g,";").replace(/#.*$/g,"").replace(c,"$1%s;").replace(/[\?;]$/g,"");this.baseURL.match(/%s/)||(this.baseURL+=(this.baseURL.match(/\?/)?";":"?")+"r=%s");this.multi&&(this.baseURL=this.baseURL.replace(/align=\d+;?/,"").replace(/;$/,"")+";action=primary;id="+this.multi);!1===this.multi&&(this.baseURL=this.baseURL.replace(/r\d+=[^;]+;?/g,""));this.coloured&&this.el.addClass("coloured");this.el.on("click","a.expand",function(){b.populateAjax(this.href,g(this).parents("tr"));return!1});this.getContent();g(".refresh-zmenu",this.el).on("click",function(){g(this).closest("tbody").hide();b.elLk.loading.show();b.populateAjax(b.href,g(this).parents("tbody"),1);return!1})},getContent:function(){var b=this;this.populated=!1;clearTimeout(this.timeout);this.timeout=setTimeout(function(){!1===b.populated&&(b.elLk.container.hide(),b.elLk.loading.show(),b.show(b.das))},300);this.data.mr_menu?this.showMarkRegionMenu():"drag"===this.drag?this.populateRegion():"vdrag"===this.drag?this.populateVRegion():!1!==this.das?this.populateDas():this.href?this.href.match(/#/)&&!this.href.match(/#:@:/)?this.populate(!0):this.populateAjax():this.populate()},showMarkRegionMenu:function(){var b=this,c=[];u.markedLocation&&c.push('<a class="loc-icon-a _mr_jump_location"> <span class="loc-icon loc-change"></span>Jump to marked location</a>','<a class="loc-icon-a _mr_remove" style="cursor:pointer;"> <span class="loc-icon remove"></span>Remove marking</a>');this.buildMenu(c,"Marked Region");this.elLk.container.find("._mr_jump_location").off().on("click",function(f){u.updateLocation(u.markedLocation[0]);b.hide()}).css({cursor:"pointer"});this.elLk.container.find("._mr_remove").off().on("click",function(f){u.markLocation(!1);b.hide()})},populate:function(b,c,f){var h=this.title.toString().split("; "),k=h.shift();this.buildMenu(h,k,b,c,!0,f)},populateDas:function(){var b=this.title.match(/Start: (\d+)/)[1],c=this.title.match(/End: (\d+)/)[1],f=(this.title.match(/Strand: ([-+])/)||[])[1],h=this.title.match(/; Id: ([^;]+)$/)[1];b=[F.location.pathname.replace(/\/(\w+)\/\w+$/,"/ZMenu/$1/Das"),"?logic_name=",this.logicName,";",this.das,"_id=",h,";start=",b,";end=",c,";strand=",{"+":1,"-":-1}[f],";label=",this.title.split("; ")[0]].join("");for(var k in u.coreParams)u.coreParams[k]&&(b+=";"+k+"="+u.coreParams[k]);this.populateNoAjax(!0);this.populateAjax(b)},convertQuickUrl:function(b){if(!b.match(/^#:@:/))return b;b=b.replace(/^#:@:/,"");for(var c=[];;){var f=/^(\d+)-/.exec(b);if(!f)break;var h=parseInt(f[1]);c.push(b.substr(f[0].length,h));b=b.substr(f[0].length+h+1)}b=[];f={};for(var k;1<c.length;){h=c.shift();var l=c.shift();b.push(h);f[h]=encodeURIComponent(h)+"="+encodeURIComponent(l);"type"==h&&(k=l)}c=F.location.pathname.split("/");c.splice(1,2,c[1],"ZMenu",b.type||k);k=F.location.search.replace(/^\?/,"").split(/&|;/);h=[];for(l=0;l<k.length;l++){var p=k[l].split("=");f[decodeURIComponent(p[0])]===R&&h.push(k[l])}for(l=0;l<b.length;l++)h.push(f[b[l]]);return c.join("/")+
"?"+h.join(";")},populateAjax:function(b,c){var f=this.timeout;b=b||this.href;(b=this.convertQuickUrl(b))&&b.match("/ZMenu/")?g.extend(g.ajax({url:b,data:this.coords.clickStart?{click_chr:this.coords.clickChr||u.location.name,click_start:this.coords.clickStart,click_end:this.coords.clickEnd,click_y:this.coords.clickY}:{},dataType:this.crossOrigin?"jsonp":"json",context:this,success:g.proxy(this.buildMenuAjax,this),error:g.proxy(this.populateNoAjax,this,!1,!0)}),{timeout:f,expand:c}):this.populateNoAjax()},buildMenuAjax:function(b,c,f){c=b.features;var h=c.length,k=Math.min(h,5),l,p,q;if(f.timeout===this.timeout){if(0===h)return this.populateNoAjax();this.populated=!0;for(l=0;l<h;l++){var m=c[l];if(0===l||t.children().length===k)var t=g("<div></div>").appendTo(this.elLk.container);if(m.entries.length){var v=q="";m.caption&&(v+=this.header(m.caption,1<h));for(p=0;p<m.entries.length;p++)"subheader"===m.entries[p].key?m.entries[p].value!==m.caption&&(q=this.header(m.entries[p].value,!0)):q=this.row(m.entries[p].key,m.entries[p].value,m.entries[p]["class"],m.entries[p].childOf),v+=q;f.expand?(f.expand.replaceWith(v),f.expand=null):this.makeTable(v).appendTo(t).find("a.update_panel").attr("rel",this.imageId)}}1<h&&(this.elLk.header=g('<div class="header">'+(b.header?b.header:h+" features")+"</div>").insertBefore(this.elLk.container.addClass("row"+(h>k?" grid":""))));this.addLocationIcons();this.show()}},addLocationIcons:function(){var b=this.elLk.container.find("._location_mark").removeClass("_location_mark");b.length&&this.imageId&&!this.imageId.match("Multi")&&b.each(function(){var c=this.href.match(u.locationMatch);c&&g('<br /><a class="loc-icon loc-mark _location_mark _ht" title="Mark feature on image" href="'+u.updateURL({mr:c[1]},this.href)+'"></a>'+(this.className.match(/_location_change/)?'<a class="loc-icon loc-zoom _location_change _ht" title="Zoom on feature" href="'+this.href+'"></a>':"")).insertAfter(this);return!0})},populateNoAjax:function(b,c){if(this.das&&!0!==b)this.populated=!0,this.show();else{b="";var f=this.title.match(/Location: (\S+)/);if(f){var h=f[1].split(/\W/);this.location=parseInt(h[1],10)+(h[2]-h[1])/2;b+=this.row(" ",'<a class="loc-icon-a _location_change" href="'+this.zoomURL(1)+'"><span class="loc-icon loc-pin"></span>Centre on feature</a>');b+=this.row(" ",'<a class="loc-icon-a _location_change" href="'+this.baseURL.replace(/%s/,f[1])+'"><span class="loc-icon loc-zoom"></span>Zoom to feature</a>')}this.populate(!0,b,c)}},populateRegion:function(){function b(){var B=v-t+1>u.maxRegionLength?"Overview":"View";m=m.replace(/.+\?/,"?");z=['<a class="loc-icon-a" href="'+h.speciesPath+"/Location/"+B+m+'"><span class="loc-icon loc-change"></span>Jump to region '+B.toLowerCase()+"</a>"]}function c(){var B=t?"region":"location";z=['<a href="'+m.replace(/;action=primary;id=\d+/,"")+'">Realign using this '+B+"</a>"];h.multi?z.push('<a href="'+m+'">Use '+B+" as primary</a>"):z.push('<a href="'+m.replace(/[rg]\d+=[^;]+;?/g,"")+'">Jump to '+B+"</a>");w=h.species.replace(/_/g," ")+" "+h.chr+":"+(t?t+"-"+v:h.location)}function f(){var B=t?"region":"location";B+=h.species===u.species?"":" on "+u.species.replace(/_/g," ");z=['<a class="loc-icon-a" href="'+m.replace(/%s/,u.coreParams.r+";align_start="+t+";align_end="+v)+'"><span class="loc-icon loc-change"></span>Jump to best aligned '+B+"</a>"];w="Alignment: "+(t?t+"-"+v:h.location)}var h=this,k=this.start,l=this.end,p=!!F.location.pathname.match("/Location/")&&!F.location.pathname.match(/\/(Chromosome|Synteny)/),q=(l-k+
1)/(this.areaCoords.r-this.areaCoords.l),m=this.baseURL;if(this.coords.r){var t=Math.floor(k+(this.coords.s-this.areaCoords.l)*q);var v=Math.floor(k+(this.coords.s+this.coords.r-this.areaCoords.l)*q);t>v&&(q=t,t=v,v=q);t=Math.max(t,k);v=Math.min(v,l);1===this.strand?this.location=(t+v)/2:(this.location=(2*this.start+2*this.end-t-v)/2,q=t,t=this.end+this.start-v,v=this.end+this.start-q);if(this.align)f();else{m=m.replace(/%s/,this.chr+":"+t+"-"+v);var w="Region: "+this.chr+":"+t+"-"+v;if(p)if(!1!==this.multi)c();else{k="_location_change";v-t+1>u.maxRegionLength&&m.match("/View")&&(m=m.replace("/View","/Overview"),k="");var z=['<a class="'+k+' loc-icon-a" href="'+m+'"><span class="loc-icon loc-change"></span>Jump to region ('+(v-t+1)+" bp)</a>"]}else b()}!1!==this.multi||this.align||z.unshift('<a class="_location_mark loc-icon-a" href="'+u.updateURL({mr:this.chr+":"+t+"-"+v},F.location.href)+'"><span class="loc-icon loc-mark"></span>Mark region ('+(v-t+1)+" bp)</a>")}else this.location=Math.floor(k+
(this.coords.x-this.areaCoords.l)*q),this.align?(m=this.zoomURL(.1),f()):(m=this.zoomURL(1),w="Location: "+this.chr+":"+this.location,p?!1!==this.multi?c():(z=['<a class="_location_change" href="'+this.zoomURL(10)+'">Zoom out x10</a>','<a class="_location_change" href="'+this.zoomURL(5)+'">Zoom out x5</a>','<a class="_location_change" href="'+this.zoomURL(2)+'">Zoom out x2</a>','<a class="_location_change" href="'+m+'">Centre here</a>'],g.each([2,5,10],function(){var B=h.zoomURL(1/this);""!==B&&z.push('<a class="_location_change" href="'+
B+'">Zoom in x'+this+"</a>")})):b());this.buildMenu(z,w)},populateVRegion:function(){var b=this.start,c=this.end,f=(c-b+1)/(this.areaCoords.b-this.areaCoords.t),h=Math.min(u.location.length,u.maxRegionLength)/2;f===c&&(f/=2);if(this.coords.r){var k=Math.floor(b+(this.coords.s-this.areaCoords.t)*f);h=Math.floor(b+(this.coords.s+this.coords.r-this.areaCoords.t)*f);f=h-k+1>u.maxRegionLength?"Overview":"View";if(k>h){var l=k;k=h;h=l}k=Math.max(k,b);h=Math.min(h,c);b=this.chr+": "+k+"-"+h;this.location=(k+h)/2}else this.location=Math.floor(b+(this.coords.y-this.areaCoords.t)*f),f="View",k=Math.max(Math.floor(this.location-h),1),h=Math.floor(this.location+h),b=this.chr+": "+this.location;k=this.baseURL.replace(/.+\?/,"?").replace(/%s/,this.chr+":"+k+"-"+h);f=['<a href="'+this.speciesPath+"/Location/"+f+k+'">Jump to region '+f.toLowerCase()+"</a>"];F.location.pathname.match("/Chromosome")||f.push('<a href="'+this.speciesPath+"/Location/Chromosome"+k+'">Chromosome summary</a>');this.buildMenu(f,b)},buildMenu:function(b,c,f,h,k,l){var p=[],q=b.length;c=c||(l?"Message":"Menu");h=h||"";!0===l?h=this.row('<p>Still loading data... <a class="refresh-zmenu"> Please click here to refresh </a> this menu. </p> <p>If you think this is an error, or you have any questions, please <a href="/Help/Contact" class="popup">contact our HelpDesk team</a>.</p>')+h:!0===f&&this.href&&(f=this.title?this.title.split("; ")[0]:c,h=this.row("Link",'<a href="'+this.href+'">'+f+"</a>")+h);for(;q--;)if(f=this.coloured?b[q].match(/\[(.+)\]/):null)for(f=f[1].split(","),l=0;l<f.length;l+=2){f[l]=f[l].split(":");var m='<td style="color:#'+f[l][1]+'">'+f[l][0]+"</td>";f[l+1]?(f[l+1]=f[l+1].split(":"),m+='<td style="color:#'+f[l+1][1]+'">'+f[l+1][0]+"</td>"):m+="<td></td>";p.push("<tr>"+m+"</tr>")}else l=k?g("<span/>").html(b[q]).text():b[q],f=l.split(": "),p.unshift(this.row.apply(this,1<f.length?[f.shift(),f.join(": ")]:[l]));this.makeTable(this.header(c)+p.join("")+h).appendTo(this.elLk.container);this.das?this.elLk.container.hide():(this.populated=!0,this.show())},zoomURL:function(b){var c=Math.min(u.location.length,u.maxRegionLength)*b;if(1>c)return"";b=Math.round(this.location-(c-1)/2);c=Math.round(this.location+(c-1)/2);1>b&&(b=this.start);return this.align?this.baseURL.replace(/%s/,u.coreParams.r+";align_start="+b+";align_end="+c):this.baseURL.replace(/%s/,(this.chr||u.location.name)+":"+b+"-"+c)},show:function(b){!b&&this.elLk.container.html()&&(this.elLk.loading.hide(),this.elLk.container.show());u.EventManager.trigger("panelToFront",this.id);this.el.css({top:0,left:0,display:"block"}).position({of:this.event,my:"left top",collision:"fit"}).hasClass("ui-draggable")||this.el.scrollTop(0).draggable({handle:".header:not(.subheader)",start:function(){g(this).css({"margin-top":-1*g(F).scrollTop()})},stop:function(){g(this).css({top:parseInt(g(this).css("top"))+parseInt(g(this).css("margin-top")),"margin-top":0})}});this.relatedEl&&this.relatedEl.addClass("highlight");this.elLk.container.find("._ht").helptip();this.elLk.container.find("._zmenu").zMenuLink();this.el.hasClass("closed")&&this.hide()},showExisting:function(b){this.event=b.event;this.coords=b.coords;this.group||this.drag||this.event.shiftKey?(this.elLk.header&&(this.elLk.header.remove(),delete this.elLk.header),this.elLk.container.empty(),this.hide(),this.getContent()):this.show()},hide:function(){this.el&&(this.base(),this.relatedEl&&this.relatedEl.removeClass("highlight"))},makeTable:function(b){function c(p){"A"!==p.target.nodeName&&(p=g(this).parent(),p.siblings("."+p[0].className).toggle(),g(this).toggleClass("closed opened"))}var f={};b=g('<table class="zmenu" cellspacing="0"></table>').html(b);var h=b.find("tr.child"),k=b.find("tr[class]:not(.child)").each(function(){h.filter("."+this.className).length&&(f[this.className]=1)}),l;for(l in f)k.filter("."+l).children(":first").addClass("closed").on("click",c),h.filter("."+l).hide();k=h=null;return b},header:function(b,c){return'<tr class="header'+(c?" subheader":"")+'"><th colspan="2">'+b+"</th></tr>"},row:function(b,c,f,h){return"<tr"+
(f||h?' class="'+(f||h).replace(/\W/g,"_")+(h?" child":"")+'"':"")+">"+(b&&c?"<th>"+b+"</th><td>"+c+"</td>":'<td colspan="2">'+(b||c)+"</td>")+"</tr>"}},{template:g('<div class="zmenu_holder">  <span class="close"></span>  <div class="info_popup floating_popup">    <div class="loading"><div>Loading component</div><p class="spinner"></p></div>    <div class="container"></div>  </div></div>')});u.Panel.AlignmentText=u.Panel.Content.extend({constructor:function(){this.base.apply(this,arguments)},init:function(){this.base();var b,c,f="",h="";g("div.display_full_message_div a",this.el).on("click",function(k){k.preventDefault();f||(f=g(this).parent(".display_full_message_div").siblings("p").html());h||(h="Currently showing full alignment. Please click the button below to show the alignment for first "+g(this).data("displayWidth")+" columns.");b=u.PanelManager.getPanels("TextSequence")[0];"Display full alignment"===g(this).html()?(g(this).html("Hide full alignment"),g(this).closest(".message-pad").find("p:first-child").hide().html(h).fadeIn("slow"),b&&b.el.hide(),c&&c.el.fadeIn()):(g(this).html("Display full alignment"),g(this).closest(".message-pad").find("p:first-child").hide().html(f).fadeIn("slow"),c&&c.el.hide(),b&&b.el.fadeIn());c||(k={},Object.assign(k,g(this).data(),b.params),c=u.EventManager.trigger("createPanel","full_alignment","TextSequence",k),k=c.showFullTextSequence(g(this).data("totalLength"),g(this).data("chunkLength"),g(this).data("displayWidth")),c.el.html(k),c.init())})}});u.Panel.CellTypeSelector=u.Panel.CloudMultiSelector.extend({updateSelection:function(){if(this.changed){var b={image_config:this.params.image_config};b[this.urlParam+"_on"]=encodeURIComponent(this.changed_on.join(","));b[this.urlParam+"_off"]=encodeURIComponent(this.changed_off.join(","));this.reset_selection();g.ajax({url:"/"+u.species+"/Ajax/cell_type",data:b,context:this,complete:function(){var c=["FeaturesByCellLine","FeatureDetails","FeatureSummary","ViewBottom"];u.EventManager.trigger("partialReload");for(var f=0;f<c.length;f++)u.EventManager.triggerSpecific("updatePanel",c[f])}});return!0}}});u.Panel.ComparaAlignSliceSelector=u.Panel.extend({constructor:function(b){this.base(b);u.EventManager.register("updateAlignmentSpeciesSelection",this,this.updateAlignmentSpeciesSelection);u.EventManager.register("updateMultipleAlignmentSpeciesSelection",this,this.updateMultipleAlignmentSpeciesSelection)},init:function(){this.base();this.elLk.form=g("form",this.el);this.elLk.selectedInput=g("form input.ss-alignment-selected-value",this.el);this.elLk.go=g("form a.alignment-go",this.el);this.configUrl=g("input.compara_config_url",this.el).val();this.updateComponent=g("input.update_component",this.el).val()},updateAlignmentSpeciesSelection:function(b){this.elLk.selectedInput.val(b.data.value);var c=this.elLk.go[0].href;c.match(/align=/)?c.replace(/align=(\d+)/,"align="+b.data.value):c.replace(/;$/,"");this.elLk.form.submit()},updateMultipleAlignmentSpeciesSelection:function(b){var c={};c[u.species]={};g.each(b.childList,function(f,h){c[u.species][h.data.key]=h.bSelected?"yes":"off"});c[u.species].align=b.data.value;g.ajax({url:this.configUrl,type:"POST",data:{alignment_selector:JSON.stringify(c),submit:1},traditional:!0,dataType:"json",async:!1,context:this,success:function(f){f.updated&&((f=this.elLk.selectedInput.val())&&f===b.data.value?(this.elLk.selectedInput.val(b.data.value),u.EventManager.trigger("queuePageReload",this.updateComponent,!0)):this.updateAlignmentSpeciesSelection(b))}})}});u.Panel.EvidenceSelector=u.Panel.CloudMultiSelector.extend({updateSelection:function(){if(this.changed){var b={};b[this.urlParam]=encodeURIComponent(this.selection.join(","));b[this.urlParam+"_on"]=encodeURIComponent(this.changed_on.join(","));b[this.urlParam+"_off"]=encodeURIComponent(this.changed_off.join(","));this.reset_selection();g.ajax({url:"/"+u.species+"/Ajax/evidence",data:b,context:this,complete:function(){u.EventManager.trigger("partialReload");u.EventManager.triggerSpecific("updatePanel","FeaturesByCellLine");u.EventManager.triggerSpecific("updatePanel","ViewBottom")}});return!0}}});u.Panel.ImageMap=u.Panel.Content.extend({constructor:function(b,c){function f(){delete this.imgOffset}
this.base(b,c);this.panning=this.panningAllowed=this.dragging=!1;this.clicking=!0;this.dragCoords={};this.dragRegion={};this.highlightRegions={};this.areas=[];this.draggables=[];this.speciesCount=0;this.minImageWidth=500;this.labelWidth=0;this.boxCoords={};this.altKeyDragging=!1;this.allowHighlight=!!F.location.pathname.match(/\/Location\//);this.locationMarkingArea=!1;this.highlightedTracks={};u.EventManager.register("highlightImage",this,this.highlightImage);u.EventManager.register("mouseUp",this,this.dragStop);u.EventManager.register("hashChange",this,this.hashChange);u.EventManager.register("changeFavourite",this,this.changeFavourite);u.EventManager.register("imageResize",this,function(){this.xhr&&this.xhr.abort();this.getContent()});u.EventManager.register("windowResize",this,f);u.EventManager.register("ajaxLoaded",this,f);u.EventManager.register("changeWidth",this,function(){this.params.updateURL=u.updateURL({image_width:!1},this.params.updateURL);u.EventManager.trigger("queuePageReload",this.id)});u.EventManager.register("highlightAllImages",this,function(){this.align||this.highlightAllImages()});u.EventManager.register("markLocation",this,this.markLocation)},init:function(){var b=this,c={};this.base();this.imageConfig=g("input.image_config",this.el).val();this.viewConfig=g("input.view_config",this.el).val();this.hashChangeReload=(this.lastImage=1<u.images.total&&this.el.parents(".image_panel")[0]===u.images.last)||g(".hash_change_reload",this.el).length;this.zMenus={};this.params.highlight=1===u.images.total||!this.lastImage;this.elLk.container=g(".image_container",this.el);this.elLk.drag=g(".drag_select",this.elLk.container);this.elLk.map=g(".json_imagemap",this.elLk.container);var f=this.loadJSON(this.elLk.map.html());this.elLk.areas=f.out;this.elLk.resizeMenu=g(".image_resize_menu",this.elLk.container).appendTo("body").css("left",this.el.offset().left).attr("rel",this.id);this.elLk.img=g("img.imagemap",this.elLk.container);this.elLk.hoverLabels=g(".hover_label",this.elLk.container);this.elLk.boundaries=g(".boundaries",this.elLk.container);this.elLk.toolbars=g(".image_toolbar",this.elLk.container);this.elLk.exportButton=this.elLk.toolbars.find(".export");this.elLk.popupLinks=g("a.popup",this.elLk.toolbars);this.vertical=this.elLk.img.hasClass("vertical");f.flags&&(this.multi=f.flags.multi,this.align=f.flags.align);this.makeImageMap();this.makeHoverLabels();this.initImageButtons();this.initImagePanning();this.initSelector();this.highlightLastUploadedUserDataTrack();this.markLocation(u.markedLocation);this.updateHighlightedTracks();this.vertical||this.makeResizable();c[this.id]=this.getSpecies();g.extend(this,u.Share);this.shareInit({species:c,type:"image",positionPopup:this.positionToolbarPopup});if(this.elLk.boundaries.length)if(u.EventManager.register("changeTrackOrder",this,this.externalOrder),this.elLk.img[0].complete)this.makeSortable();else this.elLk.img.on("load",function(){b.makeSortable()});"undefined"!==typeof FileReader&&this.dropFileUpload();g("a",this.elLk.toolbars).helptip({track:!1});g("a.resize",this.elLk.toolbars).data("popup",this.elLk.resizeMenu);this.elLk.popupLinks.on("click",function(){var h=g(this).data("popup");b.elLk.popupLinks.map(function(){return(g(this).data("popup")||g()).filter(":visible")[0]}).not(h).hide();h&&!h.hasClass("share_page")&&b.positionToolbarPopup(h,this).toggle();h=null;return!1});g("a.image_resize",this.elLk.resizeMenu).on("click",function(){g(this).has(".current").length||b.resize(parseInt(g(this).text(),10)||u.imageWidth());return!1});this.highlightAllImages()},loadJSON:function(b){if(!b)return{out:[],flags:{}};raw=g.parseJSON(b);out=[];flags={};g.each(raw,function(c,f){data={shape:f[0],coords:f[1],attrs:f[2]};klass={};data.attrs.klass&&g.each(data.attrs.klass,function(h,k){klass[k]=1;flags[k]=1});data.klass=klass;out.push(data)});return{out:out,flags:flags}},initImageButtons:function(){var b=this;this.el.find("._reset").on("click",function(c){c.preventDefault();g.ajax({context:b,url:this.href,type:"post",success:function(){u.EventManager.trigger("resetConfig");u.EventManager.trigger("resetMessage");this.getContent()},data:{image_config:b.imageConfig,view_config:b.viewConfig}})})},initImagePanning:function(){var b=this;this.elLk.boundaries.length&&this.draggables.length&&!this.draggables[0].a.klass.noscroll&&(this.elLk.dragSwitch=this.elLk.toolbars.first().append('<div class="scroll-switch"><span>Drag/Select:</span><div><button title="Scroll to a region" class="dragging on"></button></div><div class="last"><button title="Select a region" class="dragging"></button></div></div>').find("button").helptip().on("click",function(){var c=g(this).hasClass("on");b.setPanning(c);c&&(b.selectArea(!1),b.removeZMenus())}).parent(),this.panningAllowed=!0,this.setPanning())},hashChange:function(b){var c=this.hashChangeReload;this.params.updateURL=u.urlFromHash(this.params.updateURL);if(1===u.images.total)this.highlightAllImages();else if(!this.multi&&this.highlightRegions[0]){var f=this.highlightRegions[0][0].region.range;b=b.split(/\W/);if(parseInt(b[1],10)<f.start||parseInt(b[2],10)>f.end||f.chr!==b[0])c=!0}c&&this.base();this.align&&u.EventManager.trigger("highlightAllImages")},toggleLoading:function(b){b?(this.selectArea(!1),this.elLk.drag.filter(":not(:has(.image_spinner))").append('<div class="spinner image_spinner"><div>'),this.elLk.toolbars.append('<div class="image_loading">Loading&#133;</div>')):this.elLk.drag.find(".image_spinner").add(this.elLk.toolbars.find(".image_loading")).remove()},getContent:function(b,c,f,h,k){this.imageConfig&&(g(this.elLk.labelLayers).add(this.elLk.hoverLayers).add(this.elLk.resizeMenu).remove(),this.removeZMenus(),this.removeShare());this.elLk.drag&&this.elLk.drag.length&&g.contains(this.el[0],this.elLk.drag[0])&&(this.toggleLoading(!0),k=k||{},k.background=!0);this.base.call(this,b,c,f,h,k);this.xhr.done(function(l){l||(delete u.images[this.imageNumber],u.EventManager.trigger("highlightAllImages"))})},makeImageMap:function(){var b=this,c=["l","t","r","b"];g.each(this.elLk.areas,function(){var f={a:this};this.shape&&"rect"!==this.shape.toLowerCase()?(f.c=[],g.each(this.coords,function(){f.c.push(parseInt(this,10))})):g.each(this.coords,function(q){f[c[q]]=parseInt(this,10)});b.areas.push(f);if(this.klass.drag||this.klass.vdrag){var h=this.attrs.href.split("|");var k=parseInt(h[5],10);var l=parseInt(h[6],10);var p=(l-k+1)/(this.vertical?f.b-f.t:f.r-f.l);f.range={chr:h[4],start:k,end:l,scale:p,vertical:this.vertical};b.draggables.push(f);b.allowHighlight&&!b.vertical&&(k=parseInt(h[1],10)-1,b.multi||!k)&&(b.highlightRegions[k]||(b.highlightRegions[k]=[],b.speciesCount++),b.highlightRegions[k].push({region:f}),b.imageNumber=parseInt(h[2],10),u.images[b.imageNumber]=u.images[b.imageNumber]||{},u.images[b.imageNumber][k]=[b.imageNumber,k,parseInt(h[5],10),parseInt(h[6],10)])}});this.draggables.length&&(this.locationMarkingArea=this.draggables[0]);u.images.total&&this.highlightAllImages();this.elLk.drag.on({mousedown:function(f,h){f=h||f;f.which&&1!==f.which||b.dragStart(f);return!1},mousemove:function(f,h){if(!1===b.dragging)if(f=b.getArea(b.getMapCoords(h||f)),g(this).toggleClass("drag_select_pointer",!(!f||f.a.klass.label||f.a.klass.drag||f.a.klass.vdrag||f.a.klass.hover)),f&&f.a&&(f.a.klass.nav||f.a.klass.tooltip)){if(k!==f.a.attrs.alt){var k=f.a.attrs.alt;b.elLk.helpTip||(b.elLk.helpTip=g('<div class="ui-tooltip helptip-top"><div class="ui-tooltip-content"></div></div>'));b.elLk.helpTip.children().html(k).end().appendTo("body").position({of:{pageX:b.imgOffset.left+f.l+10,pageY:b.imgOffset.top+f.b+(f.b-f.t)-15,preventDefault:!0},my:"center top"})}}else b.elLk.helpTip&&b.elLk.helpTip.detach().css({top:0,left:0})},mouseleave:function(f,h){(h||f).relatedTarget&&b.elLk.helpTip&&b.elLk.helpTip.detach()},click:function(f,h){f=h||f;b.clicking?b.makeZMenu(f,b.getMapCoords(f)):b.clicking=!0}})},makeHoverLabels:function(){var b=this;this.elLk.labelLayers=g();this.elLk.hoverLayers=g();g.each(this.areas,function(){if(this.a){if(this.a.klass.label){var c="";g.each(this.a.klass,function(k,l){"label"!=k&&(c+=k)});c=b.elLk.hoverLabels.filter("."+c);var f=c.find(".hl-content ._copy_url"),h=g("<a/>",{href:f.val()}).prop("href");f.val(h);c.find(".hl-content ._copy_url").val(h);c.length&&(b.elLk.labelLayers=b.elLk.labelLayers.add(g('<div class="label_layer _label_layer">').append('<div class="label_layer_bg">').append(c).appendTo(b.elLk.container).data({area:this})));b.labelWidth=Math.max(b.labelWidth,this.a.coords[2]);c=null}else this.a.klass.hover?b.elLk.hoverLayers=b.elLk.hoverLayers.add(g('<div class="hover_layer">').appendTo(b.elLk.container).data({area:this}).on("mousedown mousemove click",function(k){b.elLk.drag.triggerHandler(k.type,k)})):this.a.klass.hoverzmenu&&this.a.attrs.alt&&(f=g('<div class="label_layer">'),f.appendTo(b.elLk.container).data({area:this}),b.elLk.labelLayers=b.elLk.labelLayers.add(f),function(k){k.on("click",function(l){g(this).data("zmenu")||(l=b.makeZMenu(l,b.getMapCoords(l),{approx:2}),g(this).data("zmenu",l));g("#"+g(this).data("zmenu")).show().find(".close").remove()});k.on("mouseleave",function(l){g("#"+g(this).data("zmenu")).delay(200).hide(0).on("mouseenter",function(){g(this).clearQueue()}).on("mouseleave",function(){g(this).hide()})})}(f));$a=null}});this.elLk.labelLayers.on({mouseenter:function(){g(this).find("._dyna_load").removeClass("_dyna_load").dynaLoad();b.elLk.boundaries.find("."+g(this).find(".hl-icon-highlight").data("highlightTrack")).addClass("hover")},mouseleave:function(){b.elLk.boundaries.find("."+g(this).find(".hl-icon-highlight").data("highlightTrack")).removeClass("hover")},click:function(c){g(this).siblings().not(".pinned").find(".hover_label").hide();g(this).hasClass("pinned")||(g(this).find(".hover_label").toggle().off().click(function(f){("A"!==f.target.nodeName||g(f.target).hasClass("config"))&&f.stopPropagation()}),g(L).off(".hoverMenuRemove").on("click.hoverMenuRemove",function(f){g(f.target).is("._label_layer")||(g(b.elLk.labelLayers).not(".pinned").find(".hover_label").hide(),g(this).off(".hoverMenuRemove"))}))}}).find(".close").on({click:function(c){g(this).parent().hide();g(this).siblings("._hl_pin").removeClass("on").closest("._label_layer").removeClass("pinned");c.stopPropagation();g(L).off(".hoverMenuRemove")}}).externalLinks();this.positionLayers();this.elLk.hoverLabels.css("left",function(){return g(this.parentNode).width()});this.initHoverLabels()},positionLayers:function(){if(this.elLk.img&&this.elLk.img.length){var b=this.elLk.container.offset(),c=this.elLk.img.offset(),f=c.top-b.top-1,h=c.left-b.left-1,k=this.labelWidth;this.elLk.labelLayers.each(function(){var l=g(this),p=l.data("area");l.css({left:h+p.l,top:f+p.t,height:p.b-p.t,width:k-p.l})});this.elLk.hoverLayers.each(function(){var l=g(this),p=l.data("area");l.css({left:h+p.l+1,top:f+p.t+1,height:p.b-p.t,width:p.r-p.l})})}},initHoverLabels:function(){var b=this;this.elLk.hoverLabels.each(function(){g(this).find("._hl_icon").removeClass("_hl_icon").tabs(g(this).find("._hl_tab")).end().find("._hl_pin").off().on("click",function(c){g(this).toggleClass("on").closest("._label_layer").toggleClass("pinned",g(this).hasClass("on"));c.stopPropagation&&c.stopPropagation()}).end().find("._hl_extend").off().on({click:function(c){c.stopPropagation()},mousedown:function(c){c.preventDefault();var f=g(this).closest(".hover_label");g(L).on("mousemove.resizeHoverLabel",{hoverLabel:f,startX:c.pageX,startW:f.width()},function(h){h.data.hoverLabel.css("width",Math.max(300,Math.min(u.cookie.get("ENSEMBL_WIDTH")-300,h.data.startW+h.pageX-h.data.startX)))}).on("mouseup.resizeHoverLabel",function(){g(L).off(".resizeHoverLabel")})}})}).find(".hl-icon-highlight").on("click",function(c){c.preventDefault();b.toggleHighlight(g(this).data("highlightTrack"))}).end().find("a.config").on("click",function(c){c.preventDefault();b.handleConfigClick(this)}).end().find("form.graph_config").on("submit",function(c){c.preventDefault();b.handleGraphForm(this)}).end().find("input._copy_url").off().on("click focus blur",function(c){g(this).val(this.value).select().closest("._label_layer").toggleClass("focused","blur"!==c.type)})},toggleHighlight:function(b,c){var f=this;Array.isArray(b)||(b=[b]);g.each(b,function(h,k){track=k&&k.split(".")[0];(h=g(g(f.elLk.boundaries).find("li."+track)))&&(c?g(h)&&g(h).addClass("track_highlight"):""!==c&&c!==R?g(h)&&g(h).removeClass("track_highlight"):g(h)&&g(h).toggleClass("track_highlight"))});this.updateHighlightedTracks()},updateHighlightedTracks:function(){var b=this;g.each(b.elLk.hoverLabels,function(c,f){c=g(f).find(".hl-icon-highlight").data("highlightTrack");g("li",b.elLk.boundaries).filter(".track_highlight."+c).length?b.highlightedTracks[c]=1:b.highlightedTracks[c]&&delete b.highlightedTracks[c]});this.updateExportButton()},highlightLastUploadedUserDataTrack:function(){var b=this,c=[];this.elLk.boundaries.find("li._new_userdata.usertrack_highlight").on("mouseover",function(){b.removeUserDataHighlight()});var f=0;this.elLk.boundaries.children().each(function(h){h=g(this);g(this).hasClass("_new_userdata")?c.push(h):(b.addHighlightClasses(c),c=[]);f++;c.length&&b.elLk.boundaries.children().length===f&&b.addHighlightClasses(c)})},addHighlightClasses:function(b){1<b.length?g(b).each(function(c,f){0==c?g(f).addClass("usertrack_highlight_border_top usertrack_highlight_border_left usertrack_highlight_border_right"):c!==b.length-1?g(f).addClass("usertrack_highlight_border_left usertrack_highlight_border_right"):g(f).addClass("usertrack_highlight_border_bottom usertrack_highlight_border_left usertrack_highlight_border_right")}):1==b.length&&g(b[0]).addClass("usertrack_highlight_border_top usertrack_highlight_border_bottom usertrack_highlight_border_left usertrack_highlight_border_right")},removeUserDataHighlight:function(){g(this.elLk.boundaries).find("._new_userdata").removeClass("usertrack_highlight _new_userdata usertrack_highlight_border_top usertrack_highlight_border_left usertrack_highlight_border_right usertrack_highlight_border_bottom")},handleConfigClick:function(b){var c=g(b);if(!c.parent().hasClass("current")){var f=b.rel;b=b.href.split(";");var h=b.pop().split("="),k="";k={};var l=c.hasClass("favourite"),p=c.hasClass("hl-icon-highlight"),q=c.hasClass("matrix-cell");l||p?(k=c.hasClass("selected")?"off":"on",b.push(h[0]+"="+h[1]+k),l&&u.EventManager.trigger("changeFavourite",h[0],"on"===k),this.changeHighlightTrackIcon(h[0],"on"===k)):(c.parents("._label_layer").addClass("hover_label_spinner"),k[h[0]]={renderer:h[1]},b.push("image_config="+
encodeURIComponent(JSON.stringify(k))));g.ajax({url:b.join(";"),dataType:"json",context:{panel:this,track:h[0],update:h[1]},success:function(m){m.updated&&(this.panel.changeConfiguration(f,this.track,this.update),this.panel.updateExportButton(),q&&u.EventManager.trigger("updateFromTrackLabel",h))}});c=null}},handleGraphForm:function(b){b=g(b);var c=b.prop("action").split(";"),f=b.find("input[name=config]").val(),h=b.find("input[name=track]").val(),k=b.find("input[name=y_min]").val(),l=b.find("input[name=y_max]").val();b.parents("._label_layer").addClass("hover_label_spinner");b={};b[h]={y_max:l,y_min:k};c.push("image_config="+encodeURIComponent(JSON.stringify(b)));g.ajax({url:c.join(";"),dataType:"json",context:{panel:this,track:h,update:l},success:function(p){p.updated&&this.panel.changeAxes(f,this.track,this.y_min,this.y_max)}});$form=null},changeConfiguration:function(b,c,f){u.EventManager.triggerSpecific("changeConfiguration","modal_config_"+b,c,f);"off"===f&&this.removeTrack(c)||(u.EventManager.trigger("reloadPage",this.id),u.EventManager.trigger("partialReload"))},changeAxes:function(b,c,f,h){u.EventManager.triggerSpecific("changeAxes","modal_config_"+b,c,f,h);u.EventManager.trigger("reloadPage",this.id);u.EventManager.trigger("partialReload")},makeResizable:function(){function b(h,k){f.imageResize=100*Math.floor(k.size.width/100);c.apply(this,[k.helper].concat("resizestart"===h.type?["Drag to resize",h.pageY]:f.imageResize+"px"))}function c(h,k,l){"number"===typeof l?h.data("y",l):l=h.data("y");h.html('<div class="bg"></div><div class="ui-tooltip"><div class="ui-tooltip-content"></div></div>').find(".ui-tooltip-content").html(k).parent().css("top",function(){return l-h.offset().top-g(this).outerHeight(!0)/2});h=null}var f=this;this.elLk.container.resizable({handles:"e",grid:[100,0],minWidth:this.minImageWidth,maxWidth:g(F).width()-this.el.offset().left,helper:"image_resize_overlay",start:b,resize:b,stop:function(h,k){k.originalSize.width===k.size.width?g(this).css({width:f.imageResize,height:""}):f.resize(f.imageResize)}})},makeSortable:function(){var b=this,c=g(".boundaries_wrapper",this.el).position().top,f=this.elLk.boundaries.position().top+
c-(u.browser.ie7?3:0),h=[];this.elLk.boundaries.children().each(function(k){var l=g(this),p=l.position().top+f,q=[];l.data({areas:q,position:k,top:l.offset().top});h.push({top:Math.floor(p),bottom:Math.ceil(p+l.height()),areas:q})});g.each(this.areas,function(){var k=0;a:for(;10>=k;k++)for(var l=h.length-1;0<=l;l--)if(h[l].top<=this.t+k&&h[l].bottom>=this.b-k){h[l].areas.push(this);this.assigned=!0;break a}});this.elLk.boundaries.each(function(){g(this).data("species",this.className.split(" ")[0])}).sortable({axis:"y",handle:"div.handle",revert:200,helper:"clone",placeholder:"placeholder",start:function(k,l){b.sortStart(k,l)},stop:function(k,l){b.sortStop(k,l)},update:function(k,l){b.sortUpdate(k,l)}}).css("visibility","visible");this.elLk.img2=this.elLk.img.wrap("<div>").parent().css({overflow:"hidden",height:c}).clone().insertAfter(this.elLk.img.parent()).css({height:"auto"}).find("img").css({marginTop:-c})},removeTrack:function(b){var c=this;if(!this.elLk.img2)return!1;var f=0;this.el.find("li."+b).each(function(){var h=g(this),k=h.data("areas");c.areas=g.grep(c.areas,function(l){return-1===g.inArray(l,k)});f+=parseInt(h.css("height"));h=null}).remove();this.elLk.labelLayers=this.elLk.labelLayers.has("."+b).remove().end().filter(function(){return!!this.parentNode});this.elLk.img2.css("marginTop",parseInt(this.elLk.img2.css("marginTop"))-f);this.positionAreas(-f);this.positionLayers();this.removeShare();u.EventManager.trigger("removeShare");0<Object.keys(this.highlightRegions).length&&this.highlightImage(this.imageNumber,0);this.markLocation(u.markedLocation);return!0},sortStart:function(b,c){c.placeholder.css({backgroundImage:c.item.css("backgroundImage"),backgroundPosition:c.item.css("backgroundPosition"),backgroundPositionY:c.item.css("backgroundPositionY"),height:c.item.height(),opacity:.8}).html(c.item.html());c.helper.stop().css({opacity:.8}).addClass("helper");g(L.body).addClass("track-reordering");this.dragging=!0},sortStop:function(b,c){g(L.body).removeClass("track-reordering");this.dragging=!1},sortUpdate:function(b,c){b=g.trim(c.item.prev().prop("className")||"").replace(" ",".");var f=g.trim(c.item.prop("className")).replace(" ",".");u.EventManager.triggerSpecific("changeTrackOrder","modal_config_"+this.id.toLowerCase(),f,b);this.afterSort(c.item.parent().data("species"),f,b)},externalOrder:function(b,c,f){var h=this.elLk.boundaries.find("li."+c),k=[],l;for(l in f)if(k=this.elLk.boundaries.find("li."+f[l]),k.length)break;h.length&&(k.length?h.insertAfter(k):h.parent().prepend(h));this.afterSort(b,c,f[0]||"")},afterSort:function(b,c,f){this.positionAreas();this.positionLayers();this.removeShare();u.EventManager.trigger("removeShare");this.saveSort(b,c,f)},saveSort:function(b,c,f){g.ajax({url:"/"+b+"/Ajax/track_order",type:"post",data:{image_config:this.imageConfig,track:c,prev:f}})},positionAreas:function(b){var c=this.elLk.boundaries.children();c.each(function(f){var h=g(this);if(f!==h.data("position")){var k=h.offset().top;var l=k-h.data("top");g.each(h.data("areas"),function(){this.t+=l;this.b+=l});h.data({top:k,position:f})}h=null});b&&g.each(this.areas,function(f,h){h.a.klass.drag?h.b+=b:h.a.klass.label&&!h.assigned&&(h.t+=b,h.b+=b)});c=null},changeFavourite:function(b,c){this.elLk.hoverLabels.filter("."+b).find("a.favourite").toggleClass("selected",c)},changeHighlightTrackIcon:function(b,c){this.elLk.hoverLabels.filter("."+b).find("a.hl-icon-highlight").toggleClass("selected",c)},dragStart:function(b){var c=this;this.dragCoords.map=this.getMapCoords(b);this.dragCoords.page={x:b.pageX,y:b.pageY};this.dragCoords.offset={x:b.pageX-this.dragCoords.map.x,y:b.pageY-this.dragCoords.map.y};if(this.dragRegion=this.getArea(this.dragCoords.map,!0))this.mousemove=function(f,h){c.dragging=b;c.drag(h||f);return!1},this.elLk.drag.on("mousemove",this.mousemove),g(L).on("keyup.exitOnEsc",function(f){27===f.which&&(c.newLocation=!1,c.panning&&c.dragStop())}),(this.altKeyDragging=b.altKey||b.shiftKey||b.metaKey)&&this.setPanning(!this.panning),this.panning&&(this.selectArea(!1),this.removeZMenus(),this.elLk.hoverLayers.hide())},dragStop:function(b){this.mousemove&&(this.elLk.drag.off("mousemove",this.mousemove),this.mousemove=!1,g(L).off(".exitOnEsc"),this.altKeyDragging&&this.setPanning(!this.panning));if(!1!==this.dragging)if(this.elLk.hoverLayers.show(),this.elLk.boundariesPanning)this.clicking=this.dragging=!1,this.elLk.boundariesPanning.helptip("destroy"),this.newLocation?u.updateLocation(this.newLocation):(this.elLk.boundariesPanning.parent().remove(),this.elLk.boundariesPanning=!1,this.markLocation(u.markedLocation));else{var c=b.pageX-this.dragCoords.page.x;var f=b.pageY-this.dragCoords.page.y;3>Math.abs(c)&&3>Math.abs(f)?this.clicking=!0:(c=this.vertical?{r:f,s:this.dragCoords.map.y}:{r:c,s:this.dragCoords.map.x},this.makeZMenu(b,c,{onclose:function(){this.selectArea(!1)},context:this}),this.clicking=this.dragging=!1)}},drag:function(b){this.panning?this.panImage(b):this.selectArea(b)},setPanning:function(b){this.panningAllowed&&("undefined"===typeof b?b="1"===u.cookie.get("ENSEMBL_REGION_PAN"):u.cookie.set("ENSEMBL_REGION_PAN",b?"1":"0"),this.panning=b,this.elLk.dragSwitch.toggleClass2("selected",function(){return g(this).find("button").hasClass("on")?b:!b}))},panImage:function(b){this.elLk.boundariesPanning||(this.elLk.boundariesPanning=g('<div class="boundaries_panning">').appendTo(this.elLk.boundaries.parent()).append(this.elLk.boundaries.clone()).css({left:this.dragRegion.l,width:this.dragRegion.r-this.dragRegion.l}).find("ul").find("li").css("marginLeft",-1*this.dragRegion.l).end().helptip({delay:500,position:{at:"center",of:this.el}}));(b=Math.min(this.dragRegion.range.start-1,Math.round((b.pageX-this.dragCoords.page.x)*this.dragRegion.range.scale)))?(this.newLocation=this.dragRegion.range.chr+":"+(this.dragRegion.range.start-b)+"-"+(this.dragRegion.range.end-b),this.elLk.boundariesPanning.helptip("option","content",this.newLocation).helptip("open"),this.markLocation(u.markedLocation,b)):(this.newLocation=!1,this.elLk.boundariesPanning.helptip("close"));this.elLk.boundariesPanning.css("left",b/this.dragRegion.range.scale+
"px")},resize:function(b){this.params.updateURL=u.updateURL({image_width:b},this.params.updateURL);this.getContent()},makeZMenu:function(b,c,f){var h;if((h=c.r?this.dragRegion:f&&f.approx?this.getBestArea(c,R,f.approx):this.getArea(c))&&!h.a.klass.label&&!h.a.klass.tooltip)if(h.a.klass.nav)this.navClick(h,b);else{h.a.attrs.href&&u.markedLocation&&(h.a.attrs.href=u.updateURL({mr:u.markedLocation[0]},h.a.attrs.href));var k=(f&&f.mr_menu?"mr_menu":"zmenu_")+h.a.coords.join("_"),l,p;if(b.shiftKey||h.a.klass.das||h.a.klass.group)if(p=(l=this.dragRegion||this.getArea(c,!0))?l.range:!1){l=p.start+p.scale*(p.vertical?c.y-l.t:c.x-l.l);var q=2*p.scale;c.clickChr=p.chr;c.clickStart=Math.max(Math.floor(l-q),p.start);c.clickEnd=1<q?Math.min(Math.ceil(l+q),p.end):Math.max(c.clickStart,Math.floor(l));c.clickY=h.a.coords[3]-c.y;k+="_multi"}if(f&&f.close)(b=g("#"+k))&&b.hide();else return u.EventManager.trigger("makeZMenu",k,g.extend({event:b,coords:c,area:h,imageId:this.id,relatedEl:h.a.id?g("."+h.a.id,this.el):!1},f)),this.zMenus[k]=1,k}},navClick:function(b,c){u.redirect(b.a.attrs.href)},removeZMenus:function(){for(var b in this.zMenus)u.EventManager.trigger("destroyPanel",b)},highlightAllImages:function(){var b=u.images[this.imageNumber+1]||u.images[this.imageNumber],c;for(c in b){var f=b[c];this.highlightImage.apply(this,f)}if(!this.align&&u.images[this.imageNumber-1])for(c in b=u.images[this.imageNumber],b)f=b[c].slice(),f.unshift("highlightImage"),u.EventManager.trigger.apply(u.EventManager,f)},highlightImage:function(b,c,f,h){if(!(!this.draggables.length||this.vertical||1<b-this.imageNumber||0>b-this.imageNumber))for(var k=this.highlightRegions[c].length,l;k--;){l=this.highlightRegions[c][k];if(!l.region.a)break;this.imageNumber===b&&(1!==this.imageNumber&&this.highlight(l.region,"redbox",c,k),c&&u.multiSpecies[c]?(f=u.multiSpecies[c].location.start,h=u.multiSpecies[c].location.end):(f=u.location.start,h=u.location.end));l={t:Math.round(l.region.t+2),b:Math.round(l.region.b-2),l:Math.round((f-l.region.range.start)/
l.region.range.scale+l.region.l),r:Math.round((h-l.region.range.start)/l.region.range.scale+l.region.l)};this.params.highlight&&(this.boxCoords[c]=l,this.updateExportButton(),this.highlight(l,"redbox2",c,k))}},highlight:function(b,c,f,h){var k=b.r-b.l+1,l=b.b-b.t+1,p={l:{left:b.l,width:1,top:b.t,height:l},r:{left:b.r,width:1,top:b.t,height:l},t:{left:b.l,width:k,top:b.t,height:1,overflow:"hidden"},b:{left:b.l,width:k,top:b.b,height:1,overflow:"hidden"}};if("undefined"!==typeof f){var q=c;c=c+"_"+
f+(h||"")}b=g("."+c,this.el);b.length||(b=g(['<div class="',c,' l"></div><div class="',c,' r"></div><div class="',c,' t"></div><div class="',c,' b"></div>'].join("")).insertAfter(this.elLk.img));b.each(function(){g(this).css(p[this.className.split(" ")[1]])});"undefined"!==typeof f&&b.addClass(q);this.selectArea(!1);b=null},selectArea:function(b){if(!1===b)this.elLk.selector&&this.elLk.selector.hide();else{var c=b.pageX-this.dragCoords.offset.x;b=b.pageY-this.dragCoords.offset.y;switch(c<this.dragCoords.map.x){case!0:var f=c;var h=this.dragCoords.map.x;break;case!1:h=c,f=this.dragCoords.map.x}switch(b<this.dragCoords.map.y){case!0:var k=b;var l=this.dragCoords.map.y;break;case!1:l=b,k=this.dragCoords.map.y}if(this.vertical||c<this.dragRegion.l)f=this.dragRegion.l;if(this.vertical||c>this.dragRegion.r)h=this.dragRegion.r;if(!this.vertical||b<this.dragRegion.t)k=this.dragRegion.t;if(!this.vertical||b>this.dragRegion.b)l=this.dragRegion.b;this.elLk.selector.css({left:f,top:k,width:h-f+1,height:l-k-1}).show()}},initSelector:function(){this.elLk.selector&&this.elLk.selector.length||(this.elLk.selector=g('<div class="_selector selector"></div>').insertAfter(this.elLk.img).toggleClass("vertical",this.vertical).filter(":not(.vertical)").append('<div class="left-border"></div><div class="right-border"></div>').end(),this.activateSelector())},activateSelector:function(){this.elLk.selector.on("click",function(b){b.stopPropagation();g(L).off(".selectbox")}).on("mousedown",{panel:this},function(b){b.stopPropagation();b.preventDefault();g(L).on("mousemove.selectbox",{action:b.target!==b.currentTarget?b.target.className.match(/left/)?"left":"right":"move",x:b.pageX,panel:b.data.panel,width:parseInt(b.data.panel.elLk.selector.css("width")),left:parseInt(b.data.panel.elLk.selector.css("left"))},function(c){c.stopPropagation();var f=c.pageX-c.data.x,h={left:c.data.left,width:c.data.width};"right"!==c.data.action&&(f=Math.max(f,c.data.panel.dragRegion.l+1-h.left));"left"!==c.data.action&&(f=Math.min(c.data.panel.dragRegion.r-h.left-h.width+1,f));switch(c.data.action){case"left":f=Math.min(h.width-6,f);h.left+=f;h.width-=f;break;case"right":h.width=Math.max(h.width+f,6);break;case"move":h.left+=f}c.data.panel.elLk.selector.css(h);c.data.panel.makeZMenu(c,{s:h.left,r:h.width})}).on("mouseup.selectbox click.selectbox",function(c){g(this).off(".selectbox")})}).end()},markLocation:function(b,c){var f=this;c=c||0;if(!this.vertical&&!this.multi&&this.locationMarkingArea)if(this.elLk.markedLocation||(this.elLk.markedLocation=g('<div class="selector mrselector"><div class="mrselector-close">&#9776;</div></div>').hide().insertAfter(this.elLk.selector).find("div").helptip({content:"Click for more options"}).on("click mousedown",function(k){k.stopPropagation();g(this).helptip("close");"click"===k.type&&f.makeZMenu(k,f.getMapCoords(k),{onclose:function(){f.selectArea(!1)},context:f,mr_menu:1})}).end()),this.elLk.markerButton||(this.elLk.markerButton=g('<a class="mr-reset outside">').hide().appendTo(this.elLk.toolbars).helptip().on({refreshTip:function(){g(this).helptip("option","content",this.className.match(/outside/)?"Jump to the marked region":this.className.match(/selected/)?"Clear marked region":"Reinstate marked region")},click:function(k){k.preventDefault();if(this.className.match("selected"))u.markLocation(!1);else if(this.className.match(/outside/)){k=u.getMarkedLocation()||u.lastMarkedLocation;var l=f.locationMarkingArea.range.end-f.locationMarkingArea.range.start,p=(k[2]+k[3])/2;u.markLocation(k);u.updateLocation(k[1]+":"+Math.max(1,Math.round(p-l/2))+"-"+Math.round(p+l/2))}else u.markLocation(u.lastMarkedLocation)}})),!1===b)this.elLk.markedLocation.hide(),this.elLk.markerButton.removeClass("selected").trigger("refreshTip").show(),this.updateExportButton();else if(b){this.selectArea(!1);var h=this.locationMarkingArea.range.start-c;c=this.locationMarkingArea.range.end+1-c;this.locationMarkingArea.range.chr===b[1]&&(h>b[2]&&h<b[3]||c>b[2]&&c<b[3]||h<=b[2]&&c>=b[3])?(this.elLk.markedLocation.css({left:this.locationMarkingArea.l+Math.max(b[2]-h,0)/this.locationMarkingArea.range.scale,width:(Math.min(c,b[3]+1)-Math.max(b[2],h))/this.locationMarkingArea.range.scale-1,top:this.locationMarkingArea.t,height:this.locationMarkingArea.b-
this.locationMarkingArea.t}).show(),this.elLk.markerButton.addClass("selected").removeClass("outside").trigger("refreshTip").show()):(this.elLk.markedLocation.hide(),this.panningAllowed?this.elLk.markerButton.addClass("outside").removeClass("selected").trigger("refreshTip").show():this.elLk.markerButton.hide());this.updateExportButton()}},updateExportButton:function(){var b=this.getExtraExportParam();b=g.isEmptyObject(b)?!1:encodeURIComponent(JSON.stringify(b));this.elLk.exportButton.attr("href",function(){return u.updateURL({extra:b,decodeURL:1},this.href)})},getExtraExportParam:function(){var b={};b.highlightedTracks=Object.keys(this.highlightedTracks);g.isEmptyObject(this.boxCoords)||(b.boxes=this.boxCoords);u.markedLocation&&this.locationMarkingArea&&(b.mark={x:Math.round((u.markedLocation[2]-this.locationMarkingArea.range.start)/this.locationMarkingArea.range.scale+this.locationMarkingArea.l),y:this.locationMarkingArea.t,w:Math.round((u.markedLocation[3]-u.markedLocation[2])/this.locationMarkingArea.range.scale),h:this.locationMarkingArea.b-this.locationMarkingArea.t},b.mark.x<this.locationMarkingArea.l&&(b.mark.w=b.mark.w-this.locationMarkingArea.l+b.mark.x,b.mark.x=this.locationMarkingArea.l),0>=b.mark.w&&delete b.mark);return b},getMapCoords:function(b){this.imgOffset=this.elLk.img||this.imgOffset?this.imgOffset||this.elLk.img.offset():0;return{x:b.pageX-this.imgOffset.left-1,y:b.pageY-this.imgOffset.top-1}},getBestArea:function(b,c,f){var h,k=[[0,0],[-1,0],[1,0],[0,-1],[0,1]];for(h=0;h<k.length;h++){var l=this.getArea({x:b.x+k[h][0]*f,y:b.y+k[h][1]*f},c);if(l)return l}},getArea:function(b,c){c=c?this.draggables:this.areas;for(var f,h,k=0;k<c.length;k++){f=c[k];switch(f.a.shape.toLowerCase()){case"circle":var l=this.inCircle(f.c,b);break;case"poly":l=this.inPoly(f.c,b);break;default:l=this.inRect(f,b)}if(!0===l){l=g.extend({},f);if(!l.a.attrs.overlap)return h||l;h=l}}return h},inRect:function(b,c){return c.x>=b.l&&c.x<=b.r&&c.y>=b.t&&c.y<=b.b},inCircle:function(b,c){return(c.x-b[0])*(c.x-b[0])+(c.y-
b[1])*(c.y-b[1])<=b[2]*b[2]},inPoly:function(b,c){for(var f=b.length,h=0,k,l,p,q,m=0;m<f;m+=2)k=b[m%f]-c.x,p=b[(m+1)%f]-c.y,l=b[(m+2)%f]-c.x,q=b[(m+3)%f]-c.y,h+=Math.atan2(k*q-p*l,k*l+p*q);return.01<Math.abs(h/Math.PI/2)},positionToolbarPopup:function(b,c){c=g(c.parentNode);b.css({top:c.hasClass("bottom")?c.offset().top-b.outerHeight():this.elLk.img.offset().top});return b},getSpecies:function(){var b=g.map(this.draggables,function(f){return f.a.attrs.href.split("|")[3]});if(b.length){var c={};c[u.species]=1;g.each(b,function(){c[this]=1});b=g.map(c,function(f,h){return h})}return 1<b.length?b:R},dropFileUpload:function(){function b(q){q.stopPropagation();q.preventDefault();return!1}function c(q){if(q.length){var m=q.shift();if(m.size>5*Math.pow(1024,2))return c(q);k.readAsText(m);k.onloadend=function(t){l.push(g.ajax({url:"/"+u.species+"/UserData/DropUpload",data:{text:t.target.result,name:m.name},type:"POST",success:function(v){v&&(p=v);c(q)}}))}}else p&&(f.hashChangeReload=!0,u.updateLocation(p))}
var f=this,h=this.el[0],k=new FileReader,l=[],p;h.addEventListener("dragenter",b,!1);h.addEventListener("dragexit",b,!1);h.addEventListener("dragover",b,!1);g(".drop_upload",this.el).length&&!this.multi?h.addEventListener("drop",function(q){q.stopPropagation();q.preventDefault();c([].slice.call(q.dataTransfer.files).sort(function(m,t){return m.name.toLowerCase()>t.name.toLowerCase()}))},!1):h.addEventListener("drop",b,!1);h=null}});u.Panel.Message=u.Panel.Content.extend({constructor:function(){this.base.apply(this,arguments);u.EventManager.register("resetMessage",this,this.reset)},reset:function(){this.el.empty()}});u.Panel.ModalContainer=u.Panel.Overlay.extend({init:function(){var b=this;this.base();this.elLk.content=g(".modal_content",this.el);this.elLk.title=g(".modal_title",this.el);this.elLk.menu=g("ul.tabs",this.el);this.elLk.tabs=g("li",this.elLk.menu);this.elLk.caption=g(".modal_caption",this.el);this.elLk.closeButton=g(".modal_close",this.el).on("click",g.proxy(this.hide,this));this.elLk.overlay=g(".modal_overlay",this.el);this.elLk.overlayBg=g(".modal_overlay_bg",this.el);this.elLk.overlayContent=g(".overlay_content",this.elLk.overlay);this.pageReload=this.reloadURL=this.xhr=!1;this.sectionReload={};this.modalReload={};this.activePanel="";this.el.on("click",".modal_confirm",function(){var c=confirm(this.title+"\nAre you sure you want to continue?");this.title="";!0===c&&b.open(this);return!1});g(".overlay_close",this.elLk.overlay).on("click",g.proxy(this.hideOverlay,this));this.elLk.content.each(function(){g(this).data("tab",b.elLk.tabs.children("a."+this.id).parent())});this.elLk.tabs.children("a").each(function(){g(this).data("panels",b.elLk.content.filter("#"+this.className).addClass("active"))}).on("click",function(){var c=g(this).parent();c.hasClass("active")||(u.EventManager.trigger("updateConfiguration",!0),b.el&&(b.elLk.tabs.removeClass("active"),c.addClass("active"),b.getContent(this.href,g(this).data("panels").filter(".active").attr("id"))));return!1});u.EventManager.register("modalOpen",this,this.open);u.EventManager.register("modalClose",this,this.hide);u.EventManager.register("modalOverlayShow",this,this.showOverlay);u.EventManager.register("modalOverlayHide",this,this.hideOverlay);u.EventManager.register("modalPanelResize",this,this.resizeOverlay);u.EventManager.register("queuePageReload",this,this.setPageReload);u.EventManager.register("addModalContent",this,this.addContent);u.EventManager.register("setActivePanel",this,function(c){this.activePanel=c;this.elLk.content.filter("#"+c).addClass("active")});u.EventManager.register("modalReload",this,function(c){this.modalReload[c]=!0})},open:function(b){var c=g(b),f=(b.className?((b.className.match(/\bmodal_title_(\w+)\b/)||[]).pop()||"").replace("_"," "):"")||this.elLk.caption.html()||b.title||c.text();c=this.el.is(":visible")||c.hasClass("force")?b.rel:this.activePanel.match(/config/)&&b.rel.match(/config/)?this.activePanel:b.rel;c=(c||"").split("-");var h=c[0]?this.elLk.tabs.children("a."+c[0]):[];this.elLk.caption.html(f).show();this.elLk.menu.hide();this.elLk.closeButton.attr({title:"Close",alt:"Close"});this.show();this.getContent(b.href||(h.length?h[0].href:""),c.join("-"));g("body").addClass("modal-open");return!0},hide:function(b){this.base();this.elLk.caption.html("");this.hideOverlay();!0!==b&&!u.EventManager.trigger("updateConfiguration")&&(this.pageReload||this.sectionReload.count)||"force"===this.pageReload?this.setPageReload(!1,!0):g(".modal_reload",this.el).length&&this.setPageReload(!1,!0,!0);g("body").removeClass("modal-open")},showOverlay:function(b){this.overlayShown=!0;this.elLk.overlayContent.children().detach().end().append(b);this.elLk.overlay.show().css({marginLeft:-this.elLk.overlay.outerWidth()/2});this.resizeOverlay();this.elLk.overlayBg.show();this.elLk.closeButton.hide()},hideOverlay:function(){this.overlayShown=!1;this.elLk.closeButton.show();this.elLk.overlayBg.add(this.elLk.overlay).hide()},resizeOverlay:function(){if(this.overlayShown){this.elLk.overlayContent.removeClass("overlay_scroll").height("auto");var b=this.el.height(),c=this.elLk.overlay.outerHeight();this.elLk.overlay.offset().top+c>this.el.offset().top+b&&this.elLk.overlayContent.height(b-2*this.elLk.overlay.position().top-(c-this.elLk.overlay.height())).addClass("overlay_scroll")}},getContent:function(b,c){this.xhr&&this.xhr.abort();var f=b.match(/reset=/)||g(".modal_reload",this.el).remove().length;if(c&&c.match("-")){var h=c.split("-");c=h.shift();h=h.join("-")}else h=(b.match(/#(.+)$/)||[])[1];c=c||(h?this.activePanel:"modal_default");var k=this.elLk.content.filter("#"+c);this.elLk.content.hide();this.activePanel=c;this.modalReload[c]&&(delete this.modalReload[c],f=!0);if(f)k.empty(),u.EventManager.trigger("resetConfig");else if(c.match(/config/)&&k.children(":not(.spinner, .ajax_error)").length){u.EventManager.triggerSpecific("showConfiguration",c,h);this.changeTab(this.elLk.content.filter("#"+c).data("tab"));this.elLk.closeButton.attr({title:"Save and close",alt:"Save and close"});return}k.html('<div class="spinner">Loading Content</div>').show();var l=b.match(/decodeURL=1/)||0;l=u.prepareRequestParams(b,l);this.xhr=g.ajax({url:l.requestURL,type:l.requestType,data:l.requestData,dataType:"json",context:this,success:function(p){var q=h?g.extend(p.params||{},{hash:h}):p.params,m;if(p.redirectURL)return this.getContent(p.redirectURL,c);switch(p.panelType){case"ModalContent":var t="Close";break;case"Configurator":t="Save and close";break;default:t="Update options"}p.activeTab&&this.changeTab(this.elLk.tabs.has("."+p.activeTab));u.EventManager.trigger("destroyPanel",c,"empty");var v=g(p.wrapper);p.tools&&(p.nav+=p.tools);p.nav?m=['<div class="modal_nav nav">',p.nav,"</div>"].join(""):v.addClass("no_local_context");k.html(p.content).wrapInner(v).prepend(m).find(".tool_buttons > p").show();this.elLk.closeButton.attr({title:t,alt:t});v=g(".modal_reload",k);(f||v.length)&&this.setPageReload(g("input.component",k).val(),!1,!!v.length,v.attr("href"));b.match(/reset=/)&&(q.reset=b.match(/reset=(\w+)/)[1]);u.EventManager.trigger("createPanel",c,p.panelType||g((p.content.match(/<input[^<]*class="[^<]*panel_type[^<]*"[^<]*>/)||[])[0]).val(),q)},error:function(p){0!==p.status&&k.html('<div class="error ajax_error"><h3>Ajax error</h3><div class="error-pad"><p>Sorry, the page request failed to load.</p><pre></pre></div></div>').find("pre").text(p.responseText)},complete:function(){this.xhr=!1}})},addContent:function(b,c,f,h){h=this.elLk.tabs.children("a."+(h||f));b&&(this.elLk.content.filter(":last").after(b),this.elLk.content=g(".modal_content",this.el),h.data("panels").push(b[0]),b.data("tab",h.parent()));this.getContent(c,f)},changeTab:function(b){b.hasClass("active")||(this.elLk.tabs.removeClass("active"),b.addClass("active"));this.elLk.caption.hide();this.elLk.menu.show()},setPageReload:function(b,c,f,h){b&&u.PanelManager.panels[b]?(this.sectionReload[b]=1,this.sectionReload.count=(this.sectionReload.count||0)+1):!1!==b&&(this.pageReload=!0);!0===f&&(this.pageReload="force");h&&(this.reloadURL=h);!0===c&&(u.EventManager.trigger("reloadPage",!!this.pageReload||this.sectionReload,this.reloadURL),u.EventManager.trigger("partialReload"),this.sectionReload={})}});u.Panel.ModalContent=u.Panel.LocalContext.extend({constructor:function(){this.base.apply(this,arguments);u.EventManager.register("modalFormSubmit",this,this.formSubmit)},init:function(){var b=this;this.activeLink=!1;this.base();this.elLk.content=g(".modal_wrapper",this.el);g("a",this.elLk.links).on("click",function(){if(!g(this).hasClass("disabled")){var c=g(this).parent();c.hasClass("active")||(b.elLk.links.removeClass("active"),b.getContent(c.addClass("active"),this.href))}return!1});this.elLk.links.on("click",function(c){c.stopPropagation();return g(this).children("a").trigger("click")});this.elLk.content.on("click","a.delete_bookmark",function(){u.EventManager.trigger("deleteBookmark",this.href.match(/id=(\d+)\b/)[1])}).on("click","form div.select_all input",function(){g(this).parents("fieldset").find("input[type=checkbox]").prop("checked",this.checked)}).on("click","form.wizard input.back",function(){g(this).parents("form.wizard").append('<input type="hidden" name="wizard_back" value="1" />').submit()});this.initialize();this.initFromHash()},initialize:function(){this.addSubPanel();this.setSelectAll();this.elLk.dataTable=g("table.data_table",this.el);this.elLk.dataTable.length&&(this.dataTableInit||g.extend(this,u.DataTable),this.dataTableInit(),this.el.togglewrap());u.EventManager.trigger("validateForms",this.el);this.el.find("._ht").helptip();this.el.find("._stt").selectToToggle({},this.el);this.el.find("._sdd").speciesDropdown()},initFromHash:function(){this.params.hash&&this.elLk.links.filter(":has(a."+
this.params.hash+")").trigger("click")},getContent:function(b,c){this.elLk.content.html('<div class="panel"><div class="spinner">Loading Content</div></div>');c=u.prepareRequestParams(c);g.ajax({url:c.requestURL,type:c.requestType,data:c.requestData,dataType:"json",context:this,success:function(f){if(f.redirectURL&&"modal"===f.redirectType)return this.getContent(b,f.redirectURL);if("page"===f.redirectType)return u.redirect(f.redirectURL);"download"===f.redirectType?(u.EventManager.trigger("modalClose"),F.location.href=f.redirectURL):("undefined"===typeof b||b.hasClass("active"))&&this.updateContent(f)},error:function(f){0!==f.status&&this.displayErrorMessage(f.responseText)}})},formSubmit:function(b,c){c=c||b.serialize();g.ajax({url:b.attr("action"),type:b.attr("method"),data:c,dataType:"json",context:this,iframe:!!b.find("input[type=file]").length,form:b,success:function(f){if(f.redirectURL&&"modal"===f.redirectType)return f.modalTab?u.EventManager.trigger("modalOpen",{href:f.redirectURL,rel:f.modalTab}):this.getContent(R,f.redirectURL);"download"===f.redirectType?(u.EventManager.trigger("modalClose"),F.location.href=f.redirectURL):!0===f.success||"page"===f.redirectType?u.EventManager.trigger("reloadPage",!1,"page"===f.redirectType?f.redirectURL:!1):this.el.is(":visible")&&this.updateContent(f)},error:function(f){0!==f.status&&this.displayErrorMessage(f.responseText)}});this.elLk.content.html('<div class="panel"><div class="spinner">Loading Content</div></div>');return!1},updateContent:function(b){var c=this;b.wrapper&&this.elLk.content.wrapInner(b.wrapper);this.elLk.content.html(b.content);g(".modal_reload",this.el).length&&u.EventManager.trigger("queuePageReload","",!1,!1,g(".modal_reload",this.el).attr("href"));if(g(".export_buttons_preview",this.el).length)g(".export_buttons_preview",this.el).on("click",function(){var f=g('input[name="'+this.name+'"]:hidden',c.el);"uncompressed"===this.name?(F.location=g(f).val(),u.EventManager.trigger("modalClose")):("gz"===this.name&&g("form#export",this.el).attr("action",g(f).val()).find('input[name="compression"]').val("gz"),g("form#export",this.el).submit())});this.initialize()},addSubPanel:function(){var b=this,c=[];g(".ajax",this.elLk.content).each(function(){c.push([g(this).parents(".js_panel")[0].id,"Content"])});g(".js_panel",this.elLk.content).each(function(){var h=g("input.subpanel_type",this).val();!h||b instanceof u.Panel[h]||c.push([this.id,h])});for(var f in c)u.EventManager.trigger("destroyPanel",c[f][0],"empty"),u.EventManager.trigger("createPanel",c[f][0],c[f][1])},setSelectAll:function(){g("form div.select_all input",this.elLk.content).prop("checked",function(){return 0>=g(this).parents("fieldset").find("input[type=checkbox]:not(:checked)").length-1});this.elLk.content.find("input._selectall").on("change",function(){g(this).parents("div._selectall").find("input[type=checkbox]").prop("checked",this.checked)})},displayErrorMessage:function(b){this.elLk.content.html('<div class="error ajax_error"><h3>Ajax error</h3><div class="error-pad"><p>Sorry, the page request failed to load.</p><pre></pre></div></div>').find("pre").text(b||"")}});u.Panel.MultiSpeciesSelector=u.Panel.MultiSelector.extend({updateSelection:function(){var b=["s","r","g"],c={},f=[],h=[],k,l;for(k in u.multiSpecies)c[u.multiSpecies[k].s]=parseInt(k,10);for(k=0;k<this.selection.length;k++){var p=c[this.selection[k]];if("undefined"!==typeof p)for(l=b.length;l--;)u.multiSpecies[p][b[l]]&&("s"===b[l]?h.push("s"+(k+1)+"="+u.multiSpecies[p].s):f.push(b[l]+(k+1)+"="+u.multiSpecies[p][b[l]]));else h.push("s"+(k+1)+"="+this.selection[k])}this.selection.join(",")!==this.initialSelection&&g.ajax({url:"/"+u.species+"/Ajax/multi_species?"+h.join(";"),context:this,complete:function(){u.redirect(this.elLk.form.attr("action")+"?"+u.cleanURL(this.elLk.form.serialize()+";"+h.join(";")+";"+f.join(";")))}});return!0}});u.Panel.PopulationGraph=u.Panel.Piechart.extend({init:function(){this.graphColours={A:"#008000",T:"#FF0000",G:"#FF9000",C:"#0000FF","-":"#000000","default":["#008080","#FF00FF","#7B68EE"]};this.base()},toggleContent:function(b){if(b.hasClass("closed")&&!b.data("done")){this.base(b);if(!this.canAddContent())return;this.makeGraphs(this.el.find("."+b.attr("rel")+" .pie_chart > div[id^=graphHolder]").map(function(){return this.id.match(/\d+/).pop()}).toArray());b.data("done",!0)}else this.base(b);b=null},canAddContent:function(){return!!this.graphEls}});u.Panel.RegButtons=u.Panel.Content.extend({constructor:function(b,c){this.base(b,c);u.EventManager.register("partialReload",this,this.partialReload)},partialReload:function(){u.EventManager.triggerSpecific("updatePanel",this.id,null,null,null,null,{background:!0})}});u.Panel.TextSequence=u.Panel.Content.extend({constructor:function(){this.base.apply(this,arguments);u.EventManager.register("dataTableRedraw",this,this.initPopups)},init:function(){var b=this;this.base();u.browser.ie||g("pre > [title]",this.el).helptip({track:!0});this.el.find(".adornment").each(function(){g(this).adorn(function(c){c=g(c);b.initPopups(c);b.updateKey(c);b.fixKey()})});this.el.on("mousedown",".info_popup",function(){g(this).css("zIndex",++u.PanelManager.zIndex)})},updateKey:function(b){var c=g(".sequence_key_json",b);if(c=JSON.parse(c.html()||!1))if(b=b.parents(".js_panel").find(".sequence_key"),b.length){var f=b.data("key")||{};g.extend(!0,f,c);b.data("key",f);var h=[];g.each(f,function(k,l){"variations"==k||"exons"==k?g.each(l,function(p,q){h.push(k+"="+p)}):h.push(k+"="+l)});h.sort();c=this.params.updateURL.replace(/sub_slice\?/,"key?;");c+=h.join(";");b.data("url",c)}},fixKey:function(){this.elLk.keyBox||(this.elLk.keyBox=this.el.parents(".js_panel").find("._adornment_key").first());this.elLk.keyBoxToggler||(this.elLk.keyBoxToggler=g('<div class="toggler"><span class="open">&#9660;</span><span>&#9650;</span></div>'));if(!this.elLk.keyBoxToggler.parent().length)this.elLk.keyBoxToggler.appendTo(this.elLk.keyBox).off(".textsequence").on("click.textsequence",function(){g(this).parent().removeClass("was_collapsed").toggleClass("collapsed",100)});this.elLk.keyBox.keepOnPage({marginTop:10,onreset:function(){g(this).removeClass("fixed").filter(".collapsed").removeClass("collapsed").addClass("was_collapsed")},onfix:function(){g(this).addClass("fixed").filter(".was_collapsed").removeClass("was_collapsed").addClass("collapsed")}}).keepOnPage("trigger")},initPopups:function(b){b.find(".info_popup").hide();b.find("pre a.sequence_info:not(._zmenu_initalised)").zMenuLink().addClass("_zmenu_initalised")},getContent:function(b,c,f,h,k){k=k||{};k.paced=!0;this.elLk.keyBox&&this.elLk.keyBox.keepOnPage("destroy");this.base(b,c,f,h,k)},showFullTextSequence:function(){for(var b=1,c=this.params.chunkLength,f=parseInt(this.params.totalLength/
c)*c,h,k="";c<=this.params.totalLength;){h=this.params.updateURL;h=h.replace(/subslice_start=(\d+);/,"subslice_start="+b+";");h=h.replace(/subslice_end=(\d+);/,"subslice_end="+c+";");h=h.replace(/follow=0/,"");h+=";follow=1";k+='<div class="ajax"><input type="hidden" class="ajax_load" value="'+h+'" /></div>';if(c==this.params.totalLength)break;b=c+1;c+=this.params.chunkLength;c>f&&(c=this.params.totalLength)}return k}});u.Panel.TranscriptHaplotypes=u.Panel.Content.extend({init:function(){var b=this;this.base();this.haplotypeData=JSON.parse(this.params.haplotype_data);delete this.params.haplotype_data;var c=JSON.parse(this.params.population_info);delete this.params.population_info;this.populationStructure=c.population_structure;this.populationDescriptions=c.population_descriptions;this.samplePopulationHash=c.sample_population_hash;this.el.find("a.details-link").on("click",function(h){b.renderHaplotypePanel(this.rel)});this.el.find(".tool_buttons a.popup").removeAttr("rel");this.el.find("a.zmenu").on("click",function(h){h.preventDefault();u.EventManager.trigger("makeZMenu",g(this).text().replace(/\W/g,"_"),{event:h,area:{link:g(this)}})});if(F.location.hash){c=F.location.hash.replace(/^#/,"");var f=c.replace(/_.+/,"");b.fetchHaplotypeByHex(f)&&(b.renderHaplotypePanel(f),F.location.href="#"+c)}},renderHaplotypePanel:function(b){var c=this,f=g("div.details-view");f.show().empty().append(c.detailsContent(b));f.find("._ht").helptip();f.find(".toggle").on("click",function(h){h.preventDefault();c.el.find("#"+
this.rel).toggle();h=g(this);h.hasClass("closed")?h.removeClass("closed").addClass("open"):h.removeClass("open").addClass("closed")});f.find("a.zmenu").on("click",function(h){h.preventDefault();u.EventManager.trigger("makeZMenu",g(this).text().replace(/\W/g,"_"),{event:h,area:{link:g(this)}})})},fetchHaplotypeByHex:function(b){for(var c=0;c<this.haplotypeData.protein_haplotypes.length;c++){var f=this.haplotypeData.protein_haplotypes[c];if(f.hex===b)return f}for(c=0;c<this.haplotypeData.cds_haplotypes.length;c++)if(f=this.haplotypeData.cds_haplotypes[c],f.hex===b)return f},detailsContent:function(b){var c=this.fetchHaplotypeByHex(b);if("undef"===typeof c)return"Unable to display details";var f=c.type,h="cds"===f?"protein":"CDS";f="<hr/><h2>Details of "+("cds"===f?"CDS":"protein")+" haplotype "+c.name.replace(/,/g,",&#8203;")+"</h2><div>";h=[{id:"pop",title:"Population frequencies",sub:"populationTable"},{id:"seq",title:"Aligned sequence",sub:"alignedSequence"},{id:"raw",title:"Sequence",sub:"rawSequence"},{id:"cds",title:"Corresponding "+h+" haplotypes",sub:"otherHaplotypes"},{id:"sam",title:"Sample data",sub:"sampleTable"}];var k=[],l="",p;for(p in h){var q=h[p];k.push('<a href="#'+b+"_"+q.id+'">'+q.title+"</a>");l=l+'<hr style="border-top-color: lightgrey"/><div id="'+b+"_"+q.id+'"><h3>'+q.title+"</h3>"+this[q.sub](c)+"</div>"}return f=f+"<div><i>Jump to: </i>"+k.join(" | ")+"</div>"+l+"</div>"},otherHaplotypes:function(b){b=this.getOtherHaplotypes(b);var c=[],f;for(f in b){var h=b[f],k=h.type.substring(0,1),l=h.name.replace(/,/g,",&#8203;");k='<span id="'+h.hex+'"><b>'+k+".ALT"+("p"===k?"":parseInt(f)+1)+':</b> <a class="_ht" title="Details for '+("REF"===l?"reference haplotype":"haplotype "+l)+'" href="'+F.location.href.replace(/#.+/,"").replace(/;?ht_type=[a-z]+/,"")+";ht_type="+h.type+"#"+h.hex+'">'+l+"</a></span>";k=k+"<br/>Observed count: "+h.count+' | <a href="#" class="toggle closed" rel="seq-'+h.hex+'">Show sequence</a>';k=k+'<div class="hidden" style="margin-top: 1em; display: none" id="seq-'+
h.hex+'">'+this.rawSequence(h)+"</div>";c.push(k)}return(1<c.length?"<p><i>NB: Each CDS sequence below encodes the same protein sequence</i></p>":"")+"<ul>"+c.map(function(p){return"<li>"+p+"</li>"}).join("")+"</ul>"},populationTable:function(b){var c=this.populationStructure,f=this.populationDescriptions,h='<table class="ss" style="width:500px"><tr><th>Population group</th><th>Population</th><th style="width:220px">Frequency (count)</th></tr>',k=Object.keys(c).sort(),l;for(l in k){var p=k[l],q=1,m=[];if(0<c[p].length){for(var t in c[p]){var v=c[p][t],w="",z=b.population_counts.hasOwnProperty(v)?b.population_counts[v]:0,B=b.population_frequencies.hasOwnProperty(v)?b.population_frequencies[v]:0;z&&(q?q=0:w+="<tr>",w=w+'<td><span class="ht _ht" title="'+f[v]+'">'+this.shortName(v)+"</span></td><td>",w+='<nobr><div style="width:220px; float: left;">',w=w+'<div style="width:'+Math.round(120*B)+'px; background-color: #8b9bc1; float: left; display: inline; height: 1em;"></div>',w=w+'<div style="width:'+
Math.round(120*(1-B))+'px; background-color:lightgrey; float: left; display: inline; height: 1em;"></div>',w=w+"&nbsp;"+B.toPrecision(3)+" ("+z+")</div></nobr>",w+="</td></tr>",m.push(w))}h=h+'<tr><td rowspan="'+(0<m.length?m.length:1)+'"><b><span class="ht _ht" title="'+f[p]+'">'+this.shortName(p)+"</span></b></td>";h=m.length?h+m.join(""):h+'<td colspan="2"><span style="font-style: italic; color: grey;">No data</span></td></tr>'}else h+="<tr>",h+="<td>N/A</td>",h=h+'<td><span class="ht _ht" title="'+
f[p]+'">'+this.shortName(p)+"</span></td>",z=b.population_counts.hasOwnProperty(p)?b.population_counts[p]:0,B=b.population_frequencies.hasOwnProperty(p)?b.population_frequencies[p]:0,h+='<td><nobr><div style="width:220px; float: left;">',h=h+'<div style="width:'+Math.round(120*B)+'px; background-color: #8b9bc1; float: left; display: inline; height: 1em;"></div>',h=h+'<div style="width:'+Math.round(120*(1-B))+'px; background-color:lightgrey; float: left; display: inline; height: 1em;"></div>',h=h+
"&nbsp;"+B.toPrecision(3)+" ("+z+")</div></nobr>",h+="</td></tr>"}return h=h+"</table><p><b>Total count:</b> "+b.count+"</p>"},sampleTable:function(b){var c=this,f='<table id="ind-table" class="ss" style="width:500px"><tr><th>Sample name</th><th>Population(s)</th><th>Haplotype copies</th></tr>',h=c.samplePopulationHash,k=c.populationDescriptions,l=c.populationStructure,p={},q;for(q in l){p[q]=1;for(var m in l[q])p[l[q][m]]=2}l=Object.keys(b.samples).sort(function(w,z){w=g.grep(Object.keys(h[w]),function(B){return B.match(/ALL/i)},1).map(c.shortName).sort(function(B,D){return p[B]<p[D]}).join("");z=g.grep(Object.keys(h[z]),function(B){return B.match(/ALL/i)},1).map(c.shortName).sort(function(B,D){return p[B]<p[D]}).join("");return w<z?-1:w>z});m=0;for(q in l){var t=l[q],v=b.samples[t];f=f+'<tr class="bg'+(m+1)+'"><td>'+c.shortName(t)+"</td><td>"+g.grep(Object.keys(h[t]),function(w){return w.match(/ALL/i)},1).sort(function(w,z){return p[w]<p[z]}).map(function(w){return'<span class="ht _ht" title="'+k[w]+'">'+c.shortName(w)+
"</span>"}).join(", ")+"</td><td>"+v+"</td></tr>";m=1-m}return f+"</table>"},alignedSequence:function(b){var c=this;String.prototype.repeat=function(N){return Array(N+1).join(this)};if("protein"===b.type){var f=b;var h=c.getOtherHaplotypes(b)}else f=c.getOtherHaplotypes(b)[0],h=[b];b=f.aligned_sequences[0];var k=f.aligned_sequences[1],l=b.length>=k.length?b.length:k.length;f=c.parseDiffs(f);for(var p=h[0].aligned_sequences[0].replace(/-/g,""),q=h.map(function(N){return N.aligned_sequences[1].replace(/-/g,"")}),m=h.map(function(N){return c.parseDiffs(N)}),t=0,v=0,w=0,z=0,B="",D=1,E=h.length.toString().length,G=["<b>Protein</b>  p.REF "+" ".repeat(E),"         p.ALT "+" ".repeat(E),"<b>CDS</b>      c.REF "+" ".repeat(E)],I=0;I<h.length;I++)G.push('         <a class="_ht" href="#'+h[I].hex+'" title="'+h[I].name.replace(/,/g,",&#8203;")+" ("+h[I].count+')">c.ALT'+(I+1).toString()+"</a> "+" ".repeat(E-(I+1).toString().length));for(h=G.slice();t<l;){E=b.substr(t,1)||"-";var K=k.substr(t,1)||"-";K=E===K?".":K;h[0]=h[0]+" "+E+" ";var S=f.hasOwnProperty(t)?'<span class="ht _ht" style="color:white; background-color:'+f[t].colour+'" title="'+f[t].html+'"> '+K+" </span>":" "+K+" ";h[1]+=S;"-"===E?(S="-".repeat(3),h[2]+=S):(S=p.substr(v,3),h[2]+=D?S:'<span style="background-color:#fff9af">'+S+"</span>",D=1-D);for(I in q){for(var U="-"===K?"-".repeat(3):q[I].substr(w,3),T="",V=0;V<S.length;V++){var O=S.substr(V,1),Q=U.substr(V,1);O=O===Q?".":Q;T=m[I].hasOwnProperty(v+V)?m[I][v+V].hasOwnProperty("variation_feature")?T+'<a class="sequence_info zmenu" draggable="false" href="/'+u.species+"/ZMenu/Variation?v="+m[I][v+V].variation_feature+"&vf="+m[I][v+V].variation_feature_id+'">'+O+"</a>":T+'<span class="ht _ht" title="Unable to identify corresponding variant">'+O+"</span>":T+O}h[parseInt(I)+3]=h[parseInt(I)+3]+T}t++;v+="-"===E?0:3;w+="-"===K?0:3;z+=3;60<=z&&(B=B+h.join("\n")+"\n\n",h=G.slice(),z=0)}B=B+h.join("\n")+"\n\n";return c.sequenceKey()+"<pre>"+B+"</pre>"},sequenceKey:function(){return'<div class="adornment-key" style="position: static;"><dl><dt>Sequence</dt><dd><ul><li><span style="border: 1px solid lightgrey">.&nbsp;&nbsp;Match</span></li><li><span style="border: 1px solid lightgrey">-&nbsp;&nbsp;Missing sequence</span></li></ul></dd><dt>Codons</dt><dd><ul><li><span>Alternating codons</span></li><li><span style="background-color: #fff9af">Alternating codons</span></li></ul></dd><dt>Protein changes</dt><dd><ul><li><span style="color: white; background-color:red">Deleterious or damaging</span></li><li><span style="color: white; background-color:green">Tolerated or benign</span></li><li><span style="color: white; background-color:#ff69b4">Insertion or deletion</span></li><li><span style="color: white; background-color:red">Stop gain or loss</span></li><li><span style="color: white; background-color:grey">Other</span></li></ul></dd></dl></div>'},parseDiffs:function(b){var c={},f;for(f in b.diffs){var h=b.diffs[f],k=h.diff,l=parseInt(k.match(/\d+/g)[0]),p=l;k.match(/{(\d+)}/)?p=l+parseInt(k.match(/{(\d+)}/)[1])-1:k.match(/[A-Z\*]+$/)&&(p=l+k.match(/[A-Z\*]+$/)[0].length-1);var q="<p><b>"+k+"</b></p>",m="grey";k.match(/ins|del/)?m="#ff69b4":k.match(/\*/)&&(m="orange");k=["PolyPhen","SIFT"];for(f in k){var t=k[f],v=t.toLowerCase(),w=R,z=R;h.hasOwnProperty(v+"_prediction")&&(w=h[v+"_prediction"]);h.hasOwnProperty(v+"_score")&&(z=h[v+"_score"]);"undefined"!==typeof w&&(w.match(/deleterious$/)||w.match(/probably.damaging/)?m="red":"grey"===m&&(w.match(/tolerated$/)||w.match(/benign/))&&(m="green"),q=q+"<b>"+t+"</b>: "+w+" ("+z+")<br/>")}h.colour=m;h.html=q;for(f=l-1;f<p;f++)c[f]=h}return c},rawSequence:function(b){return this.fastaSequence(b.name,b.seq)},fastaSequence:function(b,c,f){"undefined"===typeof f&&(f=60);return"<pre>&gt;"+b+"\n"+c.match(new RegExp("(.{1,"+f+"})","g")).join("\n")+"</pre>"},getOtherHaplotypes:function(b){var c=[],f;for(f in b.other_hexes)c.push(this.fetchHaplotypeByHex(f));return c=c.sort(function(h,k){return h.count<k.count?1:h.count>k.count?-1:0})},shortName:function(b){return b.replace("1000GENOMES:phase_3:","")}});u.Panel.Interaction=u.Panel.extend({constructor:function(b,c){this.base(b,c)},init:function(){var b=this;this.base();var c=g('input[name="intr_metadata"]',this.el).val();this.elLk.metadataLink=g(".interactions-right .label a");this.elLk.speciesRows=g(".interactions-species table tbody tr");this.elLk.otherRows=g(".interactions-other table tbody tr");this.elLk.intr_metadata=c?JSON.parse(c):{};this.elLk.metadataLink.click(function(){b.displayMetadata()})},displayMetadata:function(){var b=this;if(g(".metarow",this.el).length)g(".metarow",this.el).toggle();else{var c=this.elLk.intr_metadata.species,f=this.elLk.intr_metadata.other,h,k,l,p;c&&c.forEach(function(q,m){h=b.elLk.speciesRows[m];p='<div class="meta">';q.forEach(function(t){k=t.label?'<div class="label">'+t.label+"</div>":"";l=t.value?'<div class="value"><p>'+
t.value+"</p></div>":"";p+="<div>"+k+l+"</div>"});p+="</div>";g(h).after('<tr class="metarow"  style="background-color:#eee"><td colspan="10">'+p+"</td></tr>")});f&&f.forEach(function(q,m){m=b.elLk.otherRows[m];var t='<div class="meta">';q.forEach(function(v){t+='<div><div class="label">'+v.label+'</div><div class="value">'+v.value+"</div></div>"});t+="</div>";g(m).after('<tr class="metarow"  style="background-color:#eee"><td colspan="10">'+t+"</td></tr>")})}}});u.Panel.ComparaOrtholog=u.Panel.Content.extend({init:function(){this.base.apply(this,arguments);u.EventManager.register("dataTableFilterUpdated",this,this.updateWithoutOrthologList);u.EventManager.register("dataTableFilterUpdated",this,this.updateDownloadButton)},updateDownloadButton:function(b){var c=g(".export.modal_link")[0],f=c.href;0<f.indexOf(";filtered_sets=")&&(f=f.substring(0,f.indexOf(";filtered_sets=")));c.href=f+";filtered_sets="+b.join(",").replace(/\s/g,"")},updateWithoutOrthologList:function(b){var c=0;g("#no_ortho_species li").each(function(){var f=this,h=!1,k=b.length;b.forEach(function(l){l=g.trim(l);1<k&&"all"===l||-1<f.className.indexOf(l)&&(h=!0)});!0===h?(g(f).show(),c+=1):g(f).hide()});g(".no_ortho_count").text(c);0===c?g("#no_ortho_message_pad").hide():g("#no_ortho_message_pad").show()}});u.Panel.ComparaTree=u.Panel.ImageMap.extend({init:function(){this.base.apply(this,arguments);this.elLk.highlightLink=this.el.find(".switch_highlighting");this.elLk.highlightLink.on("click",function(b){var c=g(this);b.preventDefault();u.cookie.set("gene_tree_highlighting",c.hasClass("on")?"off":"on");u.LayoutManager.reloadPage()})}});u.Panel.ConfigManager=u.Panel.ModalContent.extend({constructor:function(b,c){this.base(b,c)},init:function(){var b=this;this.base();u.EventManager.register("modalPanelResize",b,function(){this.el.togglewrap("update")});var c=g("form",this.el);this.elLk.recordTypes=g(".records .record_type",this.el);this.elLk.tables=g("table",this.elLk.recordTypes);this.elLk.shareConfig=g(".share_config",this.el).detach();this.elLk.editSets=g(".edit_config_set",this.el).detach();this.elLk.saveAll=g(".save_all_config_set",this.el).detach();this.elLk.noRecords=g(".no_records",this.el);this.elLk.resetAll=g(".reset_all",this.el);this.elLk.editTypes=g("div.record_type",this.elLk.editSets);this.elLk.editTable=g("table",this.elLk.editTypes);this.elLk.editRecord=g(".edit_record",this.elLk.editSets);this.elLk.editSelected=g("input.selected",this.elLk.editSets);this.elLk.editId=g(".config_key",this.elLk.editSets);this.elLk.addSet=g(".add_set",this.elLk.editSets);this.elLk.saveToGroup=g(".groups",this.elLk.addSet);this.elLk.addHeader=g(".add_header",this.elLk.editSets);this.elLk.editHeader=g(".edit_header",this.elLk.editSets);this.elLk.setsHeader=g(".config_header",this.elLk.editHeader);this.elLk.saveSets=g(".sets ul",this.elLk.saveAll);this.elLk.saveConfigs=g(".configs ul",this.elLk.saveAll);this.elLk.saveHeader=g(".config_header",this.elLk.saveAll);this.elLk.shareURL=g(".share_url",this.elLk.shareConfig);this.elLk.shareGroups=g(".share_groups",this.elLk.shareConfig);this.elLk.shareGroup=g("input.group",this.elLk.shareConfig);this.elLk.shareId=g(".config_key",this.elLk.shareConfig);this.elLk.shareHeader=g(".config_header",this.elLk.shareConfig);this.elLk.addSet.validate({validate:function(f){f&&(f=!!b.elLk.addSet.find("input.selected:checked").length);return f}});c.on("submit",function(){return b.formSubmit(g(this))});this.elLk.tables.on("click",".expand, .collapse",function(){var f=g(this),h=f.parents("tr");f.add(f.siblings("a")).add(h.siblings("."+h[0].className.replace(/ /g,"."))).toggle();if(f.hasClass("expand")&&!f.data("hasConfig")){var k=f.parents("table").dataTable();h=h[0];k.fnOpen(h,'<div class="spinner"></div>').className=h.className;f.data("hasConfig",g.ajax({url:this.href,cache:!1,success:function(l){f.data("hasConfig",!0);var p=g(k.fnOpen(h,l,"details")).addClass(h.className).togglewrap("update").find(".editables_list");0===p.children().length&&p.parent().hide();k.fnUpdate(h.cells[1].innerHTML+'<div class="hidden">'+l+"</div>",h,1);f=h=k=null}}))}else f=h=null;return!1});this.elLk.tables.on("click","a.edit",function(f){f.preventDefault();g.ajax({url:this.href,context:this,dataType:"json",success:function(h){if(b[h.func])b[h.func](g(this).parents("tr"),h);else h.redirectURL&&u.EventManager.trigger("modalOpen",{href:h.redirectURL,rel:h.modalTab})}})});this.elLk.tables.on("click","a.share_record",function(){var f=g(this),h=f.data("share"),k=b.params.records[f.parents("tr").data("configId")];b.elLk.shareHeader.html(k.name);b.elLk.shareId.val(k.id);u.EventManager.trigger("modalOverlayShow",b.elLk.shareConfig);if(h){if(h.groups){b.elLk.shareGroup.prop("checked",function(){return!!h.groups[this.value]});var l=!0}if(h.url){b.elLk.shareURL.val(h.url).show().select();var p=!0}}l||b.elLk.shareGroup.prop("checked",!1);p||b.elLk.shareURL.hide();b.elLk.shareLink=f;f=null;return!1});this.elLk.tables.on("click","a.edit_record",function(){var f=b.params.records[g(this).parents("tr").data("configId")];b.elLk.setsHeader.html(f.name);b.elLk.addSet.add(b.elLk.addHeader).hide();b.elLk.editRecord.add(b.elLk.editHeader).show();b.elLk.editId.val(f.id);b.updateEditTable(f.group+"."+f.groupId,f);u.EventManager.trigger("modalOverlayShow",b.elLk.editSets);return!1});this.elLk.tables.on("click","._ht",function(){g(this).data("uiTooltip").close()});this.elLk.editSets.on("click",".add_to_set",function(){var f=g(this).parents("tr");f.hasClass("disabled")||f.toggleClass("added");var h=f.hasClass("added");if("set"===b.params.recordType)f.siblings("."+(b.params.editables[this.rel].codes.join(", .")||"_")).not(".added")[h?"addClass":"removeClass"]("disabled");b.elLk.editSelected.filter("."+this.rel).prop("checked",h);b.elLk.addSet.filter(function(){return"none"!==this.style.display}).validate();f=null;return!1});g("a.create_set",this.el).on("click",function(){var f=b.elLk.editSets.find("input.record_type");1<f.length&&(f=f.first().prop("checked",!0));b.updateEditTable(f.val());b.elLk.editRecord.add(b.elLk.editHeader).hide();b.elLk.addSet.find("input[name=name], textarea").val("").end().validate();b.elLk.addSet.find(".save").addClass("disabled").prop("disabled",!0);b.elLk.addSet.add(b.elLk.addHeader).show();u.EventManager.trigger("modalOverlayShow",b.elLk.editSets);return!1});g("input.record_type",this.elLk.editSets).on("click",function(){b.elLk.saveToGroup["group"===this.value?"show":"hide"]();b.updateEditTable(this.value+("group"===this.value?"."+b.elLk.saveToGroup.find("input.group:checked").val():""));u.EventManager.trigger("modalPanelResize")});g("input.group",this.elLk.saveToGroup).on("click",function(){b.updateEditTable((g(this).hasClass("suggested")?"suggested":"group")+"."+this.value);u.EventManager.trigger("modalPanelResize")});g(".make_url",this.elLk.shareConfig).on("click",function(){function f(k){h=h||{};h.url=k;b.elLk.shareURL.val(k).show().select();b.elLk.shareLink.data("share",h)}var h=b.elLk.shareLink.data("share");h&&h.url?f(h.url):g.ajax({url:b.elLk.shareLink[0].href,cache:!1,success:f})});g(".cancel, .continue",this.elLk.saveAll).on("click",function(){u.EventManager.trigger("modalOverlayHide");g(this).hasClass("continue")&&b.elLk.saveAllLink.trigger("click")});this.elLk.shareGroup.on("click",function(){var f=b.elLk.shareLink.data("share")||{},h=!0;f.groups=f.groups||{};f.groups[this.value]=this.checked;for(var k in f.groups)if(f.groups[k]){h=!1;break}b.elLk.shareGroups[h?"addClass":"removeClass"]("disabled").prop("disabled",h);b.elLk.shareLink.data("share",f)});this.elLk.shareConfig.add(this.elLk.editSets).find("form").on("submit",function(){u.EventManager.trigger("modalOverlayHide")});g("form",this.elLk.resetAll).on("submit",function(){b.elLk.resetAll.hide()});c=null},initialize:function(){g(".records table tbody tr",this.el).each(function(){g(this).data("configId",this.className)});this.base()},updateEditTable:function(b,c){b=this.elLk.editTypes.hide().filter("."+b).show().find("table").dataTable();this.elLk.editSelected.filter(":checked").prop("checked",!1);b.find("tr").removeClass("added disabled");b.fnDraw();if(c){b=b.find("tbody tr");var f=[],h;for(h in c.editables)f.push("."+h);b.filter(f.join(", ")).addClass("added");b.filter("."+(c.codes.join(", .")||"_")).not(".added").addClass("disabled");this.elLk.editSelected.filter(f.join(", ")).prop("checked",!0)}},saveEdit:function(b,c,f){var h=f.parent().data("configId");f.togglewrap("update").find("._ht").helptip();"name"===b&&(this.params.records[h].name=c);g.ajax({url:f.find("a.save").attr("href"),data:{param:b,value:c},cache:!1,success:function(k){"success"===k&&"name"===b&&u.EventManager.trigger("updateSavedConfig",{changed:{id:h,name:c}})}});f=null},addTableRow:function(b){var c=this;g.ajax({url:this.params.updateURL,data:{config_keys:b.configKeys},traditional:!0,cache:!1,dataType:"json",success:function(f){var h;for(h in f.tables){var k=g(f.tables[h]).find("tbody tr").filter(function(){return!c.params.records[this.className]});if(0!==k.length){var l=c.elLk.tables.filter("."+h).dataTable();c.addDataTableRows(l,k,!0);c.elLk.recordTypes.filter("."+h).show();l.fnSort("config"===c.params.recordType?[[0,"asc"],[1,"asc"],[2,"asc"]]:[[0,"asc"]]);l.togglewrap("update")}}c.elLk.noRecords.hide();g.extend(c.params.records,f.data);l=k=null}})},updateTable:function(b){var c=this.params.records[b.id],f=this.elLk.editTable.find("tbody tr"),h=this.elLk.tables.find("."+b.id).find(".editables_list"),k=h.first().children().detach(),l=b.editables.added||[];b=b.editables.removed||[];var p,q;for(p=0;p<l.length;p++){var m=this.params.editables[l[p]];var t="config"===this.params.recordType?[m,c]:[c,m];k=k.add(g(this.params.listTemplate).addClass(l[p]).find(".name").html(m.name).end().find(".conf").html(m.conf).end());c.editables[l[p]]=1;t[0].codes=t[0].codes.concat(g.grep(t[1].codes,function(v){return-1===g.inArray(v,t[0].codes)}))}for(p=0;p<b.length;p++)for(q in m=this.params.editables[b[p]],t="config"===this.params.recordType?[m,c]:[c,m],k=k.not("."+b[p]),delete c.editables[b[p]],t[1].codes)t[0].codes=g.grep(t[0].codes,function(v){return v!==t[1].codes[q]});"config"===this.params.recordType&&(f.filter("."+(l.join(", .")||"_")).addClass(c.codes[0]),f.filter("."+(b.join(", .")||"_")).removeClass(c.codes[0]));h.html(k.map(function(){return[[g(this).text().toLowerCase(),this]]}).sort(function(v,w){return v[0]<w[0]?-1:v[0]>w[0]?1:0}).map(function(){return this[1]})).parent()[k.length?"show":"hide"]().siblings(".none")[k.length?"hide":"show"]().parents("td").togglewrap("update");f=h=k=null},activateRecord:function(b){var c=this.params.records[b.data("configId")];b.siblings(".active").stop(!0,!0).removeClass("active").find(".config_used").stop(!0,!0).hide();b.addClass("active").find(".config_used").show().delay(1E3).fadeOut(500);this.updatePanels(c);c.codes.length&&this.elLk.resetAll.show()},saveRecord:function(b,c){b=this.elLk.editTypes.filter(".session");var f=this.elLk.editTypes.filter(".user"),h=b.find("table").dataTable();b=f.find("table").dataTable();f=g('<span class="icon_link sprite sprite_disabled _ht save_icon" title="Saved">&nbsp;</span>').helptip();this.elLk.tables.find("tr").filter("."+c.ids.join(", .")).find("a.save_icon").replaceWith(f);f=h.find("tr").filter("."+c.ids.join(", ."));this.addDataTableRows(b,f);f.each(function(){h.fnDeleteRow(this)});b.fnSort("set"===this.params.recordType?[[0,"asc"],[1,"asc"],[2,"asc"]]:[[0,"asc"]]);b.togglewrap("update");for(var k in c.ids)this.params.records[c.ids[k]]&&(this.params.records[c.ids[k]].group="user",this.params.records[c.ids[k]].groupId=this.params.userId);f=b=f=h=b=f=null},saveAll:function(b,c){var f={sets:"",configs:""},h;c.sets=(c.sets||[]).sort();c.configs=(c.configs||[]).sort();for(var k in f){for(h in c[k])f[k]+="<li>"+c[k][h]+"</li>";this.elLk["sets"===k?"saveSets":"saveConfigs"].html(f[k]).parent()[f[k]?"show":"hide"]()}this.elLk.saveHeader.html(this.params.records[b.data("configId")].name);this.elLk.saveAllLink=b.find("a.save_all");u.EventManager.trigger("modalOverlayShow",this.elLk.saveAll)},deleteRecord:function(b){var c=b.parents("table");c.dataTable().fnDeleteRow(b[0]);c.find(".dataTables_empty").length&&(c.parents(".record_type").hide().siblings(".record_type").filter(":visible").length||this.elLk.noRecords.show());u.EventManager.trigger("updateSavedConfig",{deleted:[b.data("configId")]})},updatePanels:function(b){var c;for(c in b.codes){var f=b.codes[c].split("_")[1];u.PanelManager.panels[f]&&(u.EventManager.trigger("queuePageReload",f,!0),u.EventManager.trigger("activateConfig",f))}},addDataTableRows:function(b,c,f){var h=c.first().children(),k=b.fnAddData(c.map(function(){return g(this).children().map(function(){return this.innerHTML})}).toArray());b=b.fnSettings().aoData;for(var l=k.length;l--;)g(b[k[l]].nTr).addClass(c[l].className).children().addClass(function(p){return h[p].className}).find("._ht").helptip(),f&&g(b[k[l]].nTr).data("configId",c[l].className);b=c=h=null},formSubmit:function(b){g.ajax({url:b.attr("action"),type:b.attr("method"),data:b.serialize(),traditional:!0,cache:!1,dataType:"json",context:this,success:function(c){if(this[c.func])this[c.func](c)}});return!1}});u.Panel.Configurator=u.Panel.ModalContent.extend({constructor:function(b,c){if(c.trackIds){for(var f=c.trackIds.length,h={};f--;)h[c.trackIds[f]]=c.tracks[f];this.tracks=h;delete c.tracks;delete c.trackIds}else c.tracksByType={};this.base(b,c);u.EventManager.register("updateConfiguration",this,this.updateConfiguration);u.EventManager.register("showConfiguration",this,this.show);u.EventManager.register("changeConfiguration",this,this.externalChange);u.EventManager.register("changeTrackOrder",this,this.externalOrder);u.EventManager.register("changeFavourite",this,this.changeFavourite);u.EventManager.register("syncViewConfig",this,this.syncViewConfig);u.EventManager.register("updateSavedConfig",this,this.updateSavedConfig);u.EventManager.register("activateConfig",this,this.activateConfig);u.EventManager.register("resetConfig",this,this.externalReset);u.EventManager.register("refreshConfigList",this,this.refreshConfigList);u.EventManager.register("changeMatrixTrackRenderers",this,this.changeMatrixTrackRenderers)},init:function(){function b(){var q=!g.grep(c.elLk.saveAsRequired.not(".disabled"),function(m){return m.value}).length;c.elLk.saveAsSubmit.prop("disabled",q)[q?"addClass":"removeClass"]("disabled")}var c=this,f,h,k;this.base();this.el.find(".configuration_search").prependTo(this.el.closest(".modal_content").find(".modal_nav").first());this.elLk.form=g("form.configuration",this.el);this.elLk.headers=g("h1",this.el);this.elLk.search=g(".configuration_search_text",this.el);this.elLk.searchResults=g("a.search_results",this.elLk.links);this.elLk.configDivs=g("div.config",this.elLk.form);this.elLk.configMenus=this.elLk.configDivs.find("ul.config_menu");this.elLk.configs=this.elLk.configMenus.children("li");this.elLk.tracks=this.elLk.configs.filter(".track");this.elLk.favouritesMsg=this.elLk.configDivs.filter(".favourite_tracks");this.elLk.noSearchResults=this.elLk.configDivs.filter(".no_search");this.elLk.trackOrder=this.elLk.configDivs.filter(".track_order");this.elLk.trackOrderList=g("ul.config_menu",this.elLk.trackOrder);this.elLk.viewConfigs=this.elLk.configDivs.filter(".view_config");this.elLk.viewConfigInputs=g(":input:not([name=select_all])",this.elLk.viewConfigs);this.elLk.imageConfigExtras=g(".image_config_notes, .configuration_search",this.el);this.elLk.saveAs=g(".config_save_as",this.el).detach();this.elLk.saveAsInputs=g(".name, .desc, .default, .existing, input.group",this.elLk.saveAs);this.elLk.saveAsRequired=this.elLk.saveAsInputs.filter(".name, .existing");this.elLk.existingConfigs=this.elLk.saveAsInputs.filter(".existing");this.elLk.saveTo=g(".save_to",this.elLk.saveAs);this.elLk.saveAsGroup=g(".groups",this.elLk.saveAs);this.elLk.saveAsSubmit=g(".fbutton",this.elLk.saveAs);this.elLk.popup=g();this.elLk.help=g();this.elLk.configForm=this.el.find("._config_settings");this.elLk.configDropdown=this.elLk.configForm.find("._config_dropdown");this.elLk.configSelector=this.elLk.configDropdown.find("select");this.elLk.configSaveAsLink=g('<a href="#" class="small left-margin"></a>').insertAfter(this.elLk.configSelector).hide().on("click",{panel:this},function(q){q.preventDefault();q.data.panel.configSave(!0)});this.elLk.configSaveLink=g('<a href="#" class="small left-margin"></a>').insertAfter(this.elLk.configSelector).hide().on("click",{panel:this},function(q){q.preventDefault();q.data.panel.configSave()});this.elLk.configSaveInput=this.elLk.configDropdown.find("div:has(input)").hide();this.component=g("input.component",this.elLk.form).val();this.sortable=!!this.elLk.trackOrder.length;this.lastQuery=!1;this.populated={};this.favourites={};this.externalFavourites={};this.imageConfig={};this.viewConfig={};this.subPanels=[];this.searchCache=[];for(f in this.params.tracksByType){var l=this.params.tracksByType[f];for(h=l.length;h--;)for(k in l[h]){var p=this.tracks[l[h][k]];p.fav&&(this.favourites[f]||(this.favourites[f]={}),this.favourites[f][l[h][k]]=[h,p.html])}}this.elLk.tracks.each(function(){var q=c.tracks[this.id];q.el=g(this).data("track",q).removeAttr("id");c.imageConfig[q.id]={renderer:q.renderer,favourite:q.fav}});this.elLk.viewConfigInputs.each(function(){c.viewConfig[this.name]="checkbox"===this.type?this.checked?this.value:"off":"select-multiple"===this.type?g("option:selected",this).map(function(){return this.value}).toArray():this.value});this.sortable&&this.makeSortable();this.elLk.configDivs.not(".view_config").on("click","ul.config_menu > li.track div.track_name, .select_all",g.proxy(this.showConfigMenu,this)).on("click",".popup_menu li",g.proxy(this.setTrackConfig,this)).on("click",".config_header",function(){g("a."+this.parentNode.className.replace(/\s*config\s*/,""),c.elLk.links).trigger("click");return!1}).on("click",".matrix_link",function(){g("a.regulatory_features",c.elLk.links).trigger("click");return!1}).on("click",".favourite",function(){var q=g(this).parents("li.track").data("track");u.EventManager.trigger("changeFavourite",q.id,q.fav?0:1,q.type,c.id);return!1}).on("click",".menu_help",function(){c.toggleDescription(this);return!1});this.elLk.viewConfigs.on("change",":input",function(){if("checkbox"===this.type){var q=this.checked;var m="checked"}else q=this.value,m="value";u.EventManager.trigger("syncViewConfig",c.id,g(this).parents(".config")[0].className.replace(/ /g,"."),this.name,m,q)});this.elLk.search.on({keyup:function(){var q=this.value.toLowerCase();2>this.value.length&&(c.lastQuery=q);q!==c.lastQuery&&(c.searchTimer&&clearTimeout(c.searchTimer),c.query=q,c.searchTimer=setTimeout(function(){c.elLk.links.removeClass("active");c.elLk.searchResults.removeClass("disabled").parent().addClass("active");c.elLk.headers.hide().filter(".search_results").show();c.elLk.imageConfigExtras.show();c.elLk.form.addClass("multi").removeClass("single");c.search()},250))},focus:function(){this.value===this.defaultValue&&(this.value="");this.style.color="#000"},blur:function(){this.value||(this.value="Find a track",this.style.color="#999")}});this.el.find("select[name=species]").on("change",function(){var q=this.value.replace(/^\//,"").split(/\//).shift();q="modal_config_"+(c.component+(q===u.species?"":"_"+q)).toLowerCase();var m=g("#"+q);c.hide();m.length&&m.children().length&&!m.data("reload")?m.addClass("active").show().find("select[name=species]").prop("selectedIndex",this.selectedIndex).selectToToggle("trigger").focus():(u.EventManager.trigger("updateConfiguration",!0),m=m.length?!m.removeData("reload"):g("<div>",{id:q,"class":"modal_content js_panel active",html:'<div class="spinner">Loading Content</div>'}),u.EventManager.trigger("addModalContent",m,this.value,q,"modal_config_"+c.component.toLowerCase()));g(c.el).removeClass("active");u.EventManager.trigger("setActivePanel",q);c.updateConfiguration(!0)});g(".save_configuration",this.el).on("click",function(q){q.preventDefault()});this.elLk.saveAsInputs.filter(".name").on("keyup blur input",b);this.elLk.existingConfigs.on("change",b);this.elLk.saveTo.on("click",function(){c.elLk.saveAsGroup["group"===this.value?"show":"hide"]()});this.elLk.saveAsSubmit.on("click",function(){var q={save_as:1};g.each(g(this).parents("form").serializeArray(),function(){var m=this.value.replace(/<[^>]+>/g,"");q[this.name]?(q[this.name]=g.isArray(q[this.name])?q[this.name]:[q[this.name]],q[this.name].push(m)):q[this.name]=m});if(q.name||q.overwrite)c.updateConfiguration(!0,q),u.EventManager.trigger("modalOverlayHide")});this.getContent();this.el.externalLinks();this.initConfigList()},initFromHash:function(){if(this.params.hash){var b=this.elLk.links.children("."+this.params.hash);b.length&&(this.elLk.links.removeClass("active"),b.parent().addClass("active"));delete this.params.hash}},showConfigMenu:function(b){if("A"===b.target.nodeName)return!0;var c=g(b.currentTarget),f=c.hasClass("select_all");c.hasClass("track_name")&&(c=c.parent());if(f&&b.target===b.currentTarget)return!1;b=c.data();if(!b.popup||b.popup.parentNode!==c[0]){var h=c.children(".popup_menu");b.popup=h.length?h:g(b.track.popup).prependTo(c);f&&h.children(".current").removeClass("current")}2!==b.popup.children().length||f?(this.elLk.popup.not(b.popup.show()).hide(),this.elLk.popup=b.popup):b.popup.children(":not(."+b.track.renderer+")").trigger("click");f||(c=b.popup.children("."+b.track.renderer),c.hasClass(".current")||c.addClass("current").siblings(".current").removeClass("current"));return!1},setTrackConfig:function(b,c){var f=g(b.target);if(f.is(".header")||f.filter(".close").parents(".popup_menu").hide().length)return!1;var h=b.target.className;f=f.parents("ul.popup_menu").hide().parent();var k=h.match(/\s*current\s*/);b=b.currentTarget.className.match(/\s*subset_(\w+)\s*/);k||b?b&&this.elLk.links.children("a."+b[1]).trigger("click"):this.changeTrackRenderer(f.hasClass("select_all")?f.next().find("li.track:not(.hidden)"):f,h,c);return!1},changeMatrixTrackRenderers:function(b){var c=this;g.each(b,function(f,h){c.tracks[f]&&(b=g(c.tracks[f].el).data(),b.track.renderer=h.renderer||"off")})},changeTrackRenderer:function(b,c,f,h){var k=this.params.subTracks||{},l=0,p,q;"all_on"===c&&b.each(function(){var m=g(this).data();m.track.newRenderer=(m.popup=m.popup||g(m.track.popup).prependTo(this)).children("li.off +")[0].className});b.each(function(){var m=g(this).data("track"),t=m.el.add(m.linkedEls);t.removeClass(m.renderer+" on");"off"===m.renderer^"off"===c&&(q="off"===c?-1:1,"number"===typeof k[m.id]?(l+=q*k[m.id],p=!0):(l+=q,!1!==f&&(f=!0)));t.each(function(){g(this).data("track").renderer=m.newRenderer||c}).addClass(m.renderer+
("off"===m.renderer?"":" on"));delete m.newRenderer;t=null});p&&!1!==f&&u.EventManager.trigger("changeColumnRenderer",g.map(b,function(m){return g(m).data("track").id}),c,!0)&&(f=!1);!1!==f&&this.elLk.links.children(b.data("track").links).siblings(".count").children(".on").html(function(m,t){return parseInt(t,10)+l});b=null;this.configSettingChanged(h)},addTracks:function(b){if(!this.populated[b]&&this.params.tracksByType[b]){for(var c=this.params.tracksByType[b],f=this.tracks,h=this.elLk.configDivs.filter("."+
b).find("ul.config_menu").each(function(D){g.data(this,"index",D)}),k=this.elLk.popup.length?this.elLk.popup.parent().data("track"):!1,l=g(),p=[],q=[],m=[],t=c.length,v,w,z,B;t--;){v=c[t].length;z=h.eq(t);q[t]=[];p[t]=[];for(m[t]=!1;v--;)w=f[c[t][v]],f[w.id].el?(f[w.id].el.remove(),q[t].unshift(['<li class="',f[w.id].el[0].className,'" id="',w.id,'">',f[w.id].el[0].innerHTML,"</li>"].join(""))):q[t].unshift(w.html),p[t][v]=w.id;z[0].innerHTML&&(z.children(":has(.config_menu)").each(function(){q[t].push('<li class="',this.className,'" id="',this.id,'">');g.each(g(this).children(".config_menu"),function(){var D=g.data(this,"index");if("undefined"===typeof D)var E=this.innerHTML;else E=q[D],q[D]="",m[t]=!0;q[t].push("<",this.nodeName,' class="',this.className,'">',E,"</",this.nodeName,">")});q[t].push("</li>")}),m[t]&&l.push(z[0]));q[t]=q[t].join("")}for(t=c.length;t--;)q[t]&&(h[t].innerHTML=q[t]);for(t=0;t<c.length;t++)for(z=h.eq(t),v=p[t].length,z.parents(".subset").attr("class").replace(/subset|active|first|\s/g,""),B=z.children(),m[t]&&B.children("ul.config_menu").each(function(D){h[t+D+1]=this}),B.filter(".track").each(function(){g.data(this,"track",f[this.id])}).removeAttr("id");v--;)z=B.eq(v),w=p[t][v],f[w].el=z,this.imageConfig[w]||(this.imageConfig[w]={renderer:"off",favourite:!!this.favourites[b]&&this.favourites[b][w]}),this.externalFavourite(w,z);k&&(this.elLk.popup=f[k.id].el.children(".popup_menu"));this.updateElLk(b,l);this.populated[b]=1;h=l=z=B=z=null}},updateElLk:function(b,c){c&&c.length&&(this.elLk.configMenus=this.elLk.configMenus.add(c.find("ul.config_menu")).filter(function(){return g(this).parents("body").length}));this.elLk.configs=b?this.elLk.configs.add("string"===typeof b?this.elLk.configMenus.filter("."+b).children("li"):b).filter(function(){return this.parentNode&&"UL"===this.parentNode.nodeName}):this.elLk.configMenus.children("li");this.elLk.tracks=this.elLk.configs.filter(".track")},show:function(b){this.elLk.popup.hide();b&&this.elLk.links.removeClass("active").find("."+
b).parent().addClass("active");this.base();this.getContent()},getContent:function(b,c){function f(){var v,w;var z=g.extend({},q.externalFavourites);var B=[];for(v in z)z[v]?q.addTracks(z[v][1]):delete q.favourites[z[v][1]][v];for(w in q.favourites)for(v in q.favourites[w])q.imageConfig[v]||(z=g(q.favourites[w][v][1]).appendTo(q.elLk.configDivs.filter("."+w).find("ul.config_menu").eq(q.favourites[w][v][0])),q.tracks[v].el=z.data("track",q.tracks[v]),q.imageConfig[v]={renderer:"off",favourite:1},B.push(z[0]));B.length&&q.updateElLk(B);q.elLk.favouritesMsg[q.elLk.configs.hide().filter(".track.fav").show().parents("li, div.subset, div.config").show().length?"hide":"show"]()}function h(){var v=q.elLk.trackOrderList,w=v.children(),z=["f","r"],B=[],D,E,G,I,K,S;q.elLk.tracks.filter(".on").each(function(){var U=g(this);E=U.data("track");I=E.fav?" fav":"";K=q.params.order[E.id];if("undefined"===typeof K||w.filter("."+E.id).length)for(D in z)K=q.params.order[E.id+"."+z[D]],"undefined"===typeof K||w.filter("."+
E.id+"."+z[D]).length||B.push([K,U,E.id+" "+z[D]+I,'<div class="strand" title="'+("f"===z[D]?"Forward":"Reverse")+' strand"></div>']);else B.push([K,U,E.id])});B=B.sort(function(U,T){return U[0]-T[0]});w.length?g.each(B,function(){G=this[2].split(" ")[0];D=w.length;for(S=this[1].clone(!0).data({order:this[0],trackName:this[2],trackId:G}).removeAttr("id").removeClass("track").addClass(this[2]).children(".controls").prepend(this[3]).end();D--;)if(g(w[D]).data("order")<this[0]){S.insertAfter(w[D]);break}-1===D&&S.insertBefore(w[0]);q.tracks[G].linkedEls=(q.tracks[G].linkedEls||g()).add(S);S=null}):g.each(B,function(){G=this[2].split(" ")[0];q.tracks[G].linkedEls=(q.tracks[G].linkedEls||g()).add(this[1].clone(!0).data({order:this[0],trackName:this[2],trackId:G}).removeAttr("id").addClass(this[2]).children(".controls").prepend(this[3]).end().appendTo(v).children(".popup_menu").hide().end())});B.length&&q.updateElLk("track_order");q.elLk.trackOrder.show().find("ul.config_menu li").filter(function(){return"none"===this.style.display}).show();v=w=null}function k(v,w){v.html('<div class="spinner">Loading Content</div>');g.ajax({url:m,cache:!1,dataType:"json",success:function(z){var B=v.width();v.detach().html(z.content).insertAfter(q.elLk.form);var D=g(".js_panel",v);D.length?(u.EventManager.trigger("createPanel",D[0].id,z.panelType,g.extend(z.params,{links:q.elLk.links.filter(".active").parents("li.parent").andSelf(),parentTracks:q.tracks,width:B,clickedLink:w})),q.subPanels.push(D[0].id)):(q.elLk.viewConfigInputs=g(":input:not([name=select_all])",q.elLk.viewConfigs),q.setSelectAll(),g(":input:not([name=select_all])",v).each(function(){q.viewConfig[this.name]="checkbox"===this.type?this.checked?this.value:"off":this.value}))}})}function l(){"none"===this.style.display&&(this.style.display="block")}function p(){if(-1!==(" "+this.className+" ").indexOf(" active "))return this}var q=this;c=this.elLk.links.filter(".active").children("a")[0];this.el.animate({scrollTop:0},0);if("multi"===c.rel^this.elLk.form.hasClass("multi"))this.elLk.form["multi"===c.rel?"addClass":"removeClass"]("multi")["multi"!==c.rel?"addClass":"removeClass"]("single");this.elLk.configDivs.filter(function(){return"none"!==this.style.display}).hide();this.elLk.imageConfigExtras.show();this.toggleDescription(this.elLk.help,"hide");this.lastQuery=!1;if("#"!==g(c).attr("href"))var m=c.href;c=c.className;if(-1!==c.indexOf("-")){c=c.split("-");var t=c[1];c=c[0]}this.elLk.headers.hide().filter("."+c).show();this.elLk.configDivs.filter(".functional").find(".hidden-caption").hide();switch(c){case"search_results":this.elLk.search.val(this.query).css("color","#000");this.search();break;case"active_tracks":this.elLk.configs.hide().filter(".on").show().parents("li, div.subset, div.config").show();this.elLk.configDivs.filter(".functional").find(".hidden-caption").show();this.elLk.configDivs.filter(".matrix").hide();break;case"favourite_tracks":f();break;case"track_order":h();break;default:this.addTracks(c),c=this.elLk.configDivs.filter("."+c).each(l),c.hasClass("has_matrix")&&!t?c.children(".multiple").each(function(){this.style.display="none"}):t?c.children("."+t).addClass("active").each(l).siblings(":not(.config_header)").map(function(){"none"!==this.style.display&&(this.style.display="none");return p.call(this)}).removeClass("active"):(c.hasClass("functional")&&!t&&c.children(".subset").each(function(){this.className.match(/regulatory_features/)&&(this.childNodes[1].hidden=!0)}),c.children().map(function(){l.call(this);return p.call(this)}).removeClass("active")),m?(c.children().length||(this.addTracks(this.elLk.links.filter(".active").parent().siblings("a").attr("class")),k(c,b)),c.data("active",!0),this.elLk.configDivs.not(c).data("active",!1)):c.find("ul.config_menu > li").each(l),this.elLk.imageConfigExtras.css("display",c.hasClass("view_config")?"none":"block"),c=null}},formSubmit:function(){return!1},updateConfiguration:function(b,c){if(!g("input.invalid",this.elLk.form).length){var f=this,h=!1,k={},l={},p=[],q=0;g.each(this.subPanels,function(m,t){if(m=u.EventManager.triggerSpecific("updateConfiguration",t,t,!0))g.extend(l,m.viewConfig),g.extend(k,m.imageConfig),m.menu_id&&p.push(m.menu_id),h=!0,q=m.matrix});this.elLk.tracks.each(function(){var m=g(this).data("track");if(m){var t=!f.imageConfig[m.id].favourite&&m.fav?1:f.imageConfig[m.id].favourite&&!m.fav?0:!1;f.imageConfig[m.id].renderer!==m.renderer&&(k[m.id]={renderer:m.renderer},h=!0);!1!==t&&(k[m.id]=k[m.id]||{},k[m.id].favourite=t,h=!0)}});this.elLk.viewConfigInputs.each(function(){if(!l[this.name]||"off"===l[this.name]){var m="checkbox"===this.type||"radio"===this.type?this.checked?this.value:"off":"select-multiple"===this.type?g("option:selected",this).map(function(){return this.value}).toArray():this.value;"image_width"===this.name?(u.setWidth(parseInt(m,10),1),f.viewConfig.image_width=m,u.EventManager.trigger("changeWidth")):(l[this.name]=m,h=!0,"select-multiple"===this.type&&(f.viewConfig[this.name]=m))}});if(!0===h||"undefined"!==typeof c){if(!0===c)return{imageConfig:k,viewConfig:l};g.extend(!0,this.imageConfig,k);g.extend(!0,this.viewConfig,l);this.updatePage(g.extend(c,{image_config:JSON.stringify(k),view_config:JSON.stringify(l),menu_ids:JSON.stringify(p),matrix:q}),b);return h}}},updatePage:function(b,c){var f=this;b.submit=1;b.reload=this.params.reset?1:0;this.params.reset=!1;g.ajax({url:this.elLk.form.attr("action"),type:this.elLk.form.attr("method"),data:g.extend(b,u.coreParams),traditional:!0,dataType:"json",async:!1,success:function(h){h.existingConfig&&f.updateSavedConfig(h.existingConfig);h.updated?u.EventManager.trigger("queuePageReload",f.component,!c):h.redirect&&u.redirect(h.redirect)}})},updateSavedConfig:function(b){b.deleted&&this.elLk.existingConfigs.children("."+b.deleted.join(", .")).remove();if(b.saved)for(var c in b.saved)this.elLk.existingConfigs.children("."+b.saved[c].value).length||g("<option>",b.saved[c]).appendTo(this.elLk.existingConfigs);b.changed&&this.elLk.existingConfigs.children("."+b.changed.id).html(b.changed.name);b=this.elLk.existingConfigs.children("[class]").length;this.elLk.existingConfigs[b?"removeClass":"addClass"]("disabled").parent()[b?"show":"hide"]()},activateConfig:function(b){b&&b!==this.component||(u.EventManager.trigger("modalReload",this.id),this.params.species===u.species?this.el.addClass("active"):this.el.removeClass("active").data("reload",!0))},makeSortable:function(){var b=this,c;for(c in this.params.order)this.params.order[c]=parseFloat(this.params.order[c],10);this.elLk.trackOrderList.sortable({axis:"y",containment:"parent",update:function(f,h){f=h.item.data("trackName").replace(" ",".");h=g.makeArray(h.item.prevAll().map(function(k,l){return(g(l).data("trackName")||"").replace(" ",".")}));u.EventManager.triggerSpecific("changeTrackOrder",b.component,b.params.species,f,h)}})},search:function(){function b(E,G,I,K){(q=-1!==G.indexOf(c.query))||-1!==I.indexOf(c.query)?(c.imageConfig[E]||(K=g(K).appendTo(B),c.imageConfig[E]={renderer:"off",favourite:!!c.favourites[t]&&c.favourites[t][E]},l.push(K[0]),c.externalFavourite(E,K),c.tracks[E].el=K.data("track",c.tracks[E])),q||h.showDesc.push(K[0]),c.searchCache.push([E,G,I,K,t]),h.show.push(K[0],K.parents("li").toArray()),v=!0,f="hide"):c.imageConfig[E]&&h.hide.push(K[0],K.find("div.desc").toArray())}var c=this,f="show",h={show:[],hide:[],showDesc:[]},k=g.extend([],this.searchCache),l=[],p,q;this.searchCache=[];if(2<=this.lastQuery.length&&-1!==this.query.indexOf(this.lastQuery)){var m=k.length;for(p={};m--;){var t=k[m][4];var v=!1;"undefined"===typeof p[t]&&(p[t]=!1);b.apply(this,k[m]);v&&(p[t]=!0)}for(t in p)p[t]||h.hide.push(this.elLk.configDivs.filter("."+t).toArray())}else for(t in h.hide.push(this.elLk.configDivs.toArray(),this.elLk.configDivs.children(".subset").toArray()),this.params.tracksByType){v=!1;k=this.elLk.configDivs.filter("."+t);var w=k.find("ul.config_menu");var z=this.params.tracksByType[t];for(m=z.length;m--;){var B=w.eq(m);for(p in z[m]){var D=this.tracks[z[m][p]];b(D.id,D.name,D.desc,D.el||D.html)}}v&&h.show.push(k[0],k.children(".subset").toArray())}l.length&&this.updateElLk(l);this.lastQuery=this.query;g([].concat.apply([],h.hide)).filter(function(){return"none"!==this.style.display}).css("display","none");g([].concat.apply([],h.show)).filter(function(){return!this.style.display||"none"===this.style.display}).css("display","block");this.toggleDescription(h.showDesc,"show");this.elLk.noSearchResults[f]();h=k=B=w=null},toggleDescription:function(b,c){var f=g(),h=g();"undefined"===typeof b.length&&(b=[b]);var k=b.length;if(k){for(;k--;)switch(b[k].nodeName){case"LI":f.push(g(b[k]).children("div.desc")[0]);h.push(g(".menu_help",b[k])[0]);break;case"DIV":f.push(g(b[k]).parent().siblings("div.desc")[0]),h.push(b[k])}switch(c){case"hide":f.css("display","none");h.removeClass("open");break;case"show":f.css("display","block");h.addClass("open");break;default:f.toggle(),h.toggleClass("open")}h.attr("title",function(){return g(this).hasClass("open")?"Hide information":"Click for more information"});f.find("._dyna_load").removeClass("_dyna_load").dynaLoad({complete:function(){this.externalLinks()}});this.elLk.help=this.elLk.help.add(h).filter(".open")}},changeFavourite:function(b,c,f,h){if(this.tracks[b].el){var k=this.tracks[b].el.toggleClass("fav");this.tracks[b].fav=!this.tracks[b].fav}this.sortable&&this.elLk.trackOrderList.children("."+b).toggleClass("fav");"favourite_tracks"===this.elLk.links.filter(".active").children("a")[0].className&&(k=k.hide().parents("div.config"),k.find("li:visible").length||k.hide(),this.elLk.tracks.filter(".fav").length||this.elLk.favouritesMsg.show());this.id!==h&&(f&&(this.externalFavourites[b]=[c,f]),this.imageConfig[b]&&(this.imageConfig[b].favourite=c))},externalFavourite:function(b,c){"undefined"!==typeof this.externalFavourites[b]&&(this.imageConfig[b].favourite=this.externalFavourites[b][0],this.tracks[b].fav!==this.imageConfig[b].favourite&&(c[this.imageConfig[b].favourite?"addClass":"removeClass"]("fav"),this.tracks[b].fav=this.imageConfig[b].favourite),delete this.externalFavourites[b])},externalChange:function(b,c){var f={};"object"!==typeof b?f[b]=c:f=b;for(var h in f)this.tracks[h]&&(this.changeTrackRenderer(this.tracks[h].el,f[h]),this.imageConfig[h].renderer=f[h])},syncViewConfig:function(b,c,f,h,k){var l=this;this.id!==b&&(b=this.elLk.viewConfigs.filter("."+c).find(":input[name="+f+"]").prop(h,k),this.viewConfig[f]&&(this.viewConfig[f]="checked"===h?k?b[0].value:"off":k),"select_all"===b.attr("name")&&b.parents("fieldset").find("input[type=checkbox]").prop("checked",k).each(function(){l.viewConfig[this.name]=k?this.value:"off"}),b=null)},externalOrder:function(b,c){if(!this.elLk.trackOrderList.children().length){var f=this.elLk.links.filter(".active").children("a")[0].className;this.show("track_order");this.getContent();this.show(f)}b=this.elLk.trackOrderList.find("."+b);c=c?this.elLk.trackOrderList.find("."+c):!1;b.length&&(c&&c.length?b.insertAfter(c):b.parent().prepend(b))},externalReset:function(){this.el.empty().removeClass("active")},initConfigList:function(){this.elLk.configSelector.off().on("change",{panel:this},function(b){var c=g(this),f=c.val();if("current"!==f){if(c.find("option[value=current]").prop("disabled")||F.confirm("Your current configuration is unsaved and will be lost if you continue."))if("public"===f)b.data.panel.openPublicConfigs();else{c.data("selected",f);b.data.panel.setConfig(f);return}c.find("option[value="+c.data("selected")+"]").prop("selected",!0)}});this.elLk.configSaveInput.last().append('<a class="left-margin" href="#">Cancel</a>').find("a").on("click",{panel:this},function(b){b.preventDefault();b.data.panel.elLk.configSaveInput.find("input").trigger("reset").end().hide();b.data.panel.elLk.configSelector.parent().show()}).end().end().first().find("input").on("keydown mousedown",function(){this.value===this.defaultValue&&(this.value="")});this.elLk.configForm.on("submit",{panel:this,input:this.elLk.configSaveInput.find("input[type=text]")[0]},function(b){b.preventDefault();b.data.input.value===b.data.input.defaultValue?g(b.data.input).selectRange(0,b.data.input.defaultValue.length):b.data.panel.configSave(!0,b.data.input.value)});this.refreshConfigList()},refreshConfigList:function(){this.elLk.configDropdown.removeClass("hidden").css("opacity",.5);this.elLk.configSelector.parent().show();this.elLk.configSaveLink.add(this.elLk.configSaveAsLink).hide();this.elLk.configSaveInput.hide();g.ajax({url:this.params.config_selector_url,dataType:"json",context:this,success:function(b){this.elLk.configSelector.empty().prop("disabled",!1);this.elLk.configSelector.append('<option value="default">Default</option>');this.elLk.configSelector.append(g('<option value="current">Current unsaved</option>').prop("disabled","current"!==b.selected).on("select",{link:this.elLk.configSaveAsLink,selector:this.elLk.configSelector},function(c){c.data.selector.data("selected","current");this.disabled=!1;this.selected=!0;c.data.link.html("Save current configuration").show()}).on("unselect",{link:this.elLk.configSaveAsLink,selector:this.elLk.configSelector,persistent:"current"===b.selected},function(c){var f=c.data.selector.data("selected");c.data.selector.find("option[value="+f+"]").prop("selected",!0);c.data.persistent||(c.data.link.hide(),this.disabled=!0)}));b.configs&&b.configs.length&&this.elLk.configSelector.append(g('<optgroup label="Saved configurations">').append(g.map(b.configs,function(c){return g('<option value="'+c.value+'">'+c.name+"</option>")})).find("option").on("select",{links:[this.elLk.configSaveLink,this.elLk.configSaveAsLink]},function(c,f){f||(c.data.links[0].html("Save existing").show(),c.data.links[1].html("Create new").show());this.selected=!0}).on("unselect",{links:this.elLk.configSaveLink.add(this.elLk.configSaveAsLink)},function(c,f){c.data.links.hide()}).end());this.elLk.configSelector.data("selected",b.selected).find("option[value="+b.selected+"]").triggerHandler("select",!0)},error:function(){this.elLk.configSelector.empty().append("<option>Error</option>").prop("disabled",!0)},complete:function(){this.elLk.configDropdown.css("opacity",1)}})},configSettingChanged:function(b){b=b?this.updateConfiguration(this.id):this.updateConfiguration(!0,!0);this.elLk.configSelector.find("default"===this.elLk.configSelector.val()?"option[value=current]":":selected").trigger(g.isEmptyObject(b.imageConfig)&&g.isEmptyObject(b.viewConfig)?"unselect":"select")},configSave:function(b,c){var f=this.updateConfiguration(!0,!0);if(!g.isEmptyObject(f.imageConfig)||!g.isEmptyObject(f.viewConfig)||"current"===this.elLk.configSelector.data("selected")){if(b)if(c)f.configName=c;else{this.elLk.configSaveInput.show().first().find("input").val(function(){return this.defaultValue}).selectRange(0,function(){return this.defaultValue.length});this.elLk.configSelector.parent().hide();return}else f.configId=this.elLk.configSelector.val(),f.configName=this.elLk.configSelector.find("option:selected").html();this.elLk.configSelector.empty().append("<option>Applying...</option>").prop("disabled",!0);g.ajax({url:this.params.config_save_url,dataType:"json",method:"post",context:this,data:{config:JSON.stringify(f)},success:function(h){h.updated?(this.refreshConfigList(),u.EventManager.trigger("queuePageReload",this.component,!1,!0)):this.showError("Error: Configuration settings could not be saved.")},error:function(){this.showError("Error: Configuration settings could not be saved.")},complete:function(){this.elLk.configSelector.prop("disabled",!1)}})}},openPublicConfigs:function(){},setConfig:function(b){g.ajax({url:this.params.config_apply_url,dataType:"json",context:this,data:{apply:b},success:function(c){c.updated?(this.elLk.configSelector.empty().append("<option>Applying...</option>").prop("disabled",!0),this.elLk.configSaveLink.add(this.elLk.configSaveAsLink).remove(),u.redirect()):this.showError("Error: Configuration settings could not be applied.")},error:function(){this.showError("Error: Configuration settings could not be applied.")}})},showError:function(b){alert(b)},destructor:function(){this.imageConfig=this.searchCache=this.tracks=null;this.base.apply(this,arguments)}});u.Panel.DataExport=u.Panel.extend({init:function(){var b=this;this.base();this.elLk.form=this.el.find("form").first();this.elLk.buttons=this.elLk.form.find("input.export_buttons");this.elLk.images=this.elLk.form.find("div._export_formats div");if(1==this.elLk.images.length)this.elLk.buttons.removeClass("disabled").prop("disabled",0);else this.elLk.images.on("click",function(){b.selectOption(this.firstChild.innerHTML)});this.elLk.dropdown=this.elLk.form.find("select._export_formats").on("change",function(){b.selectOption(this.value,!0)});this.elLk.compression=this.elLk.form.find('input[name="compression"]');this.elLk.buttons.on("click",function(){if(1==b.elLk.images.length||""!==b.elLk.dropdown.val())b.elLk.compression.val(this.name),b.elLk.form.trigger("submit")});this.elLk.dropdown.trigger("change")},selectOption:function(b,c){this.elLk.images.removeClass("selected").filter(function(){return this.firstChild.innerHTML==b}).addClass("selected");c||this.elLk.dropdown.find("option[value="+b+"]").prop("selected",!0).end().selectToToggle("trigger");this.elLk.buttons.toggleClass("disabled",""===b).prop("disabled",""===b);"RTF"===b&&this.elLk.buttons.filter("[name=preview]").prop("disabled",!0).addClass("disabled")}});u.Panel.EQTLTable=u.Panel.Content.extend({init:function(){this.base();this.tableData=[];this.eQTLRestURL=this.params.eqtl_rest_endpoint.replace("http:",F.location.protocol);this.geneURLTemplate=decodeURIComponent(this.params.eqtl_gene_url_template);this.elLk.eQTLTable=this.el.find("._variant_eqtl_table");this.elLk.eQTLTable.children().hide().end().removeClass("hidden").append("<p>Loading "+this.elLk.eQTLTable.find("h2").text()+" ...</p>");this.fetchEQTLTable()},fetchEQTLTable:function(){g.ajax({url:this.eQTLRestURL,dataType:"json",context:this,success:function(b){var c=Object.values(b._embedded.associations);b=b._links.next?b._links.next.href:"";this.tableData=this.tableData.concat(c);b?(this.eQTLRestURL=b.replace("http:",F.location.protocol),this.fetchEQTLTable()):(this.elLk.eQTLTable.children().show(),this.showEQTLTable(this.tableData),this.elLk.eQTLTable.children("p").remove())},error:function(b){this.showError((b.responseJSON||{}).error)}})},showEQTLTable:function(b){for(var c=this.geneURLTemplate,f=this.elLk.eQTLTable.children().filter("h3").remove().end().show().find("table").dataTable(),h=f.fnSettings().aoData.length-1;0<=h;h--)f.fnDeleteRow(h,!1);var k={};g.each(b,function(l,p){l=p.gene_id+"-"+p.qtl_group;l in k||(k[l]=p)});b=null;f.fnAddData(g.makeArray(g.map(k,function(l){return[['<a href="'+u.populateTemplate(c,{geneId:l.gene_id})+'">'+l.gene_id+"</a>",l.neg_log10_pvalue,l.beta,l.qtl_group]]})),!1);f.fnDraw()},showError:function(b){b?b.match(/not recognize/)&&(b=""):b="Error loading eQTL data from REST";this.elLk.eQTLTable.children("h3").show().end().children("p").html(b).show()}});u.Panel.Exporter=u.Panel.ModalContent.extend({init:function(){var b=this;this.base();this.config={};g.each(g("form.configuration",this.el).serializeArray(),function(){b.config[this.name]=this.value})},formSubmit:function(b){var c=this,f=g.extend({},this.config),h={},k={},l;g("input[type=hidden], input.as-param",b).each(function(){h[this.name]=this.value});var p={};g("input.as-param",b).each(function(){p[this.name]=1});if(b.hasClass("configuration")){g.each(b.serializeArray(),function(){p[this.name]||c.config[this.name]===this.value||(k[this.name]=this.value);delete f[this.name]});for(l in f)k[l]="no";h.view_config=JSON.stringify(k);g.extend(!0,this.config,k)}return this.base(b,h)}});u.Panel.Glossary=u.Panel.extend({init:function(){var b=this;this.base();this.glossaryRestURL=this.params.glossary_search_endpoint;this.elLk.glossaryForm=this.el.find("._glossary_search");this.elLk.glossaryInput=this.el.find('input[name="query"]');this.elLk.glossaryButton=this.el.find("._rest_search");this.elLk.glossaryResults=this.el.find("._glossary_results");this.elLk.glossaryButton.on("click",function(c){b.fetchGlossary();c.preventDefault()})},fetchGlossary:function(){this.elLk.glossaryResults.children().remove().end().removeClass("hidden").append('<p class="_loading">Loading ...</p>');g.ajax({url:this.glossaryRestURL+"&rows=100&q="+this.elLk.glossaryInput.val(),dataType:"json",context:this,success:function(b){this.showGlossaryResults(b);this.elLk.glossaryResults.children("._loading").remove()},error:function(b){this.showError((b.responseJSON||{}).error)}})},showGlossaryResults:function(b){var c=b.response.numFound;b=b.response.docs;if(0<c){var f='<p class="top-margin">Found '+c+" matching terms";100<c&&(f+=" - showing first 100");this.elLk.glossaryResults.append(f+":</p>");var h=this.elLk.glossaryResults.append("<dl>"),k=new RegExp("("+this.elLk.glossaryInput.val()+")","ig");g.each(b,function(l,p){l=p.label.replace(k,'<span class="hl">$1</span>');p=p.description[0].replace(k,'<span class="hl">$1</span>');h.append("<dt>"+l+"</dt><dd>"+p+"</dd>")})}else this.elLk.glossaryResults.append("<p>No results found.</p>")},showError:function(b){b?b.match(/not recognize/)&&(b=""):b="Error loading glossary results from OLS";this.elLk.glossaryResults.append("<p>"+b+"</p>")}});u.Panel.ImageExport=u.Panel.extend({init:function(){var b=this;this.base();this.elLk.form=this.el.find("form").first();this.elLk.extSwitch=this.elLk.form.find("select[name=image_format]").on("change",function(){b.updateExtension(this.value)});this.elLk.pdfSwitch=this.elLk.form.find("input[name=format]").on("change",function(){"pdf"==this.value?b.updateExtension(this.value):"custom"!=this.value&&b.updateExtension("png")})},updateExtension:function(b){this.elLk.fileName=this.elLk.form.find("input[name=filename]");b=this.elLk.fileName.val().replace(/\.(\w)*$/i,"."+b);this.elLk.fileName.val(b)}});u.Panel.ManageConfigs=u.Panel.ModalContent.extend({initialize:function(){var b=this;this.base.apply(this,arguments);this.elLk.table=this.el.find("._manage_configs");this.elLk.table.find("span").each(function(){var c={},f=g(this);f.closest("tr").find("input[type=hidden]").each(function(){c[this.name.replace(/saved_config_/,"")]=this.value});c.account=!!c.account;f.data(c).filter(function(){return c.account}).closest("tr").addClass("user-config");b.setHelptip(f)}).on("click",{panel:this},function(c){c.preventDefault();var f=g(this),h=f.data();switch(this.className){case"save":u.isLoggedInUser&&!h.account&&c.data.panel.moveConfig(h.code);break;case"edit":c.data.panel.showEditDesc(f.closest("td"));break;case"delete":g.when(c.data.panel.deleteConfig(h.code)).done(function(){u.EventManager.trigger("refreshConfigList")});break;case"share":u.isLoggedInUser&&h.account&&c.data.panel.showShareURL(c,F.location.href.replace(/(&|;)time=[^;&]+/,"")+";share_config="+h.name+"/"+
h.code)}})},setHelptip:function(b){b.helptip({content:function(c,f){switch(c.prop("className")){case"save":return u.isLoggedInUser?f.account?"Already saved":"Save to account":"Please login to save configuration to your user account";case"edit":return"Edit description";case"delete":return"Delete configuration";case"share":return u.isLoggedInUser?f.account?"Share configuration":"Please save this configuration before sharing it.":"Please login and save this configuration before sharing it."}}(b,b.data())})},showEditDesc:function(b){b.find("span, div").hide().end().append(g("<textarea>"+(b.find("div").attr("class").match("empty")?"":b.find("div").html())+"</textarea>")).append(g('<a href="#" class="button left-margin">Save</a>').on("click",{panel:this},function(c){c.preventDefault();this.className.match(/disabled/)||c.data.panel.saveEditDesc(g(this).closest("td"))})).append(g('<a href="#" class="small left-margin">Cancel</a>').on("click",{panel:this},function(c){c.preventDefault();this.className.match(/disabled/)||c.data.panel.cancelEditDesc(g(this).closest("td"))}))},saveEditDesc:function(b){b.find("textarea").prop("disabled",!0).end().find("a").addClass("disabled");this._ajax({url:this.params.save_desc_url,context:{panel:this,td:b},data:{code:b.closest("tr").find("input[name=saved_config_code]").val(),desc:b.find("textarea").val()},complete:function(){this.td.find("textarea").prop("disabled",!1).end().find("a").removeClass("disabled")}})},cancelEditDesc:function(b){b.find("span, div").show().end().find("textarea, a").remove()},moveConfig:function(b){return this._ajax({url:this.params.move_config_url,data:{code:b}})},deleteConfig:function(b){return this._ajax({url:this.params.delete_config_url,data:{code:b}})},showShareURL:function(b,c){b.stopPropagation();this.elLk.shareURLHolder||(this.elLk.shareURLHolder=g('<div class="manage-config-copy-url"><p>Copy this link:</p><input type="string" /></div>').appendTo(L.body));this.elLk.shareURLHolder.show().css({left:b.clientX,top:b.clientY}).on("click",function(f){f.stopPropagation()}).find("input").val(c).selectRange(0,c.length);g(L).off(".hideShareURL").on("click.hideShareURL",{popup:this.elLk.shareURLHolder},function(f){1===f.which&&(f.data.popup.hide(),g(L).off(".hideShareURL"))})},_ajax:function(b){return g.ajax(g.extend({context:{panel:this},dataType:"json",success:function(c){c.updated&&this.panel.getContent(R,this.panel.params.url)}},b))}});u.Panel.TaxonSelector=u.Panel.extend({constructor:function(b,c){this.base(b);this.dataUrl=c.dataUrl;this.taxonTreeData=null;this.imagePath=u.speciesImagePath;this.lastSelected=null;this.activeTreeKey="";this.selectionLimit=c.selectionLimit;this.defaultSpecies=[];this.multiHash={};c.defaultSpecies&&(this.defaultSpecies=c.defaultSpecies);c.referer_action&&(this.referer_action=c.referer_action);c.referer_type&&(this.referer_type=c.referer_type);c.allOptions&&(this.allOptions=c.allOptions);c.includedOptions&&(this.includedOptions=c.includedOptions);c.multiselect&&(this.multiSelect=parseInt(c.multiselect));c.align&&(this.alignId=c.align);c.alignLabel&&(this.alignLabel=c.alignLabel.replace(/\s/g,"_"));this.isCompara="Compara_Alignments"===this.referer_action;u.EventManager.register("modalPanelResize",this,this.resize)},init:function(){var b=this;b.base();b.elLk.form=g("form",b.el);b.elLk.tree=g(".taxon_selector_tree .vscroll_container",b.el);b.elLk.list=g(".taxon_selector_list .vscroll_container ul",b.el);b.elLk.buttons=g(".ss-buttons",b.el);b.elLk.mastertree=g(".taxon_tree_master",b.el);b.elLk.finder=g(".finder input",b.el);b.elLk.divisions=g(".species_division_buttons",b.el);b.elLk.breadcrumbs=g(".ss_breadcrumbs",b.el);b.elLk.count=g(".taxon_selector_list .ss-count",b.el);b.elLk.msg=g(".ss-msg span",b.el);b.elLk.finder.focus();g(".modal_close").hide();g(".modal_close").unbind().bind("click",function(){u.EventManager.trigger("modalClose",!0);return b.updateConfiguration()});g("#ss-reset",b.elLk.buttons).click(function(){return b.resetConfiguration()});g("#ss-cancel",b.elLk.buttons).click(function(){u.EventManager.trigger("modalClose",!0)});g("#ss-submit",b.elLk.buttons).click(function(){u.EventManager.trigger("modalClose",!0);return b.updateConfiguration()});g(L).ajaxError(function(c,f,h,k){console.log(k)});g.ajax({url:b.dataUrl,async:!1,dataType:"JSON",success:function(c){c.json[0]&&(b.taxonTreeData=c.json[0],b.initialize())},error:function(c,f,h){console.log("Error loading json: ",h);b.elLk.tree.html("Couldn't load species tree")}});b.resize();b.updateCount()},updateCount:function(){this.elLk.count.html(this.getCurrentSelectionCount());this.elLk.count.removeClass("warn");var b=this.getCurrentSelectionCount();if(0==b)return this.disableButton(!0),!1;if(this.selectionLimit&&b>this.selectionLimit)return this.elLk.msg.html("Selection limit of "+this.selectionLimit+" species exeeded!").show(),this.elLk.count.addClass("warn"),this.disableButton(!0),!1;this.elLk.msg.hide();this.disableButton(!1)},resetConfiguration:function(){this.initialize()},getCurrentSelectionCount:function(){return g("li",this.elLk.list).length||0},initialize:function(){var b=this;this.elLk.tree.html("");this.elLk.list.html("");this.updateCount();this.taxonTreeData&&(this.initAutoComplete(),this.addBreadcrumbs(),this.createMenu(this.taxonTreeData.children),this.defaultSpecies&&this.populateDefaultSpecies(),this.isCompara&&this.createMultipleAlignmentsHash());this.elLk.list.sortable({containment:this.elLk.list.parent(),start:function(c,f){g(f.item).addClass("ss-drag-active")},stop:function(c,f){g(f.item).removeClass("ss-drag-active");b.startSort()}})},createMultipleAlignmentsHash:function(){var b=this;this.multiHash={};g.each(this.taxonTreeData.children,function(c,f){"Multiple"===f.key&&g.each(f.children,function(h,k){b.multiHash[k.key]={};g.each(k.children,function(l,p){b.multiHash[k.key][p.key]="yes"})})})},updateMultipleAlignmentsHash:function(b,c){this.multiHash[b.parent.data.key]=!this.multiHash[b.parent.data.key]&&{};this.multiHash[b.parent.data.key][b.data.key]=c?"off":"yes"},startSort:function(){return!0},createMenu:function(b,c){var f=this,h=[];g.each(b,function(k,l){k="";l.title===c&&(k="active");k=g("<a/>",{"class":"division_button btn "+
k,text:l.title});g(k).off().on("click",function(){var p=f.elLk.mastertree.dynatree("getTree").getNodeInTree(l.key);p.data.is_submenu&&f.addBreadcrumbs(p);l.is_submenu?l.children&&(f.createMenu(l.children),f.hideTree()):(f.highlightElement(this),f.displayTree(p.data.title,!0))});h.push(k)});f.elLk.divisions.html(h)},highlightElement:function(b){g(b).siblings().removeClass("active");g(b).addClass("active")},addBreadcrumbs:function(b){var c=this;if(!b&&(b=c.elLk.mastertree.dynatree("getRoot").getChildren()[0],!b))return;var f=[],h=b.getKeyPath(!1,"key"),k=!1;h&&(h=h.split("/"),g.each(h,function(l,p){p&&(k=l===h.length-1?!0:!1,f.push(c.createListElement(p,k)))}));c.elLk.breadcrumbs.html(f)},getPath:function(b){var c=function(f,h,k){for(var l in h)if(h.hasOwnProperty(l)){if(h[l].title===k)return h[l].is_submenu?f+h[l].title:f;if("object"===typeof h[l]){h.title&&(f+=h.title+",");var p=c(f,h[l],k);if(p)return p}}return!1};return b=(b=c("",b,key))&&b.replace(/(,$)/g,"")},createListElement:function(b,c){var f=this;c=g("<li/>",{"class":c?"active":""});var h=f.elLk.mastertree.dynatree("getTree").getNodeInTree(b);g("<a/>",{text:h.data.title,href:"javascript:void(0);"}).appendTo(c);g(c).on("click",function(){h.data.children?(f.addBreadcrumbs(h),f.hideTree(),f.createMenu(h.data.children)):f.displayTree(h,!0)});return c},initAutoComplete:function(){var b=this;b.elLk.mastertree.dynatree({children:[b.taxonTreeData]});b.elLk.mastertree.hide();var c=[],f=[];b.elLk.mastertree.dynatree("getRoot").visit(function(k){if(!k.data.is_submenu&&k.data.searchable){var l=k.data.isFolder?k.data.title:k.data.title===k.data.key?k.data.title:k.data.title+" ("+k.data.key+")";c.push(l);f[l]={key:k.data.key,multi:"Multiple"===k.parent.data.key};f[k.data.key]={key:k.data.key,multi:"Multiple"===k.parent.data.key}}});var h=b.elLk.finder;h.autocomplete({minLength:3,classes:{"ui-autocomplete":"ss-autocomplete"},source:function(k,l){l(b.filterArray(g.unique(c),k.term))},select:function(k,l){f[l.item.value].multi&&b.elLk.mastertree.dynatree("getTree").reload();b.locateNode(f[l.item.value].key,"Multiple"===b.activeTreeKey);b.multiSelect||(k=b.elLk.tree.dynatree("getTree").getSelectedNodes(),k.length&&"Multiple"!==b.activeTreeKey&&(b.lastSelected=k[0]))},open:function(k,l){g(".ui-menu").css("z-index",1E9)}}).focus(function(){g(this).val()==g(this).attr("title")?(h.val(""),h.removeClass("inactive")):""!=g(this).val()&&h.autocomplete("search")}).blur(function(){h.removeClass("invalid");h.addClass("inactive");h.val(g(this).attr("title"))}).keyup(function(){if(3<=h.val().length){var k=b.filterArray(c,h.val());k&&k.length?h.removeClass("invalid"):h.addClass("invalid")}else h.removeClass("invalid")}).data("ui-autocomplete")._renderItem=function(k,l){k.addClass("ss-autocomplete");var p=new RegExp("(?![^&;]+;)(?!<[^<>]*)("+g.ui.autocomplete.escapeRegex(this.term)+")(?![^<>]*>)(?![^&;]+;)","gi");l.label=l.label.replace(p,"<span class='ss-ac-highlight'>$1</span>");return g("<li/>").data("ui-autocomplete-item",l).addClass("ss-ac-result-li").append("<a class='ss-ac-result'>"+
l.label+"</a>").appendTo(k)}},hideTree:function(){g(this.elLk.tree).children().hide()},displayTree:function(b,c){var f=this;if((c=f.elLk.mastertree.dynatree("getTree").getNodeInTree(b))&&c.data.isFolder){var h=f.isCompara&&"Multiple"!==b||!f.isCompara&&!this.multiSelect?1:3;f.elLk.tree.dynatree({children:[c.toDict(!0)],imagePath:f.imagePath,checkbox:!0,selectMode:h,activeVisible:!0,onSelect:function(k,l){if(f.isCompara&&"Multiple"===b){if(l.data.isFolder||"Multiple"===l.parent.data.key)var p=l;else p=l.parent,f.updateMultipleAlignmentsHash(l,k);f.lastSelected&&f.lastSelected.data&&f.lastSelected.data.key!==p.data.key?f.setSelection(l,k,!0,!0):f.setSelection(l,k);f.lastSelected=p}else f.multiSelect?(f.disableButton(!k),f.setSelection(l,k)):(f.lastSelected=k?l:null,f.setSelection(l,k,!0,!0))},onDblClick:function(k,l){k.toggleSelect()},onKeydown:function(k,l){if(32==l.which)return k.toggleSelect(),!1}});this.activeTreeKey=b}else console.log("master tree is null")},populateDefaultSpecies:function(){var b=this,c=b.elLk.mastertree.dynatree("getTree"),f=b.isCompara&&b.alignLabel,h,k;b.defaultSpecies&&0<b.defaultSpecies.length&&(g.each(b.defaultSpecies.reverse(),function(l,p){h=c.getNodeByKey(p);k=p;h||(sp=p.match(/(.*)--\w+$/))&&sp[1]&&(h=c.getNodeInTree(sp[1]),k=sp[1]);h&&(h.select(),!f&&h.makeVisible(),b.setSelection(h,!0),b.lastSelected=b.isCompara&&b.alignLabel?c.getNodeByKey(b.alignLabel):h)}),f?b.locateNode(b.alignLabel):b.locateNode(k))},getTree:function(b,c){for(c=c||"isInternalNode";b.parent;){if(b.data[c])return b;b=b.parent}return!1},getNodeFromTaxonTree:function(b,c){var f=function(h,k,l){if(k.key===h)return k.isInternalNode?k:!0;if(k.isFolder){k.isInternalNode&&(l=k);for(var p in k.children){var q=f(h,k.children[p],l);if(q)return!0===q?l:q}}return!1};return f(b,c,c)},resize:function(){var b=g(this.el).height()-80;this.elLk.tree.parent(".content").height(b);this.elLk.list.closest(".vscroll_container").height(b-29)},getSelectedItems:function(b){b||(b=this.elLk.mastertree);b=this.elLk.mastertree.dynatree("getTree").getSelectedNodes();var c=[],f={};g.each(b,function(h,k){k.data.isFolder||(f[k.data.title]={key:k.data.key,title:k.data.title,img_url:k.data.img_url,value:k.data.value})});g.each(g("li",this.elLk.list),function(h,k){c.push(f[g(".selected-sp-title",this).text()])});return c},getAllLeaves:function(b){function c(h){if(h.childList)for(var k in h.childList)c(h.childList[k]);else 1!==h.data.unselectable&&(f[f.length]=h);return f}var f=[];return c(b)},setSelection:function(b,c,f,h){var k=this,l=[];b.hasChildren()?l=k.getAllLeaves(b):l.push(b);f&&(k.isCompara&&"Multiple"===k.activeTreeKey?(k.elLk.mastertree.dynatree("getTree").visit(function(p){p&&p.select(!1)}),k.elLk.tree.dynatree("getTree").visit(function(p){p&&p.select(!1)}),b.select(c)):k.elLk.mastertree.dynatree("getTree").reload());h&&k.elLk.list.children().remove();g.each(l,function(p,q){k.elLk.mastertree.dynatree("getTree").selectKey(q.data.key,c);c?g("li."+CSS.escape(q.data.key),k.elLk.list).length||(p=(q.data.special_type?q.data.special_type:q.data.key)+".png",q.data.img_url=q.data.img_url||k.imagePath+p,p='<span class="selected-sp-img"><img src="'+q.data.img_url+'"></span>',g("<li/>",{"class":q.data.key}).data(q.data).append(p,'<span class="selected-sp-title">'+q.data.title+'</span><span class="remove">x</span>').prependTo(k.elLk.list)):g("li."+CSS.escape(q.data.key),k.elLk.list).length&&g.each(g("li",k.elLk.list),function(m,t){g(t).data("key")===q.data.key&&g(t).remove()})});g("li span.remove",k.elLk.list).off().on("click",function(){k.removeListItem(g(this).parent());k.updateCount()});k.updateCount();g("h2",k.elLk.taxon_selector_list).removeClass("active").addClass("active")},disableButton:function(b){g("#ss-submit",this.elLk.buttons).attr("disabled",b);b?g("#ss-submit",this.elLk.buttons).removeClass("active"):g("#ss-submit",this.elLk.buttons).addClass("active")},locateNode:function(b,c){var f=this.elLk.mastertree.dynatree("getTree").getNodeInTree(b);if(f){if(!f.data.isFolder){var h=this.isCompara||!this.multiSelect;this.setSelection(f,!0,h,h)}h=this.getTree(f,"isInternalNode");if(f=this.getTree(f,"is_submenu"))this.createMenu(f.data.children,h.data.title),this.addBreadcrumbs(f);this.displayTree(h.data.title);(b=this.elLk.tree.dynatree("getTree").getNodeInTree(b))&&b.activate();b&&!b.data.isFolder&&c&&b.select();this.isCompara||(this.lastSelected=b)}},removeListItem:function(b){var c=this,f=g(b).attr("class");if(""!=f){var h=[];h=c.elLk.mastertree.dynatree("getTree").getSelectedNodes();g.each(h,function(k,l){l.data.key==f&&(g("ul",c.elLk.tree).length&&(tree_node=c.elLk.tree.dynatree("getTree").getNodeInTree(f))&&tree_node.toggleSelect(),l.toggleSelect(),g(b).remove())})}},filterArray:function(b,c){c=c.replace(/[^a-zA-Z0-9 ]/g,"").toUpperCase();var f=new RegExp(g.ui.autocomplete.escapeRegex(c),"i");b=g.grep(b,function(h){return h&&f.test(h.replace(/[^a-zA-Z0-9 ]/g,""))});b.sort(function(h,k){var l=h.toUpperCase().substr(0,c.length)==c,p=k.toUpperCase().substr(0,c.length)==c;return h.match(/reference/i)?-1:k.match(/reference/i)?1:l==p?h==k?0:h<k?-1:1:l?-1:1});return b},updateConfiguration:function(){var b="Multiple"===this.activeTreeKey;var c=this.isCompara?this.lastSelected?[this.lastSelected]:[]:this.multiSelect?this.getSelectedItems(this.elLk.mastertree):this.lastSelected?[this.lastSelected.data]:[];if(!c.length)return!1;for(var f=[],h=0;h<c.length;h++)this.isCompara?c[h]&&f.push(c[h].data.key):c[h]&&f.push(c[h].key);if(!this.approveSelection(f))return!1;if("Tools"===this.referer_type)u.EventManager.trigger("updateTaxonSelection",c);else if(this.isCompara)c=c[0],b?u.EventManager.trigger("updateMultipleAlignmentSpeciesSelection",c):u.EventManager.trigger("updateAlignmentSpeciesSelection",c);else if("Multi"===this.referer_action){b=[];for(h=0;h<c.length;h++)c[h]&&b.push("s"+(h+1)+"="+c[h].key);c=this.elLk.form.prop("action").replace(/[s,r]\d+=.*(;)?/,"");u.redirect(c+u.cleanURL(this.elLk.form.serialize()+";"+b.join(";")))}return!0},approveSelection:function(b){return b.length&&this.defaultSpecies&&b.join(",")!==this.defaultSpecies.join(",")}});u.Panel.ConfigMatrix=u.Panel.Configurator.extend({constructor:function(b,c){this.base(b,c);u.EventManager.remove(b);u.EventManager.register("mouseUp",this,this.dragStop);u.EventManager.register("updateConfiguration",this,this.updateConfiguration);u.EventManager.register("changeColumnRenderer",this,this.changeColumnRenderer);u.EventManager.register("modalPanelResize",this,this.setScrollerSize)},init:function(){var b=this;u.Panel.prototype.init.call(this);this.startCell=[];this.dragCell=[];this.imageConfig={};this.elLk.links=this.params.links.find("> .count > .on");this.elLk.wrapper=this.el.children(".config_matrix_wrapper");this.elLk.scroller=this.el.children(".config_matrix_scroller").add(this.elLk.wrapper).on("scroll",function(){b.elLk.scroller.not(this).scrollLeft(this.scrollLeft)});this.elLk.filterWrapper=this.el.children(".filter_wrapper");this.elLk.tableWrapper=this.elLk.wrapper.children(".table_wrapper");this.elLk.noResults=this.elLk.wrapper.children(".no_results");this.elLk.table=this.elLk.tableWrapper.children("table.config_matrix");this.elLk.headers=this.elLk.table.children("thead").children("tr:first").children("th");this.elLk.axisLabels=this.elLk.headers.filter(".axes").find("i");this.elLk.configMenus=this.elLk.table.children("thead").children("tr.config_menu").children("th");this.elLk.rows=this.elLk.table.children("tbody").children("tr");this.elLk.columnHeaders=this.elLk.headers.add(this.elLk.configMenus).not(".first");this.elLk.cols=[].slice.call(g.map(this.elLk.table[0].rows[0].cells,function(l,p){if(p)return[[]]}));this.elLk.popup=g();this.elLk.subtracks=g();this.elLk.hiddenCells=g();this.elLk.configForm=this.el.closest(".panel").find("._config_settings");this.elLk.configDropdown=this.elLk.configForm.find("._config_dropdown");this.elLk.configSelector=this.elLk.configDropdown.find("select");this.elLk.tableWrapper.data("maxWidth",this.elLk.tableWrapper[0].style.width).width("auto");var c=this.elLk.columnHeaders.children("p");var f=Math.max.apply(Math,c.map(function(){return g(this).width()}).toArray()),h=c.addClass("rotate").first().width(),k=this.elLk.headers.filter(".axes").height();u.browser.ie?(c.css({width:f,bottom:f-h}),f>k&&this.elLk.tableWrapper.css("marginTop",f-k)):(h=(f-h)/2,c.css({lineHeight:f+"px",top:h}),f>k&&this.elLk.tableWrapper.css("marginTop",-h/2));c=null;this.elLk.axisLabels.each(function(){var l=g(this),p=l.clone().addClass("clone").insertAfter(this);if(p.width()>l.width())l.data("fullLabel",g('<em class="floating_popup">'+this.innerHTML+"</em>").css(g(this).position()).appendTo(l)).on({mouseenter:function(){g(this).data("fullLabel").show()},mouseleave:function(){g(this).data("fullLabel").hide()}});p.remove();l=p=null});for(f=0;f<this.elLk.table[0].rows.length;f++)for(c=this.elLk.cols.length;c--;)this.elLk.cols[c].push(this.elLk.table[0].rows[f].cells[c+1]);this.elLk.options=this.elLk.rows.children(".opt").each(function(){var l=g(this);this.configCode=b.id+"_"+this.title.replace(":","_");this.searchTerms=g.trim(this.parentNode.className+" "+b.elLk.headers.eq(l.index()).children("p").html()+" "+this.title).toLowerCase();b.imageConfig[this.configCode]={renderer:l.hasClass("on")?"on":"off"}});this.elLk.tracks=this.elLk.configMenus.not(".select_all").each(function(){var l=b.tracks[this.id];b.imageConfig[this.id]={renderer:l.renderer};g.extend(l,{el:g(this),linkedEls:b.params.parentTracks[this.id].el});g(this).data("track",l);l.renderer!==b.params.parentTracks[this.id].renderer&&b.changeColumnRenderer(g(this),b.params.parentTracks[this.id].renderer)}).removeAttr("id");this.setEventHandlers();this.tutorial();this.setScrollerSize();u.browser.ie67&&(this.elLk.headers.css("zIndex",function(l){return 200-l}),this.elLk.configMenus.css("zIndex",function(l){return 100-l}))},setEventHandlers:function(){var b=this;this.el.children(".header_wrapper").children(".help").on("click",function(){g(this).toggleClass("open").attr("title",function(c,f){return"Hide information"===f?"Click for more information":"Hide information"}).siblings(".desc").width(g(this).parent().width()-25).toggle();return!1});this.elLk.filterWrapper.children("select.filter").on("change",function(){b.elLk.rows.removeClass("hidden");this.value&&b.elLk.rows.not("."+this.value).addClass("hidden");b.afterFilter()});this.elLk.filterWrapper.children("input.filter").on({keyup:function(){var c=this.value;c&&2>c.length&&(this.lastQuery=c);c!==this.lastQuery&&(this.searchTimer&&clearTimeout(this.searchTimer),this.searchTimer=setTimeout(function(){b.filter(c)},250))},focus:function(){this.value="";this.style.color="#000"},blur:function(){this.value||(b.filter(),this.value=this.defaultValue,this.style.color="#999")}});if(!u.browser.ie)this.elLk.table.on("mousedown",function(c){c.which&&1!==c.which||!/^(TD|P|SPAN)$/.test(c.target.nodeName)||b.dragStart(c);return!1});this.elLk.table.children("thead").children("tr.config_menu").on("click","th",g.proxy(this.showConfigMenu,this)).on("click",".popup_menu li",g.proxy(this.setColumnConfig,this));this.elLk.headers.not(".axes").on({mouseenter:function(){b.mousemove||b.selectAllCol(g(this).children("div").show())},mouseleave:function(){g(this).children("div").hide()}}).children(".select_all_column").find("input").on("click",function(c){c=this.className;var f=b.elLk.rows.children("."+this.name);switch(c){case"":break;case"none":f.removeClass("on");break;case"all":f.addClass("on");break;default:f.filter("."+c).addClass("on").end().not("."+c).removeClass("on")}b.resetSelectAll(f)});this.elLk.rows.children("th").on({mouseenter:function(){if(!b.mousemove){var c=g(this).find(".select_all_row").show();c.data("selectAll")||(c.children("input").prop("checked",b.allOnRow(this)),c.data("selectAll",!0))}},mouseleave:function(){g(this).find(".select_all_row").hide()}}).find(".select_all_row").on("click",function(c){c=g("input",this);var f=g(this).parents("th"),h=b.allOnRow(f[0]);b.resetSelectAll(f.siblings(".opt")[h?"removeClass":"addClass"]("on"));c.prop("checked",!h)});this.elLk.configMenus.filter(".select_all").children(".popup_menu").children("li:not(.header)").on("click",function(){b.changeColumnRenderer(g(this).parent().hide().parent().siblings().filter(function(){return"none"!==this.style.display}),this.className);return!1});this.elLk.table.children("tbody").on("click",".opt",function(){var c=g(this).toggleClass("on"),f=b.params.cellTracks?g.trim(b.params.cellTracks[this.title]):!1;if(f&&c.hasClass("on")){b.removePopups();var h=c.data("subtracks");if(!h){h=g(f);g(".popup_menu li",h).on("click",g.proxy(b.setTrackConfig,b));g("> ul.config_menu > li.track, .select_all",h).on("click",g.proxy(b.showConfigMenu,b)).not(".select_all").each(function(){g(this).data({track:g.extend(b.tracks[this.id],{el:g(this)}),popup:g(this).children(".popup_menu")})}).removeAttr("id");h.children(".close").on("click",function(){b.removePopups(g(this).parent());return!1});var k=b.elLk.configMenus.eq(c.index()).data("track");b.setDefaultRenderer(h.data({cell:c,colTrack:k}),k.renderer);c.data("subtracks",h);b.elLk.subtracks.push(h[0]);b.elLk.tracks.push.apply(b.elLk.tracks,h.find(".track").each(function(){var l=g(this).data("track");b.imageConfig[l.id]={renderer:l.renderer}}).toArray())}h.appendTo(b.elLk.wrapper).position({of:this,within:b.elLk.wrapper,my:"left top",collision:"flipfit"})}f?b.updateLinkCount():b.resetSelectAll(c);c=h=null;return!1})},showConfigMenu:function(b){var c=g(b.currentTarget),f=c.data("popup");this.base(b);f&&f.position({of:c,within:this.elLk.wrapper,my:c.hasClass("select_all")?"left bottom+2":"left+8 top",at:c.hasClass("select_all")?"left top":"left center",collision:"flipfit"});return!1},setColumnConfig:function(b){b=g(b.target);b.is(".header")||b.filter(".close").parents(".popup_menu").hide().length||this.changeColumnRenderer(b.parent().hide().parent(),b[0].className);return!1},setTrackConfig:function(b){var c=g(b.target);if(c.is(".header")||c.filter(".close").parents(".popup_menu").hide().length)return!1;var f=c.parents(".subtracks"),h=f.data("cell"),k=f.data("colTrack"),l="default"===b.currentTarget.className;l&&(b.target=b.currentTarget);this.base(b,!1);l&&c.parents(".track").add(c.parents(".select_all").siblings("ul.config_menu").children(".track"))["off"===k.renderer?"removeClass":"addClass"]("on").children("div").removeClass().addClass(k.renderer);this.params.defaultRenderers[h[0].title]=g("> ul.config_menu > li.default",f).length;h.find("span.on").html(f.find("li.track.on").length);this.updateLinkCount();return!1},changeColumnRenderer:function(b,c,f){var h=this;f&&(b=g(g.map(b,function(k){return h.tracks[k]?h.tracks[k].el[0]:R})));b.length&&this.changeTrackRenderer(b,c,!0);b=null;return!0},changeTrackRenderer:function(b,c,f){var h=this,k=b.map(function(){return g(this).hasClass("on")}).toArray(),l;this.base(b,c,!1,!0);f&&(this.params.defaultRenderers&&b.each(function(p){l=g(this);l.hasClass("on")!==k[p]&&h.elLk.options.filter("."+
l.data("track").colClass).find(".on").html(function(q,m){return parseInt(m,10)})}),this.setDefaultRenderer(this.elLk.subtracks.filter(function(){return b.filter(g(this).data("colTrack").el[0]).length}),b.data("track").renderer),this.updateLinkCount());b=l=null},setDefaultRenderer:function(b,c){b.find("li.default").filter(".track")["off"===c?"removeClass":"addClass"]("on").end().children("div").removeClass().addClass(c)},updateLinkCount:function(){var b=0,c=this.elLk.links.last(),f=parseInt(c.html(),10);this.params.cellTracks?this.elLk.options.filter(".on").find(".on").each(function(){b+=parseInt(this.innerHTML,10)}):b=this.elLk.configMenus.filter(".on").length;c.html(b);this.elLk.links.first().html(function(h,k){return parseInt(k,10)+(b-f)});c=null},removePopups:function(b){(b||this.elLk.subtracks.filter(function(){return this.parentNode})).detach().each(function(){var c=g(this);c.find("li.track.on").length||c.data("cell").removeClass("on")})},tutorial:function(){var b=this;u.browser.ie67||(this.showTutorial="off"!==u.cookie.get("config_matrix_tutorial"),this.elLk.tutorial=g(".tutorial",this.el),this.showTutorial&&this.elLk.tutorial.css("display","block"),this.elLk.tutorialToggle=this.el.find(".toggle_tutorial, span.close").on("click",function(){b.showTutorial=!b.showTutorial;b.elLk.tutorial.css("display",b.showTutorial?"block":"none");b.el.find(".toggle_tutorial")[b.showTutorial?"addClass":"removeClass"]("on");u.cookie.set("config_matrix_tutorial",b.showTutorial?"on":"off");return!1})[b.showTutorial?"addClass":"removeClass"]("on"))},setScrollerSize:function(){if(this.el.parent().data("active")){var b=u.browser.ie?parseInt(this.elLk.tableWrapper.data("maxWidth"),10)>this.params.width:this.elLk.table.width()>this.el.width();this.elLk.wrapper[b?"addClass":"removeClass"]("wide");this.elLk.tableWrapper.width(b?this.elLk.tableWrapper.data("maxWidth"):"auto");u.browser.ie||this.elLk.scroller.eq(0).children().width(b?this.elLk.wrapper[0].scrollWidth:"auto")}},allOnRow:function(b){b=g(b).siblings(".opt");return b.length===b.filter(".on").length},selectAllCol:function(b){if(b.length&&!b.data("selectAll")){var c=b.find("input"),f=this.elLk.rows.children("."+c[0].name),h=f.filter(".on"),k,l;f.length===f.filter(".default").length?k=".default":h.length?f.length===h.length&&(k=".all"):k=".none";if(k)c.filter(k).prop("checked",!0);else{k=c.filter(":checked");c=c.not(".all, .none");for(l=c.length;l--;){var p=c[l].className;var q=f.filter("."+p);if(q.length===h.length&&q.length===h.filter("."+p).length){c[l].checked="checked";break}}-1===l&&k.prop("checked",!1)}b.data("selectAll",!0)}},resetSelectAll:function(b){var c={},f={},h;b.each(function(){c[g(this).parent().index()]=1;f[g(this).index()]=1});for(h in c)g("th .select_all_row",this.elLk.rows[h]).data("selectAll",!1);for(h in f){var k=g(".select_all_column",this.elLk.headers[h]).data("selectAll",!1).parent().attr("class");var l=this.elLk.configMenus.filter("."+k);var p=l.data();var q=!!this.elLk.rows.children(".on."+k).length;k="off"===p.track.renderer;k===q&&(p.popup=p.popup||g(p.track.popup).prependTo(l),p.popup.children().removeClass("current").filter("li.off"+(q?" +":"")).trigger("click"))}b.find(".on").length&&this.updateLinkCount();b=l=null},updateConfiguration:function(b,c){if(b===this.id){var f=this,h={},k=!1,l;this.elLk.options.each(function(){l=g(this).hasClass("on")?"on":"off";if(f.imageConfig[this.configCode].renderer!==l||c)h[this.configCode]={renderer:l},k=!0});this.elLk.tracks.each(function(){var p=g(this).data("track");if(f.imageConfig[p.id].renderer!==p.renderer||c)h[p.id]={renderer:p.renderer},k=!0});if(k)return g.extend(!0,this.imageConfig,h),{imageConfig:h}}},dragStart:function(b){var c="P"===b.target.nodeName?g(b.target.parentNode):"SPAN"===b.target.nodeName?g(b.target.parentNode.parentNode):g(b.target);"TD"===c[0].nodeName&&(this.mousemove={x:b.pageX,y:b.pageY},this.startCell=[c.index(),c.parent().index()+2],this.elLk.table.on("mousemove",g.proxy(this.drag,this)),this.removePopups())},dragStop:function(){if(this.mousemove){this.elLk.table.off("mousemove");var b=g(".highlight",this.elLk.table).removeClass("highlight");1<b.length&&(b=b.filter(".opt"),1===b.length?b.trigger("click"):this.resetSelectAll(b.toggleClass("on")));this.mousemove=!1;this.dragCell=[]}},drag:function(b){if(!(3>Math.abs(b.pageX-this.mousemove.x)&&3>Math.abs(b.pageY-this.mousemove.y)))if(b="P"===b.target.nodeName?g(b.target.parentNode):"SPAN"===b.target.nodeName?g(b.target.parentNode.parentNode):g(b.target),"TD"!==b[0].nodeName)b=null;else if(b=[b.index(),b.parent().index()+2],b[0]!==this.dragCell[0]||b[1]!==this.dragCell[1]){var c=[b[0],this.startCell[0]].sort(function(p,q){return p-q}),f=[b[1],this.startCell[1]].sort(function(p,q){return p-q}),h=[],k,l;for(k=f[0];k<=f[1];k++)if("none"!==this.elLk.table[0].rows[k].style.display&&"gap"!==this.elLk.table[0].rows[k].className)for(l=c[0];l<=c[1];l++)h.push(this.elLk.table[0].rows[k].cells[l]);g(".highlight",this.elLk.table).not(h).removeClass("highlight");g(h).not(".highlight").addClass("highlight").not(":has(p)").append("<p></p>");this.dragCell=b;b=h=null}},filter:function(b){var c=[],f=[],h={},k={},l,p,q;if(b){var m=this.elLk.options.filter(function(){return"none"!==this.style.display});b=b.toLowerCase();var t=(l=b.match(/(?:"[^"]+"|'[^']+')/g))?g.map(l,function(w){return w.replace(/^["']/,"").replace(/["']$/,"")}):[b];for(p in t)b=g.trim(t[p]),""!==b&&(b=b.split(" "),m.each(function(){l=!0;for(q in b)if(-1===this.searchTerms.indexOf(b[q])){l=!1;break}l&&(c.push(this),h[g(this.parentNode).index()]=k[g(this).index()-1]=!0)}));if(c.length){var v={show:g(),hide:g()};for(p in h)f.push(this.elLk.rows[p]);this.elLk.rows.not(f).css("display","none");this.elLk.options.filter(".filter").removeClass("filter");g(c).addClass("filter");g(f).show().each(function(){for(p=1;p<this.cells.length;p++)v[k[p-1]?"show":"hide"].push(this.cells[p])});this.elLk.columnHeaders.each(function(){v[k[g(this).index()-1]?"show":"hide"].push(this)});v.show.css("display","");v.hide.css("display","none");this.elLk.hiddenCells=this.elLk.hiddenCells.add(v.hide.not(this.elLk.hiddenCells))}else this.elLk.rows.css("display","none")}else this.elLk.options.filter(".filter").removeClass("filter"),this.elLk.rows.filter(function(){return"none"===this.style.display}).add(this.elLk.hiddenCells).css("display",""),this.elLk.hiddenCells=g();this.afterFilter()},afterFilter:function(){var b=this.elLk.rows.filter(function(){return"none"!==this.style.display&&-1===this.className.indexOf("hidden")}).length;b||this.elLk.popup.hide();this.showTutorial&&this.elLk.tutorialToggle.trigger("click");this.elLk.table[4>b?"addClass":"removeClass"]("short");this.elLk.noResults[b?"hide":"show"]();this.setScrollerSize()}});u.Panel.ConfigMatrixForm=u.Panel.Configurator.extend({constructor:function(b,c){this.base(b,c);u.EventManager.remove(b)},init:function(){u.Panel.prototype.init.call(this)}});u.Panel.ConfigRegMatrixForm=u.Panel.ConfigMatrixForm.extend({init:function(){var b=this;this.base(arguments);u.EventManager.register("modalPanelResize",this,this.resize);u.EventManager.register("updateConfiguration",this,this.updateConfiguration);u.EventManager.register("updateFromTrackLabel",this,this.updateFromTrackLabel);u.EventManager.register("modalOpen",this,this.modalOpen);this.disableYdim=F.location.href.match("Regulation/Summary")?1:0;this.elLk.dx={};this.elLk.dx.container=g("div#dx-content",this.el);this.elLk.dy={};this.elLk.dy.container=g("div#dy-content",this.el);this.elLk.buttonTab=this.el.find("div.track-tab");this.elLk.breadcrumb=this.el.find("div.large-breadcrumbs li");this.elLk.trackPanel=this.el.find(".track-panel#track-content");this.elLk.matrixContainer=this.el.find("div.matrix-container");this.elLk.trackConfiguration=this.el.find(".track-panel#configuration-content");this.elLk.resultBox=this.el.find(".result-box");this.elLk.filterList=this.el.find("ul.result-list");this.elLk.displayButton=this.el.find("button.showMatrix");this.elLk.clearAll=this.el.find("span.clearall");this.elLk.ajaxError=this.el.find("span.error._ajax");this.localStoreObj={};this.localStorageKey="RegMatrix-"+u.species;this.elLk.lookup={};this.menuCountSpan=g(this.params.links).find("li.active a").siblings(".count").children(".on")[0];this.buttonOriginalWidth=this.elLk.displayButton.outerWidth();this.buttonOriginalHTML=this.elLk.displayButton.html();this.matrixLoadState=!0;this.json={};this.searchTerms={};this.rendererConfig={normal:"normal",peak:"compact",signal:"signal","peak-signal":"signal_feature"};this.resize();b.el.find("div#dy-tab div.search-box").hide();g.ajax({url:"/Json/RegulationData/info?species="+u.species,dataType:"json",context:this,success:function(c){this.checkError(c)?console.log("Fetching extra information error...."):(b.elLk.ajaxError.hide(),Object.assign(this.json,c),g.each(c.info,function(f,h){h.search_terms&&(f=f.replace(/[^\w\-]/g,"_"),b.searchTerms[h.search_terms]=f)}),g.ajax({url:"/Json/RegulationData/data?species="+u.species,dataType:"json",context:this,success:function(f){this.checkError(f)?console.log("Fetching main regulation data error...."):(b.elLk.ajaxError.hide(),Object.assign(this.json,f),g(this.el).find("div.spinner").remove(),this.trackTab(),this.populateLookUp(),this.loadState(),this.setDragSelectEvent(),this.registerRibbonArrowEvents(),this.updateRHS(),this.addExtraDimensions(),this.goToUserLocation(),this.resize(),this.selectDeselectAll(),b.el.find("._ht").helptip())},error:function(){g(this.el).find("div.spinner").remove();this.showError()}}))},error:function(){g(this.el).find("div.spinner").remove();this.showError()}});this.elLk.buttonTab.on("click",function(c){var f=b.getActiveTab();"INPUT"!==c.target.nodeName&&c.currentTarget.id!==f+"-tab"&&b.elLk.trackPanel.find('input[name="matrix_search"]').val()&&(b.elLk.trackPanel.find('input[name="matrix_search"]').val(""),b.elLk.searchCrossIcon.hide(),b.resetFilter());b.toggleTab({selectElement:this,container:b.el.find("div.track-menu")});b.resize()});this.elLk.breadcrumb.on("click",function(c){b.toggleBreadcrumb(this);c.preventDefault()});this.clickSubResultLink();this.showHideFilters();this.clickCheckbox(this.elLk.filterList);this.clearAll(this.elLk.clearAll);this.clearSearch();this.resetTracks();this.resetMatrix();b.el.on("click",function(c){!g(c.target).parent().closest("div").hasClass("track-popup")&&b.trackPopup&&(b.el.find("div.matrix-container div.xBoxes.track-on, div.matrix-container div.xBoxes.track-off").removeClass("mClick"),b.trackPopup.hide())});this.elLk.matrixContainer.on("scroll",function(){b.el.find("div.matrix-container div.xBoxes.track-on, div.matrix-container div.xBoxes.track-off").removeClass("mClick");b.trackPopup.hide()});this.el.find(".view-track, button.showMatrix").on("click",function(){g(this).hasClass("_edit")&&(b.addExtraDimensions(),u.EventManager.trigger("modalClose"))});this.clickDisplayButton(this.elLk.displayButton,this.el.find("li._configure"));this.elLk.trackPanel.find('input[name="matrix_search"]').on("input",function(c){(c=g(this).val().trim())?b.elLk.searchCrossIcon.show():b.elLk.searchCrossIcon.hide();if(b.resetFilter(c,!0)){var f=b.getActiveTab(),h=new RegExp(c,"gi"),k=Object.keys(b.elLk.lookup).filter(function(p){return p.match(h)&&b.elLk.lookup[p].parentTabId===f});g.each(b.searchTerms,function(p,q){p.match(h)&&k.push(q)});c=g.unique(k);if(c.length){b.elLk[f].container.find("span.search-error").hide();b.elLk[f].container.find("div.selectall-container div.select-link, div.selectall-container div.divider").show();var l="."+c.join(",.");c=b.elLk.lookup[c[0]].parentTab.find("li").not(l);g.each(c,function(p,q){"none"!==g(q).css("display")&&g(q).addClass("_search_hide").hide()})}else b.elLk[f].container.find("li").addClass("_search_hide").hide(),b.elLk[f].container.find("span.search-error").show(),b.elLk[f].container.find("div.selectall-container div.select-link, div.selectall-container div.divider").hide();b.updateAvailableTabsOrRibbons(f,!0)}});this.disableYdim?(b.el.find("h5.result-header._dyHeader, div#dy, div._dyMatrixHeader").hide(),b.el.find("button.reset-button._matrix").css("margin-top","0"),b.el.find("div#dy-tab").addClass("inactive").attr("title","No Experimental evidence is available for this view")):(b.el.find("h5.result-header._dyHeader, div#dy").show(),b.el.find("div#dy-tab").removeClass("inactive").attr("title",""))},checkError:function(b){return"404"===b.header.status?(this.showError(),1):0},showError:function(){this.elLk.ajaxError.show()},modalOpen:function(){this.emptyMatrix();this.displayMatrix();this.toggleButton();this.goToUserLocation()},resetFilter:function(b,c){this.getActiveTabContainer().find("li._search_hide").removeClass("_search_hide");this.getActiveTabContainer().find("span.search-error").hide();this.getActiveTabContainer().find("div.selectall-container div.select-link, div.selectall-container div.divider").show();var f=this.getActiveTabContainer().find("li._filtered");f.length?f.show():this.getActiveTabContainer().find("li").show();f=this.getActiveTab();this.updateAvailableTabsOrRibbons(f,!0,c);return b&&3>b.length?0:1},updateAvailableTabsOrRibbons:function(b,c,f){var h=this,k=h.elLk[b];if(k.haveSubTabs){var l,p=[];g.each(Object.keys(h.elLk[b].tabs),function(q,m){if(k.tabs[m]){g(k.tabs[m]).hasClass("active")&&(l=m);q=g("#"+m+"-content",h.el.trackPanel);var t=0;g(k.tabs[m]).addClass("inactive");g("li",q).each(function(w,z){if("none"!==g(z).css("display"))return t=1,!1});1==t&&(t=0,g(k.tabs[m]).removeClass("inactive"),p.push(m));"alphabetRibbon"===h.json.data[h[b]].data[m].listType&&h.activateAlphabetRibbon(q,c,f);var v=0;g("li",q).each(function(w,z){"none"!==g(z).css("display")&&v++})}});p.length&&l&&(!l||0>p.indexOf(l))&&h.toggleTab({selectElement:g(k.tabs[p[0]]),container:g(k.tabs[p[0]]).parent(),searchTriggered:!0})}else h.activateAlphabetRibbon(k.container,c,f)},activateAlphabetRibbon:function(b,c,f){var h,k,l=0,p=b.find(".ribbon-banner .alphabet-div");b.find(".ribbon-content .alphabet-content");var q=b.find(".ribbon-content .alphabet-content.active");g(p).removeClass("active").addClass("inactive");var m=b.find("li");m=g(m).closest(".alphabet-content");var t={};g.each(m,function(v,w){g("li",w).each(function(z,B){if("none"!==g(B).css("display"))return l=1,!1});1==l&&(l=0,activeRibbonData=g(w).data("ribbon"),k="."+activeRibbonData,h=p.not(':not("'+k+'")'),h.removeClass("inactive"),t[activeRibbonData]=h)});q=q.data("ribbon");c={container:b,selByClass:1,resetRibbonOffset:c,searchTriggered:!0};c.resetFilter=f&&!0;t[q]&&!f?c.selectElement=t[q]:(c.selectElement=t[Object.keys(t).sort()[0]],c.searchTriggered=!1);this.toggleTab(c);f=this.getActiveAlphabets(b);c=b.find(".ribbon-banner .larrow");b=b.find(".ribbon-banner .rarrow");g(c,b).removeClass("inactive active");0>=f.length?(g(c).addClass("inactive"),g(b).addClass("inactive")):(g(f[0]).hasClass("active")?(g(c).addClass("inactive"),1<f.length&&g(b).addClass("active")):g(c).removeClass("inactive").addClass("active"),g(f[f.length-1]).hasClass("active")?(g(b).addClass("inactive"),1<f.length&&g(c).addClass("active")):g(b).removeClass("inactive").addClass("active"))},addExtraDimensions:function(){var b=this;b.json.extra_dimensions&&b.json.extra_dimensions.forEach(function(c){b.elLk.lookup[c]=b.json.data[c]})},updateConfiguration:function(){var b=this,c={},f,h=[];b.elLk.searchCrossIcon.parent().find("input.configuration_search_text").val("");b.resetFilter("",!0);b.localStoreObj.userLocation&&b.setUserLocation();if(0>=Object.keys(b.localStoreObj).length||!b.localStoreObj.dx)return{image_config:{}};g.each(b.json.extra_dimensions,function(k,l){b.localStoreObj[l]&&g.each(b.localStoreObj[l],function(p,q){p.match(/_sep_/)&&q.state&&(f="",h=p.split("_sep_"),p=b.elLk.lookup[h[0]].set.replace(/_non_core/,"_core"),f=p+"_"+b.elLk.lookup[h[1]].label,c[f]={renderer:"track-on"===q.state?"on":"off"},b.localStoreObj.dy&&b.localStoreObj.dy[h[0]]&&(f=p+"_"+b.elLk.lookup[h[1]].label+"_"+b.elLk.lookup[h[0]].label,c[f]={renderer:"track-on"===q.state?b.rendererConfig[q.renderer]:"off"}))})});if(b.localStoreObj.matrix)return g.each(b.localStoreObj.matrix,function(k,l){k.match(/_sep_/)&&l.state&&(f="",h=k.split("_sep_"),k=b.elLk.lookup[h[0]].set.replace(/_non_core/,"_core"),f=k+"_"+b.elLk.lookup[h[1]].label,c[f]={renderer:"track-on"===l.state?"on":"off"},b.localStoreObj.dy&&b.localStoreObj.dy[h[0]]&&(f=k+"_"+b.elLk.lookup[h[1]].label+"_"+b.elLk.lookup[h[0]].label,c[f]={renderer:"track-on"===l.state?b.rendererConfig[l.renderer]:"off"}))}),u.EventManager.trigger("changeMatrixTrackRenderers",c),g.extend(this.imageConfig,c),{imageConfig:c,matrix:1}},updateFromTrackLabel:function(b){var c=b[0];b=b[1];if(c){if(this.localStoreObj.epigenomic_activity&&c.match(/^reg_feat/)){var f="epigenomic_activity";var h=c.split(/_/).pop()}else this.localStoreObj.segmentation_features&&c.match(/^seg_Segmentation/)&&(f="segmentation_features",h=c.split(/_/).pop());c=f+"_sep_"+h;"off"==b?(this.localStoreObj[f][f].state.on--,this.localStoreObj[f][f].state.off++,this.localStoreObj[f][c].state="track-off"):(this.localStoreObj[f][f].state.off--,this.localStoreObj[f][f].state.on++,this.localStoreObj[f][c].state="track-on",this.localStoreObj[f][c].renderer=b)}},getNewPanelHeight:function(){return g(this.el).closest(".modal_content.js_panel").outerHeight()-160},resize:function(){var b=this;b.elLk.resultBox.outerHeight(this.getNewPanelHeight());b.elLk[this.getActiveTab()].haveSubTabs?(g.each(b.elLk[this.getActiveTab()].tabContentContainer,function(c,f){g("ul",f).outerHeight(b.getNewPanelHeight()-170)}),b.elLk.trackPanel.find(".ribbon-content ul").outerHeight(b.getNewPanelHeight()-190)):b.elLk.trackPanel.find(".ribbon-content ul").outerHeight(this.getNewPanelHeight()-165);b.elLk.matrixContainer.outerHeight(this.getNewPanelHeight()-147)},getActiveTabContainer:function(){return g("div#dx-content.active, div#dy-content.active",this.el)},getActiveTab:function(){return g("div#dx-content.active span.rhsection-id, div#dy-content.active span.rhsection-id",this.el).html()},getActiveSubTab:function(){return g("div#dx-content.active .tab-content.active span.rhsection-id, div#dy-content.active .tab-content.active span.rhsection-id",this.el).html()},populateLookUp:function(){var b=this;this.elLk.dx.ribbonBanner=g(".ribbon-banner .letters-ribbon .alphabet-div",this.elLk.dx.container);this.elLk.dx.tabContents=g(".ribbon-content li",this.elLk.dx.container);this.elLk.dx.haveSubTabs=!1;this.elLk.dy.haveSubTabs=!0;this.elLk.dy.tabs={};this.elLk.dy.tabContents={};b.elLk.dy.tabContentContainer={};var c=g(".tabs.dy div.track-tab",this.elLk.dy.container);g.each(c,function(f,h){f=g(h).attr("id").split("-")[0]||g(h).attr("id");b.elLk.dy.tabs[f]=h;b.elLk.dy.tabContentContainer[f]=b.elLk.dy.container.find("#"+f+"-content");h=g("span.content-id",h).html();b.elLk.dy.tabContents[f]=g("div#"+h+" li",b.elLk.dy.container)})},loadState:function(){var b=this;this.loadingState=!0;this.localStoreObj=this.getLocalStorage();if(Object.keys(this.localStoreObj).length){if(this.localStoreObj.dx){var c;g.each(this.localStoreObj.dx,function(h){c=b.elLk.dx.tabContents.not(":not(."+h+")");b.selectBox(c)});b.filterData(g(c).data("item"))}if(this.localStoreObj.dy){var f;g.each(this.localStoreObj.dy,function(h){f=b.elLk.lookup[h].subTab;c=b.elLk.dy.tabContents[f].filter(function(){return g(this).hasClass(h)});b.selectBox(c)});!this.localStoreObj.dx&&this.localStoreObj.dy&&b.filterData(g(c).data("item"))}b.updateRHS()}this.loadingState=!1},setUserLocation:function(){this.localStoreObj.userLocation&&(this.localStoreObj.userLocation.view=this.elLk.breadcrumb.filter(".active").attr("id"),this.elLk.trackPanel.hasClass("active")?this.localStoreObj.userLocation.tab=this.elLk.trackPanel.find("div.track-menu div.track-tab.active").attr("id"):this.localStoreObj.userLocation.tab="",this.setLocalStorage())},goToUserLocation:function(){g.isEmptyObject(this.localStoreObj.userLocation)||(this.toggleBreadcrumb(this.localStoreObj.userLocation.view?"#"+this.localStoreObj.userLocation.view:"#track-select"),this.localStoreObj.userLocation.tab&&this.toggleTab({selectElement:"#"+
this.localStoreObj.userLocation.tab,container:this.el.find("div.track-menu")}))},setDragSelectEvent:function(){var b=this;this.dragSelect||(this.dragSelect=new fa({elements:"li span",zone:"._drag_select_zone",onSelect:function(c){b.selectBox(c.parentElement,1);this.el=c.parentElement},stop:function(){var c=g(this.el).data("item");c&&b.elLk.lookup[c].parentTabId===b.getActiveTab()&&(b.filterData(c),b.updateRHS())}}))},clearAll:function(b){var c=this;b.on("click",function(f){g.each(c.el.find("div.result-box").find("li").not(".noremove"),function(h,k){c.selectBox(k)})})},clearSearch:function(){var b=this;b.elLk.searchCrossIcon=b.elLk.buttonTab.find("span.search-cross-icon");b.elLk.searchCrossIcon.click("on",function(){b.getActiveTabContainer().find("span.search-error").hide();b.getActiveTabContainer().find("div.selectall-container div.select-link, div.selectall-container div.divider").show();g(this).parent().find("input.configuration_search_text").val("");b.resetFilter("",!0);b.elLk.searchCrossIcon.hide();b.elLk.searchCrossIcon.parent().find("input").focus()})},enableConfigureButton:function(b){var c=this.el.find(b).length,f=0;this.el.find(b).each(function(h,k){g(k).find("li").length&&g(k).find("span.fancy-checkbox.selected").length&&f++});f===c?(this.el.find("li.view-track").removeClass("inactive"),this.el.find("li._configure").removeClass("inactive"),this.elLk.displayButton.addClass("active")):(this.el.find("li.view-track").addClass("inactive"),this.el.find("li._configure").addClass("inactive"),this.elLk.displayButton.removeClass("active"))},trackError:function(b){var c=this;c.el.find(b).each(function(f,h){f="_"+g(h).attr("id");g(h).find("li").length&&g(h).find("span.fancy-checkbox.selected").length?(c.el.find("span."+f).hide(),c.el.find("div#dx.result-content").show()):(c.el.find("span."+f).show(),c.el.find("div#dx.result-content").hide())})},showResetLink:function(b){this.el.find(b).find("li").length&&this.el.find(b).find("span.fancy-checkbox.selected").length?this.el.find("div.reset_track").show():this.el.find("div.reset_track").hide()},updateCurrentCount:function(b,c,f){b&&(this.el.find("#"+b+" span.current-count",this.elLk.resultBox).html(c),this.el.find("#"+b+" span.total",this.elLk.resultBox).html(f))},selectDeselectAll:function(){var b=this;b.el.find("div.selectall-container div.select-link").on("click",function(c){var f=g(this).hasClass("all-box"),h="";g(this).closest(".tab-content").find("li._filtered").length&&(h="._filtered");h=g(this).closest(".tab-content").find("li"+h+':not("._search_hide")');var k=h.find("span.fancy-checkbox");f?(k.addClass("selected"),h.addClass("_selected")):(k.removeClass("selected"),h.removeClass("_selected"));h.map(function(){b.elLk.lookup[g(this).data("item")].selected=f});h=h.data("item");b.filterData(h);b.updateRHS();c.stopPropagation()})},clickCheckbox:function(b){var c=this,f="li";"DIV"===b[0].nodeName&&(f="");g(b).off().on("click",f,function(h){c.selectBox(this);1<g(this).closest("ul.result-list").children("li").length?c.removeFromMatrix(g(this).data("item")):(c.toggleButton(),g(this).closest(".result-content").find(".sub-result-link").click());var k=g(this).data("item");c.filterData(k);c.updateRHS();h.stopPropagation()})},removeFromMatrix:function(b){var c=this;if(b){c.elLk.trackConfiguration.find(".matrix-container ."+b+", .matrix-container ._emptyBox_"+b).remove();var f=g.extend({},c.localStoreObj.matrix);g.each(c.json.extra_dimensions,function(h,k){g.extend(f,c.localStoreObj[k])});Object.keys(f).map(function(h){if(h.match(b+"_sep_")||h.match("_sep_"+b)){var k=c.itemDimension(h),l=c.localStoreObj[k][h].state.replace("track-",""),p=c.localStoreObj[k][h].renderer;g.each(h.split("_sep_"),function(q,m){m!=b&&(q=c.itemDimension(m),0<c.localStoreObj[q][m].total&&--c.localStoreObj[q][m].total,0<c.localStoreObj[q][m].state[l]&&(--c.localStoreObj[q][m].state[l],--c.localStoreObj[q][m].state["reset-"+l]),0<c.localStoreObj[q][m].renderer[p]&&(--c.localStoreObj[q][m].renderer[p],--c.localStoreObj[q][m].renderer["reset-"+p]),0<c.localStoreObj[q].allSelection.total&&--c.localStoreObj[q].allSelection.total,0<c.localStoreObj[q].allSelection.state[l]&&(--c.localStoreObj[q].allSelection.state[l],--c.localStoreObj[q].allSelection.state["reset-"+l]),0<c.localStoreObj[q].allSelection.renderer[p]&&(--c.localStoreObj[q].allSelection.renderer[p],--c.localStoreObj[q].allSelection.renderer["reset-"+p]))});delete c.localStoreObj[k][h]}});delete c.localStoreObj[c.itemDimension(b)][b];c.setLocalStorage()}},updateRHS:function(b){this.updateSelectedTracksPanel(b);this.updateShowHideLinks(b);this.showResetLink("div#dx, div#dy");this.setLocalStorage();this.trackError("div#dx, div#source");this.enableConfigureButton("div#dx, div#source");0<Object.keys(this.localStoreObj).length&&this.localStoreObj.dx&&(this.emptyMatrix(),this.displayMatrix())},selectBox:function(b){var c=this,f=g("span.fancy-checkbox",b),h=f.hasClass("selected");if(g(b).hasClass("all-box")){var k="";g(b).closest(".tab-content").find("li._filtered").length&&(k="._filtered");b=g(b).closest(".tab-content").find("li"+k+':not("._search_hide")');k=b.find("span.fancy-checkbox");h?(f.removeClass("selected"),k.removeClass("selected"),b.removeClass("_selected")):(f.addClass("selected"),k.addClass("selected"),b.addClass("_selected"));b.map(function(){c.elLk.lookup[g(this).data("item")].selected=!h})}else f=g(b).data("item"),c.elLk.lookup[f].selected=!h,f=g("."+f,c.el),h?g(f).removeClass("_selected").find("span.fancy-checkbox").removeClass("selected"):g(f).addClass("_selected").find("span.fancy-checkbox").addClass("selected")},updateSelectedTracksPanel:function(b){var c=this,f=[];this.selectedTracksCount={};this.totalSelected=0;["dx","dy"].forEach(function(k){if(c.elLk[k].haveSubTabs)g.each(c.elLk[k].tabContents,function(q,m){l=m.has(".selected")||[];p=m.has("._filtered")||[];_search_hide=m.has("._search_hide")||[];p=p.length||m.filter(function(){return"none"!==g(this).css("display")||g(this).hasClass("_search_hide")});c.selectedTracksCount[q]=c.selectedTracksCount[q]||{};c.selectedTracksCount[q].selected=c.selectedTracksCount[q].selected||[];g(l).map(function(){c.selectedTracksCount[q].selected.push(g(this).data("item"))});c.selectedTracksCount[q].available=p.length;c.totalSelected+=l.length;c.updateCurrentCount(q,l.length,p.length);l.length&&f.push(l)});else{var l=c.elLk[k].tabContents.has(".selected")||[];var p=c.elLk[k].tabContents.has("._filtered")||[];p=p.length||c.elLk[k].tabContents.filter(function(){return"none"!==g(this).css("display")||g(this).hasClass("_search_hide")});c.selectedTracksCount[k]=c.selectedTracksCount[k]||{};c.selectedTracksCount[k].selected=c.selectedTracksCount[k].selected||[];g(l).map(function(){c.selectedTracksCount[k].selected.push(g(this).data("item"))});c.selectedTracksCount[k].available=p.length;c.totalSelected+=l.length;c.updateCurrentCount(k,l.length,p.length);l.length&&f.push(l)}});var h={};g(f).each(function(k,l){g(l).each(function(p,q){p=g(q).data("item");h[p]=g(q).clone().removeClass("noremove _search_hide").show()})});c.updateSelectedTracks(h);b=Object.keys(h);!c.loadingState&&c.addToStore(b);c.setLocalStorage()},updateSelectedTracks:function(b){var c=this;g('li:not(".noremove")',c.elLk.filterList).remove();g.each(b,function(f,h){g("#"+c.elLk.lookup[f].subTab+".result-content ul",c.el).append(h)})},updateLHMenu:function(){var b=0,c=this.localStoreObj.matrix,f;for(f in c)f.match("_sep_")&&c[f].state&&"track-on"===c[f].state&&b++;g(this.menuCountSpan).text(b)},setLocalStorage:function(){localStorage.setItem(this.localStorageKey,JSON.stringify(this.localStoreObj));this.updateLHMenu()},getLocalStorage:function(){return JSON.parse(localStorage.getItem(this.localStorageKey))||{}},addToStore:function(b){this.localStoreObj={};if(b.length){var c=this,f;g.each(b,function(h,k){f=c.elLk.lookup[k].parentTabId;c.localStoreObj[f]=c.localStoreObj[f]||{};c.localStoreObj[f][k]=1});c.localStoreObj.matrix=c.getLocalStorage().matrix||{};g.each(c.json.extra_dimensions,function(h,k){c.localStoreObj[k]=c.getLocalStorage()[k]||{}});c.localStoreObj.userLocation=c.getLocalStorage().userLocation||{}}},removeFromStore:function(b,c){"dx"!==c?b&&c&&delete this.localStoreObj.dy[c][b]:b&&c&&delete this.localStoreObj[c][b]},clickDisplayButton:function(b,c){var f=this;b.on("click",function(h){b.hasClass("_edit")?(f.toggleTab({selectElement:f.el.find("li._configure"),container:f.el.find("div.large-breadcrumbs")}),f.toggleButton()):b.hasClass("active")&&(f.toggleTab({selectElement:c,container:f.el.find("div.large-breadcrumbs")}),f.toggleButton());f.emptyMatrix();f.displayMatrix()})},clickSubResultLink:function(){var b=this;b.el.find("div.sub-result-link").on("click",function(c){c="div#"+b.el.find(this).parent().attr("id")+"-tab";var f="div#"+b.el.find(c).find("span.content-id").html(),h=b.el.find(this).parent().find("span._parent-tab-id").html();b.el.find(".track-tab.active").first().removeClass("active");b.el.find(".tab-content.active").first().removeClass("active");b.el.find("div#configuration-content:visible").length&&(b.toggleTab({selectElement:b.el.find("li._track-select"),container:b.el.find("div.large-breadcrumbs")}),b.toggleButton());if(h){h="div#"+h;var k="div#"+b.el.find(h).find("span.content-id").html();b.el.find(k+" .track-tab.active").removeClass("active");b.el.find(k+" .tab-content.active").removeClass("active");b.el.find(h).addClass("active");b.el.find(k).addClass("active");g(h).find("div.search-box").length&&(b.el.find(".search-box").hide(),g(h).find("div.search-box").show())}g(c).find("div.search-box").length&&(b.el.find(".search-box").hide(),g(c).find("div.search-box").show());b.el.find(c).addClass("active");b.el.find(f).addClass("active")})},updateShowHideLinks:function(){g.each(this.elLk.filterList,function(b,c){!g(c).siblings("div.show-hide:visible").length&&g("li",c).length?(b="none"===g(c).css("display")?"._show":"._hide",g(c).siblings(b).show()):g(c).siblings("div.show-hide:visible").length&&0===g("li",c).length&&g(c).siblings("._hide, ._show").hide()})},showHideFilters:function(){var b=this;b.el.find("div.show-hide").on("click",function(c){b.el.find(this).parent().find("div.show-hide, ul.result-list").toggle()})},trackTab:function(){var b=this,c=b.el.find("div#dx-content"),f=c.data("rhsection-id");b.dx=b.json.dimensions[0];b.dy=b.json.dimensions[1];var h=b.json.data[b.dx],k=b.json.data[b.dy];this.displayCheckbox({data:Object.keys(h.data),container:"div#dx-content",listType:h.listType,parentTabContainer:c,rhSectionId:f,noFilter:!0});var l='<div class="tabs dy">',p="";Object.keys(k.data).sort().forEach(function(t){var v=k.data[t];delete k.data[t];k.data[t]=v});var q=0;g.each(k.data,function(t,v){var w="";0===q&&(w="active");l+='<div class="track-tab '+w+'" id="'+t+'-tab">'+v.name+'<span class="hidden content-id">'+t+"-content</span></div>";p+='<div id="'+t+'-content" class="tab-content '+w+'" data-rhsection-id="'+t+'""><span class="hidden rhsection-id">'+t+"</span></div>";q++});l+="</div>";var m=b.el.find("div#dy-content");m.append(l).append(p);f=m.data("rhsection-id");k.subtabs?g.each(k.data,function(t,v){b.displayCheckbox({data:v.data,container:"div#"+t+"-content",listType:v.listType,parentTabContainer:m,rhSectionId:f,noFilter:!0,set:v.set})}):this.displayCheckbox({data:k.data,container:"div#dy-content",listType:k.listType,parentTabContainer:m,rhSectionId:f,noFilter:!0});b.addRelationData();this.el.find("div.dy div.track-tab").on("click",function(){b.toggleTab({selectElement:this,container:b.el.find("div.dy")});b.resize()})},toggleTab:function(b){var c=b.selectElement,f=b.container,h=b.selByClass,k=b.resetRibbonOffset,l=b.searchTriggered,p=b.resetFilter,q=this;g(c).hasClass("active")||g(c).hasClass("inactive")||(g(c).find("div.search-box").length&&(q.el.find(".search-box").hide(),g(c).find("div.search-box").show()),b=f.find(".active span.content-id").html(),f.find(".active").removeClass("active"),h?f.find("div."+b).removeClass("active"):q.el.find("#"+b).removeClass("active"),b=g(c).find("span.content-id").html(),g(c).addClass("active"),activeAlphabetContentDiv=h?f.find("div."+b):q.el.find("#"+b),activeAlphabetContentDiv.addClass("active"),h=g(".content-id",c).html(),f=g("#"+h+" .tabs div.track-tab",q.elLk.trackPanel),f.length&&!f.hasClass("active")&&f.not(".inactive").length&&(f=f.not(".inactive")[0],h=g(".content-id",f).html(),h=g("#"+h,q.elLk.trackPanel),g(f).addClass("active"),g(h).addClass("active")),k&&g(c).closest(".letters-ribbon").data({reset:!0}),activeAlphabetContentDiv=q.elLk.trackPanel.find("div.ribbon-content .alphabet-content.active"),g.each(activeAlphabetContentDiv,function(m,t){m=g(t).closest(".tab-content").find("div.alphabet-div.active");if(g(m).closest(".letters-ribbon").data("reset")&&(g(c).hasClass("track-tab")||l)&&!p){var v=q.getActiveAlphabets().filter(function(){return g(this).hasClass("active")});v=g(m).parent().children().index(v);var w=g(m).closest(".ribbon-banner").offset();"none"!==g(m).closest(".ribbon-banner").closest(".tab-content").css("display")&&(newOffset=w.left-22*v+10,g(m).closest(".letters-ribbon").offset({left:newOffset}),g(m).closest(".letters-ribbon").removeData("reset"))}m.offset()&&!p&&g(t).offset({left:m.offset().left-2})}))},toggleBreadcrumb:function(b){this.el.find(b).hasClass("view-track")||this.toggleTab({selectElement:b,container:this.el.find("div.large-breadcrumbs")});this.toggleButton();this.el.find(b).hasClass("_configure")&&!this.el.find(b).hasClass("inactive")&&(this.emptyMatrix(),this.displayMatrix())},toggleButton:function(){this.el.find("div.track-configuration:visible").length?this.el.find("button.showMatrix").addClass("_edit").outerWidth("100px").html("View tracks"):this.el.find("button.showMatrix").outerWidth(this.buttonOriginalWidth).html(this.buttonOriginalHTML).removeClass("_edit")},createTooltipText:function(b){if(b!==R){var c="";this.json.info&&this.json.info[b]&&(c=this.json.info[b].full_name?this.json.info[b].full_name:b,c="<p> <u>"+c+"</u></p><p>"+this.json.info[b].description+"</p>");return c}},displayCheckbox:function(b){var c=b.data;if(c){var f=b.container,h=b.listType,k=b.parentTabContainer,l=b.rhSectionId,p=b.noFilter,q=b.set||"",m=this,t={},v=0;if(h&&"alphabetRibbon"===h)g.each(c.sort(),function(B,D){B=D.charAt(0).toLowerCase();t[B]||(t[B]=[]);t[B].push(D)}),m.alphabetRibbon(t,f,k,l,p,q),m.updateAvailableTabsOrRibbons(m.getActiveTab());else{f=m.el.find(f);var w='<div class="_drag_select_zone"> <ul class="letter-content list-content">',z=f.find("span.rhsection-id").html();c=c.sort();g.each(c,function(B,D){if(D){var E=D.replace(/[^\w\-]/g,"_");B=m.createTooltipText(D);w+='<li class="noremove '+E+'" data-parent-tab="'+z+'" data-item="'+E+'"><span class="fancy-checkbox"></span><text class="_ht _ht_delay" title="'+B+'">'+D+"</text></li>"}v++;m.elLk.lookup[E]={label:D,parentTab:k,parentTabId:l,subTab:z,selected:!1,set:q||""}});w+="</ul></div>";w='<div class="content-wrapper"><span class="hidden error search-error">No matches</span><div class="selectall-container"><div class="deselect-box select-link" id="deSelectBox-'+g(f).attr("id")+'">Deselect all</div><div class="divider">|</div><div class="all-box select-link" id="allBox-'+
g(f).attr("id")+'">Select all</div></div>'+w+"</div>";f.append(w);g.each(c,function(B,D){D&&(B=D.replace(/[^\w\-]/g,"_"),m.elLk.lookup[B].el=f.find("."+B))});m.el.find("div#"+z+" span.total").html(v)}}},addRelationData:function(){var b=this;g.each(b.json.data[b.dx].data,function(c,f){var h=c.replace(/[^\w\-]/g,"_");b.elLk.lookup[h].data=f;var k="";g.each(f,function(l,p){l=p.val.replace(/[^\w\-]/g,"_");k+=l+" ";(p=b.el.find("li."+l).attr("data-filter"))?b.el.find("li."+l).attr("data-filter",p+" "+
h):b.el.find("li."+l).attr("data-filter",h);b.el.find("li."+l).attr("data-filtercontainer")||b.el.find("li."+l).attr("data-filtercontainer","dx-content")});b.el.find("li."+h).attr("data-filter",k).attr("data-filtercontainer","dy-content")})},filterData:function(b){if(b){var c=g(this.elLk.lookup[b].parentTab,this.el),f="#"+g("."+b,this.elLk.trackPanel).data("filtercontainer"),h=this.el.find(f).find("li"),k={};c.find("li span.fancy-checkbox.selected").parent().map(function(){g(this).data("filter")&&g(this).data("filter").split(" ").map(function(p){""!==p&&(k[p]=1)})});h.hide();c="";if(Object.keys(k).length){c="li."+Object.keys(k).join(", li.");var l=this.elLk.trackPanel.find(f).find("li._selected");this.elLk.trackPanel.find(f).find(c).addClass("_filtered").show();g(l).addClass("_filtered").show();h.not("._filtered").find("span.fancy-checkbox").removeClass("selected")}else h.removeClass("_filtered").show();this.updateAvailableTabsOrRibbons({dx:"dy",dy:"dx"}[this.elLk.lookup[b].parentTabId],!0)}},getActiveAlphabets:function(b){b=b||this.getActiveTabContainer();return g(b).find(".ribbon-banner div.alphabet-div").not(".inactive")},alphabetRibbon:function(b,c,f,h,k,l){var p=this,q="",m="",t=0;c=p.el.find(c);var v=c.find("span.rhsection-id").html();g.each(Array(26),function(w){var z=String.fromCharCode(w+97),B="",D="";0===w&&(B="active");b[z]&&b[z].length?(D='<ul class="letter-content">',g.each(b[z],function(E,G){t++;E=G.replace(/[^\w\-]/g,"_");var I=p.createTooltipText(G);D+='<li class="noremove '+
E+'" data-parent-tab="'+v+'" data-item="'+E+'"><span class="fancy-checkbox"></span><text class="_ht _ht_delay" title="'+I+'">'+G+"</text></li>";p.elLk.lookup[E]={label:G,parentTab:f,parentTabId:h,subTab:v,selected:!1,set:l}}),D+="</ul>"):B="inactive";q+='<div class="ribbon_'+z+" alphabet-div "+B+'">'+z.toUpperCase()+'<span class="hidden content-id">'+z+"_content</span></div>";m+='<div data-ribbon="ribbon_'+z+'" class="'+z+"_content alphabet-content "+B+'">'+D+"</div>"});k=k?"no-filter":"";c.append('<span class="hidden error search-error">No matches</span><div class="selectall-container"><div class="deselect-box select-link '+
k+'" id="deSelectBox-'+g(c).attr("id")+'">Deselect all</div><div class="divider">|</div><div class="select-link all-box '+k+'" id="allBox-'+g(c).attr("id")+'">Select all</div></div><div class="cell-listing _drag_select_zone"><div class="ribbon-banner"><div class="larrow inactive">&#x25C0;</div><div class="alpha-wrapper"><div class="letters-ribbon"></div></div><div class="rarrow">&#x25B6;</div></div><div class="ribbon-content"></div></div>');c.find("div.letters-ribbon").append(q);c.find("div.ribbon-content").append(m);g.each(Array(26),function(w){w=String.fromCharCode(w+97);b[w]&&b[w].length&&g.each(b[w],function(z,B){t++;z=B.replace(/[^\w\-]/g,"_");p.elLk.lookup[z].el=c.find("."+z)})});p.el.find("div#"+v+" span.total").html(t);c.find("div.alphabet-div").on("mousedown",function(w){g(c,p.el).hasClass("active")&&g.when(p.toggleTab({selectElement:this,container:c,selByClass:1})).then(p.selectArrow(c))})},selectArrow:function(b){var c=this.getActiveAlphabets(b),f=g(c.get(0)).html().charAt(0),h=g(c.get(-1)).html().charAt(0);c.length&&(g("div.alphabet-div.active",b).html().match(f)?(g("div.larrow",b).removeClass("active").addClass("inactive"),g("div.rarrow",b).removeClass("inactive").addClass("active")):g("div.alphabet-div.active",b).html().match(h)?(g("div.rarrow",b).removeClass("active").addClass("inactive"),g("div.larrow",b).removeClass("inactive").addClass("active")):g("div.larrow, div.rarrow",b).removeClass("inactive").addClass("active"))},registerRibbonArrowEvents:function(){var b=this;b.elLk.arrows=g("div.rarrow, div.larrow",b.elLk.trackPanel);b.elLk.arrows.off().on("mousedown",function(c){container=g(c.target).closest(".tab-content");var f=container.find(".letters-ribbon"),h=container.find(".ribbon-content"),k=b.getActiveAlphabets(container),l=k.filter(function(){return g(this).hasClass("active")}),p=k.index(l);l=l.html().charAt(0).toLowerCase();var q=b.getActiveTab()+"-tab";if((g(container).hasClass("active")||g("#"+q,b.elLk.trackPanel).hasClass("active"))&&!this.className.match(/inactive/gi)){if(this.className.match(/larrow/gi)){if(!k[p-
1])return;var m=g(k[p-1]).html().charAt(0).toLowerCase();q=l.charCodeAt(0)-m.charCodeAt(0);g.when(b.toggleTab({selectElement:f.find("div.ribbon_"+m),container:container,selByClass:1})).then(b.selectArrow(container));f.find(".ribbon_"+m).offset().left<=g(c.target).offset().left+22&&(f.offset({left:f.offset().left+22*q}),m=h.find("div."+m+"_content.alphabet-content"),m.offset({left:m.offset().left+22*q}));f.find(".ribbon_a").offset().left>g(c.target).offset().left+22&&b.activateAlphabetRibbon(container,!0)}this.className.match(/rarrow/gi)&&k[p+1]&&(k=g(k[p+1]).html().charAt(0).toLowerCase(),q=k.charCodeAt(0)-l.charCodeAt(0),g.when(b.toggleTab({selectElement:f.find("div.ribbon_"+k),container:container,selByClass:1})).then(b.selectArrow(container)),f.find(".ribbon_"+k).offset().left>=g(c.target).offset().left-44&&(f.offset({left:f.offset().left-22*q}),c=h.find("div."+k+"_content.alphabet-content"),c.offset({left:c.offset().left-22*q})))}})},itemDimension:function(b){b.match("_sep_")&&(b=b.split("_sep_")[0]);return 0<=this.json.extra_dimensions.indexOf(b)?this.json.extra_dimensions[this.json.extra_dimensions.indexOf(b)]:"matrix"},displayMatrix:function(){var b=this;if(!g.isEmptyObject(b.localStoreObj)){b.trackPopup=b.el.find("div.track-popup");var c='<div  class="xContainer">',f=b.localStoreObj.dy?Object.keys(b.localStoreObj.dy):[];b.localStoreObj.dy&&f.unshift("");b.json.extra_dimensions.sort().reverse().forEach(function(p){f.unshift(p)});g.each(f,function(p,q){p=b.elLk.lookup[q]?b.elLk.lookup[q].label:q;if(""!==q||b.disableYdim)if(b.localStoreObj[b.itemDimension(q)][q]||(b.localStoreObj[b.itemDimension(q)][q]={total:0,state:{on:0,off:0,"reset-on":0,"reset-off":0},renderer:{peak:0,"peak-signal":0,signal:0,normal:0,"reset-peak":0,"reset-peak-signal":0,"reset-signal":0,"reset-normal":0}}),b.localStoreObj[b.itemDimension(q)].allSelection||(b.localStoreObj[b.itemDimension(q)].allSelection={total:0,state:{on:0,off:0,"reset-on":0,"reset-off":0},renderer:{peak:0,"peak-signal":0,signal:0,normal:0,"reset-peak":0,"reset-peak-signal":0,"reset-signal":0,"reset-normal":0}}),b.disableYdim){if("epigenomic_activity"===q||"segmentation_features"===q)c+='<div class="positionFix"><div class="rotate"><div class="overflow xLabel '+q+'"><span class="_ht _ht_delay" title="'+p+'">'+p+"</span></div></div></div>"}else c+='<div class="positionFix"><div class="rotate"><div class="overflow xLabel '+q+'"><span class="_ht _ht_delay" title="'+p+'">'+p+"</span></div></div></div>";else c+='<div class="positionFix"><div class="rotate"><div class="overflow xLabel x-label-gap">'+
p+"</div></div></div>"});c+="</div>";b.el.find("div.matrix-container").append(c);b.localStoreObj.matrix.allSelection||(b.localStoreObj.matrix.allSelection={total:0,state:{on:0,off:0,"reset-on":0,"reset-off":0},renderer:{peak:0,"peak-signal":0,signal:0,normal:0,"reset-peak":0,"reset-peak-signal":0,"reset-signal":0,"reset-normal":0}});var h='<div class="yContainer">',k='<div class="boxContainer">';g.each(b.localStoreObj.dx,function(p,q){var m=b.elLk.lookup[p].label||p,t=0,v=0,w=0,z=0;b.localStoreObj[b.itemDimension(p)][p]||"matrix"===b.itemDimension(p)&&(b.localStoreObj[b.itemDimension(p)][p]={total:0,state:{on:0,off:0,"reset-on":0,"reset-off":0},renderer:{peak:0,signal:0,normal:0,"peak-signal":0,"reset-peak":0,"reset-peak-signal":0,"reset-signal":0}});h+='<div class="yLabel '+p+'"><span class="_ht _ht_delay" title="'+b.createTooltipText(m)+'">'+m+"</span></div>";var B='<div class="rowContainer">';g.each(f,function(D,E){if(""!==E||b.disableYdim){var G="",I="",K="peak-signal",S="",U="",T=E+"_sep_"+p,V,O,Q=b.itemDimension(T),N=b.itemDimension(E);D="matrix"===Q?Q:"";b.localStoreObj[Q][T]?(G=b.localStoreObj[Q][T].state,I=b.localStoreObj[Q][T].renderer,K=b.localStoreObj[Q][T].popupType||K,U="render-"+I,S="_hasData"):g.each(b.json.data[b.dx].data[m],function(X,Z){Z.val.replace(/[^\w\-]/g,"_").toLowerCase()===E.toLowerCase()&&(S="_hasData",O=Z.dimension,K=b.json.data[O].popupType||K,V=b.json.data[O].renderer,G=Z.defaultState||b.elLk.lookup[E].defaultState,I=V||b.elLk.lookup[E].renderer,U="render-"+I,b.localStoreObj[Q][T]={state:G,renderer:I,popupType:K,"reset-state":G,"reset-renderer":I},b.localStoreObj[N].allSelection.total+=1,b.localStoreObj[N].allSelection.renderer[I]+=1,b.localStoreObj[N].allSelection.renderer["reset-"+I]+=1,b.localStoreObj[N].allSelection.state[G.replace("track-","")]++,b.localStoreObj[N].allSelection.state["reset-"+G.replace("track-","")]++,b.localStoreObj[N][E].total+=1,b.localStoreObj[N][E].renderer[I]+=1,b.localStoreObj[N][E].renderer["reset-"+I]+=1,b.localStoreObj[N][E].state[G.replace("track-","")]++,b.localStoreObj[N][E].state["reset-"+G.replace("track-","")]++,-1===b.json.extra_dimensions.indexOf(E)&&(t++,v++,"track-on"===G?w++:z++))});if(b.disableYdim){if("epigenomic_activity"===E||"segmentation_features"===E)B+='<div class="xBoxes '+G+" "+D+" "+U+" "+S+" "+p+" "+E+'" data-track-x="'+E+'" data-track-y="'+p+'" data-popup-type="'+K+'"></div>'}else B+='<div class="xBoxes '+G+" "+D+" "+U+" "+S+" "+p+" "+E+'" data-track-x="'+E+'" data-track-y="'+p+'" data-popup-type="'+K+'"></div>'}else B+='<div class="xBoxes _emptyBox_'+p+'"></div>'});b.localStoreObj.matrix[p].total+=t;b.localStoreObj.matrix[p].state.on+=w;b.localStoreObj.matrix[p].state["reset-on"]+=w;b.localStoreObj.matrix[p].state.off+=z;b.localStoreObj.matrix[p].state["reset-off"]+=z;b.localStoreObj.matrix[p].renderer["peak-signal"]+=v;b.localStoreObj.matrix[p].renderer["reset-peak-signal"]+=v;B+="</div>";k+=B});h+="</div>";k+="</div>";var l='<div class="yBoxWrapper">'+h+k+"</div>";b.el.find("div.matrix-container").append(l);l=32*f.length;b.el.find("div.matrix-container .xContainer, div.matrix-container .yBoxWrapper").width(l);b.cellClick();b.cleanMatrixStore();b.setLocalStorage();this.elLk.matrixContainer.find("._ht").helptip()}},emptyMatrix:function(){this.el.find("div.matrix-container").html("")},cleanMatrixStore:function(){var b=this,c=g.extend({},b.localStoreObj.dy);g.map(b.json.extra_dimensions,function(f){c[f]=1});g.each(g.merge(["matrix"],b.json.extra_dimensions),function(f,h){g.each(b.localStoreObj[h],function(k,l){k.match("_sep_")||"allSelection"==k||c[k]||b.localStoreObj.dx[k]||b.removeFromMatrix(k)})})},resetMatrix:function(){var b=this;this.elLk.resetMatrixButton=b.elLk.trackConfiguration.find("button.reset-button._matrix");this.elLk.resetMatrixButton.click("on",function(){var c=g.extend({},b.localStoreObj.matrix);g.each(b.json.extra_dimensions,function(f,h){g.extend(c,b.localStoreObj[h])});Object.keys(c).map(function(f){var h=b.itemDimension(f);if(f.match("_sep_")){var k=c[f].state,l=c[f].renderer,p=c[f]["reset-state"],q=c[f]["reset-renderer"];b.elLk.matrixContainer.find("div.xBoxes."+f.split("_sep_")[0]+"."+f.split("_sep_")[1]).removeClass(k).addClass(p);b.elLk.matrixContainer.find("div.xBoxes."+f.split("_sep_")[0]+"."+f.split("_sep_")[1]).removeClass("render-"+l).addClass("render-"+q);b.localStoreObj[h][f].state=p;b.localStoreObj[h][f].renderer=q}else b.localStoreObj[h][f].state.on=c[f].state["reset-on"],b.localStoreObj[h][f].state.off=c[f].state["reset-off"],b.localStoreObj[h][f].renderer.peak=c[f].renderer["reset-peak"],b.localStoreObj[h][f].renderer.signal=c[f].renderer["reset-signal"],b.localStoreObj[h][f].renderer["peak-signal"]=c[f].renderer["reset-peak-signal"],b.localStoreObj[h][f].renderer.normal=c[f].renderer["reset-normal"],b.localStoreObj[h].allSelection.state.on=c.allSelection.state["reset-on"],b.localStoreObj[h].allSelection.state.off=c.allSelection.state["reset-off"],b.localStoreObj[h].allSelection.renderer.peak=c.allSelection.renderer["reset-peak"],b.localStoreObj[h].allSelection.renderer.signal=c.allSelection.renderer["reset-signal"],b.localStoreObj[h].allSelection.renderer["peak-signal"]=c.allSelection.renderer["reset-peak-signal"],b.localStoreObj[h].allSelection.renderer.normal=c.allSelection.renderer["reset-normal"]})})},resetTracks:function(){var b=this;this.elLk.resetTrack=b.elLk.resultBox.find("div.reset_track");this.elLk.resetTrack.click("on",function(){b.localStoreObj.dx={};b.localStoreObj.dy={};b.localStoreObj.matrix={};b.setLocalStorage();b.emptyMatrix();b.resetFilter("",!0);g.each(b.el.find("div.result-box").find("li").not(".noremove"),function(c,f){b.selectBox(f);b.filterData(g(f).data("item"))});b.updateRHS();b.toggleBreadcrumb("#track-select")})},cellClick:function(){var b=this;b.elLk.rowContainer=this.elLk.matrixContainer.find("div.rowContainer");b.popupType="";b.TrackPopupType="";b.xLabel="";b.yLabel="";b.xName="";b.yName="";b.boxObj="";b.el.find("div.matrix-container div.xBoxes.track-on, div.matrix-container div.xBoxes.track-off").on("click",function(c){b.el.find("div.matrix-container div.xBoxes.track-on.mClick, div.matrix-container div.xBoxes.track-off.mClick").removeClass("mClick");b.trackPopup.hide();b.boxObj=g(this);b.popupType=g(this).data("popup-type");b.TrackPopupType=b.el.find("div.track-popup."+b.popupType);b.xName=g(this).data("track-x");b.yName=g(this).data("track-y");b.xLabel=g(b.elLk.rowContainer.find("div.xLabel."+b.xName));b.yLabel=g(b.elLk.rowContainer.find("div.yLabel."+b.yName));b.cellKey=b.xName+"_sep_"+b.yName;b.cellStateKey=b.itemDimension(b.cellKey)||"";b.dyStateKey=b.itemDimension(b.yName)||"";b.dxStateKey=b.itemDimension(b.xName)||"";var f=b.localStoreObj[b.cellStateKey][b.cellKey].state,h=b.localStoreObj[b.cellStateKey][b.cellKey].renderer,k="",l="",p=b.localStoreObj[b.dxStateKey].allSelection.state.on===b.localStoreObj[b.dxStateKey].allSelection.total?"track-on":"track-off";l=b.localStoreObj[b.dxStateKey][b.xName].state.off===b.localStoreObj[b.dxStateKey][b.xName].total?"track-off":b.localStoreObj[b.dxStateKey][b.xName].state.on===b.localStoreObj[b.dxStateKey][b.xName].total?"track-on":"track-off";k=b.localStoreObj[b.dyStateKey][b.yName].state.off===b.localStoreObj[b.dyStateKey][b.yName].total?"track-off":b.localStoreObj[b.dyStateKey][b.yName].state.on===b.localStoreObj[b.dyStateKey][b.yName].total?"track-on":"track-off";var q="";g.map(b.localStoreObj[b.dyStateKey][b.yName].renderer,function(v,w){w.match("reset-")||v!==b.localStoreObj[b.dyStateKey][b.yName].total||(q=w)});var m="";g.map(b.localStoreObj[b.dxStateKey][b.xName].renderer,function(v,w){w.match("reset-")||v!==b.localStoreObj[b.dxStateKey][b.xName].total||(m=w)});var t="";g.map(b.localStoreObj[b.dxStateKey].allSelection.renderer,function(v,w){w.match("reset-")||v!==b.localStoreObj[b.dxStateKey].allSelection.total||(t=w)});g(this).addClass("mClick");"track-on"===l?b.TrackPopupType.find('ul li label.switch input[name="column-switch"]').prop("checked",!0):b.TrackPopupType.find('ul li label.switch input[name="column-switch"]').prop("checked",!1);m?b.TrackPopupType.find("ul li input[name=column-radio]._"+m).prop("checked",!0):b.TrackPopupType.find("ul li input[name=column-radio]").prop("checked",!1);"track-on"===k?b.TrackPopupType.find('ul li label.switch input[name="row-switch"]').prop("checked",!0):b.TrackPopupType.find('ul li label.switch input[name="row-switch"]').prop("checked",!1);q?b.TrackPopupType.find("ul li input[name=row-radio]._"+q).prop("checked",!0):b.TrackPopupType.find("ul li input[name=row-radio]").prop("checked",!1);"track-on"===f?b.TrackPopupType.find('ul li label.switch input[name="cell-switch"]').prop("checked",!0):b.TrackPopupType.find('ul li label.switch input[name="cell-switch"]').prop("checked",!1);h?b.TrackPopupType.find("ul li input[name=cell-radio]._"+h).prop("checked",!0):b.TrackPopupType.find("ul li input[name=cell-radio]").prop("checked",!1);"track-on"===p?b.TrackPopupType.find('ul li label.switch input[name="all-switch"]').prop("checked",!0):b.TrackPopupType.find('ul li label.switch input[name="all-switch"]').prop("checked",!1);t?b.TrackPopupType.find("ul li input[name=all-radio]._"+t).prop("checked",!0):b.TrackPopupType.find("ul li input[name=all-radio]").prop("checked",!1);b.TrackPopupType.attr("data-track-x",g(this).data("track-x")).attr("data-track-y",g(this).data("track-y")).css({top:g(this)[0].offsetTop-
g("div.matrix-container")[0].scrollTop+15,left:g(this)[0].offsetLeft-g("div.matrix-container")[0].scrollLeft+15}).show();b.popupFunctionality();c.stopPropagation()})},updateTrackStore:function(b,c,f,h,k,l){var p=this,q=f?"state":"renderer",m=f?f.replace("track-",""):k,t=h?h.replace("track-",""):l;if("allSelection"===c)Object.keys(b).filter(function(z){z.match("_sep_")?b[z][q]=f?f:k:g.each(b[z][q],function(B,D){m===B?b[z][q][B]=b[z].total:B.match("reset-")||(b[z][q][B]=0)})});else{var v=p.itemDimension(c);if(c.match("_sep_")){b[q]=f?f:k;var w=0;g.each(c.split("_sep_"),function(z,B){p.localStoreObj[p.dxStateKey][B][q][m]<p.localStoreObj[p.dxStateKey][B].total&&(p.localStoreObj[p.dxStateKey][B][q][m]+=1);0<p.localStoreObj[p.dxStateKey][B][q][t]&&--p.localStoreObj[p.dxStateKey][B][q][t];w||(p.localStoreObj[p.dxStateKey].allSelection[q][m]<p.localStoreObj[p.dxStateKey].allSelection.total&&(p.localStoreObj[p.dxStateKey].allSelection[q][m]+=1),0<p.localStoreObj[p.dxStateKey].allSelection[q][t]&&--p.localStoreObj[p.dxStateKey].allSelection[q][t],w=1);if("matrix"!=v)return!1})}else g.each(b[q],function(z,B){z===m?b[q][z]=b.total:z.match("reset-")||(b[q][z]=0)}),Object.keys(p.localStoreObj[v]).filter(function(z){z.match(c)&&z.match("_sep_")&&("matrix"===v&&g.grep(z.split("_sep_"),function(B,D){D=p.localStoreObj[v][z][q];var E=f?f:k;D=D.replace("track-","");E=E.replace("track-","");B!=c&&D!=E&&(p.localStoreObj[v][B][q][m]<p.localStoreObj[v][B].total&&(p.localStoreObj[v][B][q][m]+=1),0<p.localStoreObj[v][B][q][D]&&--p.localStoreObj[v][B][q][D],p.localStoreObj[v].allSelection[q][m]<p.localStoreObj[v].allSelection.total&&(p.localStoreObj[v].allSelection[q][m]+=1),0<p.localStoreObj[v].allSelection[q][D]&&--p.localStoreObj[v].allSelection[q][D])}),p.localStoreObj[v][z][q]=f?f:k)})}p.setLocalStorage()},popupFunctionality:function(){var b=this;b.TrackPopupType.find("ul li label.switch input[type=checkbox]").off().on("click",function(c){var f=g(this).attr("name"),h=g(this).is(":checked")?"track-on":"track-off",k="track-on"===h?"track-off":"track-on";if("column-switch"===f)b.elLk.rowContainer.find("div.xBoxes."+b.xName+"."+k).removeClass(k).addClass(h),b.TrackPopupType.find('ul li label.switch input[name="cell-switch"]').prop("checked","track-on"===h?!0:!1),b.updateTrackStore(b.localStoreObj[b.dxStateKey][b.xName],b.xName,h,k),h=b.localStoreObj[b.dxStateKey][b.xName]&&b.localStoreObj[b.dxStateKey][b.xName].state.on===b.localStoreObj[b.dxStateKey][b.xName].total,b.TrackPopupType.find('ul li label.switch input[name="row-switch"]').prop("checked",h),allOn=b.localStoreObj[b.dxStateKey].allSelection&&b.localStoreObj[b.dxStateKey].allSelection.state.on===b.localStoreObj[b.dxStateKey].allSelection.total,b.TrackPopupType.find('ul li label.switch input[name="all-switch"]').prop("checked",allOn);else if("row-switch"===f)b.elLk.rowContainer.find("div.xBoxes.matrix."+b.yName+"."+k).removeClass(k).addClass(h),b.TrackPopupType.find('ul li label.switch input[name="cell-switch"]').prop("checked","track-on"===h?!0:!1),b.updateTrackStore(b.localStoreObj[b.dxStateKey][b.yName],b.yName,h,k),h=b.localStoreObj[b.dxStateKey][b.xName]&&b.localStoreObj[b.dxStateKey][b.xName].state.on===b.localStoreObj[b.dxStateKey][b.xName].total,b.TrackPopupType.find('ul li label.switch input[name="column-switch"]').prop("checked",h),allOn=b.localStoreObj[b.dxStateKey].allSelection&&b.localStoreObj[b.dxStateKey].allSelection.state.on===b.localStoreObj[b.dxStateKey].allSelection.total,b.TrackPopupType.find('ul li label.switch input[name="all-switch"]').prop("checked",allOn);else if("all-switch"===f)b.elLk.rowContainer.find("div.xBoxes.matrix._hasData."+k).removeClass(k).addClass(h),b.TrackPopupType.find("ul li label.switch input[name$=-switch]").prop("checked","track-on"===h?!0:!1),b.updateTrackStore(b.localStoreObj[b.dxStateKey],"allSelection",h,k);else{b.boxObj.removeClass(k).addClass(h);f=b.xName+"_sep_"+b.yName;b.updateTrackStore(b.localStoreObj[b.dxStateKey][f],f,h,k);var l,p;b.localStoreObj[b.dyStateKey][b.yName]&&(p=b.localStoreObj[b.dyStateKey][b.yName]);b.localStoreObj[b.dyStateKey][b.xName]?l=b.localStoreObj[b.dyStateKey][b.xName]:b.localStoreObj[b.xName][b.xName]&&(l=b.localStoreObj[b.xName][b.xName]);h=p.state.on===p.total;b.TrackPopupType.find('ul li label.switch input[name="row-switch"]').prop("checked",h);h=l.state.on===l.total;b.TrackPopupType.find('ul li label.switch input[name="column-switch"]').prop("checked",h);allOn=b.localStoreObj[b.dyStateKey].allSelection&&b.localStoreObj[b.dyStateKey].allSelection.state.on===b.localStoreObj[b.dyStateKey].allSelection.total;b.TrackPopupType.find('ul li label.switch input[name="all-switch"]').prop("checked",allOn)}c.stopPropagation()});b.TrackPopupType.find("ul li input[type=radio]").off().on("change",function(c){b.updateRenderer(g(this));c.stopPropagation()})},updateRenderer:function(b){var c=b.attr("name");b=b.attr("class").replace(/^_/,"");var f=this.localStoreObj.matrix[this.cellKey].renderer,h="column-radio"===c?this.xName:this.yName,k=this.itemDimension(this.xName);"column-radio"===c||"row-radio"===c?(this.TrackPopupType.find("ul li input[name=cell-radio]._"+b).prop("checked",!0),this.elLk.rowContainer.find("div.xBoxes._hasData."+
h+("row-radio"===c?".matrix":"")).removeClass(function(l,p){return(p.match(/(^|\s)render-\S+/g)||[]).join(" ")}).addClass("render-"+b),this.updateTrackStore(this.localStoreObj[k][h],h,"","",b,f)):"all-radio"===c?(this.TrackPopupType.find("ul li input[name$=-radio]._"+b).prop("checked",!0),this.elLk.rowContainer.find("div.xBoxes._hasData.matrix").removeClass(function(l,p){return(p.match(/(^|\s)render-\S+/g)||[]).join(" ")}).addClass("render-"+b),this.updateTrackStore(this.localStoreObj[k],"allSelection","","",b,f)):(this.boxObj.removeClass("render-"+f).addClass("render-"+b),this.updateTrackStore(this.localStoreObj[k][this.cellKey],this.cellKey,"","",b,f));this.localStoreObj[this.dxStateKey][this.xName].renderer[b]===this.localStoreObj[this.dxStateKey][this.xName].total?this.TrackPopupType.find("ul li input[name=column-radio]._"+b).prop("checked",!0):this.TrackPopupType.find("ul li input[name=column-radio]").prop("checked",!1);this.localStoreObj[this.dyStateKey][this.yName].renderer[b]===this.localStoreObj[this.dyStateKey][this.yName].total?this.TrackPopupType.find("ul li input[name=row-radio]._"+b).prop("checked",!0):this.TrackPopupType.find("ul li input[name=row-radio]").prop("checked",!1);this.localStoreObj[this.dyStateKey].allSelection.renderer[b]===this.localStoreObj[this.dyStateKey].allSelection.total?this.TrackPopupType.find("ul li input[name=all-radio]._"+b).prop("checked",!0):this.TrackPopupType.find("ul li input[name=all-radio]").prop("checked",!1)}});u.Panel.ConfigTrackHubMatrixForm=u.Panel.ConfigMatrixForm.extend({init:function(){var b=this;this.base(arguments);u.EventManager.register("modalPanelResize",this,this.resize);u.EventManager.register("updateConfiguration",this,this.updateConfiguration);u.EventManager.register("updateFromTrackLabel",this,this.updateFromTrackLabel);u.EventManager.register("modalOpen",this,this.modalOpen);var c=this.params.clickedLink.find("a"),f=c.attr("href");this.node_id=f.match(/menu=([^;&]+)/g)[0].split("=")[1];f=f.match(/th_species=([^;&]+)/g)[0].split("=")[1];c=c.siblings(".count").children(".on")[0];this.disableYdim=F.location.href.match("Regulation/Summary")?1:0;this.elLk.dx={};this.elLk.dx.container=g("div#dx-content",this.el);this.elLk.dy={};this.elLk.dy.container=g("div#dy-content",this.el);this.elLk.other_dimensions={};this.elLk.buttonTab=this.el.find("div.track-tab");this.elLk.trackPanel=this.el.find(".track-panel#track-content");this.elLk.matrixContainer=this.el.find("div.matrix-container");this.elLk.filterMatrix=this.el.find("div.filterMatrix-container");this.elLk.filterTrackPanel=this.el.find(".track-panel#filter-content");this.elLk.trackConfiguration=this.el.find(".track-panel#configuration-content");this.elLk.resultBox=this.el.find(".result-box#selected-box");this.elLk.filterList=this.el.find("ul.result-list");this.elLk.filterTrackBox=this.el.find(".result-box#filter-box");this.elLk.configResultBox=this.el.find(".result-box#config-result-box");this.elLk.displayButton=this.el.find("button.showMatrix");this.elLk.viewTrackButton=this.el.find("button.view-track-button");this.elLk.clearAll=this.el.find("span.clearall");this.elLk.ajaxError=this.el.find("span.error._ajax");this.localStoreObj={};this.localStorageKey=this.node_id+"-TrackHubMatrix-"+u.species;this.elLk.lookup={};this.trackHub=!0;this.multiDimFlag=0;this.menuCountSpan=c;this.rendererSelectDropdown=this.el.find("div.track-popup .renderer-selection .renderers");this.buttonOriginalWidth=this.elLk.displayButton.outerWidth();this.buttonOriginalHTML=this.elLk.displayButton.html();this.matrixLoadState=!0;this.json={};this.searchTerms={};this.rendererTextMap={normal:"Normal",compact:"Peaks",signal:"Signal",signal_feature:"Peaks & Signal",as_alignment_nolabel:"Normal",as_alignment_label:"Labels",as_transcript_label:"Structure with labels",as_transcript_nolabel:"Structure",half_height:"Half height",stack:"Stacked",unlimited:"Stacked unlimited",ungrouped:"Ungrouped",coverage_with_reads:"Coverage",histogram:"Histogram",as_collapsed_nolabel:"Collapsed",as_collapsed_label:"Collapsed with labels"};this.rendererConfig={bigbed:"as_alignment_nolabel as_alignment_label as_transcript_nolabel as_transcript_label half_height stack unlimited ungrouped".split(" "),bigwig:["normal","compact","signal","signal_feature"],biggenepred:"as_alignment_nolabel as_alignment_label as_collapsed_nolabel as_collapsed_label as_transcript_nolabel as_transcript_label half_height stack unlimited ungrouped".split(" "),bigint:["interaction"],bam:["coverage_with_reads","unlimited","histogram"],vcf:"as_alignment_nolabel as_alignment_label half_height stack unlimited ungrouped difference".split(" ")};this.resize();b.el.find("div#dy-tab div.search-box").hide();c=b.node_id.match(/Blueprint_Hub/)?"/trackhubdata/"+b.node_id+".json":"/Json/TrackHubData/data?th_species="+f+";menu="+b.node_id+";ictype="+b.params.image_config_type;g.ajax({url:c,dataType:"json",context:this,async:!1,success:function(h){this.checkError(h)?console.log("Fetching main trackhub data error...."):(b.elLk.ajaxError.hide(),this.rawJSON=h,this.buildJSON(),g(this.el).find("div.spinner").remove(),this.switchBreadcrumb(),this.trackTab(),this.populateLookUp(),this.loadState(),this.renameTrackButton(),this.setDragSelectEvent(),this.registerRibbonArrowEvents(),this.addExtraDimensions(),this.goToUserLocation(),this.resize(),this.selectDeselectAll())},error:function(){g(this.el).find("div.spinner").remove();this.showError()}});this.elLk.buttonTab.on("click",function(h){var k=b.getActiveTab();"INPUT"!==h.target.nodeName&&h.currentTarget.id!==k+"-tab"&&b.elLk.trackPanel.find('input[name="matrix_search"]').val()&&(b.elLk.trackPanel.find('input[name="matrix_search"]').val(""),b.elLk.searchCrossIcon.hide(),b.resetFilter());b.toggleTab({selectElement:this,container:b.el.find("div.track-menu")});b.resize()});this.clickSubResultLink();this.registerShowHideClickEvent();this.clickCheckbox(this.elLk.filterList);this.clearAll(this.elLk.clearAll);this.clearSearch();this.resetTracks();this.resetMatrix();this.registerResetFilterMatrixClickEvent();b.el.on("click",function(h){!g(h.target).closest(".track-popup").length&&b.trackPopup&&(b.el.find("div.matrix-container div.xBoxes.track-on, div.matrix-container div.xBoxes.track-off").removeClass("mClick"),b.trackPopup.hide());!g(h.target).closest("ul.cell").length&&b.trackPopup&&b.el.find(".renderer-selection div.renderers").removeClass("active");g(h.target).closest(".filter-rhs-popup").length||g(".filter-rhs-popup",b.elLk.filterTrackBox).hide()});this.elLk.filterMatrix.on("scroll",function(){b.el.find("div.matrix-container div.xBoxes.track-on, div.matrix-container div.xBoxes.track-off").removeClass("mClick");b.trackPopup.hide()});this.elLk.matrixContainer.on("scroll",function(){b.el.find("div.matrix-container div.xBoxes.track-on, div.matrix-container div.xBoxes.track-off").removeClass("mClick");b.trackPopup.hide()});this.el.find(".view-track, .view-track-button, button.showMatrix").on("click",function(){if(g(this).hasClass("_edit")||g(this).hasClass("view-track")&&!g(this).hasClass("inactive")||g(this).hasClass("view-track-button")&&g(this).hasClass("active"))b.addExtraDimensions(),u.EventManager.trigger("modalClose")});this.clickDisplayButton(this.elLk.displayButton,this.el.find("li#track-display"));this.clickDisplayButton(b.el.find("button.filterConfigButton"),this.el.find("li#track-display"));this.elLk.trackPanel.find('input[name="matrix_search"]').on("input",function(h){(h=g(this).val().trim())?b.elLk.searchCrossIcon.show():b.elLk.searchCrossIcon.hide();if(b.resetFilter(h,!0)){var k=b.getActiveTab(),l=new RegExp(h,"gi"),p=Object.keys(b.elLk.lookup).filter(function(m){return m.match(l)&&b.elLk.lookup[m].parentTabId===k});g.each(b.searchTerms,function(m,t){m.match(l)&&p.push(t)});h=g.unique(p);if(h.length){b.elLk[k].container.find("span.search-error").hide();b.elLk[k].container.find("div.selectall-container div.select-link, div.selectall-container div.divider").show();var q="."+h.join(",.");h=b.elLk.lookup[h[0]].parentTab.find("li").not(q);g.each(h,function(m,t){"none"!==g(t).css("display")&&g(t).addClass("_search_hide").hide()})}else b.elLk[k].container.find("li").addClass("_search_hide").hide(),b.elLk[k].container.find("span.search-error").show(),b.elLk[k].container.find("div.selectall-container div.select-link, div.selectall-container div.divider").hide();b.updateAvailableTabsOrRibbons(k,!0)}});this.disableYdim?(b.el.find("h5.result-header._dyHeader, div#dy, div._dyMatrixHeader").hide(),b.el.find("button.reset-button._matrix").css("margin-top","0"),b.el.find("div#dy-tab").addClass("inactive").attr("title","No Experimental evidence is available for this view")):(b.el.find("h5.result-header._dyHeader, div#dy").show(),b.el.find("div#dy-tab").removeClass("inactive").attr("title",""))},dropDown:function(b,c){this.dd=b.rendererSelectDropdown;this.placeholder=this.dd.children("span");this.placeholder.html(b.rendererTextMap[c]);this.opts=this.dd.find("ul.dropdown > li");this.opts.removeClass("selected");this.opts.each(function(h,k){g(k).hasClass(c)&&g(k).addClass("selected")});this.val="";var f=this;f.dd.off().on("click",function(h){g(this).toggleClass("active");return!1});f.opts.off().on("click",function(){var h=g(this);h.siblings().removeClass("selected");h.addClass("selected");f.val=h.children("i").attr("class");f.placeholder.text(h.text());b.updateRenderer(f.val)})},buildJSON:function(){var b=this,c={},f={};c.extra_dimensions=[];var h=b.getLocalStorage(),k=!1;this.initialLoad=1;2<Object.keys(b.rawJSON.metadata.dimensions).length&&(b.multiDimFlag=1);if(g.isEmptyObject(c.dimensions)){var l=b.rawJSON.metadata.dimensions.y.key;var p=b.rawJSON.metadata.dimensions.x.key;c.dimensions=[l,p];c.data={};c.format={};b.elLk.lookup.dimensionFilter={};var q={};g.each(Object.keys(b.rawJSON.metadata.dimensions.x.values),function(v,w){q[w]={name:w.replace("_"," ")}});var m={},t={};g.each(b.rawJSON.tracks,function(v,w){var z;var B=w.display&&"off"!=w.display?w.display:w.defaultDisplay;var D=w.subGroups[l],E=w.subGroups[p]+"_sep_"+D,G;g.each(w.subGroups,function(I,K){b.multiDimFlag&&I!==l&&I!==p&&"view"!==I&&(G=I+"_sep_"+w.subGroups[I],f[E]=f[E]||{},f[E][w.id]=f[E][w.id]||{},f[E][w.id].data=f[E][w.id].data||{},f[E][w.id].data[G]="off"===w.display?"off":"on",w.shortLabel&&(f[E][w.id].shortLabel=w.shortLabel),w.longLabel&&(f[E][w.id].longLabel=w.longLabel),w.display&&g.isEmptyObject(h.other_dimensions)&&b.initialLoad&&(k=!0,g.isEmptyObject(b.localStoreObj.other_dimensions)&&(b.localStoreObj.other_dimensions={}),b.localStoreObj.other_dimensions[G]=1),f[E][w.id].show=1,b.elLk.lookup.dimensionFilter[G]=b.elLk.lookup.dimensionFilter[G]||{},b.elLk.lookup.dimensionFilter[G][E]=b.elLk.lookup.dimensionFilter[G][E]||[],b.elLk.lookup.dimensionFilter[G][E].push(w.id));I===p&&(w.display&&"off"!=w.display&&g.isEmptyObject(h.matrix)&&b.initialLoad&&(k=!0,z="track-on",c.format[w.format.toLowerCase()]=c.format[w.format.toLowerCase()]+1||1,g.isEmptyObject(b.localStoreObj.dx)&&(b.localStoreObj.dx={}),b.localStoreObj.dx[D]=1,g.isEmptyObject(b.localStoreObj.dy)&&(b.localStoreObj.dy={}),b.localStoreObj.dy[K]=1),"off"===w.display&&(z="track-off"),m[D]=m[D]||[],b.multiDimFlag?t[E]||(z="track-on",m[D].push({dimension:I,val:K,defaultState:z,id:w.id,renderer:B,format:w.format.toLowerCase()}),t[E]=1):m[D].push({dimension:I,val:K,defaultState:z,id:w.id,renderer:B,format:w.format.toLowerCase()}))})});c.data[l]={name:l,label:b.rawJSON.metadata.dimensions.y.label.replace("_"," "),listType:"simpleList",data:m};c.data[p]={name:p,label:b.rawJSON.metadata.dimensions.x.label.replace("_"," "),listType:"simpleList",data:q}}b.initialLoad=0;k&&(b.localStoreObj.matrix=b.getLocalStorage().matrix||{},b.localStoreObj.filterMatrix=b.getLocalStorage().filterMatrix||{},b.localStoreObj.userLocation=b.getLocalStorage().userLocation||{},b.localStoreObj.reset_other_dimensions=b.localStoreObj.other_dimensions||{},b.localStoreObj.reset_dx=b.localStoreObj.dx||{},b.localStoreObj.reset_dy=b.localStoreObj.dy||{},b.setLocalStorage());b.elLk.filterMatrixObj=f;b.json=c;this.elLk.lookup.rendererKeys=[];g.each(b.json.format,function(v,w){g.each(b.rendererConfig[v],function(z,B){b.elLk.lookup.rendererKeys.push(B)})})},checkError:function(b){return"404"===b.header.status?(this.showError(),1):0},showError:function(){this.elLk.ajaxError.show()},modalOpen:function(){this.localStoreObj&&!g.isEmptyObject(this.localStoreObj.userLocation)&&(this.emptyMatrix(),this.displayFilterMatrix(),this.displayMatrix(),this.toggleButton(),this.goToUserLocation())},resetFilter:function(b,c){this.getActiveTabContainer().find("li._search_hide").removeClass("_search_hide");this.getActiveTabContainer().find("span.search-error").hide();this.getActiveTabContainer().find("div.selectall-container div.select-link, div.selectall-container div.divider").show();var f=this.getActiveTabContainer().find("li._filtered");f.length?f.show():this.getActiveTabContainer().find("li").show();f=this.getActiveTab();this.updateAvailableTabsOrRibbons(f,!0,c);return b&&3>b.length?0:1},updateAvailableTabsOrRibbons:function(b,c,f){var h=this,k=h.elLk[b];if(k.haveSubTabs){var l,p=[];g.each(Object.keys(h.elLk[b].tabs),function(q,m){if(k.tabs[m]){g(k.tabs[m]).hasClass("active")&&(l=m);q=g("#"+m+"-content",h.el.trackPanel);var t=0;g(k.tabs[m]).addClass("inactive");g("li",q).each(function(w,z){if("none"!==g(z).css("display"))return t=1,!1});1==t&&(t=0,g(k.tabs[m]).removeClass("inactive"),p.push(m));"alphabetRibbon"===h.json.data[h[b]].data[m].listType&&h.activateAlphabetRibbon(q,c,f);var v=0;g("li",q).each(function(w,z){"none"!==g(z).css("display")&&v++})}});p.length&&l&&(!l||0>p.indexOf(l))&&h.toggleTab({selectElement:g(k.tabs[p[0]]),container:g(k.tabs[p[0]]).parent(),searchTriggered:!0})}else h.activateAlphabetRibbon(k.container,c,f)},activateAlphabetRibbon:function(b,c,f){var h,k,l=0,p=b.find(".ribbon-banner .alphabet-div");b.find(".ribbon-content .alphabet-content");var q=b.find(".ribbon-content .alphabet-content.active");g(p).removeClass("active").addClass("inactive");var m=b.find("li");m=g(m).closest(".alphabet-content");var t={};g.each(m,function(v,w){g("li",w).each(function(z,B){if("none"!==g(B).css("display"))return l=1,!1});1==l&&(l=0,activeRibbonData=g(w).data("ribbon"),k="."+activeRibbonData,h=p.not(':not("'+k+'")'),h.removeClass("inactive"),t[activeRibbonData]=h)});q=q.data("ribbon");c={container:b,selByClass:1,resetRibbonOffset:c,searchTriggered:!0};c.resetFilter=f&&!0;t[q]&&!f?c.selectElement=t[q]:(c.selectElement=t[Object.keys(t).sort()[0]],c.searchTriggered=!1);this.toggleTab(c);f=this.getActiveAlphabets(b);c=b.find(".ribbon-banner .larrow");b=b.find(".ribbon-banner .rarrow");g(c,b).removeClass("inactive active");0>=f.length?(g(c).addClass("inactive"),g(b).addClass("inactive")):(g(f[0]).hasClass("active")?(g(c).addClass("inactive"),1<f.length&&g(b).addClass("active")):g(c).removeClass("inactive").addClass("active"),g(f[f.length-1]).hasClass("active")?(g(b).addClass("inactive"),1<f.length&&g(c).addClass("active")):g(b).removeClass("inactive").addClass("active"))},addExtraDimensions:function(){var b=this;b.json.extra_dimensions&&b.json.extra_dimensions.forEach(function(c){b.elLk.lookup[c]=b.json.data[c]})},updateConfiguration:function(){var b=this,c={};b.elLk.searchCrossIcon.parent().find("input.configuration_search_text").val("");b.resetFilter("",!0);b.localStoreObj.userLocation&&b.setUserLocation();if(0>=Object.keys(b.localStoreObj).length||!b.localStoreObj.dx)return{image_config:{}};if(b.localStoreObj.matrix)return b.multiDimFlag?g.each(b.localStoreObj.filterMatrix,function(f,h){f.match(/_sep_/)&&g.each(b.localStoreObj.filterMatrix[f].data,function(k,l){c[k]={renderer:l.show&&"on"==l.state&&"track-off"!==b.localStoreObj.matrix[f].state?b.localStoreObj.matrix[f].renderer:"off"}})}):g.each(b.localStoreObj.matrix,function(f,h){f.match(/_sep_/)&&h.state&&(f.split("_sep_"),c[h.id]={renderer:"track-on"===h.state?h.renderer:"off"},h.id&&"off"!==c[h.id].renderer&&(c[h.id]={renderer:h.renderer}))}),u.EventManager.trigger("changeMatrixTrackRenderers",c),g.extend(this.imageConfig,c),{imageConfig:c,menu_id:this.node_id,matrix:1}},updateFromTrackLabel:function(b){var c=b[0];b=b[1];if(c){if(this.localStoreObj.epigenomic_activity&&c.match(/^reg_feat/)){var f="epigenomic_activity";var h=c.split(/_/).pop()}else this.localStoreObj.segmentation_features&&c.match(/^seg_Segmentation/)&&(f="segmentation_features",h=c.split(/_/).pop());c=f+"_sep_"+h;"off"==b?(this.localStoreObj[f][f].state.on--,this.localStoreObj[f][f].state.off++,this.localStoreObj[f][c].state="track-off"):(this.localStoreObj[f][f].state.off--,this.localStoreObj[f][f].state.on++,this.localStoreObj[f][c].state="track-on",this.localStoreObj[f][c].renderer=b)}},getNewPanelHeight:function(){return g(this.el).closest(".modal_content.js_panel").outerHeight()-
160},resize:function(){if(!(0>=Object.keys(this.elLk).length)){var b=this.getNewPanelHeight();this.elLk.resultBox.outerHeight(b);this.elLk[this.getActiveTab()].haveSubTabs?(g.each(this.elLk[this.getActiveTab()].tabContentContainer,function(h,k){g("ul",k).outerHeight(b-170)}),this.elLk.trackPanel.find(".ribbon-content ul").outerHeight(b-190)):this.elLk.trackPanel.find(".ribbon-content ul").outerHeight(b-140);this.elLk.dx.container.find("ul.list-content").height(b-120);var c=g(this.el).find("div.result-box:visible").outerHeight(),f=b-160;c>b&&(f=c);this.elLk.matrixContainer.outerHeight(f-102);this.elLk.filterMatrix.outerHeight(f-102)}},getActiveTabContainer:function(){return g("div#dx-content.active, div#dy-content.active",this.el)},getActiveTab:function(){return g("div#dx-content.active span.rhsection-id, div#dy-content.active span.rhsection-id",this.el).html()},getActiveSubTab:function(){return g("div#dx-content.active .tab-content.active span.rhsection-id, div#dy-content.active .tab-content.active span.rhsection-id",this.el).html()},populateLookUp:function(){var b=this;this.elLk.dx.ribbonBanner=g(".ribbon-banner .letters-ribbon .alphabet-div",this.elLk.dx.container);this.elLk.dx.tabContents="alphabetRibbon"===b.json.data[b.dx].listType?g(".ribbon-content li",this.elLk.dx.container):g(" li",this.elLk.dx.container);this.elLk.dx.haveSubTabs=!1;this.elLk.dy.haveSubTabs=!1;this.elLk.dy.tabs={};this.elLk.dy.tabContents="alphabetRibbon"===b.json.data[b.dy].listType?g(".ribbon-content li",this.elLk.dy.container):g(" li",this.elLk.dy.container);b.elLk.dy.tabContentContainer={};var c=g(".tabs.dy div.track-tab",this.elLk.dy.container);g.each(c,function(f,h){f=g(h).attr("id").split("-")[0]||g(h).attr("id");b.elLk.dy.tabs[f]=h;b.elLk.dy.tabContentContainer[f]=b.elLk.dy.container.find("#"+f+"-content");h=g("span.content-id",h).html();b.elLk.dy.tabContents[f]=g("div#"+h+" li",b.elLk.dy.container)})},loadState:function(){var b=this;this.loadingState=!0;this.localStoreObj=this.getLocalStorage();if(Object.keys(this.localStoreObj).length){if(this.localStoreObj.dx){var c;g.each(this.localStoreObj.dx,function(f){c=b.elLk.dx.tabContents.not(":not(."+f+")");b.selectBox(c)});b.filterData(g(c).data("item"))}this.localStoreObj.dy&&(g.each(this.localStoreObj.dy,function(f){c=b.elLk.dy.tabContents.filter(function(){return g(this).hasClass(f)});b.selectBox(c)}),!this.localStoreObj.dx&&this.localStoreObj.dy&&b.filterData(g(c).data("item")));b.updateRHS()}this.loadingState=!1},renameTrackButton:function(){this.multiDimFlag?this.el.find("button.showMatrix").outerWidth("110px").html("Filter tracks").removeClass("_edit").addClass("_filterButton"):this.el.find("button.showMatrix").outerWidth(this.buttonOriginalWidth).html(this.buttonOriginalHTML).removeClass("_edit _filterButton")},setUserLocation:function(){this.localStoreObj.userLocation&&(this.localStoreObj.userLocation.view=this.elLk.breadcrumb.filter(".active").attr("id"),this.elLk.trackPanel.hasClass("active")?this.localStoreObj.userLocation.tab=this.elLk.trackPanel.find("div.track-menu div.track-tab.active").attr("id"):this.localStoreObj.userLocation.tab="",this.setLocalStorage())},goToUserLocation:function(){this.localStoreObj&&!g.isEmptyObject(this.localStoreObj.userLocation)&&(this.toggleBreadcrumb(this.localStoreObj.userLocation.view?"#"+this.localStoreObj.userLocation.view:"#track-select"),this.localStoreObj.userLocation.tab&&this.toggleTab({selectElement:"#"+this.localStoreObj.userLocation.tab,container:this.el.find("div.track-menu")}))},setDragSelectEvent:function(){var b=this;this.dragSelect||(this.dragSelect=new fa({elements:"li span",zone:"._drag_select_zone",onSelect:function(c){b.selectBox(c.parentElement,1);this.el=c.parentElement},stop:function(){var c=g(this.el).data("item");c&&b.elLk.lookup[c].parentTabId===b.getActiveTab()&&(b.filterData(c),b.updateRHS())}}))},clearAll:function(b){var c=this;b.on("click",function(f){g.each(c.elLk.resultBox.find("li").not(".noremove"),function(h,k){c.selectBox(k)})})},clearSearch:function(){var b=this;b.elLk.searchCrossIcon=b.elLk.buttonTab.find("span.search-cross-icon");b.elLk.searchCrossIcon.click("on",function(){b.getActiveTabContainer().find("span.search-error").hide();b.getActiveTabContainer().find("div.selectall-container div.select-link, div.selectall-container div.divider").show();g(this).parent().find("input.configuration_search_text").val("");b.resetFilter("",!0);b.elLk.searchCrossIcon.hide();b.elLk.searchCrossIcon.parent().find("input").focus()})},enableConfigureButton:function(b){var c=this.el.find(b).length,f=0;this.el.find(b).each(function(h,k){g(k).find("li").length&&g(k).find("span.fancy-checkbox.selected").length&&f++});f===c?(this.el.find("li.view-track").removeClass("inactive"),this.el.find("li._configure").removeClass("inactive"),this.elLk.displayButton.addClass("active")):(this.el.find("li.view-track").addClass("inactive"),this.el.find("li._configure").addClass("inactive"),this.elLk.displayButton.removeClass("active"))},trackError:function(b){var c=0;this.el.find(b).each(function(f,h){g(h).attr("id");g(h).find("li").length&&g(h).find("span.fancy-checkbox.selected").length?(f=g(h).prev(".result-header").data("header"),g(h).prev(".result-header").html(f).removeClass("error")):(c=1,f=g(h).prev(".result-header").data("header"),g(h).prev(".result-header").html("Please select "+f).addClass("error"))});c?this.elLk.viewTrackButton.removeClass("active").addClass("inactive"):this.elLk.viewTrackButton.removeClass("inactive").addClass("active")},updateCurrentCount:function(b,c,f){b&&(this.el.find("#"+b+" span.current-count",this.elLk.resultBox).html(c),this.el.find("#"+b+" span.total",this.elLk.resultBox).html(f))},selectDeselectAll:function(){var b=this;b.el.find("div.selectall-container div.select-link").on("click",function(c){var f=g(this).hasClass("all-box"),h="";g(this).closest(".tab-content").find("li._filtered").length&&(h="._filtered");h=g(this).closest(".tab-content").find("li"+h+':not("._search_hide")');var k=h.find("span.fancy-checkbox");f?(k.addClass("selected"),h.addClass("_selected")):(k.removeClass("selected"),h.removeClass("_selected"));h.map(function(){b.elLk.lookup[g(this).data("item")].selected=f});h=h.data("item");b.filterData(h);b.updateRHS();c.stopPropagation()})},clickCheckbox:function(b){var c=this,f="li";b[0]&&"DIV"===b[0].nodeName&&(f="");g(b).off().on("click",f,function(h){c.selectBox(this);1<g(this).closest("ul.result-list").children("li").length?c.removeFromMatrix(g(this).data("item")):(c.toggleButton(),g(this).closest(".result-content").find(".sub-result-link").click());var k=g(this).data("item");c.filterData(k);c.updateRHS();h.stopPropagation()})},removeFromMatrix:function(b){var c=this;if(b){c.elLk.trackConfiguration.find(".matrix-container ."+b+", .matrix-container ._emptyBox_"+
b).remove();var f=g.extend({},c.localStoreObj.matrix);g.each(c.json.extra_dimensions,function(h,k){g.extend(f,c.localStoreObj[k])});Object.keys(f).map(function(h){if(h.match(b+"_sep_")||h.match("_sep_"+b)){var k=c.itemDimension(h),l=c.localStoreObj[k][h].state.replace("track-",""),p=c.localStoreObj[k][h].renderer;g.each(h.split("_sep_"),function(q,m){m!=b&&(q=c.itemDimension(m),0<c.localStoreObj[q][m].total&&--c.localStoreObj[q][m].total,0<c.localStoreObj[q][m].state[l]&&(--c.localStoreObj[q][m].state[l],--c.localStoreObj[q][m].state["reset-"+l]),0<c.localStoreObj[q][m].renderer[p]&&(--c.localStoreObj[q][m].renderer[p],--c.localStoreObj[q][m].renderer["reset-"+p]),0<c.localStoreObj[q].allSelection.total&&--c.localStoreObj[q].allSelection.total,0<c.localStoreObj[q].allSelection.state[l]&&(--c.localStoreObj[q].allSelection.state[l],--c.localStoreObj[q].allSelection.state["reset-"+l]),0<c.localStoreObj[q].allSelection.renderer[p]&&(--c.localStoreObj[q].allSelection.renderer[p],--c.localStoreObj[q].allSelection.renderer["reset-"+
p]))});delete c.localStoreObj[k][h]}});delete c.localStoreObj[c.itemDimension(b)][b];c.setLocalStorage()}},updateRHS:function(b){this.updateSelectedTracksPanel(b);this.updateShowHideLinks(this.elLk.filterList);this.setLocalStorage();this.trackError("div#dx, div#dy");this.enableConfigureButton("div#dx, div#dy");0<Object.keys(this.localStoreObj).length&&this.localStoreObj.dx&&(this.emptyMatrix(),this.displayFilterMatrix(),this.displayMatrix())},updateLHMenu:function(){var b=0,c=this.multiDimFlag?this.localStoreObj.filterMatrix:this.localStoreObj.matrix,f;for(f in c)f.match("_sep_")&&c[f].state&&(this.multiDimFlag?b+=c[f].state.on:"track-on"===c[f].state&&b++);g(this.menuCountSpan).text(b)},selectBox:function(b){var c=this,f=g("span.fancy-checkbox",b),h=f.hasClass("selected");if(g(b).hasClass("all-box")){var k="";g(b).closest(".tab-content").find("li._filtered").length&&(k="._filtered");b=g(b).closest(".tab-content").find("li"+k+':not("._search_hide")');k=b.find("span.fancy-checkbox");h?(f.removeClass("selected"),k.removeClass("selected"),b.removeClass("_selected")):(f.addClass("selected"),k.addClass("selected"),b.addClass("_selected"));b.map(function(){c.elLk.lookup[g(this).data("item")].selected=!h})}else f=g(b).data("item"),c.elLk.lookup[f].selected=!h,f=g("."+f,c.el),h?g(f).removeClass("_selected").find("span.fancy-checkbox").removeClass("selected"):g(f).addClass("_selected").find("span.fancy-checkbox").addClass("selected")},updateSelectedTracksPanel:function(b){var c=this,f=[];this.selectedTracksCount={};this.totalSelected=0;["dx","dy"].forEach(function(k){if(c.elLk[k].haveSubTabs)g.each(c.elLk[k].tabContents,function(q,m){l=m.has(".selected")||[];p=m.has("._filtered")||[];_search_hide=m.has("._search_hide")||[];p=p.length||m.filter(function(){return"none"!==g(this).css("display")||g(this).hasClass("_search_hide")});c.selectedTracksCount[q]=c.selectedTracksCount[q]||{};c.selectedTracksCount[q].selected=c.selectedTracksCount[q].selected||[];g(l).map(function(){c.selectedTracksCount[q].selected.push(g(this).data("item"))});c.selectedTracksCount[q].available=p.length;c.totalSelected+=l.length;c.updateCurrentCount(q,l.length,p.length);l.length&&f.push(l)});else{var l=c.elLk[k].tabContents.has(".selected")||[];var p=c.elLk[k].tabContents.has("._filtered")||[];p=p.length||c.elLk[k].tabContents.filter(function(){return"none"!==g(this).css("display")||g(this).hasClass("_search_hide")});c.selectedTracksCount[k]=c.selectedTracksCount[k]||{};c.selectedTracksCount[k].selected=c.selectedTracksCount[k].selected||[];g(l).map(function(){c.selectedTracksCount[k].selected.push(g(this).data("item"))});c.selectedTracksCount[k].available=p.length;c.totalSelected+=l.length;c.updateCurrentCount(k,l.length,p.length);l.length&&f.push(l)}});var h={};g(f).each(function(k,l){g(l).each(function(p,q){p=g(q).data("item");h[p]=g(q).clone().removeClass("noremove _search_hide").show()})});c.updateSelectedTracks(h);b=Object.keys(h);!c.loadingState&&c.addToStore(b);c.setLocalStorage()},updateSelectedTracks:function(b){var c=this;g('li:not(".noremove")',c.elLk.filterList).remove();g.each(b,function(f,h){g("#"+c.elLk.lookup[f].subTab+
".result-content ul",c.el).append(h)})},setLocalStorage:function(){localStorage.setItem(this.localStorageKey,JSON.stringify(this.localStoreObj));this.updateLHMenu()},getLocalStorage:function(){return JSON.parse(localStorage.getItem(this.localStorageKey))||{}},addToStore:function(b){if(b.length){var c=this,f;c.localStoreObj.dx={};c.localStoreObj.dy={};g.each(b,function(h,k){f=c.elLk.lookup[k].parentTabId;c.localStoreObj[f]=c.localStoreObj[f]||{};c.localStoreObj[f][k]=1})}},removeFromStore:function(b,c){"dx"!==c?b&&c&&delete this.localStoreObj.dy[c][b]:b&&c&&delete this.localStoreObj[c][b]},clickDisplayButton:function(b,c){var f=this;b.on("click",function(h){b.hasClass("_edit")?(f.elLk.filterTrackBox.hide(),f.elLk.resultBox.show(),f.elLk.configResultBox.hide(),f.toggleTab({selectElement:f.el.find("li._configure"),container:f.el.find("div.large-breadcrumbs")}),f.toggleButton()):b.hasClass("active")&&(b.hasClass("_filterButton")?(f.toggleTab({selectElement:f.el.find("li#track-filter"),container:f.el.find("div.large-breadcrumbs")}),f.elLk.filterTrackBox.css("display","flex"),f.elLk.resultBox.hide(),f.elLk.configResultBox.hide()):(f.multiDimFlag&&(f.elLk.filterTrackBox.hide(),f.elLk.resultBox.hide(),f.elLk.configResultBox.show()),f.toggleTab({selectElement:c,container:f.el.find("div.large-breadcrumbs")})),f.toggleButton());f.emptyMatrix();f.displayFilterMatrix();f.displayMatrix()})},clickSubResultLink:function(){var b=this;b.el.find("div.sub-result-link").on("click",function(c){c="div#"+b.el.find(this).parent().attr("id")+"-tab";var f="div#"+b.el.find(c).find("span.content-id").html(),h=b.el.find(this).parent().find("span._parent-tab-id").html();b.el.find(".track-tab.active").first().removeClass("active");b.el.find(".tab-content.active").first().removeClass("active");b.el.find("div#configuration-content:visible").length&&(b.toggleTab({selectElement:b.el.find("li._track-select"),container:b.el.find("div.large-breadcrumbs")}),b.toggleButton());if(h){h="div#"+h;var k="div#"+b.el.find(h).find("span.content-id").html();b.el.find(k+
" .track-tab.active").removeClass("active");b.el.find(k+" .tab-content.active").removeClass("active");b.el.find(h).addClass("active");b.el.find(k).addClass("active");g(h).find("div.search-box").length&&(b.el.find(".search-box").hide(),g(h).find("div.search-box").show())}g(c).find("div.search-box").length&&(b.el.find(".search-box").hide(),g(c).find("div.search-box").show());b.el.find(c).addClass("active");b.el.find(f).addClass("active")})},updateShowHideLinks:function(b){g.each(b,function(c,f){!g(f).siblings("div.show-hide:visible").length&&g("li",f).length?(c="none"===g(f).css("display")?"._show":"._hide",g(f).siblings(c).show()):g(f).siblings("div.show-hide:visible").length&&0===g("li",f).length&&g(f).siblings("._hide, ._show").hide()})},registerShowHideClickEvent:function(){var b=this;this.elLk.filterTrackBox.find("div.show-hide").off().on("click",function(c){g(this).parent().find("div.show-hide, ul.result-list, ul.filterMatrix-list").toggle()});this.elLk.resultBox.find("div.show-hide").off().on("click",function(c){b.el.find(this).parent().find("div.show-hide, ul.result-list").toggle()});this.elLk.configResultBox.find("div.show-hide").off().on("click",function(c){b.el.find(this).parent().find("div.show-hide, ul.result-list").toggle()})},trackTab:function(){var b=this,c=b.el.find("div#dx-content"),f=c.data("rhsection-id");b.dx=b.json.dimensions[0];b.dy=b.json.dimensions[1];var h=b.json.data[b.dx],k=b.json.data[b.dy];this.displayCheckbox({data:Object.keys(h.data),container:"div#dx-content",listType:h.listType,parentTabContainer:c,rhSectionId:f,noFilter:!0});var l=b.el.find("div#dy-content");f=l.data("rhsection-id");if(k.subtabs){var p='<div class="tabs dy">',q="";Object.keys(k.data).sort().forEach(function(t){var v=k.data[t];delete k.data[t];k.data[t]=v});var m=0;g.each(k.data,function(t,v){var w="";0===m&&(w="active");p+='<div class="track-tab '+w+'" id="'+t+'-tab">'+v.name+'<span class="hidden content-id">'+t+"-content</span></div>";q+='<div id="'+t+'-content" class="tab-content '+w+'" data-rhsection-id="'+t+'""><span class="hidden rhsection-id">'+t+"</span></div>";m++});p+="</div>";l.append(p).append(q);g.each(k.data,function(t,v){b.displayCheckbox({data:v.data,container:"div#"+t+"-content",listType:v.listType,parentTabContainer:l,rhSectionId:f,noFilter:!0,set:v.set})})}else this.displayCheckbox({data:Object.keys(k.data),container:"div#dy-content",listType:k.listType,parentTabContainer:l,rhSectionId:f,noFilter:!0});b.addRelationData();this.el.find("div.dy div.track-tab").on("click",function(){b.toggleTab({selectElement:this,container:b.el.find("div.dy")});b.resize()})},toggleTab:function(b){var c=b.selectElement,f=b.container,h=b.selByClass,k=b.resetRibbonOffset,l=b.searchTriggered,p=b.resetFilter,q=this;g(c).hasClass("active")||g(c).hasClass("inactive")||(g(c).find("div.search-box").length&&(q.el.find(".search-box").hide(),g(c).find("div.search-box").show()),b=f.find(".active span.content-id").html(),f.find(".active").removeClass("active"),h?f.find("div."+b).removeClass("active"):q.el.find("#"+b).removeClass("active"),b=g(c).find("span.content-id").html(),g(c).addClass("active"),activeAlphabetContentDiv=h?f.find("div."+b):q.el.find("#"+b),activeAlphabetContentDiv.addClass("active"),h=g(".content-id",c).html(),f=g("#"+h+" .tabs div.track-tab",q.elLk.trackPanel),f.length&&!f.hasClass("active")&&f.not(".inactive").length&&(f=f.not(".inactive")[0],h=g(".content-id",f).html(),h=g("#"+h,q.elLk.trackPanel),g(f).addClass("active"),g(h).addClass("active")),k&&g(c).closest(".letters-ribbon").data({reset:!0}),activeAlphabetContentDiv=q.elLk.trackPanel.find("div.ribbon-content .alphabet-content.active"),g.each(activeAlphabetContentDiv,function(m,t){m=g(t).closest(".tab-content").find("div.alphabet-div.active");if(g(m).closest(".letters-ribbon").data("reset")&&(g(c).hasClass("track-tab")||l)&&!p){var v=q.getActiveAlphabets().filter(function(){return g(this).hasClass("active")});v=g(m).parent().children().index(v);var w=g(m).closest(".ribbon-banner").offset();"none"!==g(m).closest(".ribbon-banner").closest(".tab-content").css("display")&&(newOffset=w.left-22*v+10,g(m).closest(".letters-ribbon").offset({left:newOffset}),g(m).closest(".letters-ribbon").removeData("reset"))}m.offset()&&!p&&g(t).offset({left:m.offset().left-2})}))},switchBreadcrumb:function(){var b=this;b.multiDimFlag?(b.el.find("div.large-breadcrumbs.twoDim").remove(),b.el.find("div.large-breadcrumbs.multiDim").show()):(b.el.find("div.large-breadcrumbs.twoDim").show(),b.el.find("div.large-breadcrumbs.multiDim").remove());this.elLk.breadcrumb=this.el.find("div.large-breadcrumbs li");this.elLk.breadcrumb.on("click",function(c){b.toggleBreadcrumb(this);c.preventDefault();b.resize()})},toggleBreadcrumb:function(b){this.el.find(b).hasClass("view-track")||(this.elLk.filterTrackBox.hide(),this.elLk.configResultBox.hide(),this.elLk.resultBox.show(),this.toggleTab({selectElement:b,container:this.el.find("div.large-breadcrumbs")}));this.toggleButton();"track-filter"!==this.el.find(b).attr("id")||this.el.find(b).hasClass("inactive")||(this.elLk.filterTrackBox.css("display","flex"),this.elLk.configResultBox.hide(),this.elLk.resultBox.hide(),this.emptyMatrix(),this.displayFilterMatrix());"track-display"!==this.el.find(b).attr("id")||this.el.find(b).hasClass("inactive")||(this.multiDimFlag&&(this.elLk.filterTrackBox.hide(),this.elLk.resultBox.hide(),this.elLk.configResultBox.show()),this.emptyMatrix(),this.displayMatrix())},toggleButton:function(){this.el.find("div.track-configuration:visible").length?(this.elLk.resultBox.find("div.reset_track").hide(),this.el.find("button.showMatrix").removeClass("_filterButton").addClass("_edit").outerWidth("100px").html("View tracks")):(this.elLk.resultBox.find("div.reset_track").show(),this.multiDimFlag?this.el.find("button.showMatrix").outerWidth("110px").html("Filter tracks").removeClass("_edit").addClass("_filterButton"):this.el.find("button.showMatrix").outerWidth(this.buttonOriginalWidth).html(this.buttonOriginalHTML).removeClass("_edit _filterButton"))},createTooltipText:function(b,c){if(b!==R||c!==R)return tooltip=this.elLk.filterMatrixObj[b]&&this.elLk.filterMatrixObj[b][c]?"<p><u>"+(this.elLk.filterMatrixObj[b][c].shortLabel?this.elLk.filterMatrixObj[b][c].shortLabel:c)+"</u></p><p>"+(this.elLk.filterMatrixObj[b][c].longLabel?this.elLk.filterMatrixObj[b][c].longLabel:c)+"</p>":c},displayCheckbox:function(b){var c=b.data,f=b.container,h=b.listType,k=b.parentTabContainer,l=b.rhSectionId,p=b.noFilter,q=b.set||"",m=this,t={},v=0;if(h&&"alphabetRibbon"===h)g.each(c.sort(),function(B,D){B=D.charAt(0).toLowerCase();t[B]||(t[B]=[]);t[B].push(D)}),m.alphabetRibbon(t,f,k,l,p,q),m.updateAvailableTabsOrRibbons(m.getActiveTab());else{f=m.el.find(f);var w='<div class="_drag_select_zone"> <ul class="list-content">',z=f.find("span.rhsection-id").html();c=c.sort();g.each(c,function(B,D){if(D){B="";15<D.length&&(B=" _ht ");var E=D.replace(/[^\w\-]/g,"_");w+='<li class="noremove '+E+B+'" title="'+D+'" data-parent-tab="'+z+'" data-item="'+E+'"><span class="fancy-checkbox"></span><text>'+D+"</text></li>"}v++;m.elLk.lookup[E]={label:D,parentTab:k,parentTabId:l,subTab:z,selected:!1,set:q||""}});w+="</ul></div>";w='<div class="content-wrapper"><span class="hidden error search-error">No matches</span><div class="selectall-container"><div class="deselect-box select-link" id="deSelectBox-'+g(f).attr("id")+'">Deselect all</div><div class="divider">|</div><div class="all-box select-link" id="allBox-'+
g(f).attr("id")+'">Select all</div></div>'+w+"</div>";f.append(w);g.each(c,function(B,D){D&&(B=D.replace(/[^\w\-]/g,"_"),m.elLk.lookup[B].el=f.find("."+B))});m.el.find("div#"+z+" span.total").html(v);g(f).find("._ht").helptip({position:{at:"center bottom-10"}})}},addRelationData:function(){var b=this;g.each(b.json.data[b.dx].data,function(c,f){var h=c.replace(/[^\w\-]/g,"_");b.elLk.lookup[h].data=f;var k="";g.each(f,function(l,p){l=p.val.replace(/[^\w\-]/g,"_");k+=l+" ";(p=b.el.find("li."+l).attr("data-filter"))?b.el.find("li."+l).attr("data-filter",p+" "+h):b.el.find("li."+l).attr("data-filter",h);b.el.find("li."+l).attr("data-filtercontainer")||b.el.find("li."+l).attr("data-filtercontainer","dx-content")});b.el.find("li."+h).attr("data-filter",k).attr("data-filtercontainer","dy-content")})},filterData:function(b){if(b){var c=g(this.elLk.lookup[b].parentTab,this.el),f="#"+g("."+b,this.elLk.trackPanel).data("filtercontainer"),h=this.el.find(f).find("li"),k={};c.find("li span.fancy-checkbox.selected").parent().map(function(){g(this).data("filter")&&g(this).data("filter").split(" ").map(function(p){""!==p&&(k[p]=1)})});h.hide();c="";if(Object.keys(k).length){c="li."+Object.keys(k).join(", li.");var l=this.elLk.trackPanel.find(f).find("li._selected");this.elLk.trackPanel.find(f).find(c).addClass("_filtered").show();g(l).addClass("_filtered").show();h.not("._filtered").find("span.fancy-checkbox").removeClass("selected")}else h.removeClass("_filtered").show();this.updateAvailableTabsOrRibbons({dx:"dy",dy:"dx"}[this.elLk.lookup[b].parentTabId],!0)}},getActiveAlphabets:function(b){b=b||this.getActiveTabContainer();return g(b).find(".ribbon-banner div.alphabet-div").not(".inactive")},alphabetRibbon:function(b,c,f,h,k,l){var p=this,q="",m="",t=0;c=p.el.find(c);var v=c.find("span.rhsection-id").html();g.each(Array(26),function(w){var z=String.fromCharCode(w+97),B="",D="";0===w&&(B="active");b[z]&&b[z].length?(D='<ul class="letter-content">',g.each(b[z],function(E,G){t++;E=G.replace(/[^\w\-]/g,"_");var I=p.createTooltipText(G);D+='<li class="noremove '+
E+'" data-parent-tab="'+v+'" data-item="'+E+'"><span class="fancy-checkbox"></span><text class="_ht _ht_delay" title="'+I+'">'+G+"</text></li>";p.elLk.lookup[E]={label:G,parentTab:f,parentTabId:h,subTab:v,selected:!1,set:l}}),D+="</ul>"):B="inactive";q+='<div class="ribbon_'+z+" alphabet-div "+B+'">'+z.toUpperCase()+'<span class="hidden content-id">'+z+"_content</span></div>";m+='<div data-ribbon="ribbon_'+z+'" class="'+z+"_content alphabet-content "+B+'">'+D+"</div>"});k=k?"no-filter":"";c.append('<span class="hidden error search-error">No matches</span><div class="selectall-container"><div class="deselect-box select-link '+
k+'" id="deSelectBox-'+g(c).attr("id")+'">Deselect all</div><div class="divider">|</div><div class="select-link all-box '+k+'" id="allBox-'+g(c).attr("id")+'">Select all</div></div><div class="cell-listing _drag_select_zone"><div class="ribbon-banner"><div class="larrow inactive">&#x25C0;</div><div class="alpha-wrapper"><div class="letters-ribbon"></div></div><div class="rarrow">&#x25B6;</div></div><div class="ribbon-content"></div></div>');c.find("div.letters-ribbon").append(q);c.find("div.ribbon-content").append(m);g.each(Array(26),function(w){w=String.fromCharCode(w+97);b[w]&&b[w].length&&g.each(b[w],function(z,B){t++;z=B.replace(/[^\w\-]/g,"_");p.elLk.lookup[z].el=c.find("."+z)})});p.el.find("div#"+v+" span.total").html(t);c.find("div.alphabet-div").on("mousedown",function(w){g(c,p.el).hasClass("active")&&g.when(p.toggleTab({selectElement:this,container:c,selByClass:1})).then(p.selectArrow(c))})},selectArrow:function(b){var c=this.getActiveAlphabets(b),f=g(c.get(0)).html().charAt(0),h=g(c.get(-1)).html().charAt(0);c.length&&(g("div.alphabet-div.active",b).html().match(f)?(g("div.larrow",b).removeClass("active").addClass("inactive"),g("div.rarrow",b).removeClass("inactive").addClass("active")):g("div.alphabet-div.active",b).html().match(h)?(g("div.rarrow",b).removeClass("active").addClass("inactive"),g("div.larrow",b).removeClass("inactive").addClass("active")):g("div.larrow, div.rarrow",b).removeClass("inactive").addClass("active"))},registerRibbonArrowEvents:function(){var b=this;b.elLk.arrows=g("div.rarrow, div.larrow",b.elLk.trackPanel);b.elLk.arrows.off().on("mousedown",function(c){container=g(c.target).closest(".tab-content");var f=container.find(".letters-ribbon"),h=container.find(".ribbon-content"),k=b.getActiveAlphabets(container),l=k.filter(function(){return g(this).hasClass("active")}),p=k.index(l);l=l.html().charAt(0).toLowerCase();var q=b.getActiveTab()+"-tab";if((g(container).hasClass("active")||g("#"+q,b.elLk.trackPanel).hasClass("active"))&&!this.className.match(/inactive/gi)){if(this.className.match(/larrow/gi)){if(!k[p-
1])return;var m=g(k[p-1]).html().charAt(0).toLowerCase();q=l.charCodeAt(0)-m.charCodeAt(0);g.when(b.toggleTab({selectElement:f.find("div.ribbon_"+m),container:container,selByClass:1})).then(b.selectArrow(container));f.find(".ribbon_"+m).offset().left<=g(c.target).offset().left+22&&(f.offset({left:f.offset().left+22*q}),m=h.find("div."+m+"_content.alphabet-content"),m.offset({left:m.offset().left+22*q}));f.find(".ribbon_a").offset().left>g(c.target).offset().left+22&&b.activateAlphabetRibbon(container,!0)}this.className.match(/rarrow/gi)&&k[p+1]&&(k=g(k[p+1]).html().charAt(0).toLowerCase(),q=k.charCodeAt(0)-l.charCodeAt(0),g.when(b.toggleTab({selectElement:f.find("div.ribbon_"+k),container:container,selByClass:1})).then(b.selectArrow(container)),f.find(".ribbon_"+k).offset().left>=g(c.target).offset().left-44&&(f.offset({left:f.offset().left-22*q}),c=h.find("div."+k+"_content.alphabet-content"),c.offset({left:c.offset().left-22*q})))}})},itemDimension:function(b){b.match("_sep_")&&(b=b.split("_sep_")[0]);return this.json.extra_dimensions&&0<=this.json.extra_dimensions.indexOf(b)?this.json.extra_dimensions[this.json.extra_dimensions.indexOf(b)]:"matrix"},displayFilterMatrix:function(){var b=this;if(!g.isEmptyObject(b.localStoreObj)){b.cleanFilterMatrixStore();b.trackPopup=b.el.find("div.track-popup");var c='<div  class="xContainer">',f=b.localStoreObj.dy?Object.keys(b.localStoreObj.dy).sort():[],h="";g.each(f,function(q,m){q=b.elLk.lookup[m]?b.elLk.lookup[m].label:m;15<q.length&&(h=" _ht ");c+='<div class="positionFix"><div class="rotate"><div class="overflow xLabel '+
m+h+'" title="'+q+'"><span>'+q+"</span></div></div></div>"});c+="</div>";b.el.find("div.filterMatrix-container").append(c);var k='<div class="yContainer">',l='<div class="boxContainer">';b.localStoreObj.dx&&b.localStoreObj.dy&&g.each(Object.keys(b.localStoreObj.dx).sort(),function(q,m){q=b.elLk.lookup[m].label||m;var t="";15<q.length&&(t=" _ht ");k+='<div class="yLabel '+t+'" title="'+q+'"'+m+'"><span>'+q+"</span></div>";var v='<div class="rowContainer">';g.each(f,function(w,z){if(""!==z||b.disableYdim||b.trackHub){w="";var B=0,D=0,E="",G=z+"_sep_"+m,I=0,K="";b.localStoreObj.filterMatrix&&b.localStoreObj.filterMatrix[G]?(b.localStoreObj.filterMatrix[G].state.on===b.localStoreObj.filterMatrix[G].state.total?(w="track-on",K='<span class="count">'+b.localStoreObj.filterMatrix[G].state.on+"</span>"):(K=b.localStoreObj.filterMatrix[G].state.total-b.localStoreObj.filterMatrix[G].state.off,w=0===K?"partzero":"partial",K='<span class="partialCount">'+K+'</span><span class="count">'+b.localStoreObj.filterMatrix[G].state.total+
"</span>"),E="_hasData",0===b.localStoreObj.filterMatrix[G].state.total&&(E=w="")):b.elLk.filterMatrixObj[G]&&(E="_hasData",b.localStoreObj.filterMatrix[G]=b.localStoreObj.filterMatrix[G]||{},g.each(b.elLk.filterMatrixObj[G],function(S,U){1===U.show&&(I+=1);g.each(U.data,function(T,V){"off"===V&&1===U.show&&B++;"on"===V&&1===U.show&&D++;b.localStoreObj.filterMatrix[G].data=b.localStoreObj.filterMatrix[G].data||{};b.localStoreObj.filterMatrix[G].data[S]=b.localStoreObj.filterMatrix[G].data[S]||{};b.localStoreObj.filterMatrix[G].data[S].state=V;b.localStoreObj.filterMatrix[G].data[S]["reset-state"]=V;b.localStoreObj.filterMatrix[G].data[S].show=U.show;b.localStoreObj.filterMatrix[G].data[S]["reset-show"]=U.show;return!1})}),D===I?(w="track-on",K='<span class="count">'+D+"</span>"):B===I?(w="track-off",K='<span class="count">0</span>'):(K=I-D,w=0===K?"partzero":"partial",K='<span class="partialCount">'+K+'</span><span class="count">'+I+"</span>"),b.localStoreObj.filterMatrix[G].state=b.localStoreObj.filterMatrix[G].state||{},b.localStoreObj.filterMatrix[G].state.total=I,b.localStoreObj.filterMatrix[G].state["reset-total"]=I,b.localStoreObj.filterMatrix[G].state.on=D,b.localStoreObj.filterMatrix[G].state["reset-on"]=D,b.localStoreObj.filterMatrix[G].state.off=B,b.localStoreObj.filterMatrix[G].state["reset-off"]=B);E||(K="");v+='<div class="xBoxes matrix '+w+" "+E+" "+m+" "+z+" "+G+'" data-track-x="'+z+'" data-track-y="'+m+'" data-popup-type="_filterMatrix">'+K+"</div>"}else v+='<div class="xBoxes _emptyBox_'+m+'"></div>'});v+="</div>";l+=v});k+="</div>";l+="</div>";var p='<div class="yBoxWrapper">'+k+l+"</div>";b.el.find("div.filterMatrix-container").append(p);p=32*f.length;b.el.find("div.filterMatrix-container .xContainer, div.filterMatrix-container .yBoxWrapper").width(p);b.cellClick("filter");b.setLocalStorage();"track-filter"===b.elLk.breadcrumb.filter(".active").attr("id")&&this.elLk.filterMatrix.find(".xContainer ._ht").helptip({position:{at:"left+10 bottom+76"}});"track-filter"===b.elLk.breadcrumb.filter(".active").attr("id")&&this.elLk.filterMatrix.find(".yContainer ._ht").helptip({position:{at:"center bottom-15"}});this.updateFilterMatrixRHS()}},updateFilterMatrixRHS:function(){this.createFilterMatrixList();this.registerFilterListItemClickEvent();this.updateShowHideLinks(this.elLk.filterMatrixList);this.registerShowHideClickEvent()},cleanFilterMatrixStore:function(){var b=this,c={};g.map(Object.keys(b.localStoreObj.matrix),function(f){f.match("_sep_")&&(c[f]=b.localStoreObj.filterMatrix[f])});b.localStoreObj.filterMatrix=c},createFilterMatrixList:function(){var b=this,c=this.getLocalStorage(),f={},h={},k=[];g.each(Object.keys(c.filterMatrix).sort(),function(p,q){b.elLk.filterMatrixObj[q]&&g.each(b.elLk.filterMatrixObj[q],function(m,t){g.each(t.data,function(v,w){k=v.split("_sep_");f[k[0]]=f[k[0]]||{};f[k[0]][k[1]]=1;h[v]=h[v]||{};h[v].cells=h[v].cells||{};h[v].on=h[v].on||0;h[v].off=h[v].off||0;"on"===c.filterMatrix[q].data[m].state?h[v].on++:h[v].off++;h[v].cells[q]=h[v].cells[q]||{};h[v].cells[q].availableTracks=h[v].cells[q].availableTracks||{};h[v].cells[q].availableTracks[m]=1})})});b.elLk.extraDimValToCellMap=h;var l="";g.each(Object.keys(f).sort(),function(p,q){p=f[q];var m="";p=Object.keys(p).sort();total=p.length;var t=0;g.each(p,function(v,w){v=q+"_sep_"+w;1===b.localStoreObj.other_dimensions[v]&&t++;m+='<li data-dim-val="'+w+'" data-dim="'+q+'" data-dim-key="'+v+'"><div class="fm-count">('+h[v].on+"/"+(h[v].off+h[v].on)+")</div><text>"+w+"</text></li>"});l+='          <div class="filterMatrix-content">            <div class="_show show-hide hidden"><img src="/i/closed2.gif" class="nosprite" /></div><div class="_hide show-hide hidden"><img src="/i/open2.gif" class="nosprite" /></div>            <h5 class="result-header">'+
q+'</h5>            <ul class="filterMatrix-list">';l+=m+"</ul></div>"});b.elLk.filterTrackBox.find(".filter-content").html(l);b.elLk.filterMatrixList=b.elLk.filterTrackBox.find("ul.filterMatrix-list")},createFilterRHSPopup:function(b){var c=this,f=g(b.currentTarget).data(),h={},k=[],l=[],p=[],q=[],m=[];g.each(Object.keys(c.elLk.extraDimValToCellMap[f.dimKey].cells),function(v,w){c.localStoreObj.filterMatrix[w]&&g.each(c.localStoreObj.filterMatrix[w].data,function(z,B){c.elLk.extraDimValToCellMap[f.dimKey].cells[w].availableTracks[z]&&("on"===B.state&&k.push(z),"on"===B["reset-state"]&&p.push(z),"off"===B.state&&l.push(z),"off"===B["reset-state"]&&q.push(z),m++)})});k.length===p.length&&l.length===q.length&&JSON.stringify(k)===JSON.stringify(p)&&JSON.stringify(l)===JSON.stringify(q)?h["default"]="checked":k.length===m&&0===l.length?h.all_on="checked":l.length===m&&0===k.length&&(h.all_off="checked");h='      <div class="title">'+f.dimVal+'</div>      <div><input type="radio" name="filter_popup_selection" value="all-on" id="filter_popup_selection1"'+
h.all_on+'><label for="filter_popup_selection1">All On</label></div>      <div><input type="radio" name="filter_popup_selection" value="all-off" id="filter_popup_selection2"'+h.all_off+'><label for="filter_popup_selection2">All Off</label></div>      <div><input type="radio" name="filter_popup_selection" value="default" id="filter_popup_selection3"'+h["default"]+'><label for="filter_popup_selection3">Default</label></div>';var t=g(b.currentTarget).position();g(b.currentTarget).offset();c.elLk.filterTrackBox.find(".filter-rhs-popup").html(h).css({top:t.top+
g("div.modal_content")[0].scrollTop+20,left:t.left+g("div.modal_content")[0].scrollLeft}).show();c.elLk.filterTrackBox.find(".filter-rhs-popup input").click(g.proxy(function(v){var w=g(v.currentTarget).val();"default"===w?c.resetFilterMatrixToDefaults(f.dimKey):g.each(Object.keys(c.elLk.extraDimValToCellMap[f.dimKey].cells),function(z,B){c.localStoreObj.filterMatrix[B]&&(z=Object.keys(c.localStoreObj.filterMatrix[B].data),g.each(z,function(D,E){"all-on"===w?c.updateFilterMatrixStore(c.localStoreObj.filterMatrix[B],B,"on","off",1):c.updateFilterMatrixStore(c.localStoreObj.filterMatrix[B],B,"off","on",1)}))});c.setLocalStorage();c.emptyMatrix();c.displayFilterMatrix()},f));b.stopPropagation()},registerFilterListItemClickEvent:function(){var b=this;g("li",b.elLk.filterTrackBox).off().on("click",function(c){b.createFilterRHSPopup(c)})},registerFilterMatrixCellClickEvent:function(){g("li",this.TrackPopupType).off().on("click",function(b){b=g(this).children("span.fancy-checkbox");b.toggleClass("selected");g(this).data("track-id");g(this).hasClass("all")&&(b.hasClass("selected")?g(this).siblings().each(function(c,f){g(f).children("span.fancy-checkbox").removeClass("selected").addClass("selected")}):g(this).siblings().each(function(c,f){g(f).children("span.fancy-checkbox").removeClass("selected")}))})},displayMatrix:function(){var b=this;if(!g.isEmptyObject(b.localStoreObj)){b.trackPopup=b.el.find("div.track-popup");var c='<div  class="xContainer">',f={};g.each(b.elLk.lookup.rendererKeys,function(q,m){f[m]=0;f["reset-"+m]=0});var h=b.localStoreObj.dy?Object.keys(b.localStoreObj.dy).sort():[];b.json.extra_dimensions&&b.json.extra_dimensions.sort().reverse().forEach(function(q){h.unshift(q)});g.each(h,function(q,m){q=b.elLk.lookup[m]?b.elLk.lookup[m].label:m;var t="";15<q.length&&(t=" _ht ");""!==m||b.disableYdim||b.trackHub?(b.localStoreObj[b.itemDimension(m)][m]||(b.localStoreObj[b.itemDimension(m)][m]={total:0,state:{on:0,off:0,"reset-on":0,"reset-off":0},renderer:{},format:{}},Object.assign(b.localStoreObj[b.itemDimension(m)][m].renderer,f)),b.localStoreObj[b.itemDimension(m)].allSelection||(b.localStoreObj[b.itemDimension(m)].allSelection={total:0,state:{on:0,off:0,"reset-on":0,"reset-off":0},renderer:{},format:{}},Object.assign(b.localStoreObj[b.itemDimension(m)].allSelection.renderer,f)),b.disableYdim||(c+='<div class="positionFix"><div class="rotate"><div class="overflow xLabel '+m+t+'" title="'+q+'"><span>'+q+"</span></div></div></div>")):c+='<div class="positionFix"><div class="rotate"><div class="overflow xLabel x-label-gap '+
t+'" title="'+q+'"><span>'+q+"</span></div></div></div>"});c+="</div>";b.el.find("div.matrix-container").append(c);b.localStoreObj.matrix.allSelection||(b.localStoreObj.matrix.allSelection={total:0,state:{on:0,off:0,"reset-on":0,"reset-off":0},renderer:{},format:{}},Object.assign(b.localStoreObj.matrix.allSelection.renderer,f));var k='<div class="yContainer">',l='<div class="boxContainer">';b.localStoreObj.dx&&b.localStoreObj.dy&&g.each(Object.keys(b.localStoreObj.dx).sort(),function(q,m){var t=b.elLk.lookup[m].label||m;b.localStoreObj[b.itemDimension(m)][m]||"matrix"!==b.itemDimension(m)||(b.localStoreObj[b.itemDimension(m)][m]={total:0,state:{on:0,off:0,"reset-on":0,"reset-off":0},renderer:{},format:{}},Object.assign(b.localStoreObj[b.itemDimension(m)][m].renderer,f));q="";15<m.length&&(q=" _ht ");k+='<div class="yLabel '+q+'" title="'+t+'"'+m+'"><span>'+t+"</span></div>";var v='<div class="rowContainer">';g.each(h,function(w,z){if(""!==z||b.disableYdim||b.trackHub){var B="",D="",E="",G="",I=z+"_sep_"+m,K,S,U=b.itemDimension(I),T=b.itemDimension(z);w="matrix"===U?U:"";if(b.localStoreObj[U][I]){B=b.localStoreObj[U][I].state;D=b.localStoreObj[U][I].renderer;var V=b.localStoreObj[U][I].format;G="render-"+D;E=B?"_hasData":""}else g.each(b.json.data[b.dx].data[t],function(O,Q){Q.val.replace(/[^\w\-]/g,"_").toLowerCase()===z.toLowerCase()&&(S=Q.dimension,K=Q.renderer||b.json.data[S].renderer,B=Q.defaultState||b.elLk.lookup[z].defaultState,V=Q.format||b.elLk.lookup[z].format,b.multiDimFlag&&Object.keys(b.localStoreObj.filterMatrix).length&&(0===b.localStoreObj.filterMatrix[I].state.total||0===b.localStoreObj.filterMatrix[I].state.on)&&(B=""),E=B?"_hasData":"",id=Q.id,D=K||b.elLk.lookup[z].renderer,G="render-"+D,b.localStoreObj[U][I]={id:id,state:B,renderer:D,format:V,"reset-state":B,"reset-renderer":D},B&&(b.localStoreObj[T].allSelection.total+=1,b.localStoreObj[T].allSelection.format[V]=b.localStoreObj[T].allSelection.format[V]+1||1,b.localStoreObj[T].allSelection.renderer[D]+=1,b.localStoreObj[T].allSelection.renderer["reset-"+D]+=1,b.localStoreObj[T].allSelection.state[B.replace("track-","")]++,b.localStoreObj[T].allSelection.state["reset-"+B.replace("track-","")]++,b.localStoreObj[T][z].total+=1,b.localStoreObj[T][z].renderer[D]+=1,b.localStoreObj[T][z].renderer["reset-"+D]+=1,b.localStoreObj[T][z].state[B.replace("track-","")]++,b.localStoreObj[T][z].state["reset-"+B.replace("track-","")]++,b.localStoreObj.matrix[m].total+=1,b.localStoreObj.matrix[m].renderer[D]+=1,b.localStoreObj.matrix[m].renderer["reset-"+D]+=1,b.localStoreObj.matrix[m].state[B.replace("track-","")]++,b.localStoreObj.matrix[m].state["reset-"+B.replace("track-","")]++))});if(b.disableYdim){if("epigenomic_activity"===z||"segmentation_features"===z)v+='<div class="xBoxes '+B+" "+w+" "+G+" "+V+" "+E+" "+m+" "+z+'" data-track-x="'+z+'" data-track-y="'+m+'" data-popup-type="column-cell" data-format="'+V+'"></div>'}else v+='<div class="xBoxes '+B+" "+w+" "+G+" "+V+" "+E+" "+m+" "+z+'" data-track-x="'+z+'" data-track-y="'+m+'" data-popup-type="column-cell" data-format="'+V+'"></div>'}else v+='<div class="xBoxes _emptyBox_'+
m+'"></div>'});v+="</div>";l+=v});k+="</div>";l+="</div>";var p='<div class="yBoxWrapper">'+k+l+"</div>";b.el.find("div.matrix-container").append(p);p=32*h.length;b.el.find("div.matrix-container .xContainer, div.matrix-container .yBoxWrapper").width(p);b.cellClick("config");b.cleanMatrixStore();b.setLocalStorage();b.multiDimFlag&&b.populateConfigTracksResultBox();"track-display"===b.elLk.breadcrumb.filter(".active").attr("id")&&this.elLk.matrixContainer.find(".xContainer ._ht").helptip({position:{at:"left+10 bottom+76"}});"track-display"===b.elLk.breadcrumb.filter(".active").attr("id")&&this.elLk.matrixContainer.find(".yContainer ._ht").helptip({position:{at:"center center"}})}},populateConfigTracksResultBox:function(){var b=this,c="";g.each(b.localStoreObj.filterMatrix,function(f,h){var k="";if(f.match(/_sep_/)){k+='<div class="header-wrapper"> <div class="_show show-hide hidden"><img src="/i/closed2.gif" class="nosprite" /></div><div class="_hide show-hide hidden"><img src="/i/open2.gif" class="nosprite" /></div>';k+='<h5 class="result-header">'+f.replace("_sep_"," - ")+"</h5>";k+='<ul class="result-list">';var l=0;g.each(b.localStoreObj.filterMatrix[f].data,function(p,q){q.show&&"on"==q.state&&(l=1,k+="<li>"+(b.elLk.filterMatrixObj[f][p].shortLabel||p)+"</li>")});k+="</ul></div>";1===l&&(c+=k)}});b.elLk.configResultBox.find(".config-result-box-content").html(c);b.registerShowHideClickEvent();b.updateShowHideLinks(b.elLk.configResultBox.find("ul"))},emptyMatrix:function(){this.el.find("div.matrix-container, div.filterMatrix-container").html("")},cleanMatrixStore:function(){var b=this,c=g.extend({},b.localStoreObj.dy);g.map(b.json.extra_dimensions,function(f){c[f]=1});g.each(g.merge(["matrix"],b.json.extra_dimensions),function(f,h){g.each(b.localStoreObj[h],function(k,l){k.match("_sep_")||"allSelection"==k||c[k]||!b.localStoreObj.dx||b.localStoreObj.dx[k]||b.removeFromMatrix(k)})})},resetMatrix:function(){var b=this;this.elLk.resetMatrixButton=b.elLk.trackConfiguration.find("button.reset-button._matrix");this.elLk.resetMatrixButton.click("on",function(){b.resetFunctionality()})},registerResetFilterMatrixClickEvent:function(){var b=this;this.elLk.resetFilterMatrixButton=b.elLk.filterTrackPanel.find("button.reset-button._filterMatrix");this.elLk.resetFilterMatrixButton.click("on",function(){b.resetFilterMatrixToDefaults()})},resetFilterMatrixToDefaults:function(b){function c(k,l){g.each(l.data,function(t,v){if(v.state!=v["reset-state"]||v.show!=v["reset-show"])h.push(k),v.state=v["reset-state"],v.show=v["reset-show"]});l.state.off=l.state["reset-off"];l.state.on=l.state["reset-on"];l.state.total=l.state["reset-total"];var p=f.localStoreObj.matrix[k].state,q=f.localStoreObj.matrix[k].format,m=f.localStoreObj.matrix[k].renderer;if(0===l.state["reset-total"]||0===l.state["reset-on"])--f.localStoreObj.matrix.allSelection.state[p.replace("track-","")],--f.localStoreObj.matrix.allSelection.format[q],--f.localStoreObj.matrix.allSelection.renderer[m],--f.localStoreObj.matrix.allSelection.total,f.localStoreObj.matrix[k].state=""}var f=this,h=[];b?g.each(Object.keys(f.elLk.extraDimValToCellMap[b].cells),function(k,l){f.localStoreObj.filterMatrix[l]&&c(l,f.localStoreObj.filterMatrix[l])}):(g.each(f.localStoreObj.filterMatrix,function(k,l){c(k,l)}),f.localStoreObj.other_dimensions=g.extend({},f.localStoreObj.reset_other_dimensions),f.setLocalStorage(),f.updateFilterMatrix(h),f.updateFilterMatrixRHS())},resetFunctionality:function(b){var c=this,f=g.extend({},c.localStoreObj.matrix);g.each(c.json.extra_dimensions,function(h,k){g.extend(f,c.localStoreObj[k])});Object.keys(f).map(function(h){var k=c.itemDimension(h);if(h.match("_sep_")){var l=f[h].state,p=f[h]["reset-state"];if(l){if(!b)var q=f[h].renderer,m=f[h]["reset-renderer"];c.elLk.matrixContainer.find("div.xBoxes."+h.split("_sep_")[0]+"."+h.split("_sep_")[1]).removeClass(l).addClass(p);c.localStoreObj[k][h].state=p;b||(c.elLk.matrixContainer.find("div.xBoxes."+h.split("_sep_")[0]+"."+h.split("_sep_")[1]).removeClass("render-"+q).addClass("render-"+m),c.localStoreObj[k][h].renderer=m)}}else c.localStoreObj[k][h].state.on=f[h].state["reset-on"],c.localStoreObj[k][h].state.off=f[h].state["reset-off"],b||g.each(c.elLk.lookup.rendererKeys,function(t,v){c.localStoreObj[k][h].renderer[t]=f[h].renderer["reset-"+t]}),c.localStoreObj[k].allSelection.state.on=c.multiDimFlag?f.allSelection.total:f.allSelection.state["reset-on"],c.multiDimFlag||(c.localStoreObj[k].allSelection.state.off=f.allSelection.state["reset-off"]),b||g.each(c.elLk.lookup.rendererKeys,function(t,v){c.localStoreObj[k].allSelection.renderer[v]=f.allSelection.renderer["reset-"+v]})});c.setLocalStorage()},resetTracks:function(){var b=this;this.elLk.resetTrack=b.elLk.resultBox.find("div.reset_track");this.elLk.resetTrack.click("on",function(c){g.each(b.elLk.resultBox.find("li").not(".noremove"),function(h,k){b.selectBox(k);b.filterData(g(k).data("item"))});b.updateRHS();if(b.localStoreObj.dx){b.localStoreObj.dx=b.localStoreObj.reset_dx;var f;g.each(b.localStoreObj.dx,function(h){f=b.elLk.dx.tabContents.not(":not(."+h+")");b.selectBox(f)});b.filterData(g(f).data("item"))}b.localStoreObj.dy&&(b.localStoreObj.dy=b.localStoreObj.reset_dy,g.each(b.localStoreObj.dy,function(h){f=b.elLk.dy.tabContents.filter(function(){return g(this).hasClass(h)});b.selectBox(f)}),!b.localStoreObj.dx&&b.localStoreObj.dy&&b.filterData(g(f).data("item")));b.setLocalStorage();b.updateRHS();c.stopPropagation();b.resetFilter("",!0)})},buildMatrixPopup:function(b){var c=this,f=c.el.find("div.track-popup ul._cell .cell-style .renderers ul"),h="";g.each(c.rendererConfig[b],function(k,l){h+='<li class="'+l+'"><i class="'+l+'"></i>'+c.rendererTextMap[l]+"</li>"});f.html(h)},buildFilterMatrixPopup:function(b){var c=this;if(b!==R&&c.localStoreObj.filterMatrix&&c.localStoreObj.filterMatrix[b]){var f="",h=c.el.find("div.track-popup._filterMatrix ul"),k=c.localStoreObj.filterMatrix[b].state.on===c.localStoreObj.filterMatrix[b].state.total?"selected":"";1<Object.keys(c.localStoreObj.filterMatrix[b].data).length&&(f+='<li class="all"><span class="fancy-checkbox all '+k+'" data-cell="'+b+'"></span><text>All</text></li>');g.each(c.localStoreObj.filterMatrix[b].data,function(l,p){var q="on"===p.state?"selected":"",m=c.elLk.filterMatrixObj[b][l].shortLabel;1===p.show&&(f+='<li data-track-id="'+l+'" class="_ht" title="'+c.createTooltipText(b,l)+'"><span class="fancy-checkbox '+q+'" data-cell="'+b+'"></span><text>'+m+"</text></li>")});h.html(f);h.parent().show()}},cellClick:function(b){var c=this;c.elLk.rowContainer=this.elLk.matrixContainer.find("div.rowContainer");c.popupType="";c.TrackPopupType="";c.xLabel="";c.yLabel="";c.xName="";c.yName="";c.boxObj="";c.el.find("div.matrix-container div.xBoxes.track-on, div.matrix-container div.xBoxes.track-off, div.filterMatrix-container div.xBoxes").off().on("click",function(f){c.el.find("div.matrix-container div.xBoxes.track-on.mClick, div.matrix-container div.xBoxes.track-off.mClick, div.filterMatrix-container div.xBoxes").removeClass("mClick");if(g(this).hasClass("_hasData")){c.trackPopup.hide();c.boxObj=g(this);c.popupType=g(this).data("popup-type");c.TrackPopupType=c.el.find("div.track-popup."+c.popupType);c.xName=g(this).data("track-x");c.yName=g(this).data("track-y");c.xLabel=g(c.elLk.rowContainer.find("div.xLabel."+c.xName));c.yLabel=g(c.elLk.rowContainer.find("div.yLabel."+
c.yName));c.cellKey=c.xName+"_sep_"+c.yName;c.cellStateKey=c.itemDimension(c.cellKey)||"";c.dyStateKey=c.itemDimension(c.yName)||"";c.dxStateKey=c.itemDimension(c.xName)||"";var h=c.xName+"_sep_"+c.yName;"filter"===b?c.buildFilterMatrixPopup(h):c.buildMatrixPopup(g(this).data("format"));h=c.localStoreObj[c.cellStateKey][c.cellKey].state;var k=c.localStoreObj[c.cellStateKey][c.cellKey].renderer,l=c.localStoreObj[c.cellStateKey][c.cellKey].format,p="";c.localStoreObj[c.dxStateKey].allSelection.state.on===c.localStoreObj[c.dxStateKey].allSelection.total&&(p="track-on");c.localStoreObj[c.dxStateKey].allSelection.state.off===c.localStoreObj[c.dxStateKey].allSelection.total&&(p="track-off");var q="";g.map(c.localStoreObj[c.dxStateKey].allSelection.renderer,function(m,t){t.match("reset-")||k!==t||m!==c.localStoreObj[c.dxStateKey].allSelection.format[l]||(q=!0)});g(this).addClass("mClick");"track-on"===h?c.TrackPopupType.find('ul li label.switch input[name="cell-switch"]').prop("checked",!0):c.TrackPopupType.find('ul li label.switch input[name="cell-switch"]').prop("checked",!1);k?c.TrackPopupType.find("ul li input[name=cell-radio]._"+k).prop("checked",!0):c.TrackPopupType.find("ul li input[name=cell-radio]").prop("checked",!1);"track-on"===p||"track-off"===p?c.TrackPopupType.find("div input#all-cells-stateBox").prop("checked",!0):c.TrackPopupType.find("div input#all-cells-stateBox").prop("checked",!1);q?c.TrackPopupType.find("input#apply_to_all").prop("checked",!0):c.TrackPopupType.find("input#apply_to_all").prop("checked",!1);h="config"===b?g("div.matrix-container")[0]:g("div.filterMatrix-container")[0];c.TrackPopupType.attr("data-track-x",g(this).data("track-x")).attr("data-track-y",g(this).data("track-y")).css({top:g(this)[0].offsetTop-g(h).scrollTop()+15,left:g(this)[0].offsetLeft-g(h).scrollLeft()+15}).show();c.popupFunctionality(b);f.stopPropagation();"config"===b&&new c.dropDown(c,k);g(".track-popup._filterMatrix").find("._ht").helptip({position:{at:"center bottom-15"}})}})},updateFilterMatrixStore:function(b,c,f,h,k,l,p){k?(g.each(b.data,function(q,m){m.state=f}),this.localStoreObj.filterMatrix[c].state[h]=0,this.localStoreObj.filterMatrix[c].state[f]=this.localStoreObj.filterMatrix[c].state.total):(l!=R?(p?(this.localStoreObj.filterMatrix[c].state[h]=0,this.localStoreObj.filterMatrix[c].state.total="on"===f?Object.keys(this.localStoreObj.filterMatrix[c].data).length:0,this.localStoreObj.filterMatrix[c].state[f]="on"===f?Object.keys(this.localStoreObj.filterMatrix[c].data).length:0):1===l?"on"!=b.state&&(this.localStoreObj.filterMatrix[c].state.total+=1,this.localStoreObj.filterMatrix[c].state.on+=1):1===b.show&&(--this.localStoreObj.filterMatrix[c].state.total,--this.localStoreObj.filterMatrix[c].state[b.state]),b.show=l):(--this.localStoreObj.filterMatrix[c].state[h],this.localStoreObj.filterMatrix[c].state[f]+=1),b.state=f);b=this.localStoreObj.matrix[c].state;h=this.localStoreObj.matrix[c].format;k=this.localStoreObj.matrix[c].renderer;0===this.localStoreObj.filterMatrix[c].state.total||0===this.localStoreObj.filterMatrix[c].state.on?(--this.localStoreObj.matrix.allSelection.state[b.replace("track-","")],--this.localStoreObj.matrix.allSelection.state["reset-"+b.replace("track-","")],--this.localStoreObj.matrix.allSelection.format[h],--this.localStoreObj.matrix.allSelection.renderer[k],--this.localStoreObj.matrix.allSelection.renderer["reset-"+k],--this.localStoreObj.matrix.allSelection.total,this.localStoreObj.matrix[c].state="",this.localStoreObj.matrix[c]["reset-state"]=""):(b?(--this.localStoreObj.matrix.allSelection.state[b.replace("track-","")],--this.localStoreObj.matrix.allSelection.state["reset-"+
b.replace("track-","")],this.localStoreObj.matrix.allSelection.state.on+=1,this.localStoreObj.matrix.allSelection.state["reset-on"]+=1):(this.localStoreObj.matrix.allSelection.format[h]+=1,this.localStoreObj.matrix.allSelection.renderer[k]+=1,this.localStoreObj.matrix.allSelection.renderer["reset-"+k]+=1,this.localStoreObj.matrix.allSelection.state.on+=1,this.localStoreObj.matrix.allSelection.state["reset-on"]+=1,this.localStoreObj.matrix.allSelection.total+=1),this.localStoreObj.matrix[c].state="track-on",this.localStoreObj.matrix[c]["reset-state"]="track-on");this.setLocalStorage()},updateFilterMatrix:function(b){var c=this;g.each(b,function(f,h){if(0===c.localStoreObj.filterMatrix[h].state.total)var k=f="";else c.localStoreObj.filterMatrix[h].state.on===c.localStoreObj.filterMatrix[h].state.total?(f="_hasData track-on",k='<span class="count">'+c.localStoreObj.filterMatrix[h].state.on+"</span>"):c.localStoreObj.filterMatrix[h].state.off===c.localStoreObj.filterMatrix[h].state.total?(f="_hasData partzero",k='<span class="partialCount">0</span><span class="count">'+c.localStoreObj.filterMatrix[h].state.total+"</span>"):(k=c.localStoreObj.filterMatrix[h].state.total-c.localStoreObj.filterMatrix[h].state.off,f=0===k?"_hasData partzero":"_hasData partial",k='<span class="partialCount">'+k+'</span><span class="count">'+c.localStoreObj.filterMatrix[h].state.total+"</span>");c.elLk.filterMatrix.find("div."+h).removeClass("track-on track-off partial partzero _hasData").addClass(f).html(k)})},updateTrackStore:function(b,c,f,h,k,l,p){var q=this,m=f?"state":"renderer",t=f?f.replace("track-",""):k,v=h?h.replace("track-",""):l;if("allSelection"===c)Object.keys(b).filter(function(B){B.match("_sep_")?b[B][m]=k?b[B].format===p?k:b[B][m]:f?f:k:g.each(b[B][m],function(D,E){t===D?b[B][m][D]=b[B].total:D.match("reset-")||(b[B][m][D]=0)})});else{var w=q.itemDimension(c);if(c.match("_sep_")){b[m]=f?f:k;var z=0;g.each(c.split("_sep_"),function(B,D){q.localStoreObj[q.dxStateKey][D][m][t]<q.localStoreObj[q.dxStateKey][D].total&&(q.localStoreObj[q.dxStateKey][D][m][t]+=1);0<q.localStoreObj[q.dxStateKey][D][m][v]&&--q.localStoreObj[q.dxStateKey][D][m][v];z||(q.localStoreObj[q.dxStateKey].allSelection[m][t]<q.localStoreObj[q.dxStateKey].allSelection.total&&(q.localStoreObj[q.dxStateKey].allSelection[m][t]+=1),0<q.localStoreObj[q.dxStateKey].allSelection[m][v]&&--q.localStoreObj[q.dxStateKey].allSelection[m][v],z=1);if("matrix"!=w)return!1})}else g.each(b[m],function(B,D){B===t?b[m][B]=b.total:B.match("reset-")||(b[m][B]=0)}),Object.keys(q.localStoreObj[w]).filter(function(B){B.match(c)&&B.match("_sep_")&&("matrix"===w&&g.grep(B.split("_sep_"),function(D,E){E=q.localStoreObj[w][B][m];var G=f?f:k;E=E.replace("track-","");G=G.replace("track-","");D!=c&&E!=G&&(q.localStoreObj[w][D][m][t]<q.localStoreObj[w][D].total&&(q.localStoreObj[w][D][m][t]+=1),0<q.localStoreObj[w][D][m][E]&&--q.localStoreObj[w][D][m][E],q.localStoreObj[w].allSelection[m][t]<q.localStoreObj[w].allSelection.total&&(q.localStoreObj[w].allSelection[m][t]+=1),0<q.localStoreObj[w].allSelection[m][E]&&--q.localStoreObj[w].allSelection[m][E])}),q.localStoreObj[w][B][m]=f?f:k)})}q.setLocalStorage()},popupFunctionality:function(b){var c=this;"filter"===b?(c.TrackPopupType.find("li").off().on("click",function(f){var h=g(this).children("span.fancy-checkbox");h.toggleClass("selected");g(this).data("track-id");g(this).hasClass("all")&&(h.hasClass("selected")?g(this).siblings().each(function(p,q){g(q).children("span.fancy-checkbox").removeClass("selected").addClass("selected")}):g(this).siblings().each(function(p,q){g(q).children("span.fancy-checkbox").removeClass("selected")}));f=h.data("cell");h=h.hasClass("selected")?"off":"on";var k="on"===h?"off":"on";if(g(this).find("span.fancy-checkbox.all").length)c.updateFilterMatrixStore(c.localStoreObj.filterMatrix[f],f,k,h,1);else{var l=g(this).data("track-id");c.updateFilterMatrixStore(c.localStoreObj.filterMatrix[f].data[l],f,k,h);c.localStoreObj.filterMatrix[f].state.total===c.localStoreObj.filterMatrix[f].state.on?c.TrackPopupType.find("ul span.fancy-checkbox.all").addClass("selected"):c.TrackPopupType.find("ul span.fancy-checkbox.all").removeClass("selected")}c.updateFilterMatrix([f]);c.updateFilterMatrixRHS()}),c.TrackPopupType.find("input#apply_to_all").off().on("click",function(f){f.currentTarget.checked&&c.updateRenderer(c.TrackPopupType.find("div#dd.renderers ul.dropdown li.selected i").attr("class"),g(this));f.stopPropagation()})):(c.TrackPopupType.find("ul li label.switch input[type=checkbox]").off().on("click",function(f){var h=g(this).attr("name"),k=g(this).is(":checked")?"track-on":"track-off",l="track-on"===k?"track-off":"track-on";"cell-switch"===h&&(c.boxObj.removeClass(l).addClass(k),h=c.xName+"_sep_"+c.yName,c.updateTrackStore(c.localStoreObj[c.dxStateKey][h],h,k,l),c.localStoreObj[c.dyStateKey][c.yName]&&(yNameData=c.localStoreObj[c.dyStateKey][c.yName]),c.localStoreObj[c.dyStateKey][c.xName]?xNameData=c.localStoreObj[c.dyStateKey][c.xName]:c.localStoreObj[c.xName][c.xName]&&(xNameData=c.localStoreObj[c.xName][c.xName]),c.TrackPopupType.find("div.all-cells-state input[name=all-cells]").is(":checked")?(c.elLk.rowContainer.find("div.xBoxes.matrix._hasData."+l).removeClass(l).addClass(k),c.updateTrackStore(c.localStoreObj[c.dxStateKey],"allSelection",k,l)):!c.localStoreObj[c.dyStateKey].allSelection||c.localStoreObj[c.dyStateKey].allSelection.state.on!==c.localStoreObj[c.dyStateKey].allSelection.total&&c.localStoreObj[c.dyStateKey].allSelection.state.off!==c.localStoreObj[c.dyStateKey].allSelection.total||c.TrackPopupType.find("div input#all-cells-stateBox").prop("checked",!0));f.stopPropagation()}),c.TrackPopupType.find("div.all-cells-state input[name=all-cells]").off().on("click",function(f){if(g(this).is(":checked")){f="track-"+(c.TrackPopupType.find('ul li label.switch input[name="cell-switch"]').is(":checked")?"on":"off");var h="track-on"===f?"track-off":"track-on";c.elLk.rowContainer.find("div.xBoxes.matrix._hasData."+h).removeClass(h).addClass(f);c.updateTrackStore(c.localStoreObj[c.dxStateKey],"allSelection",f,h)}}),c.TrackPopupType.find("div.reset_track_state").click("on",function(){c.resetFunctionality(1);var f=c.localStoreObj[c.dxStateKey][c.xName+"_sep_"+c.yName]["reset-state"].replace("track-","");c.TrackPopupType.find('ul li label.switch input[name="cell-switch"]').prop("checked","on"===f?!0:!1);!c.localStoreObj[c.dyStateKey].allSelection||c.localStoreObj[c.dyStateKey].allSelection.state.on!==c.localStoreObj[c.dyStateKey].allSelection.total&&c.localStoreObj[c.dyStateKey].allSelection.state.off!==c.localStoreObj[c.dyStateKey].allSelection.total?c.TrackPopupType.find("div input#all-cells-stateBox").prop("checked",!1):c.TrackPopupType.find("div input#all-cells-stateBox").prop("checked",!0)}))},updateRenderer:function(b,c){var f=this.localStoreObj.matrix[this.cellKey].renderer,h=this.localStoreObj.matrix[this.cellKey].format,k=this.itemDimension(this.xName);this.boxObj.removeClass("render-"+f).addClass("render-"+b);this.updateTrackStore(this.localStoreObj[k][this.cellKey],this.cellKey,"","",b,f);if(c&&"apply_to_all"===c.attr("id")||!c&&this.TrackPopupType.find("input#apply_to_all:checked").length)this.elLk.matrixContainer.find("div.xBoxes._hasData.matrix."+
h).removeClass(function(l,p){return(p.match(/(^|\s)render-\S+/g)||[]).join(" ")}).addClass("render-"+b),this.updateTrackStore(this.localStoreObj[k],"allSelection","","",b,f,h);this.localStoreObj[this.dyStateKey].allSelection.renderer[b]===this.localStoreObj[this.dyStateKey].allSelection.format[h]?this.TrackPopupType.find("input#apply_to_all").prop("checked",!0):this.TrackPopupType.find("input#apply_to_all").prop("checked",!1)}});u.Panel.ManageData=u.Panel.ModalContent.extend({init:function(){var b=this;this.base();this.elLk.table=this.el.find("#ManageDataTable");this.el.find("._mu_button").each(function(){g(this).on({click:function(){b.elLk.url=g(this).attr("href");b.elLk.table.find(".mass_update").each(function(){g(this).is(":checked")&&(b.elLk.url+=";record="+g(this).val())});g(this).attr("href",b.elLk.url)}})});this.elLk.selectAll=this.el.find("#selectAllFiles");this.elLk.selectAll.on({click:function(){b.elLk.table.find(".mass_update").each(function(){b.elLk.selectAll.is(":checked")?g(this).prop("checked",!0):g(this).prop("checked",!1)})}});this.el.find("._clear_localcache").each(function(){g(this).on({click:function(){g(this).siblings().each(function(c,f){g(f).hasClass("_trackhub_key")&&localStorage.removeItem(g(f).val())})}})})}});u.Panel.SiteGallery=u.Panel.Content.extend({init:function(){this.base.apply(this,arguments);this.stickyMenu();this.el.find(".embiggen").each(function(){g(this).on({mouseover:function(){g(this).addClass("zoom")}});g(this).on({mouseout:function(){g(this).removeClass("zoom")}});g(this).on({click:function(){var b=g(this).next();b.removeClass("hide");var c=b.width()-225;0<c&&b.css("right",c+"px")}});g(this).next().children(":first").on({click:function(){g(this).parent().addClass("hide")}})})},stickyMenu:function(){this.elLk.menuBar||(this.elLk.menuBar=this.el.find("#gallery-toc"));this.elLk.menuBar.keepOnPage({marginTop:10,onreset:function(){g(this).removeClass("sticky")},onfix:function(){g(this).addClass("sticky")}}).keepOnPage("trigger")}});u.Panel.SiteGalleryHome=u.Panel.Content.extend({init:function(){this.base.apply(this,arguments);this.elLk.form=this.el.find("form[name=gallery_home]").remove(".js_param");this.elLk.dataType=this.elLk.form.find("input[name=data_type]");this.elLk.identifier=this.elLk.form.find("input[name=identifier]");this.elLk.species=this.elLk.form.find("select[name=species]");this.formAction=this.elLk.form.attr("action");this.initSelectToToggle();this.updateIdentifier();this.elLk.dataType.add(this.elLk.species).on("change",{panel:this},function(b){b.data.panel.updateIdentifier()});this.geneCache={};this.geneIDCache={};this.elLk.identifier.on("focus",{panel:this},function(b){b.data.panel.autocompleteGene()})},initSelectToToggle:function(){var b=this;this.elLk.species.find("option").addClass(function(){return b.params.sample_data[this.value].variation?"_stt__var":"_stt__novar"});this.elLk.dataType.parent().addClass(function(){return g(this).find("[value=variation]").length?"_stt_var":"_stt_var _stt_novar"});this.elLk.species.selectToToggle()},updateIdentifier:function(){var b=this.elLk.species.val();this.elLk.dataType.filter(":visible:checked").length||this.elLk.dataType.filter(":visible").first().prop("checked",!0);this.elLk.identifier.val((this.params.sample_data[b]||{})[this.elLk.dataType.filter(":checked").val()]||"");this.elLk.form.attr("action",this.formAction.replace("Multi",b))},autocompleteGene:function(){var b=this;this.elLk.identifier.autocomplete({minLength:3,source:function(c,f){var h={panel:b,term:c.term,key:c.term.substr(0,3).toUpperCase(),callback:function(k,l){var p=new RegExp("^"+
g.ui.autocomplete.escapeRegex(k),"i");return f(g.map(l,function(q,m){return p.test(m)?q.label:null}))}};if(h.key in b.geneCache)return h.callback(c.term,b.geneCache[h.key]);g.ajax({url:u.speciesPath+"/Ajax/autocomplete",cache:!0,data:{q:h.key,species:b.elLk.species.val()},dataType:"json",context:h,success:function(k){this.panel.geneCache[this.key]=k},complete:function(){return this.callback(this.term,this.panel.geneCache[this.key])}})}})}});"console"in F?function(){F.console.time||(F._timerCache={},F.console.time=function(b){F._timerCache[b]=(new Date).getTime()},F.console.timeEnd=function(b){console.log(b+": "+((new Date).getTime()-F._timerCache[b])+"ms");delete F._timerCache[b]})}():function(){var b="log debug info warn error assert dir dirxml group groupEnd time timeEnd count trace profile profileEnd".split(" ");F.console={};for(var c=0;c<b.length;c++)F.console[b[c]]=g.noop}();F.addLoadEvent=function(b){u.extend({initialize:function(){this.base();b()}})};g(function(){F.JSON?u.initialize():g.getScript("/components/json2.js",function(){u.initialize()})});this.JSON||(this.JSON={});(function(){function b(t){return 10>t?"0"+t:t}function c(t){k.lastIndex=0;return k.test(t)?'"'+t.replace(k,function(v){var w=q[v];return"string"===typeof w?w:"\\u"+("0000"+v.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function f(t,v){var w=l,z=v[t];z&&"object"===typeof z&&"function"===typeof z.toJSON&&(z=z.toJSON(t));"function"===typeof m&&(z=m.call(v,t,z));switch(typeof z){case"string":return c(z);case"number":return isFinite(z)?String(z):"null";case"boolean":case"null":return String(z);case"object":if(!z)return"null";l+=p;var B=[];if("[object Array]"===Object.prototype.toString.apply(z)){var D=z.length;for(t=0;t<D;t+=1)B[t]=f(t,z)||"null";v=0===B.length?"[]":l?"[\n"+l+B.join(",\n"+l)+"\n"+w+"]":"["+B.join(",")+"]";l=w;return v}if(m&&"object"===typeof m)for(D=m.length,t=0;t<D;t+=1){var E=m[t];"string"===typeof E&&(v=f(E,z))&&B.push(c(E)+(l?": ":":")+v)}else for(E in z)Object.hasOwnProperty.call(z,E)&&(v=f(E,z))&&B.push(c(E)+(l?": ":":")+v);v=0===B.length?"{}":l?"{\n"+l+B.join(",\n"+l)+"\n"+w+"}":"{"+B.join(",")+"}";l=w;return v}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+b(this.getUTCMonth()+1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var h=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,k=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,l,p,q={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},m;"function"!==typeof JSON.stringify&&(JSON.stringify=function(t,v,w){var z;p=l="";if("number"===typeof w)for(z=0;z<w;z+=1)p+=" ";else"string"===typeof w&&(p=w);if((m=v)&&"function"!==typeof v&&("object"!==typeof v||"number"!==typeof v.length))throw Error("JSON.stringify");return f("",{"":t})});"function"!==typeof JSON.parse&&(JSON.parse=function(t,v){function w(z,B){var D,E=z[B];if(E&&"object"===typeof E)for(D in E)if(Object.hasOwnProperty.call(E,D)){var G=w(E,D);G!==R?E[D]=G:delete E[D]}return v.call(z,B,E)}t=String(t);h.lastIndex=0;h.test(t)&&(t=t.replace(h,function(z){return"\\u"+("0000"+z.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(t.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return t=eval("("+t+")"),"function"===typeof v?w({"":t},""):t;throw new SyntaxError("JSON.parse");})})();this.sh_languages||(this.sh_languages={});this.sh_languages||(this.sh_languages={});sh_languages.perl=[[[/\b(?:import)\b/g,"sh_preproc",-1],[/(s)(\{(?:\\\}|[^}])*\}\{(?:\\\}|[^}])*\})([ixsmogce]*)/g,["sh_keyword","sh_regexp","sh_keyword"],-1],[/(s)(\((?:\\\)|[^)])*\)\((?:\\\)|[^)])*\))([ixsmogce]*)/g,["sh_keyword","sh_regexp","sh_keyword"],-1],[/(s)(\[(?:\\\]|[^\]])*\]\[(?:\\\]|[^\]])*\])([ixsmogce]*)/g,["sh_keyword","sh_regexp","sh_keyword"],-1],[/(s)(<.*><.*>)([ixsmogce]*)/g,["sh_keyword","sh_regexp","sh_keyword"],-1],[/(q(?:q?))(\{(?:\\\}|[^}])*\})/g,["sh_keyword","sh_string"],-1],[/(q(?:q?))(\((?:\\\)|[^)])*\))/g,["sh_keyword","sh_string"],-1],[/(q(?:q?))(\[(?:\\\]|[^\]])*\])/g,["sh_keyword","sh_string"],-1],[/(q(?:q?))(<.*>)/g,["sh_keyword","sh_string"],-1],[/(s)\/([^A-Za-z0-9 \t])(.*\2.*\2)([ixsmogce]*(?=[ \t]*(?:\)|;)))/g,["sh_keyword","sh_regexp","sh_regexp","sh_keyword"],-1],[/(s)\/([^A-Za-z0-9 \t])(.*\2[ \t]*)([^A-Za-z0-9 \t])(.*\4)([ixsmogce]*(?=[ \t]*(?:\)|;)))/g,"sh_keyword sh_regexp sh_regexp sh_regexp sh_regexp sh_keyword".split(" "),-1],[/#/g,"sh_comment",1],[/\b[+-]?(?:(?:0x[A-Fa-f0-9]+)|(?:(?:[\d]*\.)?[\d]+(?:[eE][+-]?[\d]+)?))u?(?:(?:int(?:8|16|32|64))|L)?\b/g,"sh_number",-1],[/(?:m|qr)(?=\{)/g,"sh_keyword",2],[/(?:m|qr)(?=#)/g,"sh_keyword",4],[/(?:m|qr)(?=\|)/g,"sh_keyword",6],[/(?:m|qr)(?=@)/g,"sh_keyword",8],[/(?:m|qr)(?=<)/g,"sh_keyword",10],[/(?:m|qr)(?=\[)/g,"sh_keyword",12],[/(?:m|qr)(?=\\)/g,"sh_keyword",14],[/(?:m|qr)(?=\/)/g,"sh_keyword",16],[/"/g,"sh_string",18],[/'/g,"sh_string",19],[/</g,"sh_string",20],[/\/[^\n]*\//g,"sh_string",-1],[/\b(?:chomp|chop|chr|crypt|hex|i|index|lc|lcfirst|length|oct|ord|pack|q|qq|reverse|rindex|sprintf|substr|tr|uc|ucfirst|m|s|g|qw|abs|atan2|cos|exp|hex|int|log|oct|rand|sin|sqrt|srand|my|local|our|delete|each|exists|keys|values|pack|read|syscall|sysread|syswrite|unpack|vec|undef|unless|return|length|grep|sort|caller|continue|dump|eval|exit|goto|last|next|redo|sub|wantarray|pop|push|shift|splice|unshift|split|switch|join|defined|foreach|last|chop|chomp|bless|dbmclose|dbmopen|ref|tie|tied|untie|while|next|map|eq|die|cmp|lc|uc|and|do|if|else|elsif|for|use|require|package|import|chdir|chmod|chown|chroot|fcntl|glob|ioctl|link|lstat|mkdir|open|opendir|readlink|rename|rmdir|stat|symlink|umask|unlink|utime|binmode|close|closedir|dbmclose|dbmopen|die|eof|fileno|flock|format|getc|print|printf|read|readdir|rewinddir|seek|seekdir|select|syscall|sysread|sysseek|syswrite|tell|telldir|truncate|warn|write|alarm|exec|fork|getpgrp|getppid|getpriority|kill|pipe|qx|setpgrp|setpriority|sleep|system|times|x|wait|waitpid)\b/g,"sh_keyword",-1],[/^=(?:head1|head2|item)/g,"sh_comment",21],[/(?:\$[#]?|@|%)[\/A-Za-z0-9_]+/g,"sh_variable",-1],[/(->)((?:[A-Za-z]|_)[A-Za-z0-9_]*)(?=[ \t]*\(?)/g,["sh_symbol","sh_function"],-1],[/~|!|%|\^|\*|\(|\)|-|\+|=|\[|\]|\\|:|;|,|\.|\/|\?|&|<|>|\|/g,"sh_symbol",-1],[/\{|\}/g,"sh_cbracket",-1]],[[/$/g,null,-2]],[[/\{/g,"sh_regexp",3]],[[/[ \t]+#.*/g,"sh_comment",-1],[/\$(?:[A-Za-z0-9_]+|\{[A-Za-z0-9_]+\})/g,"sh_variable",-1],[/\\\{|\\\}|\}/g,"sh_regexp",-3]],[[/#/g,"sh_regexp",5]],[[/[ \t]+#.*/g,"sh_comment",-1],[/\$(?:[A-Za-z0-9_]+|\{[A-Za-z0-9_]+\})/g,"sh_variable",-1],[/\\#|#/g,"sh_regexp",-3]],[[/\|/g,"sh_regexp",7]],[[/[ \t]+#.*/g,"sh_comment",-1],[/\$(?:[A-Za-z0-9_]+|\{[A-Za-z0-9_]+\})/g,"sh_variable",-1],[/\\\||\|/g,"sh_regexp",-3]],[[/@/g,"sh_regexp",9]],[[/[ \t]+#.*/g,"sh_comment",-1],[/\$(?:[A-Za-z0-9_]+|\{[A-Za-z0-9_]+\})/g,"sh_variable",-1],[/\\@|@/g,"sh_regexp",-3]],[[/</g,"sh_regexp",11]],[[/[ \t]+#.*/g,"sh_comment",-1],[/\$(?:[A-Za-z0-9_]+|\{[A-Za-z0-9_]+\})/g,"sh_variable",-1],[/\\<|\\>|>/g,"sh_regexp",-3]],[[/\[/g,"sh_regexp",13]],[[/[ \t]+#.*/g,"sh_comment",-1],[/\$(?:[A-Za-z0-9_]+|\{[A-Za-z0-9_]+\})/g,"sh_variable",-1],[/\\]|\]/g,"sh_regexp",-3]],[[/\\/g,"sh_regexp",15]],[[/[ \t]+#.*/g,"sh_comment",-1],[/\$(?:[A-Za-z0-9_]+|\{[A-Za-z0-9_]+\})/g,"sh_variable",-1],[/\\\\|\\/g,"sh_regexp",-3]],[[/\//g,"sh_regexp",17]],[[/[ \t]+#.*/g,"sh_comment",-1],[/\$(?:[A-Za-z0-9_]+|\{[A-Za-z0-9_]+\})/g,"sh_variable",-1],[/\\\/|\//g,"sh_regexp",-3]],[[/$/g,null,-2],[/\\(?:\\|")/g,null,-1],[/"/g,"sh_string",-2]],[[/$/g,null,-2],[/\\(?:\\|')/g,null,-1],[/'/g,"sh_string",-2]],[[/$/g,null,-2],[/>/g,"sh_string",-2]],[[/=cut/g,"sh_comment",-2]]];this.sh_languages||(this.sh_languages={});sh_languages.sh=[[[/\b(?:import)\b/g,"sh_preproc",-1],[/\b[+-]?(?:(?:0x[A-Fa-f0-9]+)|(?:(?:[\d]*\.)?[\d]+(?:[eE][+-]?[\d]+)?))u?(?:(?:int(?:8|16|32|64))|L)?\b/g,"sh_number",-1],[/\\"|\\'/g,"sh_normal",-1],[/"/g,"sh_string",1],[/'/g,"sh_string",2],[/function[ \t]+(?:[A-Za-z]|_)[A-Za-z0-9_]*[ \t]*(?:\(\))?|(?:[A-Za-z]|_)[A-Za-z0-9_]*[ \t]*\(\)/g,"sh_function",-1],[/[\-]+\b[A-Za-z0-9_]+\b/g,"sh_name",-1],[/(?:[A-Za-z]*[-\/]+[A-Za-z]+)+/g,"sh_normal",-1],[/\b(?:alias|bg|bind|break|builtin|caller|case|command|compgen|complete|continue|declare|dirs|disown|do|done|elif|else|enable|esac|eval|exec|exit|export|false|fc|fg|fi|for|getopts|hash|help|history|if|in|jobs|let|local|logout|popd|printf|pushd|read|readonly|return|select|set|shift|shopt|source|suspend|test|then|times|trap|true|type|typeset|umask|unalias|unset|until|wait|while)\b/g,"sh_keyword",-1],[/\b(bgzip|brew|cat|cd|chmod|cp|cpan|cpanm|curl|docker|echo|git|grep|gunzip|gzip|head|install|ln|make|mkdir|mv|perl|rm|sh|sort|tabix|tar|unzip|vep|wget|zip)\b\s+/g,"sh_keyword",-1],[/\.\/(vep|filter_vep)/g,"sh_keyword",-1],[/\b[A-Z_]+\b:\s+/g,"sh_variable",-1],[/(?:[A-Za-z]|_)[A-Za-z0-9_]*(?==)|\$\{(?:[^ \t']+)\}|\$\((?:[^ \t']+)\)|\$(?:[A-Za-z]|_)[A-Za-z0-9_]*|\$(?:[^ \t']{1})/g,"sh_variable",-1],[/~|!|%|\^|\*|\(|\)|\+|=|\[|\]|\\|:|;|,|\.|\/|\?|&|<|>|\||%%|(?:##){2}(?!#)/g,"sh_symbol",-1],[/#/g,"sh_comment",3]],[[/"/g,"sh_string",-2],[/\\./g,"sh_specialchar",-1]],[[/'/g,"sh_string",-2],[/\\./g,"sh_specialchar",-1]],[[/$/g,null,-2]]];g(function(){if(g("body.static").length)for(var b=L.getElementsByTagName("pre"),c=0;c<b.length;c++)for(var f=b.item(c),h=hb(f),k=0;k<h.length;k++){var l=h[k].toLowerCase();if("sh_sourcecode"!==l&&"sh_"===l.substr(0,3)){h=l.substring(3);if(h in sh_languages){k=sh_languages[h];a:{l=hb(f);for(h=0;h<l.length;h++)if("sh_sourcecode"===l[h].toLowerCase())break a;l.push("sh_sourceCode");f.className=l.join(" ")}h=[];l={text:[]};l.tags=h;l.pos=0;ib(f.childNodes,l);l=l.text.join("");k=ub(l,k);var p=h.length;if(0===p)h=k;else{var q=k.length;if(0!==q){for(var m=[],t=0,v=0;t<p&&v<q;){var w=h[t],z=k[v];w.pos<=z.pos?(m.push(w),t++):(m.push(z),k[v+1].pos<=w.pos?(v++,m.push(k[v]),v++):(m.push({pos:w.pos}),k[v]={node:z.node.cloneNode(!1),pos:w.pos}))}for(;t<p;)m.push(h[t]),t++;for(;v<q;)m.push(k[v]),v++;h=m}}k=L.createDocumentFragment();p=0;q=h.length;m=0;t=l.length;for(v=k;m<t||p<q;){if(p<q){var B=h[p];w=B.pos}else w=t;w<=m?(B.node?(w=B.node,v.appendChild(w),v=w):v=v.parentNode,p++):(v.appendChild(L.createTextNode(l.substring(m,w))),m=w)}for(;f.hasChildNodes();)f.removeChild(f.firstChild);f.appendChild(k)}else throw'Found <pre> element with class="'+l+'", but no such language exists';break}}});u.GA={eventConfigs:[],domainCodes:{},verbose:!1,logAjaxLoadTimes:!0,reportErrors:!0,code:function(){return this.domainCodes[F.location.hostname]},init:function(){this.code()&&!this.initialised&&(function(b,c,f,h,k,l,p){b.GoogleAnalyticsObject=k;b[k]=b[k]||function(){(b[k].q=b[k].q||[]).push(arguments)};b[k].l=1*new Date;l=c.createElement(f);p=c.getElementsByTagName(f)[0];l.async=1;l.src=h;p.parentNode.insertBefore(l,p)}(F,L,"script","//www.google-analytics.com/analytics.js","ensGA"),this.urlSpeciesRegex=new RegExp("/("+u.allSpeciesList.join("|")+")/"),ensGA("create",this.code(),"auto"),ensGA("set","anonymizeIp",!0),ensGA("set","page",this.filterURL(F.location)),ensGA("set","dimension1",u.species),ensGA("set","dimension2",u.isLoggedInUser?"yes":"no"),ensGA("set","dimension3",F.location.pathname+F.location.search),ensGA("send","pageview"),ensGA("require","linkid","linkid.js"),this.initialised=!0,this.registerConfigs(this.eventConfigs))},filterURL:function(b){"string"===typeof b&&(b=g("<a>").attr("href",b)[0]);return b.hostname===F.location.hostname?"/"+(b.pathname.replace(this.urlSpeciesRegex,"/").replace(/^\/+/,"")||"index.html"):b.hostname},sendEvent:function(b,c,f){this.initialised&&(b=b.instantiate(c,{label:"",value:1},f),c=[b.category,b.action,b.label,b.value,{nonInteraction:!!b.nonInteraction}],b.category&&b.action&&(this.verbose&&console.log(c),ensGA.apply(F,["send","event"].concat(c))),u.GA.EventConfig.destroy(b))},getConfig:function(b){if(!0===this.initialised)throw"Can not get hold of a config after Ensembl.GA has been initialised";for(var c=0;c<this.eventConfigs.length;c++)if(this.eventConfigs[c].id&&this.eventConfigs[c].id===b)return this.eventConfigs[c]},deleteConfig:function(b){if(b=this.getConfig(b))b.deleted=!0},registerConfigs:function(b){this.initialised&&(b=g.makeArray(g.map(b,function(c){return c.deleted||c.url&&!F.location.href.match(c.url)?null:new u.GA.EventConfig(c)})),this.addMouseEvents(b),this._eventConfigs||(this._eventConfigs=[]),g.merge(this._eventConfigs,b),this.ajaxEventsInitiated||(this.ajaxEventsInitiated=!0,g.ajaxPrefilter(function(c,f,h){g.each(u.GA._eventConfigs,function(){"ajax"===this.event&&f.url.match(this.ajaxUrl)&&u.GA.sendEvent(this,{currentOptions:f})})})))},addMouseEvents:function(b){g.each(b,function(){if("ajax"!==this.event)if("function"===typeof this.selector&&(this.selector=this.selector()),this.wrapper&&"function"===typeof this.wrapper&&(this.wrapper=this.wrapper()),this.wrapper&&"string"!==typeof this.selector)console.log("If 'wrapper' key is provided, 'selector' can only be a string.");else{var c=[(this.event||"click")+".ga"];this.wrapper&&c.push(this.selector);c.push({config:this},function(f){u.GA.sendEvent(f.data.config,{currentTarget:this},f)});g.fn.on.apply(g(this.wrapper||this.selector),c)}})}};u.GA.EventConfig=function(b){g.extend(this,b)};u.GA.EventConfig.prototype.getURL=function(b){return u.GA.filterURL(b||this.currentTarget||this.currentOptions.url)};u.GA.EventConfig.prototype.getText=function(b){return g(b||this.currentTarget).text().trim()};u.GA.EventConfig.prototype.instantiate=function(b,c,f){var h=g.extend({},c,this,b);h.data=g.extend({},this.data);g.each(h.data,function(k,l){u.GA.EventConfig.resolve(h,f,h.data,k)});g.each(["category","action","label","value","nonInteraction"],function(k,l){u.GA.EventConfig.resolve(h,f,h,l)});return h};u.GA.EventConfig.resolve=function(b,c,f,h){"function"===typeof f[h]&&(f[h]=f[h].call(b,c))};u.GA.EventConfig.destroy=function(b){b.data&&this.destroy(b.data);for(var c in b)b[c]=null};u.extend({initialize:function(){u.setSpecies();u.setUserFlag&&u.setUserFlag();var b=g("#hidden_species_list").val()||"";this.allSpeciesList=g.merge(["Multi"],b.split("|"));u.GA.init();u.HotJar.init();this.base.apply(this,arguments)}});u.HotJar={init:function(){this.addScript(this.hotjarIds[F.location.hostname])},addScript:function(b){b&&function(c,f,h,k,l,p){c.hj=c.hj||function(){(c.hj.q=c.hj.q||[]).push(arguments)};c._hjSettings={hjid:l,hjsv:p};a=f.getElementsByTagName("head")[0];r=f.createElement("script");r.async=1;r.src=h+c._hjSettings.hjid+k+c._hjSettings.hjsv;a.appendChild(r)}(F,L,"https://static.hotjar.com/c/hotjar-",".js?sv=",b,6)}};u.GA.eventConfigs.push({id:"SpeciesIcon",url:/^http:\/\/[^\/]+\/index.html/,wrapper:"._species_fav_container",selector:"a",event:"click",category:"SpeciesIcon",action:function(){return this.getURL()}},{id:"SpeciesDropdown",url:/^http:\/\/[^\/]+\/index.html/,selector:"select._all_species",event:"change",category:"SpeciesDropdown",action:function(){return this.getText(g(this.currentTarget).find("option:selected"))}},{id:"HomepageLink-SaveFavourites",url:/^http:\/\/[^\/]+\/index.html/,selector:"div.static_favourite_species p.customise-species-list",event:"click",category:"PageLink",action:"SaveFavourites",label:function(){return this.getText()}},{id:"HomepageLink-FullListSpeciesLink",url:/^http:\/\/[^\/]+\/index.html/,selector:"div.static_all_species > p > a, div.trackhub-ad a, p.othersites a, ._grch37_info_box a",event:"click",category:"PageLink",action:function(){return this.getURL()},label:function(){return this.getText()}},{id:"SpeciesTab",url:/.+/,selector:"#masthead div.dropdown.species a",event:"click",category:"SpeciesTab",action:function(){return this.getURL()}},{id:"MastheadLink",url:/.+/,selector:"#masthead div.logo_holder a, #masthead div.tools_holder ul.tools a",event:"click",category:"MastheadLink",action:function(){return this.getURL()},label:function(){return this.getText()||"LogoClick"}},{id:"AccountsLink",url:/.+/,selector:"._accounts_dropdown a, a._accounts_no_user",wrapper:"#masthead ._account_holder",event:"click",category:"AccountsLink",action:function(){return this.getURL()}},{id:"DynamicPageLink",url:/.+/,selector:"div.summary_panel a.dynamic-link",event:"click",data:{url:function(){return this.getURL()}},category:"DynamicPageLink",action:function(){return this.data.url},label:function(){return this.getText().replace(/\d|:|,|-/g,"").replace(/^(\s+)|(\s+)$/,"")}},{id:"LocalContext-LeftButton",url:/.+/,selector:".local_context a, .tool_buttons a",event:"click",data:{url:function(){return this.getURL()}},category:function(){return"LI"===this.currentTarget.parentNode.nodeName?"LocalContext":"LeftButton"},action:function(){return this.data.url.match("/Config/")?this.data.url.replace(/\/[^\/]+$/,""):this.data.url},label:function(){return"LI"===this.currentTarget.parentNode.nodeName?this.getText():""}},{id:"HelpHeader",url:/.+/,selector:"h1 a.help-header",event:"click",category:"HelpHeader",action:function(){return g(this.currentTarget).attr("href")},label:function(){return this.getText()}},{id:"ThumbnailIcon",url:/^http:\/\/[^\/]+\/index.html|\/Info\/Index/,selector:"#static .tool-box a, .homepage-icon a:has(img)",event:"click",category:"ThumbnailIcon",action:function(){return this.getURL()},label:function(){return this.getText()}},{id:"ThumbnailIconPlotGallery",url:/^http:\/\/[^\/]+\/index.html|\/Info\/Index/,selector:"#static ._plot_gallery_box a img",event:"click",category:"ThumbnailIcon",action:function(){return g(this.currentTarget.parentNode).attr("href")},label:function(){return g(this.currentTarget).closest("._plot_gallery_box").find("._title a").html()}},{id:"ThumbnailIconPlotGalleryLinks",url:/^http:\/\/[^\/]+\/index.html|\/Info\/Index/,selector:"#static ._plot_gallery_box p a",event:"click",category:"InPageButton",action:function(){return this.getURL()},label:function(){return this.getText()}},{id:"CarrouselIcon",url:/^http:\/\/[^\/]+\/index.html/,selector:"a.bx-prev, a.bx-next, a.bx-stop, a.bx-start, a.bx-pager-link",event:"click",category:"CarrouselIcon",action:function(){return this.getText().replace(/\d/,"")||"Pager"}},{id:"CarrouselLink",url:/^http:\/\/[^\/]+\/index.html/,selector:"ul.bxslider a",event:"click",category:"CarrouselLink",action:function(){return this.getURL()},label:function(){return this.getText()}},{id:"HomepageLink-WhatsNew",url:/^http:\/\/[^\/]+\/index.html/,selector:"div.whats-new a",event:"click",category:"PageLink",action:function(){return this.currentTarget.hostname===F.location.hostname?"NewsLink":"BlogLink"},label:function(){return this.getText()}},{id:"HomepageLink-ProjectLinks",url:/.+/,selector:"div.footer-ack a",event:"click",category:"PageLink",action:function(){return this.getURL()},label:function(){return this.getText()||g(this.currentTarget).find("img").attr("alt")+
" (logo)"}},{id:"FooterLink",url:/.+/,selector:"div#footer a, div#wide-footer a",event:"click",category:"PageLink",action:function(){return this.getURL()},label:function(){return this.getText()}},{id:"InfoPageLink",url:/^http:\/\/[^\/]+\/info\//,selector:"div#content a",event:"click",category:"PageLink",action:function(){return this.getURL()},label:function(){return(this.getText()||"[No text]")+(this.action.match(/\/Help\/(Movie|View)/)?" - "+(this.currentTarget.href.match(/id=([0-9]+)/)||[""]).pop():"")}},{id:"ImageToolbar-Button",url:/.+/,selector:".image_toolbar a:not(.popup)",wrapper:".ajax.initial_panel",event:"click",data:{panelId:function(){return g(this.currentTarget).closest(".js_panel").prop("id")}},category:"ImageToolbar",action:function(){return this.currentTarget.className.match(/mr-reset/)?this.data.panelId+"-MarkingOnOff":this.getURL().replace(this.data.panelId,"").replace(/\/$/,"")},label:function(){return this.getURL(F.location.href)}},{id:"ImageToolbar-ResizeMenu",url:/.+/,selector:">div.image_resize_menu a",wrapper:"body",event:"mousedown",category:"ImageToolbar",action:function(){return"/Resize/"+this.getURL().split("/")[1]+"/"+this.getText().replace(" ","")},label:function(){return g(this.currentTarget).closest(".image_resize_menu").attr("rel")}},{id:"ImageToolbar-SwitchGenoverse",url:"Location/View",event:"ajax",ajaxUrl:"/Genoverse/switch_image",category:"ImageToolbar",action:"/Genoverse/switch_image",label:"ViewTop"},{id:"ImageToolbar-ShareButton",url:/.+/,event:"ajax",ajaxUrl:/\/Share\/.+share_type=image/,category:"ImageToolbar",data:{url:function(){return this.getURL()}},action:function(){return this.data.url.replace(/\/[^\/]+$/,"")},label:function(){return this.data.url.split("/").pop()}},{id:"SpeciesTree-Button",url:/.+/,selector:".toolbar_menu div:not(.header)",wrapper:".js_panel",event:"click",category:"ImageToolbar",action:function(){return"SpeciesTree/"+this.currentTarget.parentNode.className.replace("toolbar_menu ","").replace("_menu","")},label:function(){return this.getText()}},{id:"TrackMenu-Open",url:/.+/,selector:"._label_layer",wrapper:".ajax.initial_panel",event:"click",category:"TrackMenu-Open",action:function(){var b,c=g(this.currentTarget).closest(".js_panel").attr("id");g(g(this.currentTarget).children(".hover_label")).attr("class").split(/\s+/).map(function(f){(f=f.match(/^_track_(.*)/))&&(b=f[1])});return"block"===g(this.currentTarget).children(".hover_label").css("display")?c+"-"+b:""},label:function(){return this.getURL(F.location.href)}},{id:"TrackMenu-HighlightIcon-Click",url:/.+/,selector:"._label_layer .hover_label .hl-buttons a.hl-icon-highlight",wrapper:".ajax.initial_panel",event:"mousedown",category:"TrackMenu-HighlightIcon-Click",action:function(){return g(this.currentTarget).closest(".js_panel").attr("id")+"-"+g(this.currentTarget).data("highlight-track")},label:function(){return this.getURL(F.location.href)}},{id:"TrackMenu-Close",url:/.+/,selector:"._label_layer .hover_label .close",wrapper:".ajax.initial_panel",event:"mousedown",category:"TrackMenu-Close",action:function(){return g(this.currentTarget).closest(".js_panel").attr("id")+
"-"+g(this.currentTarget).siblings(".hl-buttons").find(".hl-icon-highlight").data("highlight-track")},label:function(){return this.getURL(F.location.href)}},{id:"MarkedBox",url:/.+/,selector:".mrselector .mrselector-close",wrapper:".ajax.initial_panel",event:"mouseup",category:"MarkedBox",action:function(){return g(this.currentTarget).closest(".js_panel").attr("id")+"-MarkingOnOff"},label:function(){return this.getURL(F.location.href)}},{id:"TranscriptTableLink",url:/.+/,selector:".transcripts_table a",wrapper:".panel.js_panel",event:"click",category:"TranscriptTableLink",action:function(){return this.getURL()},label:function(){return this.getURL(F.location.href)}},{id:"ExonTableLink",url:/.+/,selector:"#ExonsSpreadsheet table a",wrapper:".ajax.initial_panel",event:"click",category:"ExonTableLink",action:function(){return this.getURL()},label:function(){return this.getURL(F.location.href)}},{id:"LocalButton",url:/\/(Sequence|Exon|Compara_Alignments)/,selector:"div.component-tools > a",wrapper:".ajax.initial_panel",event:"click",category:"LocalButton",action:function(){return this.getURL()}},{id:"DisplayFullAlignment",url:/\/Compara_Alignments/,selector:"div.display_full_message_div > a",wrapper:".ajax.initial_panel",event:"click",category:"DisplayFullAlignmentLink",action:function(){return this.getURL(F.location.href)},label:function(){return"Hide full alignment"===this.getText()?"Show":"Hide"}},{id:"SiteGalleryNav",url:/\/Info\/[Gene|Location|Variation]+Gallery/,selector:".gallery-nav a",event:"click",category:"ThumbnailIcon",action:function(){return this.getURL()},label:function(){return this.getText()}},{id:"SiteGalleryUpdateButton",url:/\/Info\/[Gene|Location|Variation]+Gallery/,selector:"form.gallery-header .fbutton",event:"click",category:"UpdateButton",action:function(){return this.getURL(F.location.href).match(/\/Info\/(.*Gallery)/)[1]},label:function(){var b=g(this.currentTarget).siblings("input").attr("id");b=g(this.currentTarget).closest("div.form-field").find('label[for="'+b+'"]');return g(b).html().split("displays")[0].replace(/&amp;/g,"&")||""}},{id:"SiteGallery-Preview-ThumbnailImage",url:/\/Info\/[Gene|Location|Variation]+Gallery/,selector:".gallery-preview .page-preview a",event:"click",category:"ThumbnailImage",action:function(){return this.getURL()},label:function(){return g(this.currentTarget.closest("div.page-preview")).siblings("._title").html()}},{id:"SiteGallery-Preview-PageLink",url:/\/Info\/[Gene|Location|Variation]+Gallery/,selector:".gallery-preview p.button a",event:"click",category:"InPageButton",action:function(){return this.getURL()},label:function(){return this.getText()}},{id:"SiteGallery-Preview-FormSubmit",url:/\/Info\/[Gene|Location|Variation]+Gallery/,selector:".gallery-preview form",event:"submit",category:"FormSubmit",action:function(){return this.getURL(g(this.currentTarget).attr("action"))},label:function(){return g(this.currentTarget.closest("div.gallery-preview")).find(".page-preview ").siblings("._title").html()}},{id:"DisplayFullAlignment",url:/\/Compara_Alignments/,selector:"div.display_full_message_div > a",wrapper:".ajax.initial_panel",event:"click",category:"DisplayFullAlignmentLink",action:function(){return this.getURL(F.location.href)},label:function(){return"Hide full alignment"===this.getText()?"Show":"Hide"}},{id:"TabLink",url:/.+/,selector:"#masthead ul.tabs li a:not(.toggle)",event:"click",category:"TabLink",action:function(){return this.getURL()}},{id:"TabHistory",url:/.+/,selector:"#masthead div.dropdown:not(.species) ul li a",event:"click",category:"TabHistory",action:function(){return this.getURL()},label:function(){return this.getText(g(this.currentTarget).closest("div.dropdown").find(">h4"))}},{id:"NavBar-Inputs",url:"Location/View",selector:".navbar form._nav_loc, .navbar form._nav_gene",wrapper:".ajax.initial_panel",event:"submit",category:"NavBar",action:function(){return this.currentTarget.className.match(/_nav_loc/)?"LocationSubmit":"GeneSubmit"}},{id:"NavBar-Slider",url:"Location/View",selector:".navbar .image_nav a",wrapper:".ajax.initial_panel",event:"mousedown",category:"NavBar",action:function(){return this.currentTarget.className.match("slider")?"slider":this.currentTarget.className.replace(/constant|disabled/g,"").trim()}},{id:"NavBar-ExploreIcon",url:"Gene/Summary",selector:".navbar a",wrapper:".panel.js_panel",event:"click",category:"ExploreIcon",action:function(){return this.getURL()}},{id:"NavBar-Link",url:"Gene/Summary",selector:".navbar a.no-visit",wrapper:".panel.js_panel",event:"click",category:"NavLink",action:function(){return this.getURL()},label:function(){return this.getText()}},{id:"ExploreIcon",url:/(Variation\/Explore|Gene\/Compara[^_]+|Location\/Compara[^_]+|Regulation)/,selector:".portal a",event:"click",category:"ExploreIcon",action:function(){return this.getURL()},label:function(b){return"SPAN"===b.target.nodeName?"count":"image"}},{id:"ZMenuOpen",url:/.+/,event:"ajax",ajaxUrl:/\/[^\/]+\/ZMenu\//,category:"ZMenuOpen",action:function(){return this.getURL()},label:function(){if(this.action.match("TextSequence"))return"text_sequence";var b=this.currentOptions.url.match(/(\?|;)config=([^;]+)/);return b?b.pop():this.action.match("/Label")?(decodeURIComponent(this.currentOptions.url).match(/"image_config"\s*:\s*"([^"]+)"/)||[""]).pop():F.location.href.match("Tools/VEP/Results")&&this.action.match(/\/ZMenu\/(Gene|Transcript)/)?"vep_results_table":""}},{id:"ZMenuLink",url:/.+/,event:"mouseup",selector:"div.zmenu_holder .info_popup a",wrapper:"body",category:"ZMenuLink",action:function(){return this.currentTarget.className.match(/_location_mark|_action_mark/)?"MarkingOnOff":this.currentTarget.className.match(/_location_change/)?"JumpToRegion":this.getURL()},label:function(){return this.getURL(u.PanelManager.panels[g(this.currentTarget).closest(".zmenu_holder").prop("id")].href)}},{id:"SearchInput-Inputs",url:/.+/,selector:".search_holder form, .search-form",event:"submit",category:"SearchInput",action:function(){return this.currentTarget.className.match("search-form")?F.location.href.match("index.html")?"HomepageSearch":"SpeciesPageSearch":"TopRightSearch"},label:function(){return g(this.currentTarget).find('input[name="q"]').val()||""}},{id:"SearchInput-SearchPageSearch",url:"/Search/Results",event:"ajax",ajaxUrl:"/Ajax/psychic",category:"SearchInput",action:"SearchPageSearch",label:function(){return this.currentOptions.data.q?this.currentOptions.data.q:""}},{id:"SearchInput-ExampleLink",url:/^http:\/\/[^\/]+\/index.html|\/Info\/Index/,event:"click",selector:"#SpeciesSearch .search-example a",category:"SearchInput",action:"ExampleLink",label:function(){return F.location.pathname.match(/Info/)?"SpeciesPage":"HomePage"}},{id:"SearchInput-Species",url:/.+/,selector:".search-form select#species",event:"change",category:"SearchInputSpecies",action:"HomepageSearch",label:function(){return g(this.currentTarget).val()||""}},{id:"InpageConfig",url:/\/(Variation_Gene\/Table|Variation_Transcript\/Table|ProtVariations)/,event:"click",selector:"li.prec_pri",wrapper:"div.initial_panel",category:function(b){return b.target.offsetParent&&b.target.offsetParent.className.match(/prec_pri/)?"InpageConfig":""},action:function(){return g(this.currentTarget).find("div[class*='newtable_filtertype']").not(":hidden").length?"Close":"Open"},label:function(){return g(this.currentTarget).find("div:nth-of-type(2) span").html()+": "+
g(this.currentTarget).find("div:nth-of-type(2) span:nth-of-type(2)").html()}},{id:"InpageConfigSelector",url:/\/(Variation_Gene\/Table|Variation_Transcript\/Table|ProtVariations)/,event:"click",selector:"div.baked, div.use_cols li, div.newtable_filtertype_more",wrapper:"div.initial_panel",category:"InpageConfigSelector",action:function(b){if(this.currentTarget.className.match("baked"))return g(this.currentTarget).find("li.disabled").html();if(g(this.currentTarget).parents()[1].className.match("use_cols"))return b=g(this.currentTarget).attr("class")?g(this.currentTarget).attr("class"):"off",(g(this.currentTarget).find("div.coltab-text").length?g(this.currentTarget).find("div.coltab-text").text():g(this.currentTarget).find("div.main").text())+": "+b;if(this.currentTarget.className.match("newtable_filtertype_more"))return"Filter Other Columns"},label:function(){return g(this.currentTarget).parentsUntil("div.m").find("div.title").last().text()}},{id:"InpageConfigApply",url:/\/(Variation_Gene\/Table|Variation_Transcript\/Table|ProtVariations)/,event:"click",selector:"li.apply, li.cancel",wrapper:"div.initial_panel",category:function(){return this.currentTarget.className.match("cancel")?"InpageConfigCancel":"InpageConfigApply"},action:function(){if(this.currentTarget.className.match("cancel"))return"cancel";if(!g(this.currentTarget).hasClass("unchanged")&&g(this.currentTarget).parentsUntil("div.m").find("div.newtable_range").length)return g(this.currentTarget).parentsUntil("div.m").find("div.slider_feedback").html();if(!g(this.currentTarget).hasClass("unchanged")&&g(this.currentTarget).parentsUntil("div.m").find("ul.bakery li.disabled").length)return g(this.currentTarget).parentsUntil("div.m").find("ul.bakery li.disabled").html();if(!g(this.currentTarget).hasClass("unchanged")){var b="";(g(this.currentTarget).parentsUntil("div.m").find("div.use_cols li.on div.coltab-text").length?g(this.currentTarget).parentsUntil("div.m").find("div.use_cols li.on div.coltab-text"):g(this.currentTarget).parentsUntil("div.m").find("div.use_cols li.on div.main")).each(function(){g(this).html()&&(b+=g(this).text()+",")});return b.slice(0,-1)}},label:function(){return g(this.currentTarget).parentsUntil("div.m").find("div.title").html()}},{id:"SpeciesSelectorLink",url:/.+/,event:"click",selector:"a._species_selector",wrapper:".panel.js_panel",data:{url:function(){return this.getURL(F.location.href)}},category:"SpeciesSelectorLink",action:function(){return this.data.url}},{id:"VariationTableLink",url:/\/(Variation_Gene\/Table|Variation_Transcript\/Table|ProtVariations)/,event:"click",wrapper:".ajax.initial_panel",selector:"#VariationTable td a, #ProteinVariations td a",category:function(){return F.location.pathname.match(/Variation_Gene/)?"GeneVariationTableLink":F.location.pathname.match(/Variation_Transcript/)?"TranscriptVariationTableLink":F.location.pathname.match(/ProtVariations/)?"ProteinVariationTableLink":"VariationTable"},action:function(){return this.getURL()},label:function(){return g(this.currentTarget).text()}},{id:"RunVEPButton",event:"click",wrapper:".ajax.initial_panel",selector:"input.run_button",category:"Run Button",action:"VEP",label:"Run VEP Button"},{id:"RunInstantVEPButton",event:"mouseup",wrapper:".ajax.initial_panel",selector:"input.quick-vep-button",category:"Run Button",action:"InstantVEP",label:"Run Instant VEP Button"});u.extend({initialize:function(){u.GA.logAjaxLoadTimes&&(this.ajaxLoadTimerConfig=new u.GA.EventConfig({category:"AjaxLoadTimer",action:function(){return this.getURL()},nonInteraction:!0,value:function(){return(new Date).getTime()-this.currentOptions._ensGA_StartTime}}),g.ajaxPrefilter(function(b,c,f){b._ensGA_StartTime=(new Date).getTime()}),g(L).ajaxComplete(function(b,c,f){f._ensGA_StartTime&&!f.url.match(/\.js(\?|$)/)&&u.GA.sendEvent(u.ajaxLoadTimerConfig,{currentOptions:f})}));this.base.apply(this,arguments)}});u.extend({initialize:function(){u.GA.reportErrors&&(this.reportErrorConfig=new u.GA.EventConfig({category:"ErrorReport",label:function(){return this.getURL(F.location.href)},nonInteraction:!0}));g(L).ajaxComplete(function(b,c,f){u.GA.reportErrors&&!f.url.match(/\.js(\?|$)/)&&g(L).find("div.ajax.initial_panel").each(function(){g(this).text().match(/Ajax error/i)&&u.GA.sendEvent(u.reportErrorConfig,{action:"Ajax Error"})})});this.base.apply(this,arguments)}});u.LayoutManager.extend({makeZMenu:function(b,c){if(F.location.href.match(/Transcript\/ProteinSummary/)&&!c.area.a.attrs.href&&c.area.a.attrs.title&&c.imageId){this.nonAjaxZmenuGAEvent||(this.nonAjaxZmenuGAEvent=new u.GA.EventConfig({category:"ZMenuOpen"}));var f=c.area.a.attrs.title.split(/;/)[0].split(/:/)[0],h=f?g("#"+c.imageId).find("input.image_config").val():"";f&&h&&u.GA.sendEvent(this.nonAjaxZmenuGAEvent,{action:f,label:h})}return this.base(b,c)}});u.Panel.ImageMap=u.Panel.ImageMap.extend({initHoverLabels:function(){this.base.apply(this,arguments);u.GA.registerConfigs([{selector:this.elLk.hoverLabels.find("a.config"),event:"click",data:{id:this.id,type:function(){return this.currentTarget.className.match(/closetrack|favourite/)?this.currentTarget.className.match(/closetrack/)?"off":"favourite":this.currentTarget.parentNode.className.replace(/\s*current\s*/,"")}},category:function(){return"favourite"!==this.data.type?this.currentTarget.className.match(/closetrack/)?"Image-TrackOff":"Image-TrackStyle":"Image-TrackFav"},action:function(){var b=this.currentTarget.href.match(new RegExp("([^;&]+)="+this.data.type));return b?this.data.id+"-"+b[1]:!1},label:function(){return"favourite"===this.data.type?this.currentTarget.className.match(/selected/)?"On":"Off":this.data.type}},{wrapper:this.elLk.hoverLabels.find("div._hl_tab:not(.config)"),selector:"a:not(.config)",event:"click",category:"Image-TrackDescLink",data:{id:this.id},action:function(){return this.data.id+"-"+g(this.currentTarget).closest(".hover_label").attr("class").replace(/hover_label|floating_popup/g,"").replace(/(^|\s+)[a-z0-9]{8}(\s+|$)/i,"")},label:function(){return this.getURL()}}])},navClick:function(b,c){this.navClickEventConfig||(this.navClickEventConfig=new u.GA.EventConfig({category:"ComparisonNavClick",action:function(){return this.areaAttrs.alt},label:function(){var f=parseInt((this.areaAttrs.href.match(/;id=([0-9]+)/)||[]).pop()||0);return f?"Secondary species - "+f:"Primary species"},nonInteraction:!0}));u.GA.sendEvent(this.navClickEventConfig,{areaAttrs:b.a.attrs},c);this.base(b,c)}});u.Panel.ModalContainer=u.Panel.ModalContainer.extend({init:function(){this.base.apply(this,arguments);u.GA.registerConfigs([{selector:this.elLk.tabs.children("a"),event:"click",category:"Modal-TabLink",data:{url:function(){return this.getURL()}},action:function(){return this.data.url.match(/\/Config\//)?this.data.url.replace(/\/[^\/]+$/,""):this.data.url},label:function(){return this.data.url.match(/\/Config\//)?this.data.url.split("/").pop():""}}])}});u.Panel.Exporter=u.Panel.Exporter.extend({init:function(){this.base.apply(this,arguments);u.GA.registerConfigs([{selector:this.el.find("#export_configuration"),event:"submit",category:"Exporter",action:"Export/Configure",label:function(){return g(this.currentTarget).find("select[name=output]").val()}}])}});u.Panel.ModalContent=u.Panel.ModalContent.extend({init:function(){this.base.apply(this,arguments);u.GA.registerConfigs([{selector:this.elLk.links.add(this.elLk.links.children("a")),event:"click",data:{link:function(){return g(this.currentTarget.childNodes).add(this.currentTarget).filter("a")}},category:function(b){return b.originalEvent?"Modal-LocalContext":!1},action:function(){return this.getURL(this.data.link[0])},label:function(){return this.data.link.html()}}]);this.textAlignmentEvent||(this.textAlignmentEvent={format:new u.GA.EventConfig({category:"TextAlignment-DownloadFormat",nonInteraction:!0}),compression:new u.GA.EventConfig({category:"TextAlignment-Compression",nonInteraction:!0})})},formSubmit:function(b,c){this.base(b,c);if(g(b).attr("action").match(/DataExport\/Output/)){var f={};b.serializeArray().forEach(function(h){f[h.name]=h.value});f.export_action&&"TextAlignments"==f.export_action&&"preview"!==f.compression&&(u.GA.sendEvent(this.textAlignmentEvent.format,{action:f.component,label:f.format}),u.GA.sendEvent(this.textAlignmentEvent.compression,{action:f.component,label:f.compression}))}return!1},updateContent:function(b){this.base(b);u.GA.registerConfigs([{selector:this.el.find('#DataExport_Results .export_buttons_div input[name="uncompressed"]'),event:"click",category:"TextAlignment-DownloadFormat",data:{format:this.getParam("format",this.el.find('input[name="uncompressed"]:hidden').val())},action:function(){return"Compara_Alignments"},label:function(){return this.data.format}},{selector:this.el.find('#DataExport_Results .export_buttons_div input[name="uncompressed"]'),event:"click",category:"TextAlignment-Compression",data:{compression:this.getParam("compression",this.el.find('input[name="uncompressed"]:hidden').val())},action:function(){return"Compara_Alignments"},label:function(){return this.data.compression||"uncompressed"}}])},getParam:function(b,c){c=(c||"").replace(/;/g,"&");return(b=(new RegExp("[?&]"+b+"=([^&#]*)","i")).exec(c))?b[1]:null}});u.Panel.SiteGalleryHome=u.Panel.SiteGalleryHome.extend({init:function(){var b=this;this.base.apply(this,arguments);this.siteGalleryEvent||(this.siteGalleryEvent={species:new u.GA.EventConfig({category:"Species",nonInteraction:!0}),datatype:new u.GA.EventConfig({category:"Datatype",nonInteraction:!0})});this.elLk.form.on("submit",{panel:this},function(){u.GA.sendEvent(b.siteGalleryEvent.species,{action:b.elLk.species.val()||""});u.GA.sendEvent(b.siteGalleryEvent.datatype,{action:b.elLk.dataType.filter(":checked").val()||""})})}});u.Panel.Configurator=u.Panel.Configurator.extend({init:function(){this.base.apply(this,arguments);u.GA.registerConfigs([{selector:this.elLk.links.add(this.elLk.links.children("a")),event:"click",data:{component:this.component,link:function(){return g(this.currentTarget.childNodes).add(this.currentTarget).filter("a")}},category:function(b){return b.originalEvent?"Config-LocalContext":!1},action:function(){return this.data.component+"-"+this.data.link.attr("class")},label:function(){return this.data.link.html()}},{selector:this.el.find(".tool_buttons p a"),event:"click",category:"Config-LeftButton",data:{component:this.component},action:function(){var b=this.currentTarget.href.match(/reset=([^;&]+)/);return b?"track_order"===b[1]?"/Ajax/order_reset":"/Ajax/config_reset":this.getURL()},label:function(){return this.data.component}},{selector:".config_header",wrapper:this.elLk.configDivs.not(".view_config"),event:"click",data:{component:this.component},category:"Config-HeaderLink",action:function(){return this.data.component+"-"+this.currentTarget.parentNode.className.replace(/\s*config\s*/,"")},label:function(){return this.currentTarget.innerHTML}},{selector:this.elLk.viewConfigInputs,event:"change",data:{component:this.component},category:"Config-ViewConfig",action:function(){return this.data.component+"-"+this.currentTarget.name},label:function(){return"checkbox"===this.currentTarget.type?this.currentTarget.checked?"true":"false":this.currentTarget.value}},{selector:this.elLk.search,event:"blur",data:{component:this.component},category:"Config-Search",action:function(){return this.currentTarget.value===this.currentTarget.defaultValue?!1:this.data.component},label:function(){return this.currentTarget.value}},{selector:"a",wrapper:this.elLk.imageConfigExtras,event:"click",data:{component:this.component},category:"Config-TextLink",action:function(){return this.data.component},label:function(){return this.getURL()}},{selector:"div.select_all li:not(.header)",wrapper:this.elLk.configDivs.not(".view_config"),event:"click",data:{component:this.component},category:"Config-TrackStyleAll",action:function(){var b=g(this.currentTarget).closest(".subset")[0],c=b.className.replace(/\s*(subset|first)\s*/g,"");return this.data.component+"-"+b.parentNode.className.replace(/\s*config\s*/,"")+(c?"-"+c:"")},label:function(){return this.currentTarget.className}},{selector:".favourite, .menu_help, .popup_menu li:not(.header), .desc a",wrapper:this.elLk.configDivs.not(".view_config"),event:"click",data:{component:this.component,data:function(){var b=g(this.currentTarget).closest("li.track").data();if(!b)return{};var c=this.currentTarget.className;c="A"!==this.currentTarget.nodeName?c.match(/favourite|menu_help/)?c.match(/favourite/)?{category:"Config-TrackFav",label:b.track.fav?"On":"Off"}:{category:"Config-InfoIcon",label:c.match(/open/)?"Open":"Close"}:{category:"Config-TrackStyle",label:b.track.renderer}:{category:"Config-TrackDescLink",label:this.getURL()};c.action=this.data.component+"-"+b.track.id;return c}},category:function(){return this.data.data.category},action:function(){return this.data.data.action},label:function(){return this.data.data.label}},{selector:this.elLk.configSelector,event:"change",data:{component:this.component},category:"SaveConfig",action:function(){return this.data.component},label:"Select DropDown"},{selector:"a",wrapper:this.elLk.configDropdown,event:"click",category:"SaveConfig",action:this.component,label:function(){return this.currentTarget.innerHTML}},{id:"SaveConfigSubmit",url:/.+/,event:"ajax",ajaxUrl:"/save_config",category:"SaveConfig",action:this.component,label:"Save-Ajax"}])},updatePage:function(b,c){var f=this;this.base(b,c);this.configAppliedEventConfig||(this.configAppliedEventConfig={trackStyle:new u.GA.EventConfig({category:"Config-Applied-TrackStyle",nonInteraction:!0}),trackFav:new u.GA.EventConfig({category:"Config-Applied-TrackFav",nonInteraction:!0})});b=g.parseJSON(b.image_config);g.each(b,function(h,k){"renderer"in k&&u.GA.sendEvent(f.configAppliedEventConfig.trackStyle,{action:f.component+"-"+h,label:k.renderer});"favourite"in k&&u.GA.sendEvent(f.configAppliedEventConfig.trackFav,{action:f.component+"-"+h,label:k.favourite?"On":"Off"})})}});u.Panel.ImageExport=u.Panel.ImageExport.extend({init:function(){var b=this;this.base.apply(this,arguments);this.configAppliedEventConfig||(this.configAppliedEventConfig={format:new u.GA.EventConfig({category:"ImageExportFormat",nonInteraction:!0}),custom:new u.GA.EventConfig({category:"ImageExportCustom",nonInteraction:!0})});this.elLk.form.submit(function(){if("custom"!==g('input[name="format"]:checked').val()){var c=g('input[name="format"]:checked',b.elLk.form).val()||"";""!==c&&u.GA.sendEvent(b.configAppliedEventConfig.format,{action:"format",label:c})}else{c=g('select[name="image_format"] option:selected',b.elLk.form).val()||"";if(""!==c)u.GA.sendEvent(b.configAppliedEventConfig.format,{action:"format",label:c});else return!1;var f=g('input[name="contrast"]',b.elLk.form).is(":checked");u.GA.sendEvent(b.configAppliedEventConfig.custom,{action:"contrast",label:f});"png"===c&&(c=g('select[name="resize"] option:selected',b.elLk.form).val(),f=g('select[name="scale"]  option:selected',b.elLk.form).val(),u.GA.sendEvent(b.configAppliedEventConfig.custom,{action:"resize",label:c}),u.GA.sendEvent(b.configAppliedEventConfig.custom,{action:"scale",label:f}))}return!1})}});u.DataTable.orig_DataTableInit=u.DataTable.dataTableInit;u.DataTable.dataTableInit=function(){u.DataTable.orig_DataTableInit.apply(this,arguments);u.GA.registerConfigs([{selector:this.el.find(".dataTables_export a"),event:"click",category:"TableIcon",action:function(){return g(this.currentTarget).closest(".dataTables_top").parent().find("table.data_table").prop("id")||"MissingTableID"},label:function(){return this.currentTarget.innerHTML.match(/whole/)?"whole":"see"}}])};u.Panel.CellTypeSelector=u.Panel.CellTypeSelector.extend({init:function(){var b=this;this.base.apply(this,arguments);u.GA.registerConfigs([{selector:this.elLk.content.find(".cloud_multi_selector_list li"),event:"click",category:"Config-CellTypeSelector",action:function(){return b.params.image_config+"-"+g(this.currentTarget).data("key")},label:function(){return g(this.currentTarget).hasClass("off")?"off":"on"}},{selector:g(".cloud_filter .cloud_all_none span",this.el),event:"click",category:"Config-CellTypeSelector",action:function(){return b.params.image_config+"-All"},label:function(){return g(this.currentTarget).hasClass("all")?"on":"off"}}]);this.configAppliedEventConfig={selection:new u.GA.EventConfig({category:"ConfigApplied-CellTypeSelector",nonInteraction:!0})}},updateSelection:function(){var b=this;this.base.apply(this,arguments);var c=b.params.image_config+"-All";this.changed&&(this.userInteraction&&"all-on"==this.userInteraction?u.GA.sendEvent(b.configAppliedEventConfig.selection,{action:c,label:"on"}):this.userInteraction&&"all-off"==this.userInteraction?u.GA.sendEvent(b.configAppliedEventConfig.selection,{action:c,label:"off"}):["off","on"].forEach(function(f){g.each(b["changed_"+f],function(h,k){u.GA.sendEvent(b.configAppliedEventConfig.selection,{action:c+"-"+k,label:f})})}))}});u.Panel.EvidenceSelector=u.Panel.EvidenceSelector.extend({init:function(){var b=this;this.base.apply(this,arguments);u.GA.registerConfigs([{selector:this.elLk.content.find(".cloud_multi_selector_list li"),event:"click",category:"Config-EvidenceSelector",action:function(){return b.params.image_config+"-"+g(this.currentTarget).data("key")},label:function(){return g(this.currentTarget).hasClass("off")?"off":"on"}},{selector:g(".cloud_filter .cloud_all_none span",this.el),event:"click",category:"Config-EvidenceSelector",action:function(){return b.params.image_config+"-All"},label:function(){return g(this.currentTarget).hasClass("all")?"on":"off"}}]);this.configAppliedEventConfig={selection:new u.GA.EventConfig({category:"ConfigApplied-EvidenceSelector",nonInteraction:!0})}},updateSelection:function(){var b=this;this.base.apply(this,arguments);var c=b.params.image_config+"-All";this.changed&&(this.userInteraction&&"all-on"==this.userInteraction?u.GA.sendEvent(b.configAppliedEventConfig.selection,{action:c,label:"on"}):this.userInteraction&&"all-off"==this.userInteraction?u.GA.sendEvent(b.configAppliedEventConfig.selection,{action:c,label:"off"}):["off","on"].forEach(function(f){g.each(b["changed_"+f],function(h,k){u.GA.sendEvent(b.configAppliedEventConfig.selection,{action:c+"-"+k,label:f})})}))}});u.Panel.ConfigMatrix=u.Panel.ConfigMatrix.extend({init:function(){var b=this;this.base.apply(this,arguments);u.GA.registerConfigs([{selector:"select.filter",wrapper:this.elLk.filterWrapper,event:"change",category:"ConfigMatrix-Filter",action:function(){return b.id+"-Dropdown"},label:function(){return g("option:selected",this.currentTarget).val()}},{selector:"input.filter",wrapper:this.elLk.filterWrapper,event:"blur",category:"ConfigMatrix-Filter",action:function(){return b.id+"-FilterInputBox"},label:function(){return g(this.currentTarget).val()}},{selector:"div.select_all_column input",wrapper:this.elLk.columnHeaders,event:"click",category:"Config-ConfigMatrix-SelectAllColumn",action:function(){return b.id+"-"+this.currentTarget.name},label:function(){return g(this.currentTarget).attr("class")}},{selector:"th.first .select_all_row",wrapper:this.elLk.rows,event:"click",category:"Config-ConfigMatrix-SelectAllRow",action:function(){return b.id+"-"+g(this.currentTarget).closest("th.first").parent().prop("classList")[0]},label:function(){return g(this.currentTarget).find("input").prop("checked")}},{selector:g("li",this.elLk.configMenus[0]),event:"click",category:"Config-ConfigMatrix-TrackStyleAll",action:function(){return b.id},label:function(){return this.currentTarget.className}}]);this.eventConfig={config:new u.GA.EventConfig({category:"Config-ConfigMatrix",nonInteraction:!0})}},dragStop:function(){this.dragCell.length&&u.GA.sendEvent(this.eventConfig.config,{action:"drag"});this.base.apply(this,arguments)}});u.Panel.MultiSpeciesSelector=u.Panel.MultiSpeciesSelector.extend({init:function(){this.base.apply(this,arguments)},updateSelection:function(b,c){var f=this;this.base();this.configAppliedEventConfig||(this.configAppliedEventConfig={selectSpecies:new u.GA.EventConfig({category:"SelectSpecies",nonInteraction:!0})});this.selection.join(",")!==this.initialSelection&&g(this.selection).each(function(h,k){u.GA.sendEvent(f.configAppliedEventConfig.selectSpecies,{action:f.panelType,label:k})})}});u.Panel.TextSequence=u.Panel.TextSequence.extend({init:function(){this.base.apply(this,arguments);u.GA.registerConfigs([{selector:g(this.el).parent().prev("div.info").find("div.view_full_text_seq a"),event:"click",category:"FullTextAlignment",action:function(){return this.getURL(F.location.href)}}])}});u.Panel.TaxonSelector=u.Panel.TaxonSelector.extend({init:function(){var b=this;this.base.apply(this,arguments);u.GA.registerConfigs([{selector:this.elLk.finder,event:"click",category:"SpeciesSelect-Search",data:{url:function(){return this.getURL(F.location.href)}},action:function(){return this.data.url},label:function(){return this.data.url}},{selector:g("button",this.elLk.buttons),event:"click",category:"SpeciesSelect-ButtonCLick",data:{url:function(){return this.getURL(F.location.href)}},action:function(){return g(this.currentTarget).attr("type")},label:function(){return this.data.url}},{selector:this.elLk.breadcrumbs,event:"click",category:"SpeciesSelect-Breadcrumbs",data:{url:function(){return this.getURL(F.location.href)}},action:function(){return g(this.currentTarget).children().last().text()},label:function(){return this.data.url}},{selector:this.elLk.divisions,event:"click",category:"SpeciesSelect-DivisionButton",data:{url:function(){return this.getURL(F.location.href)}},action:function(){return g(this.currentTarget).children(".active").length?g(this.currentTarget).children(".active").text():g("li.active",b.elLk.breadcrumbs).find("a").html()},label:function(){return this.data.url}}])},startSort:function(){var b=new u.GA.EventConfig({category:"SpeciesSelector-Sort",nonInteraction:!0});u.GA.sendEvent(b,{action:function(){return this.getURL(F.location.href)}})}});u.extend({initialize:function(){this.base.apply(this,arguments);this.setUserFlag()},setUserFlag:function(){this.hasOwnProperty("isLoggedInUser")||(this.isLoggedInUser=g("div._account_holder").hasClass("_logged_in"))}});u.Panel.Masthead=u.Panel.Masthead.extend({constructor:function(b){this.base(b);u.EventManager.register("refreshAccountsDropdown",this,this.refreshAccountsDropdown)},init:function(){this.base();this.elLk.accountHolder=this.el.find("div._account_holder");this.accountsBookmarkData=this.accountsRefreshURL="";this.refreshAccountsDropdown()},refreshAccountsDropdown:function(){var b=this;if(this.elLk.accountHolder.length&&!this.elLk.accountHolder.find("._accounts_no_user").length){var c=function(h){h.which&&1!==h.which||(b.toggleAccountsDropdown(!1),g(L).off("click",c))};if(!this.accountsRefreshURL){var f=this.elLk.accountHolder.find("form");this.accountsRefreshURL=f.attr("action");this.accountsBookmarkData=f.serialize()}g.ajax({url:this.accountsRefreshURL,context:this,data:this.accountsBookmarkData,type:"POST",success:function(h){this.elLk.accountHolder.html(h);this.elLk.accountLink=this.el.find("._accounts_link").on({click:function(k){k.preventDefault();g(this).hasClass("selected")||(k.stopPropagation(),b.toggleAccountsDropdown(!0),g(L).on("click",c))}});this.elLk.accountDropdown=this.el.find("._accounts_dropdown").on({click:function(k){"A"!==k.target.nodeName&&"A"!==k.target.parentNode.nodeName&&k.stopPropagation()}}).find("a").on("click",c).end();this.elLk.accountHolder.find("._accounts_no_userdb").helptip().on({click:function(k){k.preventDefault()}})},dataType:"html"})}},toggleAccountsDropdown:function(b){this.elLk.accountLink.toggleClass("selected",b);this.elLk.accountDropdown.toggle(b);b&&!this.elLk.accountDropdown.data("initiated")&&this.elLk.accountDropdown.data("initiated",!0).find("p").each(function(){var c=g(this),f=c.children("a").hide().end().append("<a>abc</a>").height();c.children("a").last().remove().end().show();c.height()>f&&c.addClass("acc-bookmark-overflow")})}});u.Panel.ModalContainer=u.Panel.ModalContainer.extend({hide:function(){this.base.apply(this,arguments);this.el&&this.el.find("._needs_refresh_on_hide").removeClass("_needs_refresh_on_hide").length&&u.EventManager.trigger("refreshAccountsDropdown")}});u.Panel.ModalContent=u.Panel.ModalContent.extend({initialize:function(){this.base();this.el.find("a._jconfirm").on("click",function(){var b=g(this);return!b.next().hasClass("_jconfirm")||F.confirm(b.next().html())});this.el.find("input._jcancel").on("click",function(b){(b=g(this.form).find("input[name=_jcancel]").val())&&u.EventManager.trigger("modalOpen",{href:b,rel:""})})},getContent:function(b,c){c.match(/\/Bookmark/)&&this.el.addClass("_needs_refresh_on_hide");return this.base(b,c)}});u.Panel.Consent=u.Panel.ModalContent.extend({init:function(){var b=this;this.base();this.elLk.noThanks=this.el.find("#consent_warning");this.elLk.message=this.el.find("#consent_message");this.elLk.noThanks.on({click:function(c){"submit"!=g(this).attr("type")&&(b.elLk.message.replaceWith('<div id="consent_warning_2"><p>If you do not accept our privacy policy, your account will be disabled and will be deleted after 30 days unless you contact us.</p><p>Are you sure you wish to do this?</div>'),g(this).val("Yes, disable my account"),g(this).attr("type","submit"),c.preventDefault())}})}});u.Panel.Register=u.Panel.ModalContent.extend({init:function(){var b=this;this.base();this.elLk.form=this.el.find("form#registration");this.elLk.button=this.el.find("#pre_consent");this.elLk.checkbox=this.el.find("#consent_checkbox");this.elLk.checkbox.on("click",function(c){b.elLk.button.hasClass("disabled")?b.elLk.button.removeClass("disabled"):b.elLk.button.addClass("disabled")});this.elLk.button.on("click",function(c){b.elLk.button.hasClass("disabled")||b.formSubmit(b.elLk.form)})}});u.Panel.AccountForm=u.Panel.extend({init:function(){var b=this;this.base();this.elLk.email=this.el.find("._openid_email");this.elLk.hideIfTuststed=this.el.find("._hide_if_trusted");this.elLk.passwordAuth=this.el.find("input._password_auth");this.elLk.passwordField=this.el.find("div._password_auth");this.elLk.changeEmailEls=this.el.find("._change_email");parseInt(this.el.find("._trusted_provider").val())&&(this.elLk.email.on({change:function(){b.toggleEmail()},click:function(){b.toggleEmail()},keyup:function(){b.toggleEmail()}}),this.toggleEmail());this.elLk.passwordAuth.parents("div").first().find("input").on({change:function(){b.togglePassword()}});this.togglePassword();this.initChangeEmail()},toggleEmail:function(){var b=this.elLk.email[0];this.elLk.hideIfTuststed.toggle(b.defaultValue!=b.value);this.togglePassword()},togglePassword:function(){this.elLk.passwordField.toggle(!(!this.elLk.passwordAuth.is(":visible")||!this.elLk.passwordAuth.attr("checked"))).find("input").focus()},initChangeEmail:function(){var b=this;this.elLk.changeEmailEls.filter("a").on({click:function(c){c.preventDefault();c=b.elLk.changeEmailEls.find("input")[0];c.value=c.defaultValue;b.elLk.changeEmailEls.toggleClass("hidden")}})}});u.Panel.Masthead=u.Panel.Masthead.extend({init:function(){this.base();this.elLk.toolsTabs=this.el.find(".tabs .tools");this.elLk.toolsDropdown=this.el.find(".dropdown.tools");this.recentJobs=g.makeArray(this.elLk.toolsDropdown.find("li a").map(function(b,c){return(c.href.match(/tl=([a-z0-9_\-]+)/i)||[]).pop()||null}));this.fetchURL="/"+(u.species||"Multi")+"/Ajax/tools_tab";this.elLk.toolsTabs.length&&this.fetchToolsTab()},fetchToolsTab:function(){g.ajax({url:this.fetchURL,context:this,data:{recent:this.recentJobs.join(","),tl:u.coreParams.tl||""},type:"POST",dataType:"JSON",success:function(b){this.populateToolsTab(b)}})},populateToolsTab:function(b){b.empty?this.elLk.toolsTabs.find("a:not(:first-child)").remove().end().find(".dropdown").removeClass("dropdown"):(this.elLk.toolsTabs.filter(":not(.final)").addClass("final").find("a:first-child").html(b.caption).attr("href",b.url),this.elLk.toolsDropdown.find("ul.recent").remove().end().find("h4").first().html("Recent jobs").after(g("<ul>").append(g.map(b.tools,function(c,f){return g("<li>").append(g("<a>").attr("href",c.url).html(c.caption)).append(g.map(c.jobs,function(h){return g("<a>").attr("href",h.url).html(h.caption).appendTo("<li>").parent().appendTo('<ul class="recent">').parent()}))}))));this.elLk.toolsTabs.filter(".final").removeClass("hidden")}});u.Panel.Content=u.Panel.Content.extend({init:function(){this.base.apply(this,arguments);this.blastButtonEnabled=!1;u.EventManager.register("enableBlastButton",this,this.enableBlastButton);u.EventManager.register("runBlastSeq",this,this.runBlastSeq)},enableBlastButton:function(b){var c=this;this.blastButtonEnabled||(this.elLk.blastButton=this.el.find("._blast_button").removeClass("modal_link").filter(":not(._blast_no_button)").removeClass("hidden").end().on("click",function(f){f.preventDefault();c.runBlastSeq()}),(b=this.elLk.blastButton.prop("rel")||b)&&this.elLk.blastButton.length&&(this.elLk.blastForm=g("<form>").appendTo(L.body).hide().attr({action:this.elLk.blastButton.attr("href"),method:"post"}).append(g.map(u.coreParams,function(f,h){return g('<input type="hidden" name="'+h+'" value="'+f+'" />')})).append(g('<input type="hidden" name="query_sequence" value="'+this.filterBlastSeq(b)+'" />')),this.blastButtonEnabled=!0));return this.blastButtonEnabled},runBlastSeq:function(b){this.elLk.blastForm&&(b&&this.elLk.blastForm.find("input[name=query_sequence]").val(this.filterBlastSeq(b)),this.elLk.blastForm.submit())},filterBlastSeq:function(b){return b.replace(/\[[^\]]+\]/g,"")}});u.Panel.ContentTools=u.Panel.Content.extend({init:function(){var b=this;this.base();this.el.find("a._json_link").on("click",function(c){c.preventDefault();(c=g(this).find("._confirm").html())&&!F.confirm(c)||b.ajax({url:this.href,spinner:!0})});this.el.find("a._change_location").on("click",function(c){b.updateLocation(this.href)})},ajax:function(b){var c=this;g.ajax(g.extend({type:"get"},b,{dataType:"json",context:c,beforeSend:function(f,h){c.ajaxBeforeSend(f,b);b.beforeSend&&"function"===typeof b.beforeSend&&b.beforeSend.call(this,f,h)},success:function(f){var h=this.ajaxSuccess(f,b);b.success&&"function"===typeof b.success&&b.success.call(this,f,h)},error:function(f,h,k){this.ajaxError(f,h,k,b);b.error&&"function"===typeof b.error&&b.error.call(this,f,h,k)},complete:function(f,h){this.ajaxComplete(f,h,b);b.complete&&"function"===typeof b.complete&&b.complete.call(this,f,h)}}))},ajaxBeforeSend:function(b,c){c.spinner&&(c.spinner=Math.random().toString().replace(/0\./,""),this.toggleSpinner(!0,"",c.spinner))},ajaxSuccess:function(b,c){if(!this.parseJSONResponseHeader(b))return"header_status";if(b.panelMethod){c=b.panelMethod.shift();if(c in this)return this[c].apply(this,b.panelMethod),b.panelMethod.unshift(c),"method_applied";this.showError("Requested method '"+c+"' could not be found.","Javascript Error");return"method_missing"}return!0},ajaxError:function(b,c,f,h){b=f?"Server error":"Error";if(!f)switch(c){case"timeout":f="The request took longer than expected. The may happen due to an issue with your Internet connection.";break;case"abort":f="The request was aborted, or the connection was closed unexpectedly.";break;default:f="An unknown error occurred"}this.showError(f,b)},ajaxComplete:function(b,c,f){f.spinner&&this.toggleSpinner(!1,"",f.spinner)},parseJSONResponseHeader:function(b){var c=b.header||{};switch(parseInt(c.status)){case 200:return!0;case 302:return c.location?this.ajax({url:c.location,async:!1}):this.showError("Redirect URL is missing","Redirection Error"),!1;case 404:return this.showError("The requested page could not be found.","Not found"),!1;case 500:return b=b.exception||{},this.showError(b.message,"Server Error: "+b.type),!1;default:return this.showError(),!1}},showError:function(b,c){c=c||(b?"Error":"Unknown Error");b=b||"An unknown error has occurred.";if(!this.elLk.errorDiv){var f=this;this.elLk.errorDiv=g("<div>").append('<div class="error-overlay"></div><div class="error-popup error"><h3 class="_error_heading"></h3><div class="error-pad"><p class="_error_message"></p><p class="center"><a href="#" class="_error_hide button">Close</a></p></div></div>').appendTo(L.body).find("a._error_hide").on("click",function(h){h.preventDefault();f.hideError()}).end()}this.elLk.errorDiv.find("._error_heading").html(c).end().find("._error_message").html(b).end().show()},toggleSpinner:function(b,c,f){this.elLk.spinnerDivs||(this.elLk.spinnerDivs=g('<div class="tools-overlay"></div><div class="overlay-spinner spinner"></div>').appendTo(this.el.css("position","relative")));b?(f&&this.elLk.spinnerDivs.addClass("_active_"+f),this.elLk.spinnerDivs.show().last().empty().html(c?"<div>"+c+"</div>":"")):(f&&this.elLk.spinnerDivs.removeClass("_active_"+
f),this.elLk.spinnerDivs.filter(function(){return!this.className.match(/_active_/)}).hide())},hideError:function(){this.elLk.errorDiv&&this.elLk.errorDiv.hide()},scrollIn:function(b){b=g.extend({margin:16,speed:400},b);var c=this.el.offset().top-b.margin;g("html,body").animate({scrollTop:c},b.speed)},updateLocation:function(b){b&&b!==F.location.href&&F.history&&F.history.pushState&&F.history.pushState({},"",b)}});u.Panel.ActivitySummary=u.Panel.ContentTools.extend({constructor:function(){this.base.apply(this,arguments);u.EventManager.register("toolsRefreshActivitySummary",this,this.refresh);u.EventManager.register("toolsToggleEmptyTable",this,this.toggleEmptyTable);this.POLL_INTERVAL=10;this.MAX_POLLS=-1;this.pollCounter=0},init:function(){var b=this;this.base();this.refreshURL=this.el.find("input[name=_refresh_url]").remove().val();this.ticketsDataHash=this.el.find("input[name=_tickets_data_hash]").remove().val();this.elLk.noJobsMessage=this.el.find("div._no_jobs");this.elLk.refreshButton=this.el.find("a._tickets_refresh").on("click",function(c){c.preventDefault();b.clearTimer();b.refresh(!1,!1,!0)});this.elLk.refreshButtonReload=this.elLk.refreshButton.children().eq(0);this.elLk.refreshButtonTimer=this.elLk.refreshButton.children().eq(1);this.elLk.refreshButtonText=this.elLk.refreshButton.children().eq(2);this.el.find("._ticket_edit").on("click",function(){var c=(this.href.match(/tl=([a-z0-9_-]+)/i)||[]).pop();u.EventManager.trigger("toolsHideTicket");return!!c&&!u.EventManager.trigger("toolsEditTicket",c)});this.el.find("._ticket_view").on("click",function(){var c=(this.href.match(/tl=([a-z0-9_-]+)/i)||[]).pop();u.EventManager.trigger("toolsToggleForm",!1);return!!c&&!u.EventManager.trigger("toolsViewTicket",c)});this.el.find("._ticket_share").each(function(){var c=g(this).find(".ticket-share-input").val();c=g("<a/>",{href:c}).prop("href");g(this).find(".ticket-share-input").attr("value",c);g(this).helptip({content:g(this).html(),close:function(f,h,k){k&&g(this).helptip("option","content",g(this).html()).helptip("close")},open:function(f,h){h.tooltip.find("input[type=checkbox]").on("change",{icon:g(this)},function(k){var l=g(this).parents("form").on("submit",function(){return!1});g.ajax({url:l.prop("action"),type:"get",data:l.serialize(),dataType:"json",context:{tooltip:h.tooltip,icon:k.data.icon},success:function(p){this.tooltip.find("._ticket_share_url").toggle(!!p.shared);this.icon.find("._ticket_share_url").toggle(!!p.shared).end().find("input[type=checkbox]")[p.shared?"attr":"removeAttr"]("checked","checked")}})})}})});this.toggleEmptyTable();this.updateTicketList(!1,!!this.el.find("input[name=_auto_refresh]").remove().val())},refresh:function(b,c,f){this.pollCounter=c?0:f?this.pollCounter:this.pollCounter+1;this.toggleLoadingMessage(!0);this.updateRefreshButton("refreshing");this.ajax({url:this.refreshURL,data:{tickets:b?"":this.ticketsDataHash},cache:!1,spinner:!0,success:function(h,k){"method_applied"!=k&&(this.updateRefreshButton("cleartimer"),this.clearTimer())},error:function(){this.updateRefreshButton("cleartimer");this.clearTimer()},complete:function(){this.toggleLoadingMessage(!1)}})},updateRefreshButton:function(b){var c=this;this.elLk.refreshButtonReload.toggle("cleartimer"===b);this.elLk.refreshButtonText.html("refreshing"===b?"Refreshing now&#8230;":"Refresh");"refreshing"===b?this.elLk.refreshButtonTimer.hide():(this.elLk.refreshButtonTimer.toggle("cleartimer"!==b),"inittimer"===b&&(c.elLk.refreshButtonTimer.text(this.POLL_INTERVAL),u.Panel.ActivitySummary.counter=setInterval(function(){c.elLk.refreshButtonTimer.text(parseInt(c.elLk.refreshButtonTimer.text())-1)},1E3)))},updateTicketList:function(b,c){var f=this;this.clearTimer();b&&(b=this.params.updateURL,b=b.replace(/;?mcache=[0-9]+/,""),b+=";mcache="+(new Date).getTime(),this.getContent(b),u.EventManager.trigger("toolsRefreshTicket",!1));(this.autoRefresh=!!c)&&(0>this.MAX_POLLS||this.pollCounter<this.MAX_POLLS)?(u.Panel.ActivitySummary.poll=setTimeout(function(){f.refresh(!1,!1,!1)},1E3*this.POLL_INTERVAL),this.updateRefreshButton("inittimer")):this.updateRefreshButton("cleartimer")},toggleEmptyTable:function(){var b=this.el.find("div._ticket_table"),c=!b.find(".dataTables_empty").length;b.toggle(c);this.elLk.noJobsMessage.toggle(!c);c||u.EventManager.trigger("toolsToggleForm",!0,!1)},toggleLoadingMessage:function(b){1===this.elLk.noJobsMessage.find("p").length&&this.elLk.noJobsMessage.append(g("<p>Loading...</p>").hide());this.elLk.noJobsMessage.find("p").each(function(c){g(this).toggle(0===c?!b:b)})},clearTimer:function(){clearTimeout(u.Panel.ActivitySummary.poll);clearInterval(u.Panel.ActivitySummary.counter)},destructor:function(){this.clearTimer();this.base.apply(this,arguments)}});u.Panel.TicketDetails=u.Panel.ContentTools.extend({constructor:function(){this.base.apply(this,arguments);u.EventManager.register("toolsViewTicket",this,this.viewTicket);u.EventManager.register("toolsRefreshTicket",this,this.refresh);u.EventManager.register("toolsHideTicket",this,this.hide)},init:function(){this.base();var b=this;this.el.find("._ticket_edit").on("click",function(){var c=(this.href.match(/tl=([a-z0-9_-]+)/i)||[]).pop(),f=c.split("-")[0];f!==b.currentTicket&&(u.EventManager.trigger("toolsToggleForm",!1,!0),b.currentTicket=f);return!!c&&!u.EventManager.trigger("toolsEditTicket",c)});this.el.find("._ticket_hide").on("click",function(c){c.preventDefault();b.el.empty();b.hide()});this.el.find("._ticket_delete").on("click",function(c){g(this).data("redirect-url")&&u.redirect(g(this).data("redirect-url"))})},refresh:function(b){this.getContent();b&&u.EventManager.trigger("toolsRefreshActivitySummary",!1,!1,!0)},viewTicket:function(b){var c=this.params.updateURL.replace(/tl=[a-z0-9_-]+/i,"");c.match(/\?/)||(c+="?");this.getContent(c,this.el.show(),{updateURL:c,updateData:{tl:b,view:1}});this.scrollIn();return!0}});u.Panel.ToolsForm=u.Panel.ContentTools.extend({constructor:function(){this.base.apply(this,arguments);u.EventManager.register("toolsToggleForm",this,this.toggleForm);u.EventManager.register("toolsEditTicket",this,this.loadTicket);u.EventManager.register("resetSelectToToggle",this,this.resetSelectToToggle)},init:function(){var b=this;this.base.apply(this,arguments);this.loadTicketURL=this.params.load_ticket_url;this.defaultSpecies=this.params.species;this.elLk.buttonDiv=this.el.find("._tool_new").on("click","a",function(c){c.preventDefault();u.EventManager.trigger("toolsHideTicket");b.toggleForm(!0,!0)});this.elLk.formDiv=this.el.find("._tool_form_div");this.elLk.form=this.elLk.formDiv.find("form._tool_form").on({submit:function(c){g('input[type="file"]',this).filter(function(){return!this.value}).prop("disabled",!0);c.preventDefault();g(this).data("valid",!0).trigger("validate").data("valid")&&(F.FormData?b.ajax(g.extend({url:this.action,method:"post",spinner:!0},{data:new FormData(this),cache:!1,contentType:!1,processData:!1})):b.ajax(g.extend({url:this.action,method:"post",spinner:!0},{iframe:!0,form:g(this)})));g('input[type="file"]',this).filter(function(){return!this.value}).prop("disabled",!1)}});this.elLk.cancelButton=this.el.find("a._tools_form_reset, a._tools_form_cancel").on("click",function(c){var f=!!this.className.match(/cancel/);c.preventDefault();b.toggleSpinner(!0);f?(b.toggleForm(!1),b.toggleSpinner(!1)):F.setTimeout(function(){b.reset();b.toggleSpinner(!1)},100)}).filter("._tools_form_cancel");this.elLk.adjustableDivs=this.elLk.form.find("div._adjustable_height").css("minHeight",function(){return g(this).height()});u.EventManager.trigger("toolsToggleEmptyTable")},editExisting:function(b){var c=this.params.edit_jobs;return c&&c.length?(this.populateForm(c,b),!0):!1},populateForm:function(b,c){if(b&&b.length){c||this.reset();for(var f in b[0]){var h=g.isArray(b[0][f])?b[0][f]:[b[0][f]];c=function(){return 0<=g.inArray(this.value,h)};this.elLk.form.find("[name="+f+"]").filter("input[type=text], textarea").val(h[0]).end().filter("[type=checkbox], [type=radio]").prop("checked",c).end().filter("select").find("option").prop("selected",c);this.toggleForm(!0)}this.resetSelectToToggle()}},getSelectedSpecies:function(){return 0<this.elLk.form.find("input[name=species]").length?this.elLk.form.find("input[name=species]").filter(":checked").map(function(){return this.value}).toArray():0<this.elLk.form.find("select[name=species]").length?this.elLk.form.find("select[name=species] option:selected").val():[]},ticketSubmitted:function(){u.EventManager.trigger("toolsRefreshActivitySummary",!0,!0,!1);this.toggleForm(!1,!0)},ticketNotSubmitted:function(b){this.showError(b.message,b.heading);"dispatcher"===b.stage&&u.EventManager.trigger("toolsRefreshActivitySummary",!0,!0,!1)},toggleForm:function(b,c){b||this.reset();this.elLk.buttonDiv.toggle(!b);this.el.find("div.tool-header").toggle(b);this.elLk.formDiv[b?"slideDown":"slideUp"](200);"boolean"===typeof c&&(this.elLk.cancelButton.toggle(c),this.el.find("div.tool-header span.right-button").toggle(c))},loadTicket:function(b){this.ajax({url:this.loadTicketURL.replace("TICKET_NAME",b),spinner:!0});this.scrollIn();return!0},reset:function(){this.elLk.form[0].reset()},resetSelectToToggle:function(b){this.elLk.form.find("._stt").selectToToggle(b||{},this.el)},adjustDivsHeight:function(){this.elLk.adjustableDivs.clearQueue().each(function(){g(this).css({minHeight:g(this).height()}).animate({minHeight:0},"1000","easeInExpo",function(){g(this).css({minHeight:g(this).height()})})})}});u.Class.ToolsFormSubElement=pa.extend({constructor:function(){this.elLk={}},destructor:function(){for(var b in this.elLk)this.elLk[b].remove(),this.elLk[b]=null;for(b in this)this[b]=null}});u.Panel.VEPResults=u.Panel.ContentTools.extend({init:function(){var b=this;this.base();this.el.find("a._zmenu").zMenuLink();this.el.find("a.filter_toggle").on("click",function(c){c.preventDefault();b.el.find("."+this.rel).toggle()});this.el.find("input.autocomplete").on("focus",function(){var c=this.name.replace("field","").replace("value",""),f=b.el.find("select[name=field"+c+"] option:selected").val();c=b.el.find("input[name=value"+c+"]");var h=g.parseJSON(b.params.auto_values);h[f]&&h[f].length?c.autocomplete({minLength:0,source:h[f]}):c.hasClass("ui-autocomplete-input")&&c.autocomplete("destroy");c.attr("placeholder","Location"===f?"chr:start-end":"defined")});this.el.find("form._apply_filter").on("submit",function(c){c.preventDefault();var f=g(this);c=f.find("input[name=ajax_url]").remove().val();f=g.map(f.serializeArray(),function(h){return h.name+"="+h.value}).sort().join(";");b.reload(F.location.href.split("?")[0]+"?"+f,c+(c.match(/\?/)?";":"?")+f)});this.el.find("a._reload").on("click",function(c){c.preventDefault();b.reload(this.href,g(this).find("input").val())});this.el.find("select._operator_dd").on("change",function(c){g(this).parent().find("input._value_switcher").toggle("in"!==this.value);g(this).parent().find("span._value_switcher").toggle("in"===this.value)});this.el.find(".data_table").scrollyTable()},reload:function(b,c){this.toggleSpinner(!0);this.updateLocation(b);this.getContent(c,this.el.addClass("no-spinner"),null,!0,{background:!0})},destructor:function(){this.toggleSpinner(!1);this.base.apply(this,arguments)}});u.Panel.VEPResultsSummary=u.Panel.Piechart.extend({init:function(){this.base();this.graphColours=JSON.parse(this.params.cons_colours.replace(/'/g,'"'));this.graphColours["default"]=["#222222","#FF00FF","#008080","#7B68EE"]},toggleContent:function(b){b.hasClass("closed")&&!b.data("done")?(this.base(b),this.makeGraphs(g(".pie_chart > div","."+b.attr("rel")).map(function(){return this.id.replace("graphHolder","")}).toArray()),b.data("done",!0)):this.base(b);b=null}});u.Panel.VRResults=u.Panel.ContentTools.extend({init:function(){var b=this;this.base();this.el.find("a._zmenu").zMenuLink();this.el.find("input.autocomplete").on("focus",function(){var c=this.name.replace("field","").replace("value",""),f=b.el.find("select[name=field"+
c+"] option:selected").val();c=b.el.find("input[name=value"+c+"]");var h=g.parseJSON(b.params.auto_values);h[f]&&h[f].length?c.autocomplete({minLength:0,source:h[f]}):c.hasClass("ui-autocomplete-input")&&c.autocomplete("destroy");c.attr("placeholder","Location"===f?"chr:start-end":"defined")});this.el.find("form._apply_filter").on("submit",function(c){c.preventDefault();var f=g(this);c=f.find("input[name=ajax_url]").remove().val();f=g.map(f.serializeArray(),function(h){return h.name+"="+h.value}).sort().join(";");b.reload(F.location.href.split("?")[0]+"?"+f,c+(c.match(/\?/)?";":"?")+f)});this.el.find("a._reload").on("click",function(c){c.preventDefault();b.reload(this.href,g(this).find("input").val())});this.el.find(".data_table").scrollyTable()},reload:function(b,c){this.toggleSpinner(!0);this.updateLocation(b);this.getContent(c,this.el.addClass("no-spinner"),null,!0,{background:!0})},destructor:function(){this.toggleSpinner(!1);this.base.apply(this,arguments)}});u.Panel.TextSequence=u.Panel.TextSequence.extend({init:function(){this.base.apply(this,arguments);var b=this,c=u.EventManager.trigger("enableBlastButton",this.el.clone().find("._seq").text());"boolean"!==typeof c&&(c=!!g.grep(g.map(c,function(f,h){return f}),function(f){return f}).length);c&&(this.el.find("span._seq").removeClass("_seq").filter(function(){return!g(this).text().match(/\.+/)}).addClass("_seq").on({mousedown:function(){b.blastSeq="";b.resetSelection();b.toggleBlastPopup(!1);g(L.body).addClass("sequence_selection");g(L).on("mouseup.TextSequence",function(f){b.blastSeq=b.getSelection();b.toggleBlastPopup(!!b.blastSeq,f);g(L.body).removeClass("sequence_selection")})},mouseup:function(f){b.blastSeq&&f.stopPropagation()}}),this.elLk.blastPopup=g('<div class="blast-popup"><p><a href="#">BLAST selected sequence</a></p></div>').hide().appendTo(L.body).on("click","a",function(f){f.preventDefault();u.EventManager.trigger("runBlastSeq",b.blastSeq)}))},toggleBlastPopup:function(b,c){var f=this;g(L).off("mouseup.TextSequence");b?(this.elLk.blastPopup.css({left:c.pageX,top:c.pageY}).show(),g(L).on("mouseup.TextSequence",function(){f.toggleBlastPopup(!1)})):this.elLk.blastPopup.hide()},resetSelection:function(){L.selection&&L.selection.empty?L.selection.empty():F.getSelection&&F.getSelection().removeAllRanges()},getSelection:function(){if(L.selection&&L.selection.createRange)var b=g("<div>").html(L.selection.createRange().htmlText).find("._seq").text();else if(F.getSelection){var c=F.getSelection();0<c.rangeCount&&(b=g(c.anchorNode).parents("._seq")[0]===g(c.focusNode).parents("._seq")[0]?g("<div>").append(c.getRangeAt(0).cloneContents()).text():g("<div>").append(c.getRangeAt(0).cloneContents()).find("._seq").text())}b&&b.match(/^\.+/)&&(b="");return b}});u.Panel.AssemblyConverterForm=u.Panel.ToolsForm.extend({init:function(){this.base.apply(this,arguments);this.elLk.speciesDropdown=this.elLk.form.find("select[name=species]");this.editExisting();this.resetSpecies()},populateForm:function(b){b&&b.length&&(this.base(b),b[0].input_file_type&&this.elLk.form.find("input[name=file]").parent().append('<p class="_download_link">'+
("text"===b[0].input_file_type?'Click <a href="'+b[0].input_file_url+'">here</a> to download the previously uploaded file.':"You previously uploaded a compressed file to run this job.")+"</p>"),b[0].mapping&&this.elLk.form.find("select[name=mappings_for_"+b[0].species+"]").find("option[value="+b[0].mapping+"]").prop("selected",!0))},reset:function(){this.base.apply(this,arguments);this.resetSpecies();this.elLk.form.find("._download_link").remove()},resetSpecies:function(){this.elLk.speciesDropdown.find("option[value="+
this.defaultSpecies+"]").prop("selected",!0).end().selectToToggle("trigger")}});u.Panel.BlastForm=u.Panel.ToolsForm.extend({constructor:function(){this.base.apply(this,arguments);this.sequences=[];this.selectedQueryType=!1;u.EventManager.register("resetSearchTools",this,this.resetSearchTools);u.EventManager.register("resetSourceTypes",this,this.resetSourceTypes)},init:function(){var b=this;this.base.apply(this,arguments);this.combinations=this.params.valid_combinations;this.restrictions=this.params.restrictions;this.missingSources=this.params.missing_sources;this.blatAvailability=this.params.blat_availability;this.sensitivityConfigs=this.params.sensitivity_configs;this.maxSequenceLength=this.params.max_sequence_length;this.maxNumSequences=this.params.max_number_sequences;this.dnaThresholdPercent=this.params.dna_threshold_percent;this.readFileURL=this.params.read_file_url;this.fetchSequenceURL=this.params.fetch_sequence_url;this.blat_value="BLAT_BLAT";this.searchToolUserSelection;this.sourceRemoved=[];if(this.combinations&&this.maxSequenceLength&&this.dnaThresholdPercent&&this.maxNumSequences){this.elLk.sequences=this.elLk.form.find("div._sequence");this.elLk.sequenceField=this.elLk.form.find("div._sequence_field");this.rnaMessageDisplayed=!1;var c=function(f){var h=g(this).off("blur change paste");setTimeout(function(){h.trigger("finish").trigger("blur").on("blur change paste",c);h=null},100)};this.elLk.sequenceInput=this.elLk.form.find("textarea[name=query_sequence]").on({focus:function(f){this.value&&this.value!==this.defaultValue||g(this).val("").removeClass("inactive")},finish:function(){(this.value=this.value.trim())&&this.value!==this.defaultValue?b.addSequenceByID(this.value)||b.addSequences(this.value):g(this).val(this.defaultValue).addClass("inactive")},"blur change paste":c});this.elLk.sequenceInputClose=this.elLk.sequenceInput.prev().on("click",function(){b.toggleSequenceFields(!1);b.updateSeqInfo(!0)});this.elLk.queryFile=this.elLk.form.find("input[name=query_file]").on({click:function(){b.elLk.sequenceInput.val("")},change:function(){F.FileList&&F.File&&F.FileReader?(b.fileReader||(b.fileReader=new FileReader),b.fileReader.onload=function(f){b.addSequences(f.target.result);b.toggleSpinner(!1);b.elLk.queryFile.val("")},b.fileReader.onerror=function(f){pabel.showError(f.target.error.code,"Error reading file");b.toggleSpinner(!1)},b.toggleSpinner(!0),b.fileReader.readAsText(this.files[0])):b.ajax({url:b.readFileURL,iframe:!0,form:b.elLk.form,spinner:!0,success:function(f){"file_error"in f?this.showError(f.file_error):"file"in f&&this.addSequences(f.file)},complete:function(){this.elLk.queryFile.val("")}})}});this.elLk.queryType=this.elLk.form.find("input[name=query_type]").on("change",function(){b.setQueryTypeValue(this.value)}).first().prop("checked",!0).end();this.elLk.dbType=this.elLk.form.find("input[name=db_type]").on("click",function(){b.resetSearchTools()}).first().prop("checked",!0).end();this.elLk.source=this.elLk.form.find("select[name^=source_]").on("change",function(){b.elLk.dbType.filter("[value="+
this.name.split("_")[1]+"]").prop("checked",!0);b.resetSearchTools()});this.elLk.searchType=this.elLk.form.find("select[name=search_type]").on("change",function(f){b.setSensitivityConfigs(g(this).find("option:selected").val());f.originalEvent&&(b.searchToolUserSelection=g(this).find("option:selected").val())});this.elLk.searchTypeOptions=this.elLk.searchType.find("option").clone();this.elLk.sensitivityOptions=this.elLk.form.find("select[name^=config_set_]").on("change",function(){b.setSensitivityConfigs(g(this))});this.elLk.form.on("validate",function(f){b.sequences.length||b.elLk.sequenceInput.trigger("finish");b.sequences.length?b.getSelectedSpecies().length||(b.showError("Please select a species to run BLAST/BLAT against.","No species selected"),g(this).data("valid",!1)):(b.showError("Please provide a sequence to run BLAST/BLAT.","No sequence found"),g(this).data("valid",!1))});this.resetSearchTools(this.blatAvailability[this.defaultSpecies]?this.blat_value:"");this.resetSourceTypes([this.defaultSpecies]);this.resetSpecies([this.defaultSpecies]);this.editExisting(!0)}else this.showError("JavaScript error occurred while initiating the Blast form.","Blast form error")},reset:function(){this.base.apply(this,arguments);for(var b=this.sequences.length-1;0<=b;b--)this.sequences[b].destructor();this.sequences=[];this.updateSeqInfo(!1);this.toggleSequenceFields(!0);this.selectedQueryType=!1;this.elLk.queryType.first().prop("checked",!0);this.elLk.dbType.first().prop("checked",!0);this.elLk.source.find("option").first().prop("selected",!0);this.resetSearchTools();this.searchToolUserSelection="";this.resetSpecies([this.defaultSpecies])},populateForm:function(b){this.reset();var c={},f={};if(b.length)for(var h=b.length-1;0<=h;h--)for(var k in b[h])"sequence"===k||"species"===k?(k in c||(c[k]=[]),"species"===k?(!f[b[h][k]]&&c[k].unshift(b[h][k]),f[b[h][k]]=1):c[k].unshift(b[h][k])):c[k]=b[h][k];if(!g.isEmptyObject(c)&&(this.toggleForm(!0),c.query_type?this.addEditingJobSequences(c.sequence,c.query_type):this.addSequenceByID(c.sequence[0].sequence)||this.addSequences(c.sequence[0].sequence),this.elLk.form.find("[name=db_type][value="+c.db_type+"]").prop("checked",!0),this.elLk.form.find("[name^=source_] option[value="+c.source+"]").prop("selected",!0),c.search_type&&(this.searchToolUserSelection=c.search_type),this.resetSearchTools(c.search_type),this.resetSpecies(c.species||[this.defaultSpecies]),c.config_set&&this.elLk.form.find("[name=config_set_"+c.search_type+"]").find('option[value="'+c.config_set+'"]').prop("selected",!0).end().selectToToggle("trigger"),c.configs))for(var l in c.configs)this.elLk.form.find("[name="+c.search_type+"__"+l+"]").filter("input[type=checkbox]").prop("checked",!!c.configs[l]).end().filter("select").find('option[value="'+c.configs[l]+'"]').prop("selected",!0).end().selectToToggle("trigger")},addSequences:function(b,c){b=this.parseRawSequences(b);var f=0,h=!!c,k=b.sequences.length,l=this.sequences.length,p;var q=0;a:for(;q<k;q++){for(p=0;p<l;p++)if(b.sequences[q].string===this.sequences[p].string&&(!c||this.sequences[p]!==c)){f++;h&&1===k&&this.removeSequence(c);continue a}if(h)c.init(b.sequences[q]),h=!1;else{if(l>=this.maxNumSequences)break;this.sequences.splice(c&&this.sequences.indexOf(c)+1||l,0,new u.Class.BlastFormSequence(b.sequences[q],this,c||!1))}l=this.sequences.length}l&&(this.setQueryTypeValue(),this.toggleSequenceFields(!1));this.updateSeqInfo({added:q-f,invalids:b.invalids+f,is_rna:b.is_rna});return q},addSequenceByID:function(b){return this.fetchSequenceURL&&b.match(/[0-9]+/)&&b.match(/^[a-z]{1}[a-z0-9\.\-_]{4,30}$/i)?(this.ajax({comet:!0,url:this.fetchSequenceURL,data:{id:b},spinner:!0,update:function(c){this.toggleSpinner(!0,"Fetching sequence&#8230;")}}),!0):!1},parseRawSequences:function(b){var c="ACTUGNX";b=b.replace(/^[\s\n\t]+|[\s\n\t]+$/g,"").split(/(?=>)|\n+[\s\t]*\n+/);var f=[],h=!1,k,l=function(z){var B,D=[],E=!1;if(1===z.length&&z[0].match(/^>/)){for(B=z[0].split(/[\s\t]+/);B.length;){var G=B.pop();if(!G.match(/^[A-Z\*\-]+$/i)||E&&60!==G.length){B.push(G);break}else D.unshift(G);E=!0}D.unshift(B.join(" "))}return 1<D.length?D:z};var p=0;a:for(;p<b.length;p++){var q=l(b[p].trim().split(/[\s\t]*\n[\s\t]*/));var m=k=0;seqString="";sequence={string:"",description:">",type:""};var t=0;b:for(;t<q.length;t++){var v=q[t];k=0;if(v.match(/^(>|;)/))0===t&&(sequence.description=v.replace(/^(>|;)(\s\t)+/,""));else for(v=v.toUpperCase().replace(/[^A-Z\*\-]+/,"");k<v.length;){var w=v.charAt(k);if(k===this.maxSequenceLength)break b;w.match(/\d|\s|\t/)||(0<=c.indexOf(w)&&(m++,"U"===w&&(h=!0)),sequence.string+=w);k++}}if(""===sequence.string)continue a;sequence.type=100*m/sequence.string.length<this.dnaThresholdPercent?"peptide":"dna";for(t=0;t<f.length;t++)if(f[t].string===sequence.string)continue a;if(!sequence.string.match(/^[A-Z\*]+$/))continue a;!0===h&&(sequence.string=sequence.string.replace(/U/g,"T"));f.push(sequence);if(f.length>=this.maxNumSequences)break a}c=b=q=k=v=w=m=t=l=null;return{sequences:f,invalids:p-f.length,is_rna:h}},addEditingJobSequences:function(b,c){var f=0;a:for(;f<b.length;f++){for(var h=this.sequences.length-
1;0<=h;h--)if(b[f].sequence===this.sequences[h].string)continue a;if(this.sequences.length>=this.maxNumSequences)break;this.sequences.push(new u.Class.BlastFormSequence({string:b[f].sequence,description:">"+(b[f].display_id||""),type:c},this,!1))}this.sequences.length&&(this.setQueryTypeValue(c),this.toggleSequenceFields(!1));this.updateSeqInfo({added:this.sequences.length});return this.sequences.length},modifySequence:function(b,c){c&&this.addSequences(c,b)?this.updateSeqInfo(!0):this.removeSequence(b)},removeSequence:function(b){this.sequences.splice(this.sequences.indexOf(b),1);b.destructor();b=!!this.sequences.length;this.updateSeqInfo(b);this.toggleSequenceFields(!b);this.setQueryTypeValue()},toggleSequenceFields:function(b){this.elLk.sequenceField.toggle(b);this.elLk.sequenceInput.val("").focus();this.elLk.sequenceInfo&&this.elLk.sequenceInfo.toggle(!b);b&&(this.elLk.sequenceInputClose.toggle(!!this.sequences.length),this.sequences.length||this.elLk.sequences.hide());this.adjustDivsHeight()},setQueryTypeValue:function(b){if(b)this.selectedQueryType=b;else if(b=this.selectedQueryType,!b){var c={peptide:0,dna:0};g.each(this.sequences,function(){c[this.guessedType]++});b=c.peptide===c.dna?this.elLk.queryType.filter(":checked").val():c.peptide<c.dna?"dna":"peptide"}this.elLk.queryType.filter("[value="+b+"]").prop("checked",!0);this.resetSearchTools()},isBlatAvailable:function(b){var c=this;b=b||this.getSelectedSpecies();var f=1;g.each(b,function(h,k){if(!c.blatAvailability[k])return f=0,!1});return f?!0:!1},resetSearchTools:function(b,c){var f=this,h=this.elLk.queryType.filter(":checked").val(),k=this.elLk.dbType.filter(":checked").val(),l=this.elLk.source.filter("[name=source_"+k+"]").val(),p=[];c=this.isBlatAvailable(c?c:this.getSelectedSpecies());b=b||!this.searchToolUserSelection&&c&&this.blat_value;for(var q=this.combinations.length-1;0<=q;q--)if(this.combinations[q].query_type===h&&this.combinations[q].db_type===k&&0<=this.combinations[q].sources.indexOf(l))if(this.sequences.length)for(var m=this.sequences.length-1;0<=m;m--)this.sequences[m].string.length>this.combinations[q].min_length&&p.push(this.combinations[q].search_type);else p.push(this.combinations[q].search_type);this.elLk.searchType.empty().append(this.elLk.searchTypeOptions.filter(function(){return 0<=p.indexOf(this.value)}).clone()).find("option[value="+(b||f.searchToolUserSelection||"")+"]").prop("selected",!0).end().selectToToggle("trigger").trigger("change");!c&&this.elLk.searchType.find("option[value="+this.blat_value+
"]").remove();f.restrictions[this.elLk.searchType.val()]?g.each(f.restrictions[this.elLk.searchType.val()],function(t,v){f.sourceRemoved.push(f.elLk.form.find("[name=source_dna] option[value='"+v.value+"']").replaceWith(""))}):f.sourceRemoved.length&&(g.each(f.sourceRemoved,function(t,v){f.elLk.form.find("[name=source_dna]").append(v)}),f.sourceRemoved=[])},resetSourceTypes:function(b){for(var c=[],f=b.length-1;0<=f;f--)c=c.concat(this.missingSources[b[f]]||[]);this.elLk.source.find("option").prop("disabled",function(){return 0<=c.indexOf(this.value)}).end().each(function(){var h=g(this).find("option:enabled");h.filter(":selected").length||h.first().prop("selected",!0)})},updateSeqInfo:function(b){var c=this;b?!0===b.is_rna&&!1===this.rnaMessageDisplayed&&(g("[name=query_type]:first").parent().before('<div class="rna_seq_message bottom-margin">You have added a RNA sequence. However, it has been replaced by its DNA equivalent.</div>'),this.rnaMessageDisplayed=!0):(g(".rna_seq_message").remove(),this.rnaMessageDisplayed=!1);this.elLk.sequenceInfo||(this.elLk.sequenceInfo=g('<div class="italic">').appendTo(this.elLk.sequences).on("click","a",function(h){h.preventDefault();c.elLk.sequenceInfo.hide();c.toggleSequenceFields(!0)}));var f="object"===g.type(b)?(parseInt(b.added)||"No")+(this.sequences.length-b.added?" more":"")+" sequence"+(1<b.added?"s":"")+" added"+(b.invalids?" ("+b.invalids+" invalid or duplicate sequence"+(1<b.invalids?"s":"")+" ignored)":"")+", ":"";this.elLk.sequenceInfo.toggle(!!b).html((this.maxNumSequences===this.sequences.length?"":'<a href="#">Add more sequences</a> ')+"("+f+(this.maxNumSequences-this.sequences.length||(f?"no":"No"))+(this.sequences.length?" more":"")+" sequence"+(1<this.maxNumSequences-this.sequences.length?"s":"")+" allowed)")},resetSpecies:function(b){b=g.map(b,function(c,f){return{key:c,title:c}});u.EventManager.deferTrigger("updateTaxonSelection",b)},setSensitivityConfigs:function(b){var c=this;"string"===typeof b&&(b=this.elLk.sensitivityOptions.filter("[name$="+b+"]").first());if(b.length){var f=b.prop("name").replace("config_set_","");b=b.find("option:selected").val();var h=!1;f in this.sensitivityConfigs&&b in this.sensitivityConfigs[f]&&(h=this.sensitivityConfigs[f][b]);h&&!g.isEmptyObject(h)&&g.each(h,function(k,l){c.elLk.form.find("[name="+f+"__"+k+"]").filter("input").prop("checked",!!l).end().filter("select").find('option[value="'+l+'"]').prop("selected",!0).end().selectToToggle("trigger")});f=b=h=null}}});u.Class.BlastFormSequence=u.Class.ToolsFormSubElement.extend({constructor:function(b,c,f){this.base();var h=this;this.parent=c;this.elLk.input=g("<input>",{type:"hidden",name:"sequence",value:""});this.elLk.close=c.elLk.sequenceInputClose.clone().helptip({content:"Remove sequence"}).show().on("click",function(){h.parent.removeSequence(h)});this.elLk.seqBox=g("<div>",{"class":"fasta-input"}).on({click:function(k){g(this).filter(":not(.editable)").addClass("editable").prop({contentEditable:!0,spellcheck:!1}).focus().data("prevSequence",g(this).text())},"blur keyup":function(k){if("blur"===k.type||"keyup"===k.type&&27===k.which){var l=g(this).filter(".editable").removeClass("editable").prop("contentEditable",!1).find("br").replaceWith("\n").end().end();"keyup"===k.type?l.text(l.data("prevSequence")):l.data("prevSequence")!=l.text()&&h.parent.modifySequence(h,l.text())}},keypress:function(k){if(13===k.which&&F.getSelection){k.preventDefault();k=F.getSelection();var l=k.getRangeAt(0),p=L.createElement("br");l.deleteContents();l.insertNode(p);l.setStartAfter(p);l.setEndAfter(p);l.collapse(!1);k.removeAllRanges();k.addRange(l)}}});this.elLk.div=g("<div>",{"class":"seq-wrapper"}).append(this.elLk.input,this.elLk.seqBox,this.elLk.close).appendTo(c.elLk.sequences.show()).insertBefore(f&&f.elLk.div.next()||c.elLk.sequenceInfo).end();this.init(b)},init:function(b){this.string=b.string;this.type=b.type;this.description=b.description;this.guessedType=b.type;b=this.description+"\n"+this.string.match(/(.{1,60})/g).join("\n");this.elLk.input.val(b);this.elLk.seqBox.text(b)}});u.Panel.FileChameleonForm=u.Panel.ToolsForm.extend({init:function(){var b=this;this.base.apply(this,arguments);this.elLk.speciesDropdown=this.elLk.form.find("._sdd");this.elLk.formatRadio=this.elLk.form.find("input[name=format]");this.elLk.fileList=this.elLk.form.find("select[name=files_list]");this.elLk.chr_filter=this.elLk.form.find("input[name=chr_filter]");this.elLk.add_transcript=this.elLk.form.find("input[name=add_transcript]");this.elLk.remap_patch=this.elLk.form.find("input[name=remap_patch]");this.release_version=this.params.release_version;this.ftp_url=this.params.ftp_url;this.speciesname_map=this.params.speciesname_mapping;this.resetSpecies(this.defaultSpecies);this.editExisting();this.populateFileListing();this.elLk.speciesDropdown.on("change",function(){b.elLk.form.find("p.nofilter_note").hide();b.elLk.form.find("div._remap").hide();b.elLk.formatRadio.is(":checked")?(b.elLk.fileList.hide(),b.populateFileListing(),b.elLk.form.find("div._filters").is(":visible")||b.elLk.form.find("p.nofilter_note").show()):b.elLk.form.find("div._stt_fasta").hide()});this.elLk.formatRadio.on("change",function(){b.elLk.fileList.hide();b.elLk.form.find("p.nofilter_note").hide();b.elLk.form.find("div._remap").hide();b.populateFileListing();b.elLk.speciesDropdown.find("input:checked").hasClass("_stt__chr_filter")||b.elLk.form.find("div._stt_fasta").hide();b.elLk.form.find("div._filters").is(":visible")||b.elLk.form.find("p.nofilter_note").show()});this.elLk.form.find("span.file_link a").on("click",function(c){c.preventDefault();b.elLk.form.find("span._file_text").hide();b.elLk.fileList.show().trigger("focus");b.elLk.form.find("span.file_link").hide()});this.elLk.fileList.on("change",function(){b.elLk.fileList.hide();b.elLk.fileList.find('option[value="'+this.value+'"]').prop("selected",!0);b.elLk.form.find("span._file_text").html(b.elLk.form.find("select[name=files_list] option:selected").text()).show();b.elLk.form.find("input[name=file_text]").val(b.elLk.form.find("select[name=files_list] option:selected").text());b.elLk.form.find("span.file_link").show()});if(this.elLk.form.find("select[name=files_list]:visible"))b.elLk.fileList.on("focusout",function(){b.elLk.fileList.hide();b.elLk.form.find("span._file_text").html(b.elLk.form.find("select[name=files_list] option:selected").text()).show();b.elLk.form.find("input[name=file_text]").val(b.elLk.form.find("select[name=files_list] option:selected").text());b.elLk.form.find("span.file_link").show()});this.elLk.form.on("validate",function(c){b.elLk.formatRadio.is(":checked")||(b.showError("Please choose a file format","No format choosen"),g(this).data("valid",!1))});b.elLk.formatRadio.is(":checked")||this.elLk.form.find("div._stt_fasta").hide()},populateForm:function(b){b&&b.length&&(this.base(b),this.resetSpecies(b[0].species),b[0].file_url&&(this.elLk.formatRadio.filter("[value="+b[0].format+"]").prop("checked",!0),this.populateFileListing(b[0].file_url)),this.elLk.speciesDropdown.find("input:checked").hasClass("_stt__chr_filter")||this.elLk.form.find("div._stt_chr_filter").hide(),b[0].chr_filter&&this.elLk.form.find("select[name=chr_filter]").show().find("option[value="+
b[0].chr_filter+"]").prop("selected",!0),b[0].long_genes&&this.elLk.form.find("select[name=long_genes]").find("option[value="+b[0].long_genes+"]").prop("selected",!0),b[0].add_transcript&&this.elLk.form.find("[name=add_transcript][value="+b[0].add_transcript+"]").prop("checked",!0),b[0].remap_patch&&this.elLk.form.find("[name=remap_patch][value="+b[0].remap_patch+"]").prop("checked",!0))},populateFileListing:function(b,c,f){var h=this;h.elLk.fileList.val();var k=c=c?c:this.elLk.form.find("input[name=format]:checked").val().toLowerCase();f=f?f:h.speciesname_map[h.elLk.speciesDropdown.find("input:checked").val()];b=b&&b.match(/(^http:\/\/.*\/)/gi)?b.replace(/(^http:\/\/.*\/)/gi,""):b;var l;if("fasta"===c){f+="/dna";k="fa";var p=h.elLk.speciesDropdown.find("input:checked").parent().find("label").html().replace(/\(.*\)/,"")+"genome assembly";b=b?b:"dna\\.toplevel\\."}else p=h.elLk.speciesDropdown.find("input:checked").parent().find("label").html().replace(/\(.*\)/,"")+"gene set",b=b?b:"(\\d+)\\."+c;var q=h.ftp_url+c+"/"+f+"/";g.ajax({url:q,dataType:"html",beforeSend:function(){h.toggleSpinner(!0)},success:function(m){m=m.replace(/<img(.*?)>/g);var t="";g(m).find("a:contains(."+k+")").each(function(){var v=g(this).attr("href");l=(selected=(b="fasta"===c&&v.match(/dna\.primary_assembly/i)&&!b.match(/http/i)?"dna\\.primary_assembly":b)&&v.match(new RegExp(b,"i"))?'selected="selected"':"")?p+" ("+v+")":v.match(/chr_patch_hapl_scaff/i)?p+" with patches ("+v+")":v;t+='<option value="'+q+v+'"'+selected+">"+l+"</option>"});h.elLk.fileList.html("").append(t);h.elLk.form.find("span._file_text").html(h.elLk.form.find("select[name=files_list] option:selected").text()).show();h.elLk.form.find("input[name=file_text]").val(h.elLk.form.find("select[name=files_list] option:selected").text());h.elLk.form.find("span.file_link").show();h.elLk.fileList.find('option[value*="chr_patch_hapl_scaff"]').length&&"gff3"===c?h.elLk.form.find("div._remap").show():h.elLk.form.find("div._remap").hide();h.elLk.form.find("div._remap").is(":visible")&&h.elLk.remap_patch.is(":checked")&&(h.elLk.fileList.find('option[value*="chr_patch_hapl_scaff"]').prop("selected",!0),h.elLk.form.find("span._file_text").html(h.elLk.form.find("select[name=files_list] option:selected").text()).show(),h.elLk.form.find("input[name=file_text]").val(h.elLk.form.find("select[name=files_list] option:selected").text()));h.elLk.remap_patch.on("change",function(){h.elLk.form.find("div._remap").is(":visible")&&h.elLk.remap_patch.is(":checked")?h.elLk.fileList.find('option[value*="chr_patch_hapl_scaff"]').prop("selected",!0):h.elLk.fileList.find('option[value*="(\\d+)\\.'+c+'"]').prop("selected",!0);h.elLk.form.find("span._file_text").html(h.elLk.form.find("select[name=files_list] option:selected").text()).show();h.elLk.form.find("input[name=file_text]").val(h.elLk.form.find("select[name=files_list] option:selected").text())})},complete:function(){h.toggleSpinner(!1)},error:function(m,t,v){h.showError('The files you requested are currently unavailable for download. Please try again later and <a href="/Help/Contact" class="popup">contact us</a> if you are still having problems.',"Files unavailable");g(h.elLk.form).data("valid",!1);h.toggleSpinner(!1,"","")}})},reset:function(){this.base.apply(this,arguments);this.resetSpecies(this.defaultSpecies);this.elLk.form.find('input[name="format"]').selectToToggle("trigger");this.elLk.form.find("p.nofilter_note").hide()},resetSpecies:function(b){this.elLk.speciesDropdown.find("input[value="+b+"]").first().click();this.elLk.speciesDropdown.speciesDropdown({refresh:!0})}});u.Panel.IDMapperForm=u.Panel.ToolsForm.extend({init:function(){this.base.apply(this,arguments);this.elLk.speciesDropdown=this.elLk.form.find("._sdd");this.resetSpecies(this.defaultSpecies);this.editExisting()},reset:function(){this.base.apply(this,arguments);this.resetSpecies(this.defaultSpecies);this.elLk.form.find("._previous_file").remove()},populateForm:function(b){b&&b.length&&(this.base(b),this.resetSpecies(b[0].species),b[0].file&&this.elLk.form.find("input[name=file]").parent().append(g('<p class="_previous_file">').html("You previously uploaded a file named "+b[0].file+
" to run this job.")))},resetSpecies:function(b){this.elLk.speciesDropdown.find('input[value="'+b+'"]').first().click();this.elLk.speciesDropdown.speciesDropdown({refresh:!0})}});u.Panel.LDForm=u.Panel.ToolsForm.extend({init:function(){this.base();this.resetSpecies(this.defaultSpecies);this.exampleData=this.params.example_data;delete this.params.example_data;var b=this;this.elLk.dataField=this.elLk.form.find("textarea[name=text]").on({"paste keyup click change focus scroll":function(c){b.dataFieldInteraction(c.type)}});this.elLk.form.find("a._example_input").on("click",function(c){c.preventDefault();c=b.elLk.form.find("input[name=species]:checked").val()||b.elLk.form.find("input[name=species]").val();c=b.exampleData[c][this.rel];"undefined"!==typeof c&&c.length||(c="");c=c.replace(/\\n/g,"\n");b.elLk.dataField.val(c).trigger("focus")});this.elLk.form.find(".plugin_enable").change(function(){b.elLk.form.find(".plugin-highlight").removeClass("plugin-highlight");b.elLk.form.find("._stt_"+this.name).addClass("plugin-highlight",100,"linear")});this.elLk.form.find(".plugin_enable").each(function(){b.elLk.form.find("._stt_"+this.name).find(":input").change(function(){b.elLk.form.find(".plugin-highlight").removeClass("plugin-highlight")})});this.editExisting();this.resetSelectToToggle()},populateForm:function(b){b&&b.length&&(b=g.extend({},b[0].config,b[0]),this.base([b]),b.input_file_type&&this.elLk.form.find("input[name=file]").parent().append('<p class="_download_link">'+("text"===b.input_file_type?'Click <a href="'+b.input_file_url+
'">here</a> to download the previously uploaded file.':"You previously uploaded a compressed file to run this job.")+"</p>"),this.elLk.speciesDropdown.find("input:checked").length||this.elLk.speciesDropdown.find("input[type=radio]").first().click(),this.resetSpecies(b.species),this.elLk.dataField.trigger("change"))},reset:function(){this.base.apply(this,arguments);this.elLk.form.find("._download_link").remove();this.elLk.dataField.removeClass("focused");this.resetSpecies(this.defaultSpecies);this.resetSelectToToggle()},resetSpecies:function(b){this.elLk.speciesDropdown||(this.elLk.speciesDropdown=this.elLk.form.find("._sdd"));this.elLk.speciesDropdown.find("input[value="+b+"]").first().click();this.elLk.speciesDropdown.speciesDropdown({refresh:!0})}});u.Panel.ThousandGenome=u.Panel.ToolsForm.extend({init:function(){var b=this;this.base.apply(this,arguments);this.elLk.speciesDropdown=this.elLk.form.find("._sdd");this.elLk.collection=this.elLk.form.find("select[name=collection_format]");this.elLk.region=this.elLk.form.find("input[name=region]");this.elLk.sample_url=this.elLk.form.find("input[name=custom_sample_url]");this.elLk.file_url=this.elLk.form.find("input[name=custom_file_url]");this.readSampleFile=this.params.read_sample_file;this.fileRestURL=this.params.genome_file_rest_url;this.filesLocation=this.params.files_location_regex;this.getIndividuals=this.params.get_individuals;this.editExisting();b.elLk.region.on("blur",function(c){g(this).data("old",g(this).data("new")||"");g(this).data("new",g(this).val());if(g(this).data("old")!==g(this).data("new")){c=b.elLk.collection.val();var f=b.elLk.region.val().replace(/\s/g,"").match(/^([^:]+):\s?([0-9,]+)(-|_|\.\.)([0-9,]+)$/);!f||5!==f.length||0>f[4]-f[2]||(b.elLk.form.find("input[name=region_check]").length&&parseFloat(f[4].replace(/,/gi,""))-parseFloat(f[2].replace(/,/gi,""))+1>parseInt(b.elLk.form.find("input[name=region_check]").val())?(b.showError("The region size is too big, maximum region size allowed is "+parseInt(b.elLk.form.find("input[name=region_check]").val()),"Large region size"),g(b.elLk.form).data("valid",!1)):(g(b.elLk.form).data("valid",!0),"custom"==c||b.elLk.form.find("input[name=bam_file_url]").is(":visible")||b.getFileURL(f[1],c),b.elLk.region.val().match(/y:/gi)&&"phase3"===c?(b.elLk.form.find("input[name=no_population]").val()||b.updatePopulation("","_stt_phase3_male"),b.elLk.form.find('[class^="_sample_url_"]').hide(),b.elLk.form.find("span._sample_url_phase3_male").show()):(b.elLk.form.find("span._stt_phase3_male").hide(),"custom"!=c&&(b.elLk.form.find("span._stt_"+
c).show(),b.elLk.form.find("span._sample_url_phase3_male").hide()))))}});b.elLk.collection.on("change",function(){var c=b.elLk.region.val().replace(/\s/g,"").match(/^([^:]+):\s?([0-9,]+)(-|_|\.\.)([0-9,]+)$/);"custom"!=b.elLk.collection.val()&&b.elLk.form.find("div.custom_population").hide();"custom"===b.elLk.collection.val()&&b.elLk.sample_url.val()&&b.elLk.form.find("div.custom_population").show();"custom"!=b.elLk.collection.val()&&b.elLk.region.val()&&b.getFileURL(c[1],b.elLk.collection.val());"phase3"===b.elLk.collection.val()&&b.elLk.region.val().match(/y:/gi)?(b.elLk.form.find("input[name=no_population]").val()||b.updatePopulation("","_stt_phase3_male"),b.elLk.form.find('[class^="_sample_url_"]').hide(),b.elLk.form.find("span._sample_url_phase3_male").show()):(b.elLk.form.find("div._stt_phase3_male").hide(),b.elLk.form.find("span._sample_url_phase3_male").hide())});b.elLk.sample_url.on("change",function(){var c=g(this);b.elLk.sample_url.val()?(c.parents("form").validate(),c.data("valid")?b.elLk.form.find("input[name=no_population]").val()||b.updatePopulation(b.elLk.sample_url.val().replace(/^\s+|\s+$/g,""),"custom_populations"):(b.elLk.form.find("div.custom_population select").html(""),b.elLk.form.find("div.population").hide())):(b.showError("Please provide a sample population URL","No sample population URL"),g(b.elLk.form).data("valid",!1))});this.elLk.form.on("validate",function(c){if(b.elLk.region.val())if(c=b.elLk.region.val().replace(/\s/g,"").match(/^([^:]+):\s?([0-9,]+)(-|_|\.\.)([0-9,]+)$/),!c||5!==c.length||0>c[4]-c[2])b.showError("Please enter a valid region e.g: 1:1-50000","Invalid Region Lookup"),g(b.elLk.form).data("valid",!1);else if(b.elLk.form.find("input[name=region_check]").length&&parseFloat(c[4].replace(/,/gi,""))-parseFloat(c[2].replace(/,/gi,""))+1>parseInt(b.elLk.form.find("input[name=region_check]").val()))b.showError("The region size is too big, maximum region size allowed is "+parseInt(b.elLk.form.find("input[name=region_check]").val()),"Large region size"),g(b.elLk.form).data("valid",!1);else if(!b.elLk.form.find("input[name=generated_file_url]").val().match(/^ftp|^http/gi)&&b.elLk.form.find("span._span_url").is(":visible"))b.showError("Genotype file URL missing, Please make sure you entered the correct region","Genotype file URL missing"),g(b.elLk.form).data("valid",!1);else{if(b.elLk.collection.is(":visible")&&"custom"===b.elLk.collection.val()){if(!b.elLk.file_url.val()){b.showError("Please provide a file URL","No file URL");g(this).data("valid",!1);return}if(b.elLk.sample_url.is(":visible")&&!b.elLk.sample_url.val()){b.showError("Please provide a sample population URL","No sample population URL");g(this).data("valid",!1);return}}b.elLk.form.find("select.tools_listbox").is(":visible")&&!b.elLk.form.find("select.tools_listbox:visible").val()?(b.showError("Please choose at least one population","No population"),g(this).data("valid",!1)):b.elLk.form.find("input[name=bam_file_url]").is(":visible")&&!b.elLk.form.find("input[name=bam_file_url]").val()?(b.showError("Please provide a BAM file url","No file URL"),g(this).data("valid",!1)):b.elLk.form.find("select.individuals_listbox").is(":visible")&&!b.elLk.form.find("select.individuals_listbox").val()&&b.elLk.form.find("input[name=ind_list]").is(":visible")&&!b.elLk.form.find("input[name=ind_list]").val()?(b.showError("Please choose at least one inidividuals","No individuals"),g(this).data("valid",!1)):"data_slicer"===b.elLk.form.find("input[name=which_tool]").val()&&b.elLk.form.find("select.tools_listbox").is(":visible")&&(c=b.elLk.form.find("select.tools_listbox:visible option:selected").map(function(){return g(this).text()}).get().join(),b.elLk.form.find("input[name=pop_caption]").val(c))}else b.showError("Please enter a region","No region entered"),g(this).data("valid",!1)})},getFileURL:function(b,c){function f(){var l='We are currently unable to retrieve the genotype data. Please try again and if the problem persists please <a href="/Help/Contact?subject='+(encodeURIComponent("Data slicer unable to retrieve genotype file from 1000G FTP site")+'">contact us</a>');h.elLk.form.find("span._span_url").html('<label class="invalid" style="display: inline;">'+
l+"</label>");h.elLk.form.find("input[name=generated_file_url]").val("")}var h=this,k;b=b.match(/^chr/gi)?b:"chr"+b;c="1000 Genomes phase "+c.replace("phase","")+" release";g.ajax({type:"POST",url:h.fileRestURL,data:JSON.stringify({query:{regexp:{url:h.filesLocation}},size:"-1",_source:["url"]}),beforeSend:function(){h.toggleSpinner(!0)},success:function(l){l.hits&&l.hits.total?(g.each(l.hits.hits,function(p,q){q._source.url&&!q._source.url.match(/tbi$/gi)&&(q._source.url.match(new RegExp(b+"\\.","i"))||q._source.url.match(new RegExp(b+"_","i")))&&(k=q._source.url)}),h.elLk.form.find("span._span_url").html("Genotype file URL: "+k),h.elLk.form.find("input[name=generated_file_url]").val(k)):f()},complete:function(){h.toggleSpinner(!1);h.elLk.form.find("select.individuals_listbox").is(":visible")&&"updateIndividuals"in h&&h.updateIndividuals()},error:function(){h.toggleSpinner(!1);f()}})},populateForm:function(b){if(b&&b.length){this.base(b);var c=b[0].upload_type,f=b[0].file_format,h=b[0].vcf_filters;b[0].job_desc&&this.elLk.form.find("input[name=name]").val(b[0].job_desc);f&&(this.elLk.form.find("select[name=file_format]").find("option[value="+f+"]").prop("selected",!0).end().selectToToggle("trigger"),"bam"===f&&(this.elLk.form.find("input[name=bam_file_url]").val(b[0].file_url),b[0].bai_file&&this.elLk.form.find("input[name=bai_file]").prop("checked",!0)));f&&"vcf"===f?"populations"===h?this.populatePopulations(b):"individuals"===h?(this.elLk.form.find("select[name=collection_format] option").removeAttr("selected"),this.elLk.form.find("select[name=collection_format]").find("option[value="+c+"]").prop("selected",!0).end().selectToToggle("trigger"),this.elLk.form.find("span._span_url").html("Genotype file URL: "+b[0].file_url),this.elLk.form.find("input[name=generated_file_url]").val(b[0].file_url),this.updateIndividuals(b[0].individuals_box?b[0].individuals_box:""),this.elLk.form.find("input[name=ind_list]").val(b[0].individuals_text)):(this.elLk.form.find("select[name=collection_format] option").removeAttr("selected"),this.elLk.form.find("select[name=collection_format]").find("option[value="+c+"]").prop("selected",!0).end().selectToToggle("trigger"),this.elLk.form.find("span._span_url").html("Genotype file URL: "+b[0].file_url),this.elLk.form.find("input[name=generated_file_url]").val(b[0].file_url)):this.populatePopulations(b);this.elLk.form.find("input[name=base]").length&&b[0].base&&this.elLk.form.find("input[name=base][value="+b[0].base+"]").prop("checked",!0)}},populatePopulations:function(b){var c=b[0].upload_type;if("custom"===c)this.elLk.form.find("select[name=collection_format] option").removeAttr("selected"),this.elLk.form.find("select[name=collection_format]").find("option[value=custom]").prop("selected",!0).end().selectToToggle("trigger"),this.elLk.form.find("input[name=custom_file_url]").val(b[0].file_url),this.elLk.form.find("input[name=custom_sample_url]").val(b[0].sample_panel),b[0].population&&this.updatePopulation(b[0].sample_panel,"custom_population",b[0].population);else{var f=this.elLk.form.find("input[name=region]").val().match(/y:/gi)&&"phase3"===c?"phase3_male":c;this.elLk.form.find("select[name=collection_format] option").removeAttr("selected");this.elLk.form.find("select[name=collection_format]").find("option[value="+c+"]").prop("selected",!0).end().selectToToggle("trigger");this.elLk.form.find("span._span_url").html("Genotype file URL: "+b[0].file_url);this.elLk.form.find("input[name=generated_file_url]").val(b[0].file_url);this.elLk.form.find('[class^="_sample_url_"]').hide();this.elLk.form.find("span._sample_url_"+f).show();b[0].population&&this.updatePopulation("","_stt_"+f,b[0].population)}},reset:function(){this.base.apply(this,arguments);this.elLk.form.find("div.population").hide();this.elLk.form.find("select[name=collection_format]").find("option[value=phase3]").prop("selected",!0).end().selectToToggle("trigger");this.elLk.form.find("select[name=phase3_populations]").find("option[value=ALL]").prop("selected",!0);this.elLk.form.find("span._span_url").html("Genotype file URL: ").show();this.elLk.form.find("input[name=generated_file_url]").val("")},updatePopulation:function(b,c,f){var h=this,k="data_slicer"===h.elLk.form.find("input[name=which_tool]").val()?1:0;if(b)g.ajax({comet:!0,type:"POST",url:h.readSampleFile,dataType:"json",data:{population_url:b,pop_value:k},beforeSend:function(){h.toggleSpinner(!0)},success:function(p){var q="";p.error?(h.showError("The sample population url is either invalid or not reachable","Invalid sample population URL"),h.elLk.form.find("div.custom_population select").html(""),h.elLk.form.find("div.population").hide(),g(h.elLk.form).data("valid",!1),h.ajax.spinner="false"):p.format_error?(h.showError(p.format_error,"Wrong sample population file content"),h.elLk.form.find("div.custom_population select").html(""),h.elLk.form.find("div.population").hide(),g(h.elLk.form).data("valid",!1),h.ajax.spinner="false"):(g.each(p.populations,function(m,t){t.value&&(t.value.match(/sample/gi)&&next,q+='<option value="'+t.value+'">'+t.caption+"</option>")}),h.elLk.form.find("div.custom_population").show(),h.elLk.form.find("div.custom_population select").html("").append(q),f&&g.each(f.split(","),function(m,t){k?h.elLk.form.find("div.custom_population select").find("option:contains("+t+")").prop("selected",!0):h.elLk.form.find("div.custom_population select").find("option[value="+t+"]").prop("selected",!0)}))},complete:function(){h.toggleSpinner(!1)}});else if(this.elLk.form.find("div.population").hide(),this.elLk.form.find("div."+c).show(),f){var l=c.replace("_stt_","")+"_populations";this.elLk.form.find("select[name="+l+"] option").removeAttr("selected");g.each(f.split(","),function(p,q){k?h.elLk.form.find("select[name="+l+"]").find("option:contains("+q+")").prop("selected",!0):h.elLk.form.find("select[name="+l+"]").find("option[value="+q+"]").prop("selected",!0)})}}});u.Panel.ToolsSpeciesList=u.Panel.extend({init:function(){this.base();this.elLk.checkboxes=g(".checkboxes",this.el);this.elLk.speciesList=g('.checkboxes input[name="species"]',this.el);this.elLk.multiselect=parseInt(g('input[name="multiselect"]',this.el).val()||1);this.elLk.vep_assembly=g("._vep_assembly span",this.el);this.elLk.list=g(".list",this.el);this.elLk.modalLink=g(".modal_link",this.el);0<g(".species_form_data",this.el).length&&(this.elLk.species_form_data=g(".species_form_data",this.el).data("species_form_data"));u.species&&"Multi"!==u.species&&this.updateTaxonSelection([{key:u.species,title:u.species}]);u.EventManager.register("updateTaxonSelection",this,this.updateTaxonSelection)},updateTaxonSelection:function(b){var c=this,f,h=[];c.elLk.list.empty();c.elLk.checkboxes.empty();g.each(b,function(q,m){f=m.key.charAt(0).toUpperCase()+m.key.substr(1);q=g("<span/>",{text:"x","class":"ss-selection-delete",click:function(){var w=g(this).parent("li").find("span.ss-selected").html(),z=[];"Homo_sapiens"!==w&&"Human"!==w||c.el.find("div.assembly_msg").hide();c.elLk.vep_assembly&&c.elLk.vep_assembly.parent().hide();g.each(b,function(B,D){w!==D.title&&z.push(D)});u.EventManager.trigger("updateTaxonSelection",z);g(this).parent("li").remove()}});"Homo_sapiens"===m.title||"Human"===m.title?c.el.find("div.assembly_msg").show():c.el.find("div.assembly_msg").hide();var t=g("<img/>",{src:m.img_url||c.elLk.species_form_data&&c.elLk.species_form_data[m.key].img_url||u.speciesImage,"class":"nosprite"}),v=g("<span/>",{text:m.title,"data-title":m.title,"data-key":m.key,"class":"ss-selected",title:m.title});g("<li/>",{}).append(t,v,q).appendTo(c.elLk.list);q="";c.elLk.species_form_data&&c.elLk.species_form_data[m.key]&&(q=c.elLk.species_form_data[m.key]["class"]);g(c.elLk.checkboxes).append('<input type="checkbox" name="species" class="'+
q+'" value="'+f+'" checked>'+m.title+"<br />");h.push(f)});if(b&&0<b.length){u.EventManager.trigger("resetSearchTools",null,h);u.EventManager.trigger("resetSourceTypes",h);var k={};c.elLk.species_form_data&&0<Object.keys(c.elLk.species_form_data).length&&(g.each(Object.keys(c.elLk.species_form_data),function(q,m){if(c.elLk.species_form_data[m]&&c.elLk.species_form_data[m]["class"]){q=c.elLk.species_form_data[m]["class"];var t=g.map(q.match(/(\s+|^)_stt__([^\s]+)/g)||[],function(v){return v.replace("_stt__","._stt_")});t.push("._stt_"+m);k[m]=q.match(/(\s+|^)_sttmulti($|\s+)/)?t.join(","):t[0]}}),u.EventManager.trigger("resetSelectToToggle",k),c.elLk.vep_assembly.html(c.elLk.species_form_data[b[0].key].vep_assembly).parent().show())}if(c.elLk.modalLink.length){var l=c.elLk.modalLink.attr("href").split("?")[0],p=g.map(b,function(q){return q.key});p=g.param({s:p,multiselect:this.elLk.multiselect,referer_type:"Tools"},!0);c.elLk.modalLink.attr("href",l+"?"+p)}}});u.Panel.VEPForm=u.Panel.ToolsForm.extend({init:function(){this.base();this.resetSpecies(this.defaultSpecies);this.consequencesData=this.params.consequences_data;delete this.params.consequences_data;this.exampleData=this.params.example_data;delete this.params.example_data;var b=this;this.speciesname_map=this.params.speciesname_mapping;b.elLk.form.find("input[name=core_type]").each(function(c){"gencode_basic"==g(this).val()?g(this).parent().addClass("_stt_Homo_sapiens _stt_Mus_musculus"):(c=g(this).next().html().replace("Ensembl ",'Ensembl<span class="_stt_Homo_sapiens _stt_Mus_musculus">/GENCODE</span> '),g(this).next().html(c))});this.elLk.form.find("a._example_input").on("click",function(c){c.preventDefault();c=b.elLk.form.find("input[name=species]:checked").val()||b.elLk.form.find("input[name=species]").val();c=b.exampleData[c][this.rel];"undefined"!==typeof c&&c.length||(c="");c=c.replace(/\\n/g,"\n");b.elLk.dataField.val(c).trigger("focus")});this.elLk.previewButton=b.elLk.form.find("[name=preview]").hide().on("click",function(c){c.preventDefault();b.enablePreviewButton(!1);b.preview(g(this).data("currentVal"),{left:c.pageX,top:c.pageY})});this.elLk.previewDiv=g('<div class="vep-preview-div">').appendTo(g(L.body));this.elLk.dataField=this.elLk.form.find("textarea[name=text]").on({"paste keyup click change focus scroll":function(c){b.dataFieldInteraction(c.type)}});this.elLk.previewButton.appendTo(this.elLk.dataField.parent());this.elLk.form.find(".plugin_enable").change(function(){b.elLk.form.find(".plugin-highlight").removeClass("plugin-highlight");b.elLk.form.find("._stt_"+this.name).addClass("plugin-highlight",100,"linear")});this.elLk.form.find(".plugin_enable").each(function(){b.elLk.form.find("._stt_"+this.name).find(":input").change(function(){b.elLk.form.find(".plugin-highlight").removeClass("plugin-highlight")})});this.editExisting();this.resetSelectToToggle();this.elLk.form.on("validate",function(c){b.getSelectedSpecies().length?""==g.trim(g(this).find(".vep-input").val())&&""==g(this).find(".ffile").val()&&""==g(this).find(".ftext.url ").val()&&(b.showError("Please provide an input.","No input found"),g(this).data("valid",!1)):(b.showError("Please select a species to run VEP against.","No species selected"),g(this).data("valid",!1))})},dataFieldInteraction:function(b){var c=this.elLk.dataField[0].value;b=u.browser.webkit?13:15;this.elLk.dataField.removeClass("focused");this.elLk.previewButton.hide();if(this.elLk.dataField.data("previousValue")!==c){this.elLk.dataField.data("previousValue",c);var f=this.elLk.dataField,h=f.data;var k=this.detectFormat(c.split(/[\r\n]+/)[0]);h.call(f,"inputFormat","id"===k||"vcf"===k||"ensembl"===k||"hgvs"===k||"spdi"===k?k:!1)}this.dataFieldHeight||(this.dataFieldHeight=this.elLk.dataField.height());c.length&&this.elLk.dataField.data("inputFormat")&&(this.elLk.fakeDataField||(this.elLk.fakeDataField=g('<div class="vep-input-div">').appendTo(this.elLk.form)),h=this.elLk.dataField.prop("selectionStart"),f=c.substr(0,h).replace(/.+[\r\n]/g,"")+c.substr(h).replace(/[\r\n].+/g,""),f.length&&(c=this.elLk.fakeDataField.html(c.substr(0,h)+"x").show().height()-b-this.elLk.dataField.scrollTop(),this.elLk.fakeDataField.hide(),this.elLk.dataField.addClass("focused").css("background-position","0 "+c+"px"),this.elLk.previewButton.show().css("margin-top",Math.max(Math.min(c,this.dataFieldHeight-b),0)+1).data("currentVal",f)))},preview:function(b,c){if(b){b=b.replace(/[\r\n]/g,"");this.elLk.previewDiv.empty().removeClass("active").addClass("loading").css(c);this.previewInp={};this.previewInp.input=b;this.previewInp.format=this.detectFormat(b);this.previewInp.species=this.speciesname_map[this.elLk.form.find("input[name=species]").val()];this.previewInp.baseURL=this.params.rest_server_url+"/vep/"+this.previewInp.species;switch(this.previewInp.format){case"id":b=this.previewInp.baseURL+"/id/"+this.previewInp.input;break;case"hgvs":b=this.previewInp.baseURL+"/hgvs/"+encodeURIComponent(this.previewInp.input);break;case"ensembl":var f=this.previewInp.input.split(/\s+/);b=this.previewInp.baseURL+"/region/"+f[0]+":"+f[1]+"-"+f[2]+":"+(f[4]&&f[4].match(/\-/)?-1:1)+"/"+f[3].replace(/[ACGTN-]+\//,"");break;case"vcf":f=this.previewInp.input.split(/\s+/);b=f[0];c=f[3];var h=f[4].split(",")[0];if(!h.match(/[ACGTN]+/i)){this.previewError("allele must be [ACGT]");return}f=parseInt(f[1]);var k=f+(c.length-1);c.length!=h.length&&(f+=1,h=1===h.length?"-":h.substring(1));b=this.previewInp.baseURL+"/region/"+b+":"+f+"-"+k+":1/"+h;break;case"spdi":f=this.previewInp.input.split(/:/);b=f[0];c=""==f[2]?"-":f[2];h=""==f[3]?"-":f[3];f=parseInt(f[1])+1;k=f+(c.length-1);b=this.previewInp.baseURL+"/region/"+b+":"+f+"-"+k+":1/"+h;break;default:this.previewError("Failed for "+
this.previewInp.format+" format");return}this.elLk.previewDiv.html('<p><img src="/i/ajax-loader.gif"/></p>');g.ajax({url:b,type:"GET",dataType:"json",context:this,success:function(l){this.renderPreviewTable(l)},error:function(l,p,q){this.previewError(l.responseJSON?l.responseJSON.error:"Unknown error")}})}},detectFormat:function(b){b=b.split(/\s+/);return 1===b.length&&b[0].match(/^(.*?:){2}([^:]+|)$/i)?"spdi":1===b.length&&b[0].match(/^([^:]+):.*?([cgmrp]?)\.?([\*\-0-9]+.*)$/i)?"hgvs":1===b.length?"id":5<=b.length&&b[0].match(/(chr)?\w+/)&&b[1].match(/^\d+$/)&&b[3].match(/^[ACGTN\-\.]+$/i)&&"undefined"!=typeof b[4]&&b[4].match(/^([\.ACGTN\-]+,?)+$|^(<\w+>)$/i)?"vcf":4<=b.length&&b[0].match(/\w+/)&&b[1].match(/^\d+$/)&&b[2].match(/^\d+$/)&&b[3].match(/(ins|dup|del)|([ACGTN-]+\/[ACGTN-]+)/i)?"ensembl":"unknown"},renderPreviewTable:function(b){var c=this;if(b&&b.length){b=b[0];var f=function(p,q){return g('<table class="ss">').html("<thead><tr>"+g.map(p,function(m){return"<th>"+m+"</th>"}).join("")+
"</tr></thead>").append(g.map(q,function(m,t){return g("<tr>").addClass(t%2?"bg2":"bg1").append(g.map(m,function(v){return g("<td>").html(v)}))}))},h=function(p){return c.consequencesData[p]?g("<nobr>").append(g("<span>").addClass("colour").css("background-color",c.consequencesData[p].colour).html("&nbsp"),g("<span>").html("&nbsp;"),g("<span>").attr({"class":"_ht ht margin-left",title:c.consequencesData[p].description}).html(p)).wrap("<div>").parent().html():""},k=function(p,q,m,t){return g("<a>").attr({"class":"zmenu",href:"/"+p+"/ZMenu/"+q+"?"+q.replace(/[a-z]/g,"").toLowerCase()+"="+m}).html(t).wrap("<div>").parent().html()};this.elLk.previewDiv.removeClass("loading").html('<div class="hint"><h3><img src="/i/close.png" alt="Hide" class="_close_button" title="">Instant results for '+this.previewInp.input+'</h3><div class="message-pad"><div class="warning"><h3>Instant VEP</h3><div class="message-pad"><p>The below is a preview of results using the <i>'+this.previewInp.species.replace("_"," ")+'</i> Ensembl transcript database and does not include all data fields present in the full results set. To obtain these please <b>close this preview window and submit the job using the <a class="button">Run</a> button below</b>.</p></div></div><p><b>Most severe consequence:</b> '+
h(b.most_severe_consequence)+"</p>"+(b.colocated_variants?"<p><b>Colocated variants:</b> "+g.map(b.colocated_variants,function(p){return k(c.previewInp.species,"Variation",p.id,p.id)+(p.minor_allele_freq?" <i>(MAF: "+p.minor_allele_freq+")</i>":"")}).join(", ")+"</p>":"")+'<div class="vep-preview-table _preview_table"></div></div></div>');var l=[];b.transcript_consequences&&g.merge(l,g.map(b.transcript_consequences,function(p){var q=[];q.push('<p class="no-bottom-margin"><b>'+k(c.previewInp.species,"Gene",p.gene_id,p.gene_symbol||p.gene_id)+"</b>: "+k(c.previewInp.species,"Transcript",p.transcript_id,p.transcript_id)+'</p><p class="small no-bottom-margin"><b>Type: </b>'+p.biotype+"</p>");q.push(p.consequence_terms.map(function(t){return h(t)}).join(", "));var m=[];p.amino_acids&&m.push("<b>Amino acids:</b> "+p.amino_acids);p.sift_prediction&&m.push("<b>SIFT:</b> "+p.sift_prediction);p.polyphen_prediction&&m.push("<b>PolyPhen:</b> "+p.polyphen_prediction);p.distance&&m.push("<b>Distance to transcript:</b> "+
p.distance+"bp");m.length||(m=["-"]);q.push(g.map(m,function(t){return'<p class="no-bottom-margin">'+t+"</p>"}));return[q]}));b.regulatory_feature_consequences&&g.merge(l,g.map(b.regulatory_feature_consequences,function(p){return[["<b>"+k(c.previewInp.species,"RegulatoryFeature",p.regulatory_feature_id,p.regulatory_feature_id)+'</b><br/><span class="small"><b>Type: </b>'+p.biotype+"</span>",p.consequence_terms.map(function(q){return h(q)}).join(", "),"-"]]}));l.length&&this.elLk.previewDiv.find("._preview_table").append(f(["Gene/Feature/Type","Consequence","Details"],l));this.elLk.previewDiv.find("a.zmenu").on("click",function(p){p.preventDefault();u.EventManager.trigger("makeZMenu",this.innerHTML.replace(/\W/g,"_"),{event:p,area:{link:g(this)}})}).end().find("._ht").helptip().end().find("._close_button").on("click",function(){c.elLk.previewDiv.empty();c.enablePreviewButton()});this.elLk.previewDiv.addClass("active")}else this.previewError("Invalid response from "+this.params.rest_server_url)},previewError:function(b){this.elLk.previewDiv.removeClass("active loading");this.enablePreviewButton();alert("Unable to generate preview:\n"+b)},enablePreviewButton:function(b){!1===b?this.elLk.previewButton.addClass("disabled").prop("disabled",!0):this.elLk.previewButton.removeClass("disabled").removeAttr("disabled")},populateForm:function(b){b&&b.length&&(b=g.extend({},b[0].config,b[0]),this.base([b]),b.input_file_type&&this.elLk.form.find("input[name=file]").parent().append('<p class="_download_link">'+("text"===b.input_file_type?'Click <a href="'+b.input_file_url+'">here</a> to download the previously uploaded file.':"You previously uploaded a compressed file to run this job.")+"</p>"),this.resetSpecies(b.species),this.elLk.dataField.trigger("change"))},reset:function(){this.base.apply(this,arguments);this.elLk.form.find("._download_link").remove();this.elLk.dataField.removeClass("focused");this.elLk.previewDiv.empty().removeClass("active loading");this.elLk.previewButton.hide();this.resetSpecies(this.defaultSpecies);this.resetSelectToToggle()},resetSpecies:function(b){var c=[];c.push({key:b,title:b});u.EventManager.deferTrigger("updateTaxonSelection",c)}});u.Panel.VRForm=u.Panel.ToolsForm.extend({init:function(){this.base();this.resetSpecies(this.defaultSpecies);this.exampleData=this.params.example_data;delete this.params.example_data;var b=this;this.elLk.form.find("a._example_input").on("click",function(c){c.preventDefault();c=b.elLk.form.find("input[name=species]:checked").val()||b.elLk.form.find("input[name=species]").val();c=b.exampleData[c][this.rel];"undefined"!==typeof c&&c.length||(c="");c=c.replace(/\\n/g,"\n");b.elLk.dataField.val(c).trigger("focus")});this.elLk.dataField=this.elLk.form.find("textarea[name=text]").on({"paste keyup click change focus scroll":function(c){b.dataFieldInteraction(c.type)}});this.editExisting();this.resetSelectToToggle()},dataFieldInteraction:function(b){this.elLk.dataField.removeClass("focused");this.dataFieldHeight||(this.dataFieldHeight=this.elLk.dataField.height())},populateForm:function(b){b&&b.length&&(b=g.extend({},b[0].config,b[0]),this.base([b]),b.input_file_type&&this.elLk.form.find("input[name=file]").parent().append('<p class="_download_link">'+
("text"===b.input_file_type?'Click <a href="'+b.input_file_url+'">here</a> to download the previously uploaded file.':"You previously uploaded a compressed file to run this job.")+"</p>"),this.resetSpecies(b.species),this.elLk.dataField.trigger("change"),this.elLk.form.find("input[name=id]").length&&!b.id&&this.elLk.form.find("input[name=id]").prop("checked",!1),this.elLk.form.find("input[name=hgvsg]").length&&!b.hgvsg&&this.elLk.form.find("input[name=hgvsg]").prop("checked",!1),this.elLk.form.find("input[name=hgvsc]").length&&!b.hgvsc&&this.elLk.form.find("input[name=hgvsc]").prop("checked",!1),this.elLk.form.find("input[name=hgvsp]").length&&!b.hgvsp&&this.elLk.form.find("input[name=hgvsp]").prop("checked",!1),this.elLk.form.find("input[name=spdi]").length&&!b.spdi&&this.elLk.form.find("input[name=spdi]").prop("checked",!1),this.elLk.form.find("input[name=vcf_string]").length&&!b.vcf_string&&this.elLk.form.find("input[name=vcf_string]").prop("checked",!1),this.elLk.form.find("input[name=var_synonyms]").length&&!b.var_synonyms&&this.elLk.form.find("input[name=var_synonyms]").prop("checked",!1),this.elLk.form.find("input[name=mane_select]").length&&!b.mane_select&&this.elLk.form.find("input[name=mane_select]").prop("checked",!1))},reset:function(){this.base.apply(this,arguments);this.elLk.form.find("._download_link").remove();this.elLk.dataField.removeClass("focused");this.resetSpecies(this.defaultSpecies);this.resetSelectToToggle()},resetSpecies:function(b){var c=[];c.push({key:b,title:b});u.EventManager.deferTrigger("updateTaxonSelection",c)}});u.Panel.DataSlicerForm=u.Panel.ThousandGenome.extend({init:function(){var b=this;this.base.apply(this,arguments);this.elLk.vcf_filters_radio=this.elLk.form.find("input[name=vcf_filters]");this.elLk.individuals=this.elLk.form.find("div._individuals");b.elLk.vcf_filters_radio.on("change",function(){"individuals"===b.elLk.form.find("input[name=vcf_filters]:checked").val()&&(b.elLk.region.val()?b.updateIndividuals():(b.showError("Please choose a region first","Missing region"),b.elLk.form.find("input[name=vcf_filters][value=null]").prop("checked",!0),b.elLk.form.find("div._stt_individuals").hide()))});b.elLk.form.find("input[name=custom_file_url]").on("change",function(){})},reset:function(){this.base.apply(this,arguments);this.elLk.form.find("div._stt_populations").hide();this.elLk.form.find("div._stt_individuals").hide();this.elLk.form.find("select[name=file_format]").find("option[value=vcf]").prop("selected",!0).end().selectToToggle("trigger");this.elLk.form.find("span._span_url").html("Genotype file URL: ").show();this.elLk.form.find("input[name=generated_file_url]").val("")},updateIndividuals:function(b){var c=this;g.ajax({comet:!0,type:"POST",dataType:"json",url:c.getIndividuals,beforeSend:function(){c.toggleSpinner(!0)},data:{file_url:c.elLk.form.find("input[name=custom_file_url]:visible").val()||c.elLk.form.find("input[name=generated_file_url]").val(),region:c.elLk.region.val()},success:function(f){var h="";f.error?(c.showError("The file url is either invalid or not reachable","Invalid genotype file URL"),c.elLk.form.find("div._individuals select").html(""),g(c.elLk.form).data("valid",!1),c.toggleSpinner(!1)):f.vcf_error?(c.showError(f.vcf_error,"VCF file ERROR"),c.elLk.form.find("div._individuals select").html(""),g(c.elLk.form).data("valid",!1),c.toggleSpinner(!1)):(g.each(f.individuals,function(k,l){l.value&&(h+='<option value="'+l.value+'">'+l.value+"</option>")}),c.elLk.form.find("div._individuals").show(),c.elLk.form.find("div._individuals select").html("").append(h),b&&g.each(b.split(","),function(k,l){c.elLk.form.find("div._individuals select").find("option[value="+l+"]").prop("selected",!0)}))},complete:function(f){c.toggleSpinner(!1)}})}});u.GA&&F.location.href.match(/\/Tools\/[^\/]+\/Results/)&&function(b){b.oldLabel=b.label;b.label=function(){var c=this.oldLabel();c&&this.currentTarget.href.match(/\/Tools\/[^\/]+\/Results/)&&(c="Tools Job Result");return c}}(u.GA.getConfig("LocalContext-LeftButton"));u.GA&&(u.Panel.Content=u.Panel.Content.extend({runBlastSeq:function(b){this.elLk.blastForm&&b&&u.GA.sendEvent(new u.GA.EventConfig({category:"LocalButton",action:"BlastSelectedSeq"}));this.base(b)}}));(function(){(function(b){b.fn.centered=function(h){if("string"===b.type(h)){if("redo"===h)return this.each(function(){return b(this).trigger("redo")})}else{var k=b.extend({},b.fn.centered.defaults,h);return this.each(function(){c(b(this),k);return b(this).on("redo",function(l){return c(b(this),k)})})}};var c=function(h,k){var l;h.find(".centeredinner").length&&h.html(h.find(".centeredinner").html());var p=b("<div/>").html(h.html()).css("word-wrap","break-word");h.empty().append(p).css("line-height","normal");p.addClass("centeredinner");var q=null;var m=l=k.min;var t=k.max;for(k=k.inc;0<k?l<=t:l>=t;m=l+=k){p.css("font-size",m+"px");if(f(p))break;q=m}q&&p.css("font-size",q+"px");h=h.height()-p.outerHeight();h%2&&--h;h/=2;return p.css({"margin-top":h,"margin-bottom":h,"text-align":"center"})};var f=function(h){return h.height()>h.parent().height()||h.width()>h.parent().width()?!0:!1};return b.fn.centered.defaults={min:5,max:100,inc:5}})(jQuery)}).call(this);(function(){(function(b){b.fn.selbox=function(p,q,m,t){if("string"===b.type(p)){if("activate"===p)return this.each(function(){return b(this).trigger("selboxactivate",[!0,q,m,t])});if("deactivate"===p)return this.each(function(){return b(this).trigger("selboxactivate",[!1])});if("maintext"===p)return this.each(function(){return b(this).trigger("selboxtext",[q])});if("select"===p)return this.each(function(){return b(this).trigger("selboxselect",[q])})}else{var v=b.extend({},b.fn.selbox.defaults,p);return this.each(function(){b(this).on("selboxtext",function(w,z){return c(b(this),z,v)});b(this).on("selboxselect",function(w,z){w=b(this).data("selboxul");if(w.length)return h(b(this),b('a[href="#'+z+'"]',w),v)});return b(this).on("selboxactivate",function(w,z,B,D,E){return z?f(b(this),B,D,E,v):l(b(this),v)})})}};var c=function(p,q,m){p=p.closest(".selboxouter").find(".selboxtext");p.html(q);return m.selchange.call(p)};var f=function(p,q,m,t,v){if(!p.closest(".selboxouter").length){p.width();var w=p.siblings(".fbutton");var z=b(v.template);var B=b(".selbox",z);var D=b(".selboxnew",z);z.insertBefore(p);D.append(p);D.append(w);b(".replacement_filter",D).width("auto");w.css("margin-top","2px");B.height(p.height());b(".selboxtext",B).height(B.height());null!=v.field&&b("<input/>").attr({type:"hidden",name:v.field}).addClass("selboxfield").appendTo(B);p.selbox("maintext",q);var E=b("ul",z).css({display:"none",width:B.width()});q=D.offset();E.appendTo("body").css({top:q.top+D.height()+"px",left:q.left+"px"});p.data("selboxul",E);var G=null;u.GA&&u.GA.EventConfig&&(G=new u.GA.EventConfig({category:"SearchInputFeatureType",nonInteraction:!0}));B.click(function(K){E.toggle();return b(".selboxselected",E).removeClass("selboxselected")});B=E.outerWidth()-E.width();E.width(E.width()-B);D=D.outerWidth()-D.width()-(E.outerWidth()-E.width());w=B=0;for(q=m.length;B<q;w=++B){var I=m[w];w=b("<a/>").attr("href","#"+t[w]).html(I).wrap("<li/>").parent();w.css("padding-left",parseInt(w.css("padding-left"))+D+"px").appendTo(E);w.click(function(K){null==F.location.pathname.match(/Search\/Results/)&&G&&u.GA.sendEvent(G,{action:b("a",this).text(),label:u.species});return h(p,b("a",this),v)});b("a",w).on("click",function(K){return h(p,b(this),v)});w.mouseleave(function(){return b(this).removeClass("selboxselected")});w.mouseenter(function(){E=b(this).closest("ul");E.find("li").removeClass("selboxselected");var K=E.find(".selboxforce").removeClass("selboxforce");K.length||(K=b(this));return K.addClass("selboxselected")})}b("html").on("focusin",function(K){if(b(K.target).parents(".selboxlist").length)return!0;p.data("selboxul").hide();return!0});return b("html").keydown(function(K){switch(K.keyCode){case 27:return E.hide();case 40:return K=b(".selboxselected",E).removeClass("selboxselected").next(),K.length||(K=b("li",E).first()),K.addClass("selboxselected"),k(K);case 38:return K=b(".selboxselected",E).removeClass("selboxselected").prev(),K.length||(K=b("li",E).last()),K.addClass("selboxselected"),k(K);case 13:return K=b(".selboxselected a",z),K.length&&h(p,K,v),E.hide()}})}};var h=function(p,q,m){var t=q.attr("href");t=t.substring(t.indexOf("#"));m.action.call(p,t.substring(1),q.html(),m);q.closest("ul").hide();b(".selboxfield",p.closest(".selboxnew")).val(t.substring(1));return!1};var k=function(p){var q=p.position().top;var m=q+p.outerHeight();var t=p.closest("ul");var v=t.height();t.find(".selboxforce").removeClass("selboxforce");p.addClass("selboxforce");if(0>q)return t.scrollTop(t.scrollTop()+q-10);if(m>v)return t.scrollTop(t.scrollTop()+(m-v)+10)};var l=function(p,q){q=p.closest(".selboxouter");if(q.length)return p.width(q.width()-(p.outerWidth()-p.width())),p.insertAfter(q),p.data("selboxul").hide(),q.remove()};return b.fn.selbox.defaults={action:function(){},selchange:function(){},field:null,template:'<div class="selboxouter">\n  <div class="selboxnew">\n    <div class="selbox">\n      <div class="selboxarrow">\n        <div class="selboxtext">\n          Hello\n        </div>\n      </div>\n    </div>\n  </div>\n  <ul class="selboxlist">\n  </ul>\n</div>'}})(jQuery)}).call(this);(function(){var b=[].slice;(function(c){c.solr_config=function(){var k=arguments[0];var l=2<=arguments.length?b.call(arguments,1):[];if("string"===c.type(k))return h(k,l);k=c.extend({},c.solr_config.defaults,k);return f(k)};var f=function(k){return c("html").data("config")?(new c.Deferred).resolve():c.ajax({url:k.url,dataType:"json"}).done(function(l){return c("html").data("config",l)})};var h=function(k,l){var p,q;var m=c("html").data("config");var t=0;var v=k.split(".");var w=0;for(p=v.length;w<p;w++){var z=v[w];if(null!=m)if("%"===z)m=m[l[t]],t+=1;else if("="===z.charAt(z.length-1)){z=z.substring(0,z.length-1);var B=l[t];t+=1;var D=null;var E=0;for(q=m.length;E<q;E++)k=m[E],k[z]===B&&(D=k);m=D}else m=m[z]}return m};return c.solr_config.defaults={}})(jQuery)}).call(this);(function(){F.rate_limiter=function(c,f){var h,k;var l=h=k=null;return function(p){var q=g.Deferred();l&&(l.reject(),clearTimeout(k),l=null);var m=(new Date).getTime();!h||m-h>f?(h=m,q.resolve(p)):(l=q,h=m,k=setTimeout(function(){return q.resolve(p)},c));return q}};F.then_loop=function(c){var f;return f=function(h){return(h=c(h))&&g.isFunction(h.promise)?h.then(f):h}};var b=function(c,f){var h=then_loop(function(k){return function(l){var p=l[0];return l[1]?p:f(p,c).then(function(q){return-1===q?[p,1]:[p+q,0]})}}(this));return g.Deferred().resolve([0,0]).then(h)};F.in_chunks=function(c,f,h){if(-1===c)return b(f,h);var k=then_loop(function(l){return function(p){if(0>=c-p)return p;var q=c-p;q>f&&(q=f);return h(p,q).then(function(m){return p+m})}}(this));return g.Deferred().resolve(0).then(k)};F.solr_current_species=function(){var c;var f=F.location.href.split("/")[3].toLowerCase();(c=g.solr_config("spnames.%",f))||(c=f);c=c.toLowerCase();return g.solr_config("revspnames.%",c)?c:null}}).call(this);(function(){var b=function(){if(u.GA)return new u.GA.EventConfig({category:function(){return"/Multi/Search"===this.ui.item.link.substr(0,13)?"SrchAuto":"SrchDirect"},action:function(){return g(this.target).parents("#masthead").length?"masthead":"results"},label:function(){return this.ui.item.link},nonInteraction:!1})};g.fn.getCursorPosition=function(){var O;if(O=this.get(0)){if(null!=O.selectionStart)return O.selectionStart;if(L.selection){O.focus();var Q=L.selection.createRange();var N=L.selection.createRange().text.length;Q.moveStart("character",-O.value.length);return Q.text.length-N}}};var c=function(){var O=g("#species_path").val()+"/Ajax/config";return g.solr_config({url:O})};var f={};var h=[];var k=function(O,Q){if(null!=f[O])Q(f[O],h);else return p("/Multi/Ajax/species",{name:O},function(N){var X;null!=N.favs&&(h=N.favs);return null!=(X=N.result)&&X[0]?(f[O]=N.result[0],Q(N.result[0],h)):Q(void 0,h)})};var l=function(O,Q){var N=!1;null!=O&&(O=O.parents("form").find("input[name='site']"),0!==O.length&&"ensembl"!==O.val()&&"ensembl_all"!==O.val()&&"vega"!==O.val()&&(N=!0));if(!N){N=decodeURIComponent(F.location.pathname.split("/")[1]);if(null==N||"Multi"===N)N="";return k(N,function(X,Z){if(null!=X)return Q([X.common]);var ea;var ja=[];var ha=0;for(ea=Z.length;ha<ea;ha++)X=Z[ha],ja.push(X.common);return Q(ja)})}};var p=function(O,Q,N){return g.ajax({url:O,data:Q,traditional:!0,success:N,dataType:"json",cache:!1})};var q={};var m=function(O,Q){var N;if(q[O.uid])return q[O.uid];var X=g.inArray(O.species,Q);X=-1<X?Q.length-X+1:0;Q=200*X+100*g.inArray(O.feature_type,z);Q+=-1!==(null!=(N=O.location)?N.indexOf("_"):void 0)?0:10;Q+="core"===O.database_type?40:0;return q[O.uid]=Q};var t=function(O,Q,N,X){var Z,ea;Q.sort(function(oa,ka){return m(ka,N)-m(oa,N)});var ja=[];var ha=0;for(ea=Q.length;ha<ea;ha++){var aa=Q[ha];var ia=B[aa.feature_type];null==ia&&(ia=B[""]);O={};for(Z in ia){var la=ia[Z];O[Z]=la.replace(/\{(.*?)\}/g,function(oa,ka){var qa,ra;return null!=(qa=null!=(ra=aa[ka])?ra:aa.id)?qa:"unnamed"})}O.link="/"+aa.url;ja.push(O)}return X(ja)};var v=function(O,Q){var N;Q=Q.toLowerCase();(N=F.solr_current_species())||(N="all");return p(O,{q:N+"__"+Q,spellcheck:!0})};var w=function(O,Q){var N,X,Z;O=null!=(N=O.result)?null!=(X=N.spellcheck)?null!=(Z=X.suggestions[1])?Z.suggestion:void 0:void 0:void 0;if(null!=O){for(X=[];O.length;)N=O.shift(),N=N.replace(/^.*?__/,""),X.push(Q.push({left:"Search for '"+N+"'",link:"/Multi/Search/Results?q="+N,text:N}));return X}};var z=["Phenotype","Gene"];var B={Phenotype:{left:"{name}",right:"{species} Phenotype"},Gene:{left:"{name}",right:"<i>{species}</i> Gene {id}"},"":{left:"{name}",right:"{id} {feature_type}"}};var D={Phenotype:"{ucspecies}/Phenotype/Locations?ph={id}",Gene:"{ucspecies}/Gene/Summary?g={id};{rest}"};var E=[{ft:["Phenotype"],fields:["name*","description*"]},{ft:["Gene"],fields:["name*"]},{ft:["Sequence"],fields:["id"],minlen:6},{fields:["id"],minlen:6}];var G=[{fields:["id"],minlen:3},{ft:["Gene","Sequence"],fields:["name"]}];var I=function(O,Q,N,X){return c().then(function(Z){return function(ea){var ja;if(!g.solr_config("static.ui.enable_direct"))return(new g.Deferred).resolve();ea=[];var ha={};var aa=0;for(ja=X.length;aa<ja;aa++){var ia=X[aa];ia=g.solr_config("spnames.%",ia.toLowerCase());ea.push(ia.toLowerCase());ha[ia.toLowerCase()]=1}(aa=F.solr_current_species())&&null==ha[aa.toLowerCase()]&&ea.push(aa.toLowerCase());ia=[];ha=0;for(aa=ea.length;ha<aa;ha++){var la=ea[ha];la=la.replace(/_/g,"_-").replace(/\s+/g,"_+");ja=N.toLowerCase().replace(/_/g,"_-").replace(/\s+/g,"_+");ia.push(la+"__"+ja)}ja=ia.join(" ");return p(Q,{q:ja,directlink:!0,spellcheck:!0})}}(this))};var K=function(O,Q){var N,X,Z,ea,ja,ha,aa,ia,la;var oa=0;O=null!=(Z=O.result)?null!=(ea=Z.spellcheck)?ea.suggestions:void 0:void 0;var ka=[];Z=ea=0;for(ja=O.length;ea<ja;Z=++ea){var qa=O[Z];if(!(!Z%2)){if(6<=oa)break;var ra=qa.suggestion;null!=ra&&ka.push(function(){var Oa,Ga;var Na=[];var Ia=0;for(Oa=ra.length;Ia<Oa;Ia++){N=ra[Ia];aa=[];var Ma=N.split("__");var Fa=0;for(Ga=Ma.length;Fa<Ga;Fa++)ha=Ma[Fa],aa.push(ha.replace(/_\+/g,"_").replace(/_\-/g," "));ia=g.solr_config("revspnames.%",aa[0].toLowerCase());la=aa[0].charAt(0).toUpperCase()+aa[0].slice(1);X={name:aa[4],id:aa[3],species:ia,ucspecies:la,rest:aa[5],feature_type:aa[2]};X.url=D[aa[2]];X.url=X.url.replace(/\{(.*?)\}/g,function(xa,Sa){var Ha;return null!=(Ha=X[Sa])?Ha:""});"string"===typeof X.id&&2===X.id.split(":").length&&(X.url=X.url.replace(/ph=/g,"oa="));Q.push(X);oa+=1;if(6<=oa)break;else Na.push(void 0)}return Na}())}}return ka};var S=null;var U=function(O){return S?S(O):c().then(function(Q){return function(N){N=g.solr_config("static.ui.direct_pause");S=F.rate_limiter(N[0],N[1]);return S(O)}}(this))};var T=function(O){return(O=O.parents("form").find("input[name='site']").val())?"ensembl"===O||"ensembl_all"===O||"vega"===O:!0};var V=[{type:"search",label:""},{type:"direct",label:"Direct Links"}];g.widget("custom.searchac",g.ui.autocomplete,{_create:function(){var O,Q;var N=g("body");if(N.hasClass("ie67")||N.hasClass("ie8")||N.hasClass("ie9")||N.hasClass("ie10"))this.element.clone().addClass("solr_ghost").css("display","none").insertAfter(this.element),g.ui.autocomplete.prototype._create.call(this);else{N=this.element.height();var X=this.element.width();N=g("<div></div>").css({position:"relative",display:"inline-block","vertical-align":"bottom"}).width(X).height(N);var Z=["left","right","top","bottom"];var ea=0;for(O=Z.length;ea<O;ea++){X=Z[ea];var ja=["margin","padding"];var ha=0;for(Q=ja.length;ha<Q;ha++){var aa=ja[ha];N.css(aa+"-"+X,this.element.css(aa+"-"+X))}Q=["style","color","width"];ha=0;for(aa=Q.length;ha<aa;ha++)ja=Q[ha],N.css("border-"+X+"-"+ja,this.element.css("border-"+X+"-"+ja))}O=["background-color"];ea=0;for(X=O.length;ea<X;ea++)aa=O[ea],N.css(aa,this.element.css(aa));N.insertAfter(this.element);this.element.css("background-image","url(data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)").css("padding",0).css("margin",0).appendTo(N).css("border","none").css("outline","none").css("background-color","transparent");this.element.css({"z-index":2,position:"absolute"});N=this.element.position();var ia=this.element.clone().css({left:N.left+"px",top:N.top+"px"}).css({position:"absolute","z-index":1}).css({background:"none"}).val("").addClass("solr_ghost").attr("placeholder","").attr("id","").attr("tabindex","5000").insertBefore(this.element).attr("name","");g.ui.autocomplete.prototype._create.call(this);var la=this.element.val();this.element.on("change keypress paste focus textInput input",function(oa){return function(ka){ka=oa.element.val();if(ka!==la)return ia.val().substring(0,ka.length)!==ka&&ia.val(""),la=ka}}(this));return this.element.on("keydown",function(oa){return function(ka){if(39===ka.keyCode){var qa=oa.element.val();if((ka=ia.val())&&ka.substring(0,qa.length)===qa&&oa.element.getCursorPosition()===qa.length)return oa.element.val(ka)}}}(this))}},_renderMenu:function(O,Q){var N,X;var Z=[];var ea=0;for(X=V.length;ea<X;ea++){var ja=V[ea];var ha=function(){var aa;var ia=[];var la=0;for(aa=Q.length;la<aa;la++)N=Q[la],N.type===ja.type&&ia.push(N);return ia}();ja.label&&ha.length&&O.append("<li class='search-ac-cat'>"+ja.label+"</li>");Z.push(g.each(ha,function(aa){return function(ia,la){return aa._renderItemData(O,la)}}(this)))}return Z},_renderItem:function(O,Q){var N=g('<a class="search-ac"></a>').html(Q.left);Q.right&&N.append(g("<em></em>").append(Q.right));return g("<li>").append(N).appendTo(O)},options:{source:function(O,Q){return T(this.element)?U({q:O.term,response:Q,element:this.element}).done(function(N){return function(X){var Z;if(Z=g("#se_q").parents("form").attr("action")){Z=Z.split("/")[1];"common"===Z&&(Z="Multi");Z="/"+Z+"/Ajax/search";var ea=X.q;return l(X.element,function(ja){return g.when(v(Z,ea),I(E,Z,ea,ja)).done(function(ha,aa){var ia=[];var la=[];var oa=[];w(ha[0],ia);null!=aa&&aa[0]&&K(aa[0],la);return t(Z,la,ja,function(ka){var qa;la=ka;ka=0;for(qa=ia.length;ka<qa;ka++){var ra=ia[ka];ra.type="search"}qa=0;for(ra=la.length;qa<ra;qa++)ka=la[qa],ka.type="direct";oa=ia.concat(la);return X.response(oa)})})})}}}(this)):Q([])},select:function(O,Q){if(F.hub&&F.hub.code_select){if(Q.item.text){g(O.target).val(Q.item.text);var N=b();u.GA&&N&&u.GA.sendEvent(N,{target:O.target,ui:Q});F.hub.update_url({q:Q.item.text});return!1}Q.item.link&&F.hub.spin_up()}if(Q.item.link)return N=b(),u.GA&&N&&u.GA.sendEvent(N,{target:O.target,ui:Q}),F.location.href=Q.item.link},focus:function(O,Q){var N;var X=g(O.target).parent().find("input.solr_ghost");var Z=g(O.target).val();(null!=(N=Q.item.text)?N:"").substring(0,Z.length)===Z?(X.val(Q.item.text),X.css("font-style",g(O.target).css("font-style"))):X.val("");return!1},close:function(O,Q){return g(O.target).parent().find("input.solr_ghost").val("")}}});g(function(){var O;var Q=g("#SpeciesSearch .search-form");if(!Q.hasClass("no-sel")&&(O=g("#q",Q).parents("form").attr("action")))return O=O.split("/")[1],g.solr_config({url:"/"+O+"/Ajax/config"}).done(function(){var N,X,Z;var ea=g("#q",Q).parent();var ja=[];var ha=[];var aa=g.solr_config("static.ui.facets.key=.members","feature_type");var ia=0;for(N=aa.length;ia<N;ia++){var la=aa[ia];ha.push(null!=(X=null!=(Z=la.text)?Z.plural:void 0)?X:la.key);ja.push(la.key)}ja.unshift("");ha.unshift("Search all categories");return ea.selbox({action:function(oa,ka){return ea.selbox("maintext",ka)},selchange:function(){return this.centered({max:14,inc:1})},field:"facet_feature_type"}).selbox("activate","",ha,ja).selbox("select","")})});F.sp_names=k;F.solr_jump_to=function(O){var Q;if(Q=g("#se_q").parents("form").attr("action"))return Q=Q.split("/")[1],"common"===Q&&(Q="Multi"),Q="/"+Q+"/Ajax/search",l(void 0,function(N){return g.when(I(G,Q,O,N)).done(function(X){var Z=[];K(X,Z);if(0!==Z.length)return F.location.href="/"+Z[0].url})})}}).call(this);u.Panel.SearchBox=u.Panel.SearchBox.extend({init:function(){this.base();var b=g("input#se_q,input#q",this.el);b.parents("form").hasClass("no-ac")||b.searchac().parents("form").submit(function(){if("!!"===b.val().substring(0,2)){var c=b.val().substring(2);F.solr_jump_to(c);return!1}return!0})}});u.Panel.SpeciesSearch=u.Panel.extend({init:function(){this.base();g("input#se_q",this.el);console.log("BOO!")}});u.Panel.GenoverseTest=u.Panel.Content.extend({init:function(){this.base.apply(this,arguments);this.params.updateURL=u.updateURL({genoverse:"function"===typeof u.genoverseSupported?1:0},this.params.updateURL);this.getContent()}});u.Panel.AFDB=u.Panel.Content.extend({init:function(){this.base.apply(this,arguments);this.loadScript()},loadScript:function(){if(this.areStaticImportsSupported()){this.addSpinner();var b=L.createElement("script");b.setAttribute("src","/alphafold/index.js");b.setAttribute("type","module");b.onload=this.onScriptLoaded.bind(this);b.onerror=this.onScriptLoadError.bind(this);L.body.appendChild(b)}else this.onUnsupportedBrowser()},onScriptLoaded:function(){var b=[L.querySelector("ensembl-alphafold-protein"),L.querySelector("ensembl-alphafold-vep")].filter(Boolean).pop();b.addEventListener("loaded",function(){this.onWidgetReady(b)}.bind(this));b.addEventListener("load-error",this.onScriptLoadError.bind(this));b.addEventListener("alphafold-model-missing",this.onAlphafoldModelMissing.bind(this))},onWidgetReady:function(b){this.removeSpinner();b.style.visibility="visible"},onScriptLoadError:function(){this.removeSpinner();this.showMsg("An error occurred while loading the 3D protein viewer")},onAlphafoldModelMissing:function(){this.removeSpinner();this.showMsg("There is no Alphafold model for this molecule")},onUnsupportedBrowser:function(){this.showMsg("Sorry, it seems that the protein viewer is not supported by your browser. Try viewing this page in a recent version of Chrome, Firefox, Edge, or Safari.")},areStaticImportsSupported:function(){return"noModule"in L.createElement("script")},showMsg:function(b){g("#afdb_msg").html('<span class="left-margin right-margin">'+b+"</span>")},addSpinner:function(){g("#afdb_msg").addClass("spinner")},removeSpinner:function(){g("#afdb_msg").removeClass("spinner")}});u.Panel.PDB=u.Panel.Content.extend({init:function(){var b=this;this.base.apply(this,arguments);g.getScript("/pdbe/litemol-custom-theme.js");this.species=u.species;this.rest_url_root=this.params.ensembl_rest_url;this.rest_vep_url=this.rest_url_root+"/vep/"+this.species+"/id/";this.rest_pr_url=this.rest_url_root+"/overlap/translation/";this.rest_lookup_url=this.rest_url_root+"/lookup/id/";this.pdbe_url_root=this.params.pdbe_rest_url;this.rest_pdbe_url_root=this.pdbe_url_root+"/api/";this.rest_pdbe_url=this.rest_pdbe_url_root+"pdb/entry/molecules/";this.rest_pdbe_quality_url=this.rest_pdbe_url_root+"validation/summary_quality_scores/entry/";this.rest_pdbe_sifts_url=this.rest_pdbe_url_root+"mappings/ensembl/";this.protein_sources={Pfam:"https://www.ebi.ac.uk/interpro/entry/pfam/",PRINTS:"https://www.ebi.ac.uk/interpro/signature/",Gene3D:"http://gene3d.biochem.ucl.ac.uk/Gene3D/search?mode=protein&sterm=",PANTHER:"http://www.pantherdb.org/panther/family.do?clsAccession=",Smart:"http://smart.embl-heidelberg.de/smart/do_annotation.pl?DOMAIN="};this.protein_features={};this.hexa_to_rgb={red:{r:255,g:0,b:0},blue:{r:0,g:0,b:250},green:{r:0,g:128,b:0},orange:{r:255,g:165,b:0},white:{r:255,g:255,b:255},dark_grey:{r:100,g:100,b:100},darkred:{r:55,g:0,b:0},"#DDD":{r:221,g:221,b:221}};this.liteMolScope;this.var_id;this.ensp_id;this.ensp_list=[];this.ensp_pdb_list={};this.ensp_pdb_quality_list={};this.ensp_pdb_author_pos={};this.ensp_var_pos={};this.ensp_var_cons={};this.ensp_length={};this.max_feature_per_gp=150;this.mapping_min_percent_length=this.mapping_min_percent=50;this.max_pdb_entries=this.mapping_min_length=10;this.spinner_waiting_time=20;this.pdb_id;this.pdb_start;this.pdb_end;this.pdb_hit_start;this.pdb_pr_name;this.pdb_author_start;this.pdb_author_end;this.pdb_struct_asym;this.pdb_chain_struc_entity={};this.details_header='<th>ID</th><th class="location _ht" title="Position in the selected PDB model"><span>PDB</span></th><th class="location _ht" title="Position in the selected Ensembl protein"><span>ENSP</span></th>';b.addSpinner();g(L).ready(function(){console.log(">>>>> STEP 00: init PDB variables and run document ready");b.addSpinner();g("#ensp_id").length?(b.ensp_id=g("#ensp_id").val(),b.ensp_list.push(b.ensp_id),g.when(b.get_ens_protein_length()).then(function(){b.get_all_pdb_list()})):(g("#variant_use_param").length?(b.var_id=g("#var_id").html(),g.when(b.get_ensp_from_enst(g("#variant_enst").val())).then(function(){if(b.ensp_list.length){var c=g("#variant_pos").val();-1==c.indexOf("-")&&(c+="-"+c);b.ensp_var_pos[b.ensp_id]=c;b.ensp_var_cons[b.ensp_id]=g("#variant_cons").val();g("#var_cons").html("("+b.ensp_var_cons[b.ensp_id]+")");b.get_all_pdb_list()}})):g.when(b.get_var_ensp_data()).then(function(){b.ensp_list.length&&g.when(b.get_ens_protein_length()).then(function(){b.get_all_pdb_list()})}),g("#ensp_list").change(function(){b.ensp_id=g(this).val();b.ensp_id?(g(".var_pos").html(b.ensp_var_pos[b.ensp_id]),g("#var_cons").html("("+b.ensp_var_cons[b.ensp_id]+")"),g("#var_ensp_id").html(b.ensp_id),b.display_pdb_list(b.ensp_id)):(g(".var_pos").html(""),g("#var_cons").html(""),g("#var_ensp_id").html(""),g("#variant_pos_info").hide())}));g("#pdb_list").change(function(){var c=g(this).val();b.selectPDBEntry(c)});g(L).on("click",".pdb_feature_group",function(){g(this).toggleClass("view_enabled view_disabled");b.selectedFeatureGroupsToHighlight(g(this).attr("id"))});g(L).on("click",".pdb_feature_subgroup",function(){g(this).toggleClass("view_enabled view_disabled");b.selectedFeatureSubGroupsToHighlight(g(this).attr("id"))});g(L).on("click",".pdb_feature_entry",function(){g(this).toggleClass("view_enabled view_disabled");b.selectedFeaturesToHighlight()});g(L).on("click",".view_toggle",function(){var c="#"+g(this).attr("rel")+"_div";g(this).hasClass("closed")?g(c).show():g(c).hide();g(this).toggleClass("open closed")});g(L).on("click",".viewer_reset_btn",function(){g(".view_spinner").show();setTimeout(function(){b.liteMolScope.LiteMolComponent.Bootstrap.Command.Visual.ResetScene.dispatch(b.liteMolScope.LiteMolComponent.plugin.context,void 0);b.setDefaultHighlighting();b.selectedFeatureGroupsToHighlight()},b.spinner_waiting_time)})})},setDefaultHighlighting:function(){g(".view_enabled").switchClass("view_enabled","view_disabled");g("#mapping_group").switchClass("view_disabled","view_enabled");this.var_id&&g("#variant_group").switchClass("view_disabled","view_enabled")},selectPDBEntry:function(b){var c=this;console.log(">>>>> STEP 10: Select PDB entry (selectPDBEntry) - start");c.setDefaultHighlighting();if(b){var f=g("#pdb_list").find("option:selected");c.pdb_id=b;c.pdb_start=Number(f.attr("data-start"));c.pdb_end=Number(f.attr("data-end"));c.pdb_chains=f.attr("data-chain").split(",");c.pdb_hit_start=Number(f.attr("data-hit-start"));c.pdb_pr_name=f.attr("data-pdb-pr-name").split(",");c.pdb_author_start=f.attr("data-author-start")?Number(f.attr("data-author-start")):c.pdb_hit_start;c.pdb_author_end=f.attr("data-author-end")?Number(f.attr("data-author-end")):Number(f.attr("data-hit-end"));console.log("    # PDB coords of "+b+" (on ENSP): "+c.pdb_start+
"-"+c.pdb_end);g("#mapping_top_ensp").html('Ensembl protein: <a href="/'+c.species+"/Transcript/Summary?t="+c.ensp_id+'">'+c.ensp_id+"</a>");g("#mapping_top_pdb").html('PDBe model: <a href="'+c.pdbe_url_root+"/entry/pdb/"+b+'" rel="external">'+b.toUpperCase()+"</a>");c.pdb_pr_name&&(f=1<f.attr("data-chain").length?"s":"",g("#mapping_top_pdb_protein_name").html("("+c.pdb_pr_name+" - chain"+f+" "+c.pdb_chains+")"));g("#mappings_top").show();g("#mapping_ensp").html(c.ensp_id);g("#mapping_pdb").html(b.toUpperCase());if(c.var_id){b=c.ensp_var_pos[c.ensp_id].split("-");var h=c.ensp_to_pdb_coords(b[0],b[1]);f=c.ensp_to_pdb_coords(b[0],b[1],1);g("#focus_variant_cb").attr("data-value",h[0]+","+h[1]);var k=c.ensp_var_cons[c.ensp_id];!k||"stop_gained"!=k&&"frameshift_variant"!=k||(h='<tr>  <td style="border-color:darkred">Altered/missing sequence</td>  <td>from '+f[0]+"</td><td>from "+b[1]+'</td>  <td><span class="pdb_feature_entry float_left view_enabled" id="focus_variant_alt_cb" data-value="'+(Number(h[1])+1)+","+
c.pdb_end+'" data-group="variant_group" data-name="focus_variant_alt" data-colour="darkred"></span>  </td></tr>',g("#var_details_div > table > tbody").find("tr:gt(0)").remove(),g("#var_details_div > table > tbody").append(h));f=f[0]==f[1]?f[0]:f[0]+"-"+f[1];g("#var_pos_pdb").html(f);b=b[0]==b[1]?b[0]:b[0]+"-"+b[1];g("#var_pos_ensp").html(b);console.log("  >>> STEP 11a: Select PDB entry (selectPDBEntry) - variant setup done")}else console.log("  >>> STEP 11b: Select PDB entry (selectPDBEntry) - done");b=c.ensp_to_pdb_coords(c.pdb_start,c.pdb_end);g("#mapping_cb").attr("data-value",b[0]+","+b[1]);g("#mapping_ensp_pos").html(c.pdb_start+"-"+c.pdb_end);b=c.ensp_to_pdb_coords(c.pdb_start,c.pdb_end,1);g("#mapping_pdb_pos").html(b[0]+"-"+b[1]);c.load3DWidget();c.ensp_id&&(c.get_exon_data(c.ensp_id),c.get_protein_feature_data(c.ensp_id),c.get_sift_polyphen_data(c.ensp_id));LiteMol.Bootstrap.Event.Tree.NodeAdded.getStream(c.liteMolScope.LiteMolComponent.plugin.context).subscribe(function(l){"model"==l.data.ref&&(console.log(">>>>> STEP 12: Load 3D widget (selectPDBEntry) - done"),l=0,c.var_id||(l=c.pdb_end-c.pdb_start+1,l=800<l?800:100>l?100:10*Math.round(l/10)),setTimeout(function(){c.selectedFeatureGroupsToHighlight()},l),g("#litemol_buttons").show())})}else g("#litemol_buttons").hide()},load3DWidget:function(){this.removeComponents();var b='<pdb-lite-mol id="litemol_pdb_model" pdb-id="\''+this.pdb_id+'\'" hide-controls="true" show-logs="false"></pdb-lite-mol>';g("#litemol_canvas").html(b);b=g("#litemol_pdb_model");angular.bootstrap(b,["pdb.component.library"]);this.liteMolScope=angular.element(g("#litemol_pdb_model")).isolateScope()},removeComponents:function(){g("#litemol_canvas").empty()},selectedFeatureGroupsToHighlight:function(b){var c=this;b||(b="_group");var f=0;/(sift|polyphen)/.test(b)&&(g(".view_spinner").show(),f=c.spinner_waiting_time);setTimeout(function(){g("div[id$="+b+"]").each(function(){var h=g(this).attr("id"),k=g("#"+h).hasClass("view_enabled");g('[data-group="'+h+'"]').each(function(){k?g(this).switchClass("view_disabled","view_enabled"):g(this).switchClass("view_enabled","view_disabled")})});c.selectedFeaturesToHighlight();g(".view_spinner").is(":visible")&&g(".view_spinner").hide()},f)},selectedFeatureSubGroupsToHighlight:function(b){var c=this;b||(b="_sg");var f=/(sift|polyphen)/,h=0;f.test(b)&&(g(".view_spinner").show(),h=c.spinner_waiting_time);setTimeout(function(){g("div[id$="+b+"]").each(function(){var k=g(this).attr("id"),l=g("#"+k).hasClass("view_enabled");g('[data-sg="'+
k+'"]').each(function(){l?g(this).switchClass("view_disabled","view_enabled"):g(this).switchClass("view_enabled","view_disabled")})});c.selectedFeaturesToHighlight();f.test(b)&&g(".view_spinner").hide()},h)},selectedFeaturesToHighlight:function(){var b=this;if(b.liteMolScope){var c={base:b.hexa_to_rgb.dark_grey,entries:[]},f=b.liteMolScope.LiteMolComponent.plugin.context.select("model")[0];if(f){c=LiteMolPluginInstance.CustomTheme.createTheme(f.props.model,c);LiteMolPluginInstance.CustomTheme.applyTheme(b.liteMolScope.LiteMolComponent.plugin,"polymer-visual",c);c=["A"];b.pdb_chains&&b.pdb_chain_struc_entity[b.pdb_id]&&(c=b.pdb_chains);f=g(".pdb_feature_entry");var h="";f.each(function(t,v){if(v.classList.contains("pdb_var_entry"))return h=t,!1});if(""!=h){var k=f.splice(h,1);f.push(k[0])}c=b.features2LiteMol(f,c);k=c[0];c=c[1];if(f=b.liteMolScope.LiteMolComponent.plugin.context.select("model")[0]){var l=LiteMolPluginInstance.CustomTheme.createTheme(f.props.model,{base:b.hexa_to_rgb.dark_grey,entries:k});if(0<c.length){k=b.liteMolScope.LiteMolComponent.Transform.build();for(var p=0,q=c.length;p<q;p++){var m=b.liteMolScope.LiteMolComponent.Query.sequence(c[p].entity_id.toString(),c[p].struct_asym_id.toString(),{seqNumber:c[p].start_residue_number},{seqNumber:c[p].end_residue_number});c[p].checked&&k.add(f,b.liteMolScope.LiteMolComponent.Transformer.Molecule.CreateSelectionFromQuery,{query:m,name:"Selection-"+p},{ref:"sequence-selection-"+p}).then(b.liteMolScope.LiteMolComponent.Transformer.Molecule.CreateVisual,{style:b.liteMolScope.LiteMolComponent.Visualization.Molecule.Default.ForType.get("BallsAndSticks")})}b.liteMolScope.LiteMolComponent.applyTransforms(k).then(function(){LiteMolPluginInstance.CustomTheme.applyTheme(b.liteMolScope.LiteMolComponent.plugin,"polymer-visual",l)})}else 0<k.length&&LiteMolPluginInstance.CustomTheme.applyTheme(b.liteMolScope.LiteMolComponent.plugin,"polymer-visual",l);console.log(">>>>> STEP 14: Highlight selected features (selectedFeaturesToHighlight) - done")}}}},features2LiteMol:function(b,c){var f=this,h=[],k=[],l={};b.each(function(p,q){p=q.getAttribute("data-group");var m=g(this).hasClass("view_enabled");if(!l[p]){var t=g('[data-group="'+p+'"]'),v=0;t.each(function(){g(this).hasClass("view_enabled")&&v++});v==t.length?(g("#"+p).switchClass("view_disabled","view_enabled"),g("#"+p+"[data-has-sg]").length&&g('[data-super-group="'+p+'"]').switchClass("view_disabled","view_enabled")):(g("#"+p).switchClass("view_enabled","view_disabled"),g("#"+p+"[data-has-sg]").length&&0==v&&g('[data-super-group="'+p+'"]').switchClass("view_enabled","view_disabled"));l[p]=1}var w=q.getAttribute("data-highlight");if(m||w){var z=q.getAttribute("data-colour").split(";");q=q.getAttribute("data-value").split(";");g.each(q,function(B,D){D=D.split(",");for(var E=Number(D[0]);E<=Number(D[1]);E++)for(var G=E,I=E,K=z[B],S=0;S<c.length;S++){var U=c[S],T=U,V=1;f.pdb_chain_struc_entity[f.pdb_id]&&f.pdb_chain_struc_entity[f.pdb_id][U]&&(V=f.pdb_chain_struc_entity[f.pdb_id][U].entity_id,T=f.pdb_chain_struc_entity[f.pdb_id][U].struct_asym_id);U={entity_id:V,struct_asym_id:T,start_residue_number:G,end_residue_number:I,color:f.hexa_to_rgb[K],checked:m};m&&h.push(U);typeof w!==typeof R&&!1!==w&&null!==w&&1==w.split(";")[B]&&k.push(U)}})}});return[h,k]},get_all_pdb_list:function(){var b=this;console.log(">>>>> STEP 06: Get all the PDB lists (get_all_pdb_list) - start");g("#pdb_list_label").hide();g("#pdb_list").hide();g("#right_form").addClass("loader_small");var c=[],f=[];g.each(b.ensp_list,function(h,k){if(b.var_id&&b.ensp_var_pos[k]||!b.var_id)c.push(b.get_pdb_by_ensp(k)),f.push(k)});b.ensp_list.length!=f.length&&(b.ensp_list=f);g.when.apply(R,c).then(function(h){var k=[];g.each(b.ensp_list,function(l,p){if(b.protein_features[p].pdb&&0!=b.protein_features[p].pdb.length){var q=b.ensp_var_pos[p];g.each(b.protein_features[p].pdb,function(m,t){m=t.id.split(".")[0];if(-1==g.inArray(m,k)){var v=0;if(q){var w=q.split("-");w[0]>=t.start&&w[1]<=t.end&&(v=1)}if(q&&1==v||!q)b.ensp_id==R&&(b.ensp_id=p),k.push(m)}})}else b.no_pdb_list_available(p)});0<k.length?b.get_pdb_extra_data(k):b.no_mapping_available()})},get_pdb_extra_data:function(b){var c=this;g.when(c.get_pdb_quality_score(b),c.get_pdb_chain_struc_entity(b)).then(function(){var f=[];g.each(c.ensp_list,function(k,l){c.parse_pdb_results(l);c.ensp_pdb_list[l]&&g.each(c.ensp_pdb_list[l],function(p,q){c.pdb_chain_struc_entity[q.id]&&f.push(q.id+"#"+l)})});var h=[];g.each(f,function(k,l){k=l.split("#");h.push(c.get_pdb_author_pos(k[0],k[1]))});g.when.apply(R,h).then(function(){console.log("  >>> STEP 08c: PDB author coordinates (get_pdb_author_pos) - done");c.finish_parse_pdb_results()},function(){c.no_mapping_available()})})},get_pdb_by_ensp:function(b){var c=this;c.protein_features[b]={pdb:[]};return g.ajax({url:c.rest_pr_url+b+"?feature=protein_feature",method:"GET",contentType:"application/json; charset=utf-8"}).done(function(f){g.each(f,function(h,k){var l=k.type;h=k.end-k.start+1;var p=k.hit_end-k.hit_start+1;if(c.protein_sources[l]||null==l||"sifts"==l){if(null==l||"sifts"==l){l=p/c.ensp_length[b]*100;if(p<c.mapping_min_length||p<c.mapping_min_percent_length&&l<c.mapping_min_percent||h!=p)return!0;l="pdb"}c.protein_features[b][l]?c.protein_features[b][l].push(k):c.protein_features[b][l]=[k]}});console.log(">>>>> STEP 07: Get list of PDBs by ENSP - "+
b+" (get_pdb_by_ensp) - done")}).fail(function(f,h,k){console.log("ErrorText: "+h+"\n");console.log("thrownError: "+k+"\n")})},get_pdb_quality_score:function(b){var c=this;return g.ajax({type:"POST",url:c.rest_pdbe_quality_url,data:b.join(",")}).done(function(f){g.each(f,function(h,k){c.ensp_pdb_quality_list[h]=k.overall_quality;console.log("    > Quality for "+h+": "+c.ensp_pdb_quality_list[h])});console.log("  >>> STEP 08a: Get PDB quality (get_pdb_quality_score) - done")}).fail(function(f,h,k){console.log("ErrorText: "+
h+"\n");console.log("thrownError: "+k+"\n")})},get_pdb_chain_struc_entity:function(b){var c=this;return g.ajax({type:"POST",url:c.rest_pdbe_url,data:b.join(",")}).done(function(f){g.each(f,function(h,k){g.each(k,function(l,p){var q=p.entity_id;if("polypeptide(L)"!=p.molecule_type||!q)return!0;g.each(p.in_chains,function(m,t){var v=p.in_struct_asyms[0];p.in_struct_asyms[m]&&0!=m&&(v=p.in_struct_asyms[m]);c.pdb_chain_struc_entity[h]||(c.pdb_chain_struc_entity[h]={});c.pdb_chain_struc_entity[h][t]={struct_asym_id:v,entity_id:q,molecule_name:p.molecule_name}})})});console.log("  >>> STEP 08b: Get PDB chain info (get_pdb_chain_struc_entity) - done")}).fail(function(f,h,k){console.log("ErrorText: "+h+"\n");console.log("thrownError: "+k+"\n")})},get_pdb_author_pos:function(b,c){var f=this,h;g.each(f.ensp_pdb_list[c],function(l,p){if(p.id==b)return h=p.chain[0],!1});var k=f.pdb_chain_struc_entity[b][h].entity_id;return g.ajax({url:f.rest_pdbe_sifts_url+b,method:"GET"}).done(function(l){var p=0,q,m,t=0,v=0,w,z;g.each(l[b].Ensembl,function(B,D){g.each(D.mappings,function(E,G){if(G.translation_id==c&&(p=1,G.entity_id==k&&G.chain_id==h)){E=G.start.residue_number;var I=G.end.residue_number,K=G.start.author_residue_number;G=G.end.author_residue_number;K==R&&(t=1);G==R&&(v=1);if(w==R||E<w)w=E,q=K?K:1;if(z==R||I>z)z=I,m=G?G:z}});if(1==p)return!1});q&&m&&(0==t||0==v)&&(f.ensp_pdb_author_pos[c]||(f.ensp_pdb_author_pos[c]={pdb_id:{}}),f.ensp_pdb_author_pos[c][b]={start:q,end:m})}).fail(function(l,p,q){console.log("ErrorText: "+p+"\n");console.log("thrownError: "+q+"\n")})},parse_pdb_results:function(b){var c=this;c.removeSpinner();var f=[],h=[],k={},l=c.protein_features[b].pdb;g.each(l,function(p,q){q=q.id.split(".");p=q[0];q=q[1];k[p]&&-1==g.inArray(q,k[p])?k[p].push(q):k[p]=[q]});g.each(l,function(p,q){p=q.id.split(".")[0];if(-1==g.inArray(p,f)){var m=q.end-q.start+1;h.push({id:p,start:q.start,end:q.end,chain:k[p].sort(),size:m,hit_start:q.hit_start,hit_end:q.hit_end,author_start:R,author_end:R,overall_quality:c.ensp_pdb_quality_list[p]});f.push(p)}});h&&0!=h.length&&(h.sort(function(p,q){return q.size-p.size||q.overall_quality-p.overall_quality}),c.ensp_pdb_list[b]=h.slice(0,c.max_pdb_entries))},finish_parse_pdb_results:function(){var b=this,c=0;console.log("  >>> STEP 09a: Start parse PDBs results (finish_parse_pdb_results)");g.each(b.ensp_pdb_list,function(f,h){var k=[];g.each(h,function(l,p){l=0;if(b.ensp_pdb_author_pos[f]){var q=p.hit_end-p.hit_start;b.ensp_pdb_author_pos[f][p.id]&&q==b.ensp_pdb_author_pos[f][p.id].end-b.ensp_pdb_author_pos[f][p.id].start&&(p.author_start=b.ensp_pdb_author_pos[f][p.id].start,p.author_end=b.ensp_pdb_author_pos[f][p.id].end,l=1)}0==l&&k.push(p)});k.length&&g.each(k,function(l,p){console.log("    > Entry "+p.id+" removed from the list");b.ensp_pdb_list[f].splice(g.inArray(p,b.ensp_pdb_list[f]),1)});0<Object.keys(b.ensp_pdb_list[f]).length?(h={value:f,text:f},f==b.ensp_id&&(h.selected="selected",g("#var_cons").html("("+b.ensp_var_cons[b.ensp_id]+")"),b.display_pdb_list(f)),g("#ensp_list").append(g("<option>",h)),c++):b.no_pdb_list_available(f)});0==c&&b.no_mapping_available();console.log("  >>> STEP 09b: Finish parse PDBs results (finish_parse_pdb_results) - done")},no_pdb_list_available:function(b){b==this.ensp_id&&1<this.ensp_list.length&&(this.ensp_id=R)},no_mapping_available:function(){this.removeSpinner();var b=1<this.ensp_list.length?':<ul class="top-margin bottom-margin"><li>'+this.ensp_list.join("</li><li>")+"</li></ul>":this.ensp_list[0]+".";Object.keys(this.ensp_var_pos).length?this.showNoData("No PDB models overlapping this variant on the following protein(s) have been found/selected: "+
b):this.showNoData("No PDB models mappings have been found/selected for the  protein(s) "+b);console.log(">>>>> STEP 99: No ENSP-PDB mappings found/retained (no_mapping_available)")},display_pdb_list:function(b){var c=this;c.removeSpinner();if(g.isEmptyObject(c.ensp_pdb_list)||!c.ensp_pdb_list[b])c.showNoData();else{g(".var_pos").length&&(g(".var_pos").html(c.ensp_var_pos[b]),g("#var_cons").html("("+c.ensp_var_cons[b]+")"),g("#var_ensp_id").html(b));var f=c.ensp_pdb_list[b],h=f.length;g("#right_form").removeClass("loader_small");g("#pdb_list_label").hide();g("#pdb_list").hide();g("#pdb_list").html("");var k,l=0,p=1;g("#pdb_list").html("");g.each(f,function(q,m){q=Math.round((m.end-m.start+1)/c.ensp_length[b]*100);var t=[];g.each(m.chain,function(v,w){v=c.pdb_chain_struc_entity[m.id][w].molecule_name;-1==g.inArray(v,t)&&t.push(v)});q={value:m.id,"data-start":m.start,"data-end":m.end,"data-hit-start":m.hit_start,"data-chain":m.chain,"data-pdb-pr-name":t,text:m.id+(" - Coverage: [ PDBe: "+m.author_start+"-"+m.author_end+" | ENSP: "+
m.start+"-"+m.end+" ] => "+q+"% of ENSP length")};(m.hit_start!=m.author_start||m.hit_end!=m.author_end)&&m.author_start&&m.author_end?(q["data-author-start"]=m.author_start,q["data-author-end"]=m.author_end):q["data-hit-end"]=m.hit_end;if(1==p||1==h)q.selected="selected",k=m.id,p=0;g("#pdb_list").append(g("<option>",q));l=1});l?(g("#pdb_list_label").show(),g("#pdb_list").show(),c.selectPDBEntry(k)):c.showNoData()}g("#ensp_pdb").show()},add_var_link:function(b){return'<a href="/'+this.species+"/Variation/Explore?v="+
b+'" target="_blank">'+b+"</a>"},get_var_ensp_data:function(){var b=this,c=this.getParameterByName("v"),f;c?f=c:g("#var_id").length&&(f=g("#var_id").html());b.var_id=f;g("#var_id").html(b.var_id);console.log(">>>>> STEP 01: Get Variant ID (get_var_ensp_data) - done");return g.ajax({url:b.rest_vep_url+b.var_id+"?protein=1",method:"GET",contentType:"application/json; charset=utf-8"}).done(function(h){console.log(">>>>> STEP 02: Get Variant data (get_var_ensp_data) - done");h=h[0].transcript_consequences;if(0<h.length){var k=[];g.each(h,function(l,p){p.protein_id&&(l=p.protein_id,-1==g.inArray(l,k)&&(k.push(l),b.ensp_var_pos[l]=p.protein_start+"-"+p.protein_end,b.ensp_var_cons[l]=p.consequence_terms[0],console.log("  >>> STEP 03a: Get Variant pos on "+l+" (get_var_ensp_data) - done")))})}g("#right_form").removeClass("loader_small");g("#ensp_list").html("");g("#pdb_list").html("");0==k.length?b.showNoData("No overlapping Ensembl protein found"):(k.sort(),b.ensp_list=k,b.ensp_id||(b.ensp_id=k[0]),console.log(">>>>> STEP 04: Get ENSP list (get_var_ensp_data) - done"))}).fail(function(h,k,l){console.log("ErrorText: "+k+"\n");console.log("thrownError: "+l+"\n");b.removeSpinner();b.showMsg()})},get_ensp_from_enst:function(b){var c=this;return g.ajax({url:c.rest_lookup_url+b+"?expand=1",method:"GET",contentType:"application/json; charset=utf-8"}).done(function(f){var h=f.Translation.id;c.ensp_id=h;c.ensp_list=[c.ensp_id];c.ensp_length[h]=f.Translation.length;console.log(">>>>> STEP 02: Get corresponding ENSP from ENST (get_ensp_from_enst) - done")}).fail(function(f,h,k){console.log("ErrorText: "+
h+"\n");console.log("thrownError: "+k+"\n");c.removeSpinner();c.showMsg()})},get_ens_protein_length:function(){var b=this;return g.ajax({type:"POST",url:b.rest_lookup_url,data:'{ "ids" : ["'+b.ensp_list.join('","')+'"], "db_type" : "core" }',dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(c){g.each(c,function(f,h){b.ensp_length[f]=h.length});console.log(">>>>> STEP 05: Get ENSP length (get_ens_protein_length) - done")}).fail(function(c,f,h){console.log("ErrorText: "+
f+"\n");console.log("thrownError: "+h+"\n");b.removeSpinner();b.showMsg()})},get_exon_data:function(b){var c=this;g.ajax({url:c.rest_pr_url+b+"?feature=translation_exon",method:"GET",contentType:"application/json; charset=utf-8",success:function(f){console.log("  >>> STEP 13a: Get Exon data (get_exon_data) - done");c.parse_exon_results(f)},error:function(f,h,k){console.log("ErrorText: "+h+"\n");console.log("thrownError: "+k+"\n")}})},parse_exon_results:function(b){var c=this;if(!b.error){var f="";g("#exon_details_div").html("");var h=0,k={};g.each(b,function(q,m){var t=m.start;m=m.end;if(t<c.pdb_start&&m<c.pdb_start||t>c.pdb_end&&m>c.pdb_end)return k[q]=1,!0;h++});var l=Object.keys(b).length,p=0;g.each(b,function(q,m){if(k[q])return!0;q+=1;var t=m.start;m=m.end;q==l&&m--;t<c.pdb_start&&m>c.pdb_start&&(t=c.pdb_start);m>c.pdb_end&&t<c.pdb_end&&(m=c.pdb_end);var v=c.ensp_to_pdb_coords(t,m);if(0==v.length)return!0;var w=c.ensp_to_pdb_coords(t,m,1),z=v[0];v=v[1];var B=w[0];w=w[1];var D=c.get_hexa_colour(p,h);f+='<tr><td style="border-color:'+D+'"><a href="/'+(c.species+"/Transcript/Exons?t="+c.ensp_id+'">Exon '+q+"</a></td><td>")+B+"-"+w+"</td><td>"+t+"-"+m+'</td><td><span class="pdb_feature_entry float_left view_disabled" id="exon_'+q+'_cb" data-value="'+(z+","+v)+'" data-group="exon_group" data-name="'+q+'" data-colour="'+D+'"></span></td></tr>';p++});c.render_selection_details("exon","exon",1<p?"Exons":"Exon",p,f)}},get_protein_feature_data:function(b){var c=this,f=0;g.each(Object.keys(this.protein_sources).sort(),function(h,k){c.protein_features[b][k]&&(c.parse_protein_feature_results(c.protein_features[b][k],k),f=1)});0==f&&g("#protein_block").html("<div>No protein annotation found</div>");console.log("  >>> STEP 13b: Get Proteins feature (get_protein_feature_data) - done")},parse_protein_feature_results:function(b,c){var f=this,h="",k=0,l=c.toLowerCase();b.sort(function(q,m){return q.start-m.start});var p=Object.keys(b).length;g.each(b,function(q,m){var t=m.start,v=m.end;t<f.pdb_start&&v>f.pdb_start&&(t=f.pdb_start);v>f.pdb_end&&t<f.pdb_end&&(v=f.pdb_end);var w=f.ensp_to_pdb_coords(t,v);if(0==w.length)return!0;var z=f.ensp_to_pdb_coords(t,v,1),B=w[0];w=w[1];var D=z[0];z=z[1];q=f.get_hexa_colour(q,p);var E=m.id;f.protein_sources[c]&&(E=f.protein_sources[c],E+="Gene3D"==c?f.ensp_id:m.id,E='<a href="'+E+'" rel="external">'+m.id+"</a>");h+='<tr><td style="border-color:'+q+'">'+E+"</td><td>"+D+"-"+z+"</td><td>"+t+"-"+v+'</td><td><span class="pdb_feature_entry float_left view_disabled" id="'+c+'_cb" data-value="'+
(B+","+w)+'" data-group="'+l+'_group" data-name="'+m.id+'" data-colour="'+q+'"></span></td></tr>';k++});f.render_selection_details("protein",l,c,k,h)},get_sift_polyphen_data:function(b){var c=this;g.ajax({url:c.rest_pr_url+b+"?feature=transcript_variation",method:"GET",contentType:"application/json; charset=utf-8"}).done(function(f){console.log("  >>> STEP 13c: Get SIFT and PolyPhen data (get_sift_polyphen_data) - done");c.parse_sift_results(f);c.parse_polyphen_results(f)}).fail(function(f,h,k){console.log("ErrorText: "+
h+"\n");console.log("thrownError: "+k+"\n")})},parse_sift_results:function(b){var c=this;b.sort(function(p,q){return p.start-q.start||q.sift-p.sift});var f="",h=0,k={score_good:"sift_1_sg",score_bad:"sift_2_sg"},l={};g.each(b,function(p,q){if(q.sift){var m=c.ensp_to_pdb_coords(q.start,q.end);if(0==m.length)return!0;p=c.ensp_to_pdb_coords(q.start,q.end,1);var t=m[0],v=m[1];m=p[0];p=p[1];p=t==v?m:m+"-"+p;m=q.start==q.end?q.start:q.start+"-"+q.end;var w=q.sift;t=t+","+v;v=q.residues;if(5<v.length){var z=v.substr(0,2)+"...";v='<span class="ht" title="'+v+'">'+z+"</span>"}z="score_good";var B="green";.05>=w&&(z="score_bad",B="red");l[z]=1;var D=c.add_var_link(q.id);f+='<tr><td style="border-color:'+B+'">'+D+"</td><td>"+p+"</td><td>"+m+"</td><td>"+v+'</td><td><div class="score '+z+'">'+w+'</div></td><td><span class="pdb_feature_entry float_left view_disabled" id="sift_'+q.id+'_cb" data-value="'+t+'" data-group="sift_group" data-name="'+q.id+'" data-colour="'+B+'" data-sg="'+k[z]+'"></span></td></tr>';h++}});b=c.build_legend(l,[{score_good:{id:k.score_good,"class":"score_bg_good",label:"Tolerated",title:"Greater than or equal to 0.05"}},{score_bad:{id:k.score_bad,"class":"score_bg_bad",label:"Deleterious",title:"Less than 0.05"}}],"sift");c.render_selection_details("variant","sift","SIFT",h,f,"Residues;Score",b,1)},parse_polyphen_results:function(b){var c=this;b.sort(function(p,q){return p.start-q.start||p.polyphen-q.polyphen});var f="",h=0,k={score_good:"polyphen_1_sg",score_ok:"polyphen_2_sg",score_bad:"polyphen_3_sg",score_neutral:"polyphen_4_sg"},l={};g.each(b,function(p,q){if(q.polyphen){var m=c.ensp_to_pdb_coords(q.start,q.end);if(0==m.length)return!0;p=c.ensp_to_pdb_coords(q.start,q.end,1);var t=m[0],v=m[1];m=p[0];p=p[1];p=t==v?m:m+"-"+p;m=q.start==q.end?q.start:q.start+"-"+q.end;var w=q.polyphen;t=t+","+v;v=q.residues;if(5<v.length){var z=v.substr(0,2)+"...";v='<span class="ht" title="'+v+'">'+z+"</span>"}z="score_neutral";var B="blue";.908<w?(z="score_bad",B="red"):.445<w&&.908>=w?(z="score_ok",B="orange"):.445>=w&&(z="score_good",B="green");l[z]=1;var D=c.add_var_link(q.id);f+='<tr><td style="border-color:'+B+'">'+D+"</td><td>"+p+"</td><td>"+m+"</td><td>"+v+'</td><td><div class="score '+z+'">'+w+'</div></td><td><span class="pdb_feature_entry float_left view_disabled" id="polyphen_'+q.id+'_cb" data-value="'+t+'" data-group="polyphen_group" data-name="'+q.id+'" data-colour="'+B+'" data-sg="'+k[z]+'"></span></td></tr>';h++}});b=c.build_legend(l,[{score_good:{id:k.score_good,"class":"score_bg_good",label:"Benign",title:"Less than or equal to 0.446"}},{score_ok:{id:k.score_ok,"class":"score_bg_ok",label:"Possibly Damaging",title:"Greater than 0.446 and less than or equal to 0.908"}},{score_bad:{id:k.score_bad,"class":"score_bg_bad",label:"Probably Damaging",title:"Greater than 0.908"}},{score_neutral:{id:k.score_neutral,"class":"score_bg_neutral",label:"Unknown",title:"Unknown"}}],"polyphen");c.render_selection_details("variant","polyphen","PolyPhen",h,f,"Residues;Score",b,1)},render_selection_details:function(b,c,f,h,k,l,p,q){b+="_block";var m=c+"_label",t=c+"_row",v=c+"_group";q=q?' data-has-sg="1"':"";var w=c+"_details",z=w+"_div";l=l?"<th>"+l.replace(";","</th><th>")+"</th>":"";view_col="<th></th>";p=p?p:"";h?(g("#"+m).length?c=g("#"+m):(c=g("<div></div>"),c.attr("id",m)),c.html('<div>  <h3 class="float_left">'+f+'</h3>  <div class="float_right view_toggle view_toggle_btn closed" rel="'+w+'"></div>  <div class="float_right pdb_feature_group view_disabled" title="Click to highlight / hide '+
f+' on the 3D viewer" id="'+v+'"'+q+'></div>  <div class="float_right view_badge" title="'+h+" "+f+" entr"+(1<h?"ies":"y")+" overlap"+(1<h?"":"s")+' this PDB model">'+h+'</div>  <div style="clear:both"></div></div><div class="'+w+'">  <div id="'+z+'" class="pdb_features_container toggleable" style="padding-top:5px;display:none">'+p+'    <table class="pdb_features"><thead><tr>'+this.details_header+l+view_col+"</tr></thead><tbody>"+k+"</tbody></table>  </div></div>"),g("#"+t).length||(f=g("<div></div>"),f.attr("id",t),f.append(c),g("#"+b).append(f))):g("#"+t).length&&g("#"+t).remove();g("._ht").helptip()},build_legend:function(b,c,f){var h="",k=b.length,l=0;g.each(c,function(p,q){g.each(q,function(m,t){b[m]&&(l++,h+='  <div class="float_left"'+(l==k?"":' style="margin-right:10px"')+'>    <div class="float_left _ht score_legend_left '+t["class"]+'" title="'+t.title+'">'+t.label+'</div>    <div class="float_left score_legend_right">      <div class="pdb_feature_subgroup view_disabled" title="Click to highlight / hide '+
(t.label+" "+f+' Variant" id="')+t.id+'" data-super-group="'+f+'_group"></div>    </div>    <div style="clear:both"></div>  </div>')})});return""==h?R:'<div class="pdb_legend">'+h+'  <div style="clear:both"></div></div>'},ensp_to_pdb_coords:function(b,c,f){b=Number(b);c=Number(c);var h,k,l=this.pdb_start,p=this.pdb_end;if(b<l&&c<l||b>p&&c>p)return[];f=f?this.pdb_author_start:this.pdb_hit_start;var q=f-this.pdb_start;b<l&&c>l&&(h=l+q);c>p&&b<p&&(k=p+q);h||(h=b+q);k||(k=c+q);h<f&&(h=f);return[h,k]},sin_to_hex:function(b,c,f){b=(Math.floor(127*Math.sin(Math.PI/f*2*b+c))+128).toString(16);return 1===b.length?"0"+b:b},get_hexa_colour:function(b,c){var f=this.sin_to_hex(b,0*Math.PI/3,c),h=this.sin_to_hex(b,2*Math.PI/3,c);b=this.sin_to_hex(b,4*Math.PI/3,c);f="#"+f+b+h;this.add_colour(f);return f},add_colour:function(b){if(!this.hexa_to_rgb[b]){var c=b.replace("#","");c=parseInt(c,16);this.hexa_to_rgb[b]={r:c>>16&255,g:c>>8&255,b:c&255}}},isOdd:function(b){return b%2},getParameterByName:function(b,c){c||(c=F.location.href);b=b.replace(/[\[\]]/g,"\\$&");return(b=(new RegExp("[?&]"+b+"(=([^&#]*)|&|#|$)")).exec(c))?b[2]?decodeURIComponent(b[2].replace(/\+/g," ")):"":null},showMsg:function(b){b=b?b:"Sorry, we are currently unable to get the data to display this view. Please try again later.";g("#ensp_pdb").html('<span class="left-margin right-margin">'+b+"</span>");g("#ensp_pdb").show()},showNoData:function(b){b||(b="No data available");this.showMsg(b)},addSpinner:function(){g("#pdb_msg").addClass("spinner")},removeSpinner:function(){g("#pdb_msg").removeClass("spinner")}});"Ensembl"in F&&"GA"in u&&(u.GA.domainCodes={"useast.ensembl.org":"UA-58710484-4","test-4.ensembl.org":"UA-58710484-1","test-3.ensembl.org":"UA-58710484-11","test-1.ensembl.org":"UA-58710484-7","test.ensembl.org":"UA-58710484-8","mtest.ensembl.org":"UA-58710484-10","uswest.ensembl.org":"UA-58710484-5","asia.ensembl.org":"UA-58710484-3","www.ensembl.org":"UA-58710484-2","m.ensembl.org":"UA-58710484-9","dev.ensembl.org":"UA-58710484-6","grch37.ensembl.org":"UA-58710484-14","grch37-test.ensembl.org":"UA-58710484-15","grch37-archive.ensembl.org":"UA-58710484-20","Jul2018.archive.ensembl.org":"UA-58710484-16","fungi.ensembl.org":"UA-64873293-2","metazoa.ensembl.org":"UA-64873293-3","plants.ensembl.org":"UA-64873293-1","protists.ensembl.org":"UA-64873293-4","bacteria.ensembl.org":"UA-64873293-5","covid-19.ensembl.org":"UA-58710484-18","rapid.ensembl.org":"UA-58710484-19"},u.GA.verbose=!0,u.GA.logAjaxLoadTimes=!0);"Ensembl"in F&&"HotJar"in
u&&(u.HotJar.hotjarIds={"www.ensembl.org":3280821,"bacteria.ensembl.org":3280832,"fungi.ensembl.org":3280835,"metazoa.ensembl.org":3280829,"plants.ensembl.org":3280824,"rapid.ensembl.org":3280838})})(jQuery,this,document);
